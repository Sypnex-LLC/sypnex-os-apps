{
  "app_metadata": {
    "id": "flow_editor",
    "name": "Flow Editor",
    "description": "Visual node-based workflow editor for creating and executing data processing pipelines",
    "icon": "fas fa-project-diagram",
    "keywords": [
      "flow",
      "workflow",
      "nodes",
      "pipeline",
      "visual",
      "editor"
    ],
    "author": "Sypnex OS",
    "version": "1.0.3",
    "type": "user_app",
    "scripts": [
      "js/utils.js",
      "js/node-registry.js",
      "js/canvas.js",
      "js/node-config.js",
      "js/node-renderer.js",
      "js/data-executors.js",
      "js/http-executors.js",
      "js/media-executors.js",
      "js/flow-executors.js",
      "js/ai-executors.js",
      "js/execution-engine.js",
      "js/workflow.js",
      "js/canvas-manager.js",
      "js/tag-manager.js",
      "js/file-manager.js",
      "js/ui-manager.js",
      "js/main.js"
    ],
    "styles": [
      "css/layout.css",
      "css/nodes.css",
      "css/components.css",
      "css/node-types.css",
      "css/responsive.css"
    ],
    "additional_files": [
      {
        "vfs_path": "/nodes/nodes-pack.json",
        "source_file": "node-definitions/nodes-pack.json"
      }
    ],
    "settings": [
      {
        "key": "DEFAULT_HTTP_TIMEOUT",
        "name": "HTTP Timeout (ms)",
        "type": "number",
        "value": 30000,
        "description": "Default timeout for HTTP requests in milliseconds"
      },
      {
        "key": "AUTO_SAVE_INTERVAL",
        "name": "Auto Save Interval (s)",
        "type": "number",
        "value": 30,
        "description": "Auto save workflows every N seconds (0 = disabled)"
      },
      {
        "key": "MAX_NODES",
        "name": "Maximum Nodes",
        "type": "number",
        "value": 50,
        "description": "Maximum number of nodes allowed in a workflow"
      }
    ]
  },
  "files": {
    "flow_editor.app": "ew0KICAiaWQiOiAiZmxvd19lZGl0b3IiLA0KICAibmFtZSI6ICJGbG93IEVkaXRvciIsDQogICJkZXNjcmlwdGlvbiI6ICJWaXN1YWwgbm9kZS1iYXNlZCB3b3JrZmxvdyBlZGl0b3IgZm9yIGNyZWF0aW5nIGFuZCBleGVjdXRpbmcgZGF0YSBwcm9jZXNzaW5nIHBpcGVsaW5lcyIsDQogICJpY29uIjogImZhcyBmYS1wcm9qZWN0LWRpYWdyYW0iLA0KICAia2V5d29yZHMiOiBbImZsb3ciLCAid29ya2Zsb3ciLCAibm9kZXMiLCAicGlwZWxpbmUiLCAidmlzdWFsIiwgImVkaXRvciJdLA0KICAiYXV0aG9yIjogIlN5cG5leCBPUyIsDQogICJ2ZXJzaW9uIjogIjEuMC4zIiwNCiAgInR5cGUiOiAidXNlcl9hcHAiLA0KICAic2NyaXB0cyI6IFsNCiAgICAianMvdXRpbHMuanMiLA0KICAgICJqcy9ub2RlLXJlZ2lzdHJ5LmpzIiwNCiAgICAianMvY2FudmFzLmpzIiwNCiAgICAianMvbm9kZS1jb25maWcuanMiLA0KICAgICJqcy9ub2RlLXJlbmRlcmVyLmpzIiwNCiAgICAianMvZGF0YS1leGVjdXRvcnMuanMiLA0KICAgICJqcy9odHRwLWV4ZWN1dG9ycy5qcyIsDQogICAgImpzL21lZGlhLWV4ZWN1dG9ycy5qcyIsDQogICAgImpzL2Zsb3ctZXhlY3V0b3JzLmpzIiwNCiAgICAianMvYWktZXhlY3V0b3JzLmpzIiwNCiAgICAianMvZXhlY3V0aW9uLWVuZ2luZS5qcyIsDQogICAgImpzL3dvcmtmbG93LmpzIiwNCiAgICAianMvY2FudmFzLW1hbmFnZXIuanMiLA0KICAgICJqcy90YWctbWFuYWdlci5qcyIsDQogICAgImpzL2ZpbGUtbWFuYWdlci5qcyIsDQogICAgImpzL3VpLW1hbmFnZXIuanMiLA0KICAgICJqcy9tYWluLmpzIg0KICBdLA0KICAic3R5bGVzIjogWw0KICAgICJjc3MvbGF5b3V0LmNzcyIsDQogICAgImNzcy9ub2Rlcy5jc3MiLA0KICAgICJjc3MvY29tcG9uZW50cy5jc3MiLA0KICAgICJjc3Mvbm9kZS10eXBlcy5jc3MiLA0KICAgICJjc3MvcmVzcG9uc2l2ZS5jc3MiDQogIF0sDQogICJhZGRpdGlvbmFsX2ZpbGVzIjogWw0KICAgIHsNCiAgICAgICJ2ZnNfcGF0aCI6ICIvbm9kZXMvbm9kZXMtcGFjay5qc29uIiwNCiAgICAgICJzb3VyY2VfZmlsZSI6ICJub2RlLWRlZmluaXRpb25zL25vZGVzLXBhY2suanNvbiINCiAgICB9DQogIF0sDQogICJzZXR0aW5ncyI6IFsNCiAgICB7DQogICAgICAia2V5IjogIkRFRkFVTFRfSFRUUF9USU1FT1VUIiwNCiAgICAgICJuYW1lIjogIkhUVFAgVGltZW91dCAobXMpIiwNCiAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAidmFsdWUiOiAzMDAwMCwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEZWZhdWx0IHRpbWVvdXQgZm9yIEhUVFAgcmVxdWVzdHMgaW4gbWlsbGlzZWNvbmRzIg0KICAgIH0sDQogICAgew0KICAgICAgImtleSI6ICJBVVRPX1NBVkVfSU5URVJWQUwiLA0KICAgICAgIm5hbWUiOiAiQXV0byBTYXZlIEludGVydmFsIChzKSIsDQogICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgInZhbHVlIjogMzAsDQogICAgICAiZGVzY3JpcHRpb24iOiAiQXV0byBzYXZlIHdvcmtmbG93cyBldmVyeSBOIHNlY29uZHMgKDAgPSBkaXNhYmxlZCkiDQogICAgfSwNCiAgICB7DQogICAgICAia2V5IjogIk1BWF9OT0RFUyIsDQogICAgICAibmFtZSI6ICJNYXhpbXVtIE5vZGVzIiwNCiAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAidmFsdWUiOiA1MCwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJNYXhpbXVtIG51bWJlciBvZiBub2RlcyBhbGxvd2VkIGluIGEgd29ya2Zsb3ciDQogICAgfQ0KICBdDQp9",
    "flow_editor.html": "PGRpdiBjbGFzcz0iYXBwLWNvbnRhaW5lciI+DQogICAgPGRpdiBjbGFzcz0iYXBwLWhlYWRlciI+DQogICAgICAgIDxoMj48aSBjbGFzcz0iZmFzIGZhLXByb2plY3QtZGlhZ3JhbSI+PC9pPiBGbG93IEVkaXRvcjwvaDI+DQogICAgICAgIDxwPkNyZWF0ZSBhbmQgZXhlY3V0ZSBub2RlLWJhc2VkIHdvcmtmbG93cyAtIFdJUDwvcD4NCiAgICA8L2Rpdj4NCg0KICAgIDxkaXYgY2xhc3M9ImFwcC1jb250ZW50Ij4NCiAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy1lZGl0b3IiPg0KICAgICAgICAgICAgPCEtLSBMZWZ0IFRvb2xib3ggLS0+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LXRvb2xib3giIGlkPSJmbG93LXRvb2xib3giPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2xib3gtaGVhZGVyIj4NCiAgICAgICAgICAgICAgICAgICAgPGg0PjxpIGNsYXNzPSJmYXMgZmEtdG9vbHMiPjwvaT4gTm9kZXM8L2g0Pg0KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJ0b2dnbGUtdG9vbGJveCIgY2xhc3M9ImJ0biBidG4tc20gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0aXRsZT0iQ29sbGFwc2UgVG9vbGJveCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tbGVmdCI+PC9pPg0KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sYm94LWNvbnRlbnQiIGlkPSJ0b29sYm94LWNvbnRlbnQiPg0KICAgICAgICAgICAgICAgICAgICA8IS0tIE5vZGVzIHdpbGwgYmUgbG9hZGVkIGR5bmFtaWNhbGx5IGZyb20gVkZTIC0tPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2FkaW5nLW5vZGVzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LW11dGVkIj5Mb2FkaW5nIG5vZGVzLi4uPC9wPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KDQogICAgICAgICAgICA8IS0tIE1haW4gd29ya3NwYWNlIC0tPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy13b3Jrc3BhY2UiPg0KICAgICAgICAgICAgICAgIDwhLS0gVG9vbGJhciAtLT4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LXRvb2xiYXIiPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sYmFyLWxlZnQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0icnVuLXdvcmtmbG93IiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBsYXkiPjwvaT4gUnVuIFdvcmtmbG93DQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InN0b3Atd29ya2Zsb3ciIGNsYXNzPSJidG4gYnRuLWRhbmdlciIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXN0b3AiPjwvaT4gU3RvcA0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjdXJyZW50LWZpbGUtaW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImN1cnJlbnQtZmlsZW5hbWUiIGNsYXNzPSJjdXJyZW50LWZpbGVuYW1lIj51bnRpdGxlZC5mbG93PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbGJhci1yaWdodCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJhZGQtdGFnIiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXN1Y2Nlc3MiIHRpdGxlPSJBZGQgQXJlYSBUYWciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGFnIj48L2k+IFRhZw0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJyZXNldC1wYW4iIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0aXRsZT0iUmVzZXQgVmlldyAoUGFuICYgWm9vbSkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY3Jvc3NoYWlycyI+PC9pPiBSZXNldCBWaWV3DQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Inpvb20tY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Inpvb20tb3V0IiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgdGl0bGU9Ilpvb20gT3V0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zZWFyY2gtbWludXMiPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iem9vbS1sZXZlbCIgY2xhc3M9Inpvb20tbGV2ZWwiPjEwMCU8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iem9vbS1pbiIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJab29tIEluIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zZWFyY2gtcGx1cyI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Inpvb20tZml0IiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgdGl0bGU9Ilpvb20gdG8gRml0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leHBhbmQtYXJyb3dzLWFsdCI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJzYXZlLWZsb3ciIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2F2ZSI+PC9pPiBTYXZlDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InNhdmUtZmxvdy1hcyIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1wcmltYXJ5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNhdmUiPjwvaT4gU2F2ZSBBcw0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJsb2FkLWZsb3ciIGNsYXNzPSJidG4gYnRuLXNlY29uZGFyeSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1mb2xkZXItb3BlbiI+PC9pPiBMb2FkDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImRlbGV0ZS1zZWxlY3RlZCIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1kYW5nZXIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJhc2giPjwvaT4gRGVsZXRlDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImNsZWFyLWNhbnZhcyIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0Ij48L2k+IENsZWFyIEFsbA0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KDQogICAgICAgICAgICAgICAgPCEtLSBNYWluIGNhbnZhcyBhcmVhIC0tPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctY2FudmFzLWNvbnRhaW5lciI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImZsb3ctY2FudmFzIiBjbGFzcz0iZmxvdy1jYW52YXMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBOb2RlcyB3aWxsIGJlIGFkZGVkIGhlcmUgZHluYW1pY2FsbHkgLS0+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgIDwhLS0gQ29uZmlndXJhdGlvbiBwYW5lbCAtLT4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctY29uZmlnLXBhbmVsIiBpZD0iZmxvdy1jb25maWctcGFuZWwiPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1oZWFkZXIiPg0KICAgICAgICAgICAgICAgICAgICA8aDQ+PGkgY2xhc3M9ImZhcyBmYS1jb2ciPjwvaT4gQ29uZmlndXJhdGlvbjwvaDQ+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InRvZ2dsZS1jb25maWciIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgdGl0bGU9IkNvbGxhcHNlIENvbmZpZ3VyYXRpb24gUGFuZWwiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLXJpZ2h0Ij48L2k+DQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1jb250ZW50IiBpZD0iY29uZmlnLWNvbnRlbnQiPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJub2RlLWNvbmZpZyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1tdXRlZCI+U2VsZWN0IGEgbm9kZSB0byBjb25maWd1cmUgaXQ8L3A+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ0YWctcGFuZWwiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGg1PjxpIGNsYXNzPSJmYXMgZmEtdGFncyI+PC9pPiBBcmVhIFRhZ3M8L2g1Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbXV0ZWQiPk5vIHRhZ3MgeWV0PC9wPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCg0KICAgICAgICA8IS0tIE91dHB1dCBwYW5lbCAtLT4NCiAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy1vdXRwdXQtcGFuZWwgY29sbGFwc2VkIiBpZD0iZmxvdy1vdXRwdXQtcGFuZWwiPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3V0cHV0LWhlYWRlciI+DQogICAgICAgICAgICAgICAgPGg0PjxpIGNsYXNzPSJmYXMgZmEtdGVybWluYWwiPjwvaT4gRXhlY3V0aW9uIE91dHB1dDwvaDQ+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3V0cHV0LWNvbnRyb2xzIj4NCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0idG9nZ2xlLW91dHB1dCIgY2xhc3M9ImJ0biBidG4tc20gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0aXRsZT0iU2hvdy9IaWRlIE91dHB1dCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tZG93biI+PC9pPg0KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY2xlYXItb3V0cHV0IiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tb3V0bGluZS1zZWNvbmRhcnkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPiBDbGVhcg0KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3V0cHV0LWNvbnRlbnQiIGlkPSJvdXRwdXQtY29udGVudCIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJleGVjdXRpb24tb3V0cHV0IiBjbGFzcz0iZXhlY3V0aW9uLW91dHB1dCI+DQogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LW11dGVkIj5Xb3JrZmxvdyBvdXRwdXQgd2lsbCBhcHBlYXIgaGVyZTwvcD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCjwvZGl2Pg0KPHN0eWxlPi8qID09PT09IFN0eWxlOiBjc3MvbGF5b3V0LmNzcyA9PT09PSAqLw0KLyogRmxvdyBFZGl0b3IgTGF5b3V0ICYgU3RydWN0dXJlICovDQoNCi8qIEZsb3cgRWRpdG9yIExheW91dCAqLw0KLmZsb3ctZWRpdG9yIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGhlaWdodDogNzB2aDsNCiAgICBnYXA6IDA7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KLyogTGVmdCBUb29sYm94ICovDQouZmxvdy10b29sYm94IHsNCiAgICB3aWR0aDogMjUwcHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgZmxleC1zaHJpbms6IDA7DQp9DQoNCi50b29sYm94LWhlYWRlciB7DQogICAgcGFkZGluZzogMTVweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQoudG9vbGJveC1oZWFkZXIgaDQgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LXNpemU6IDE2cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KfQ0KDQojdG9nZ2xlLXRvb2xib3ggew0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQojdG9nZ2xlLXRvb2xib3g6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCi8qIENvbGxhcHNlZCBzdGF0ZSAqLw0KLmZsb3ctdG9vbGJveC5jb2xsYXBzZWQgew0KICAgIHdpZHRoOiA1MHB4Ow0KfQ0KDQouZmxvdy10b29sYm94LmNvbGxhcHNlZCAudG9vbGJveC1jb250ZW50IHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouZmxvdy10b29sYm94LmNvbGxhcHNlZCAudG9vbGJveC1oZWFkZXIgaDQgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi50b29sYm94LWNvbnRlbnQgew0KICAgIGZsZXg6IDE7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KfQ0KDQovKiBNYWluIFdvcmtzcGFjZSAqLw0KLmZsb3ctd29ya3NwYWNlIHsNCiAgICBmbGV4OiAxOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBtaW4td2lkdGg6IDA7DQp9DQoNCi8qIFRvb2xiYXIgKi8NCi5mbG93LXRvb2xiYXIgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgcGFkZGluZzogMTJweCAyMHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGZsZXgtc2hyaW5rOiAwOw0KfQ0KDQoudG9vbGJhci1sZWZ0IHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGdhcDogMTBweDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQouY3VycmVudC1maWxlLWluZm8gew0KICAgIG1hcmdpbi1sZWZ0OiAxNXB4Ow0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCn0NCg0KLmN1cnJlbnQtZmlsZW5hbWUgew0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQoudG9vbGJhci1yaWdodCB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBnYXA6IDhweDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQovKiBab29tIENvbnRyb2xzICovDQouem9vbS1jb250cm9scyB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogNHB4Ow0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA2cHg7DQp9DQoNCi56b29tLWxldmVsIHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgbWluLXdpZHRoOiA0MHB4Ow0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICB1c2VyLXNlbGVjdDogbm9uZTsNCn0NCg0KLnpvb20tY29udHJvbHMgYnV0dG9uIHsNCiAgICBwYWRkaW5nOiA0cHggNnB4Ow0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQp9DQoNCi56b29tLWNvbnRyb2xzIGJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tYm9yZGVyLWNvbG9yKTsNCn0NCg0KLnpvb20tY29udHJvbHMgYnV0dG9uOmFjdGl2ZSB7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgwLjk1KTsNCn0NCg0KLyogQ2FudmFzIENvbnRhaW5lciAqLw0KLmZsb3ctY2FudmFzLWNvbnRhaW5lciB7DQogICAgZmxleDogMTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KLmZsb3ctY2FudmFzIHsNCiAgICB3aWR0aDogMTAwMDBweDsNCiAgICBoZWlnaHQ6IDEwMDAwcHg7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGJhY2tncm91bmQ6IA0KICAgICAgICByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDIwcHggMjBweCwgdmFyKC0tYm9yZGVyLWNvbG9yKSAxcHgsIHRyYW5zcGFyZW50IDFweCksDQogICAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgNDBweCA0MHB4LCB2YXIoLS1ib3JkZXItY29sb3IpIDFweCwgdHJhbnNwYXJlbnQgMXB4KTsNCiAgICBiYWNrZ3JvdW5kLXNpemU6IDQwcHggNDBweDsNCiAgICBjdXJzb3I6IGdyYWI7DQogICAgdHJhbnNmb3JtLW9yaWdpbjogMCAwOw0KICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07DQp9DQoNCi5mbG93LWNhbnZhczphY3RpdmUgew0KICAgIGN1cnNvcjogZ3JhYmJpbmc7DQp9DQoNCi5mbG93LWNhbnZhcy5wYW5uaW5nIHsNCiAgICBjdXJzb3I6IGdyYWJiaW5nOw0KfQ0KDQovKiBDb25maWd1cmF0aW9uIFBhbmVsICovDQouZmxvdy1jb25maWctcGFuZWwgew0KICAgIHdpZHRoOiAzMDBweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIGZsZXgtc2hyaW5rOiAwOw0KfQ0KDQouY29uZmlnLWhlYWRlciB7DQogICAgcGFkZGluZzogMTVweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQouY29uZmlnLWhlYWRlciBoNCB7DQogICAgbWFyZ2luOiAwOw0KICAgIGZvbnQtc2l6ZTogMTZweDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA4cHg7DQp9DQoNCiN0b2dnbGUtY29uZmlnIHsNCiAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KI3RvZ2dsZS1jb25maWc6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCi8qIENvbGxhcHNlZCBzdGF0ZSAqLw0KLmZsb3ctY29uZmlnLXBhbmVsLmNvbGxhcHNlZCB7DQogICAgd2lkdGg6IDUwcHg7DQp9DQoNCi5mbG93LWNvbmZpZy1wYW5lbC5jb2xsYXBzZWQgLmNvbmZpZy1jb250ZW50IHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouZmxvdy1jb25maWctcGFuZWwuY29sbGFwc2VkIC5jb25maWctaGVhZGVyIGg0IHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouY29uZmlnLWNvbnRlbnQgew0KICAgIGZsZXg6IDE7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCiAgICBwYWRkaW5nOiAxNXB4Ow0KfQ0KDQovKiBPdXRwdXQgUGFuZWwgKi8NCi5mbG93LW91dHB1dC1wYW5lbCB7DQogICAgbWFyZ2luLXRvcDogMTBweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KDQoub3V0cHV0LWhlYWRlciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBwYWRkaW5nOiAxMnB4IDE1cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCi5vdXRwdXQtaGVhZGVyIGg0IHsNCiAgICBtYXJnaW46IDA7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDhweDsNCn0NCg0KLm91dHB1dC1jb250ZW50IHsNCiAgICBwYWRkaW5nOiAxNXB4Ow0KICAgIG1heC1oZWlnaHQ6IDIwMHB4Ow0KICAgIG92ZXJmbG93LXk6IGF1dG87DQp9DQoNCi5mbG93LW91dHB1dC1wYW5lbC5jb2xsYXBzZWQgLm91dHB1dC1jb250ZW50IHsNCiAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7DQp9DQoNCi5mbG93LW91dHB1dC1wYW5lbCAub3V0cHV0LWhlYWRlciB7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouZmxvdy1vdXRwdXQtcGFuZWwgLm91dHB1dC1jb250cm9scyB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBnYXA6IDhweDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQoNCi8qID09PT09IFN0eWxlOiBjc3Mvbm9kZXMuY3NzID09PT09ICovDQovKiBGbG93IEVkaXRvciBOb2RlcyAmIENvbm5lY3Rpb25zICovDQoNCi8qIE5vZGUgU3R5bGVzICovDQouZmxvdy1ub2RlIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgbWluLXdpZHRoOiAxNTBweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDJweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KICAgIGN1cnNvcjogZ3JhYjsNCiAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjEpOw0KICAgIHRyYW5zaXRpb246IGJveC1zaGFkb3cgMC4ycyBlYXNlLCB0cmFuc2Zvcm0gMC4xcyBlYXNlOw0KICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07DQp9DQoNCi5mbG93LW5vZGU6YWN0aXZlIHsNCiAgICBjdXJzb3I6IGdyYWJiaW5nOw0KICAgIHRyYW5zaXRpb246IG5vbmU7DQp9DQoNCi5mbG93LW5vZGU6aG92ZXIgew0KICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjE1KTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQp9DQoNCi5mbG93LW5vZGUuc2VsZWN0ZWQgew0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgYm94LXNoYWRvdzogMCAwIDAgMnB4IHJnYmEodmFyKC0tcHJpbWFyeS1jb2xvci1yZ2IpLCAwLjIpOw0KfQ0KDQouZmxvdy1ub2RlLWhlYWRlciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDhweDsNCiAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQoubm9kZS1kZWxldGUtYnRuIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgcmlnaHQ6IC01cHg7DQogICAgdG9wOiAtNXB4Ow0KICAgIHdpZHRoOiAyMHB4Ow0KICAgIGhlaWdodDogMjBweDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICBmb250LXNpemU6IDEwcHg7DQogICAgb3BhY2l0eTogMDsNCiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMnMgZWFzZTsNCiAgICB6LWluZGV4OiAxMDsNCn0NCg0KLmZsb3ctbm9kZTpob3ZlciAubm9kZS1kZWxldGUtYnRuIHsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KDQoubm9kZS1kZWxldGUtYnRuOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiAjZDMyZjJmOw0KICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsNCn0NCg0KLmZsb3ctbm9kZS10eXBlIHsNCiAgICBwYWRkaW5nOiAycHggNnB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICBiYWNrZ3JvdW5kOiAjNmM3NTdkOw0KICAgIGNvbG9yOiB3aGl0ZTsNCn0NCg0KLmZsb3ctbm9kZS1jb250ZW50IHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnRzIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHBvaW50ZXItZXZlbnRzOiBub25lOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnQgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTJweDsNCiAgICBoZWlnaHQ6IDEycHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHBvaW50ZXItZXZlbnRzOiBhbGw7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KLmZsb3ctbm9kZS1wb3J0OmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTsNCn0NCg0KLmZsb3ctbm9kZS1wb3J0LmlucHV0IHsNCiAgICBsZWZ0OiAtNnB4Ow0KICAgIHRvcDogNTAlOw0KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsNCn0NCg0KLmZsb3ctbm9kZS1wb3J0Lm91dHB1dCB7DQogICAgcmlnaHQ6IC02cHg7DQogICAgdG9wOiA1MCU7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpOw0KfQ0KDQovKiBDb25uZWN0aW9uIExpbmVzICovDQouZmxvdy1jb25uZWN0aW9uIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQogICAgei1pbmRleDogMTsNCn0NCg0KLmZsb3ctY29ubmVjdGlvbi1saW5lIHsNCiAgICBzdHJva2U6IHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgc3Ryb2tlLXdpZHRoOiA4Ow0KICAgIGZpbGw6IG5vbmU7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCiAgICBvcGFjaXR5OiAwLjY7IC8qIFNsaWdodGx5IHRyYW5zcGFyZW50IGJ5IGRlZmF1bHQgKi8NCn0NCg0KLmZsb3ctY29ubmVjdGlvbi1saW5lOmhvdmVyIHsNCiAgICBzdHJva2U6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIG9wYWNpdHk6IDE7DQogICAgc3Ryb2tlLXdpZHRoOiAxMDsNCn0NCg0KLmZsb3ctY29ubmVjdGlvbi1saW5lLmNvbm5lY3RlZCB7DQogICAgc3Ryb2tlOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBvcGFjaXR5OiAwLjg7DQp9DQoNCi8qIFJ1bm5pbmcgU3RhdGUgKi8NCi5mbG93LW5vZGUucnVubmluZyB7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCiAgICBhbmltYXRpb246IHB1bHNlIDJzIGluZmluaXRlOw0KfQ0KDQpAa2V5ZnJhbWVzIHB1bHNlIHsNCiAgICAwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDAgcmdiYSh2YXIoLS1zdWNjZXNzLWNvbG9yLXJnYiksIDAuNCk7IH0NCiAgICA3MCUgeyBib3gtc2hhZG93OiAwIDAgMCAxMHB4IHJnYmEodmFyKC0tc3VjY2Vzcy1jb2xvci1yZ2IpLCAwKTsgfQ0KICAgIDEwMCUgeyBib3gtc2hhZG93OiAwIDAgMCAwIHJnYmEodmFyKC0tc3VjY2Vzcy1jb2xvci1yZ2IpLCAwKTsgfQ0KfQ0KDQoNCi8qID09PT09IFN0eWxlOiBjc3MvY29tcG9uZW50cy5jc3MgPT09PT0gKi8NCi8qIEZsb3cgRWRpdG9yIFVJIENvbXBvbmVudHMgKi8NCg0KLyogTm9kZSBDYXRlZ29yeSBUb29sYm94ICovDQoubm9kZS1jYXRlZ29yeSB7DQogICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCn0NCg0KLm5vZGUtY2F0ZWdvcnkgaDUgew0KICAgIG1hcmdpbjogMCAwIDEwcHggMDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsNCiAgICBsZXR0ZXItc3BhY2luZzogMC41cHg7DQogICAgcGFkZGluZzogMCA1cHg7DQp9DQoNCi50b29sYm94LW5vZGUtYnRuIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiAxMHB4Ow0KICAgIHBhZGRpbmc6IDEycHggMTVweDsNCiAgICBtYXJnaW4tYm90dG9tOiA1cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA2cHg7DQogICAgY3Vyc29yOiBncmFiOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQogICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQoudG9vbGJveC1ub2RlLWJ0bjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOw0KICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMSk7DQp9DQoNCi50b29sYm94LW5vZGUtYnRuOmFjdGl2ZSB7DQogICAgY3Vyc29yOiBncmFiYmluZzsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7DQp9DQoNCi50b29sYm94LW5vZGUtYnRuIGkgew0KICAgIGZvbnQtc2l6ZTogMTZweDsNCiAgICB3aWR0aDogMjBweDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi50b29sYm94LW5vZGUtYnRuIHNwYW4gew0KICAgIGZsZXg6IDE7DQogICAgZm9udC13ZWlnaHQ6IDUwMDsNCn0NCg0KLyogQnV0dG9ucyAqLw0KLmZsb3ctdG9vbGJhciAuYnRuIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA2cHg7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQp9DQoNCi5mbG93LXRvb2xiYXIgLmJ0bjpob3ZlciB7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOw0KICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMSk7DQp9DQoNCi5mbG93LXRvb2xiYXIgLmJ0bi1vdXRsaW5lLWRhbmdlciB7DQogICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQp9DQoNCi5mbG93LXRvb2xiYXIgLmJ0bi1vdXRsaW5lLWRhbmdlcjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLW91dGxpbmUtc2Vjb25kYXJ5IHsNCiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLW91dGxpbmUtc2Vjb25kYXJ5OmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCn0NCg0KLyogQ29uZmlndXJhdGlvbiBTdHlsZXMgKi8NCi5jb25maWctZ3JvdXAgew0KICAgIG1hcmdpbi1ib3R0b206IDE1cHg7DQp9DQoNCi5jb25maWctZ3JvdXAgbGFiZWwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICBmb250LXdlaWdodDogNTAwOw0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi5jb25maWctZ3JvdXAgaW5wdXQgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDhweCAxMnB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIDAuMnMgZWFzZTsNCn0NCg0KLmNvbmZpZy1ncm91cCBzZWxlY3Qgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDhweCAxMnB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWdsYXNzLWJvcmRlcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1nbGFzcy1iZyk7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouY29uZmlnLWdyb3VwIGlucHV0OmZvY3VzIHsNCiAgICBvdXRsaW5lOiBub25lOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgYm94LXNoYWRvdzogMCAwIDAgMnB4IHJnYmEodmFyKC0tcHJpbWFyeS1jb2xvci1yZ2IpLCAwLjEpOw0KfQ0KDQouY29uZmlnLWdyb3VwIHNlbGVjdDpmb2N1cyB7DQogICAgb3V0bGluZTogbm9uZTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLWFjY2VudC1jb2xvcik7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLCAyMTIsIDI1NSwgMC4wNSk7DQp9DQoNCi5jb25maWctZ3JvdXAgc2VsZWN0IG9wdGlvbiB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tcHJpbWFyeS1iZyk7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHBhZGRpbmc6IDhweCAxMnB4Ow0KfQ0KDQouY29uZmlnLWdyb3VwIHNlbGVjdCBvcHRpb246aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWdsYXNzLWJnKTsNCn0NCg0KLmNvbmZpZy1ncm91cCB0ZXh0YXJlYSB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICByZXNpemU6IHZlcnRpY2FsOw0KICAgIG1pbi1oZWlnaHQ6IDgwcHg7DQogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsNCn0NCg0KLyogVGFnIFBhbmVsICovDQojdGFnLXBhbmVsIHsNCiAgICBtYXJnaW4tdG9wOiAyMHB4Ow0KICAgIHBhZGRpbmctdG9wOiAyMHB4Ow0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KfQ0KDQojdGFnLXBhbmVsIGg1IHsNCiAgICBtYXJnaW46IDAgMCAxNXB4IDA7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDhweDsNCn0NCg0KLnRhZy1pdGVtIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiAxMHB4Ow0KICAgIHBhZGRpbmc6IDhweCAxMnB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDhweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KLnRhZy1pdGVtOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCn0NCg0KLnRhZy1jb2xvciB7DQogICAgd2lkdGg6IDEycHg7DQogICAgaGVpZ2h0OiAxMnB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBmbGV4LXNocmluazogMDsNCn0NCg0KLnRhZy1pbmZvIHsNCiAgICBmbGV4OiAxOw0KICAgIG1pbi13aWR0aDogMDsNCn0NCg0KLnRhZy1uYW1lIHsNCiAgICBmb250LXdlaWdodDogNTAwOw0KICAgIGZvbnQtc2l6ZTogMTNweDsNCiAgICBtYXJnaW4tYm90dG9tOiAycHg7DQp9DQoNCi50YWctZGVzY3JpcHRpb24gew0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBvcGFjaXR5OiAwLjc7DQp9DQoNCi50YWctZGVsZXRlIHsNCiAgICBiYWNrZ3JvdW5kOiBub25lOw0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBjb2xvcjogaW5oZXJpdDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgcGFkZGluZzogNHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBvcGFjaXR5OiAwLjY7DQogICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjJzIGVhc2U7DQp9DQoNCi50YWctZGVsZXRlOmhvdmVyIHsNCiAgICBvcGFjaXR5OiAxOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsNCn0NCg0KLyogT3V0cHV0IFN0eWxlcyAqLw0KLmV4ZWN1dGlvbi1vdXRwdXQgew0KICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7DQogICAgZm9udC1zaXplOiAxM3B4Ow0KICAgIGxpbmUtaGVpZ2h0OiAxLjQ7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQouZXhlY3V0aW9uLW91dHB1dCAubG9nLWVudHJ5IHsNCiAgICBtYXJnaW4tYm90dG9tOiA1cHg7DQogICAgcGFkZGluZzogNHB4IDA7DQp9DQoNCi5leGVjdXRpb24tb3V0cHV0IC5sb2ctZW50cnkuaW5mbyB7DQogICAgY29sb3I6IHZhcigtLWluZm8tY29sb3IpOw0KfQ0KDQouZXhlY3V0aW9uLW91dHB1dCAubG9nLWVudHJ5LnN1Y2Nlc3Mgew0KICAgIGNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCn0NCg0KLmV4ZWN1dGlvbi1vdXRwdXQgLmxvZy1lbnRyeS5lcnJvciB7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCn0NCg0KLmV4ZWN1dGlvbi1vdXRwdXQgLmxvZy1lbnRyeS53YXJuaW5nIHsNCiAgICBjb2xvcjogdmFyKC0td2FybmluZy1jb2xvcik7DQp9DQoNCi8qIElucHV0L091dHB1dCBNYXBwaW5ncyBDb25maWd1cmF0aW9uIFN0eWxlcyAqLw0KLmlucHV0LW1hcHBpbmdzLWNvbmZpZywNCi5vdXRwdXQtbWFwcGluZ3MtY29uZmlnIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgbWFyZ2luLXRvcDogNHB4Ow0KfQ0KDQouaW5wdXQtbWFwcGluZy1jb25maWcsDQoub3V0cHV0LW1hcHBpbmctY29uZmlnIHsNCiAgICBtYXJnaW4tYm90dG9tOiA4cHg7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wMik7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIGJvcmRlci1sZWZ0OiAzcHggc29saWQgdmFyKC0tcHJpbWFyeS1jb2xvcik7DQp9DQoNCi5pbnB1dC1tYXBwaW5nLWNvbmZpZzpsYXN0LWNoaWxkLA0KLm91dHB1dC1tYXBwaW5nLWNvbmZpZzpsYXN0LWNoaWxkIHsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQouaW5wdXQtbWFwcGluZy1jb25maWcgbGFiZWwsDQoub3V0cHV0LW1hcHBpbmctY29uZmlnIGxhYmVsIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgbWFyZ2luLWJvdHRvbTogNHB4Ow0KfQ0KDQouaW5wdXQtbWFwcGluZy1zZWxlY3QsDQoub3V0cHV0LW1hcHBpbmctc2VsZWN0IHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi5pbnB1dC1tYXBwaW5nLXNlbGVjdDpmb2N1cywNCi5vdXRwdXQtbWFwcGluZy1zZWxlY3Q6Zm9jdXMgew0KICAgIG91dGxpbmU6IG5vbmU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBib3gtc2hhZG93OiAwIDAgMCAycHggcmdiYSgwLCAxMjMsIDI1NSwgMC4xKTsNCn0NCg0KLyogTGVnYWN5IHN0eWxlcyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSAqLw0KLmlucHV0LW1hcHBpbmdzIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgbWFyZ2luLXRvcDogNHB4Ow0KfQ0KDQouaW5wdXQtbWFwcGluZyB7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBtYXJnaW4tYm90dG9tOiA0cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KICAgIGJvcmRlci1yYWRpdXM6IDNweDsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgbGluZS1oZWlnaHQ6IDEuMjsNCn0NCg0KLmlucHV0LW1hcHBpbmc6bGFzdC1jaGlsZCB7DQogICAgbWFyZ2luLWJvdHRvbTogMDsNCn0NCg0KLmlucHV0LW1hcHBpbmcgLnNvdXJjZS1ub2RlIHsNCiAgICBmb250LXdlaWdodDogNjAwOw0KfQ0KDQouaW5wdXQtbWFwcGluZyAuc291cmNlLXBvcnQgew0KICAgIG9wYWNpdHk6IDAuODsNCiAgICBmb250LXN0eWxlOiBpdGFsaWM7DQp9DQoNCg0KLyogPT09PT0gU3R5bGU6IGNzcy9ub2RlLXR5cGVzLmNzcyA9PT09PSAqLw0KLyogRmxvdyBFZGl0b3IgTm9kZSBUeXBlIFNwZWNpZmljIFN0eWxlcyAqLw0KDQovKiBEaXNwbGF5IE5vZGUgQ29udGVudCAqLw0KLmRpc3BsYXktY29udGVudCB7DQogICAgcGFkZGluZzogOHB4Ow0KfQ0KDQouZGlzcGxheS10ZXh0IHsNCiAgICBtaW4taGVpZ2h0OiA0MHB4Ow0KICAgIG1heC1oZWlnaHQ6IDIwMHB4Ow0KICAgIHdpZHRoOiAyMjBweDsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wNSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBtYXJnaW4tYm90dG9tOiA4cHg7DQogICAgcmVzaXplOiBub25lOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCi5kaXNwbGF5LXRleHQgcHJlIHsNCiAgICBtYXJnaW46IDA7DQogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsNCiAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7DQogICAgd29yZC1icmVhazogYnJlYWstd29yZDsNCiAgICB1c2VyLXNlbGVjdDogdGV4dDsNCn0NCg0KLmRpc3BsYXktZm9ybWF0IHsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCn0NCg0KLyogQXVkaW8gUGxheWVyIFN0eWxlcyAqLw0KLmF1ZGlvLWNvbnRyb2xzIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiAxMHB4Ow0KICAgIG1hcmdpbi10b3A6IDEwcHg7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wNSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KfQ0KDQouYXVkaW8tcGxheS1idG4sDQouYXVkaW8tc3RvcC1idG4gew0KICAgIHdpZHRoOiAzMnB4Ow0KICAgIGhlaWdodDogMzJweDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQp9DQoNCi5hdWRpby1wbGF5LWJ0biB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VjY2Vzcy1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KfQ0KDQouYXVkaW8tc3RvcC1idG4gew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQp9DQoNCi5hdWRpby1wbGF5LWJ0bjpob3ZlciwNCi5hdWRpby1zdG9wLWJ0bjpob3ZlciB7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOw0KICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMik7DQp9DQoNCi5hdWRpby1zdGF0dXMgew0KICAgIGZsZXg6IDE7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi8qIEpTT04gRXh0cmFjdCBEaXNwbGF5ICovDQouanNvbi1leHRyYWN0LWRpc3BsYXkgew0KICAgIG1hcmdpbi10b3A6IDEwcHg7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wNSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KfQ0KDQouZXh0cmFjdC1sYWJlbCB7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICBtYXJnaW4tYm90dG9tOiA0cHg7DQogICAgZm9udC13ZWlnaHQ6IDUwMDsNCn0NCg0KLmV4dHJhY3QtdmFsdWUgew0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICB3b3JkLWJyZWFrOiBicmVhay1hbGw7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCn0NCg0KLmV4dHJhY3QtdmFsdWUuc3VjY2VzcyB7DQogICAgY29sb3I6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tc3VjY2Vzcy1jb2xvcik7DQp9DQoNCi5leHRyYWN0LXZhbHVlLmVycm9yIHsNCiAgICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KfQ0KDQovKiBSZXBlYXRlciBOb2RlIFN0eWxlcyAqLw0KLnJlcGVhdGVyLWNvbnRlbnQgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCn0NCg0KLnJlcGVhdGVyLXN0YXR1cyB7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIG1pbi13aWR0aDogODBweDsNCn0NCg0KLnJlcGVhdGVyLXN0YXR1cy5zdG9wcGVkIHsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMSk7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KfQ0KDQoucmVwZWF0ZXItc3RhdHVzLnJ1bm5pbmcgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCiAgICBhbmltYXRpb246IHB1bHNlIDJzIGluZmluaXRlOw0KfQ0KDQoucmVwZWF0ZXItY29udHJvbHMgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZ2FwOiA4cHg7DQp9DQoNCi5yZXBlYXRlci1zdGFydC1idG4sDQoucmVwZWF0ZXItc3RvcC1idG4gew0KICAgIHdpZHRoOiAyOHB4Ow0KICAgIGhlaWdodDogMjhweDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQp9DQoNCi5yZXBlYXRlci1zdGFydC1idG4gew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCn0NCg0KLnJlcGVhdGVyLXN0b3AtYnRuIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KfQ0KDQoucmVwZWF0ZXItc3RhcnQtYnRuOmhvdmVyLA0KLnJlcGVhdGVyLXN0b3AtYnRuOmhvdmVyIHsNCiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4yKTsNCn0NCg0KLyogSW1hZ2UgTm9kZSBTdHlsZXMgKi8NCi5pbWFnZS1jb250YWluZXIgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBtaW4taGVpZ2h0OiAxMjBweDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCn0NCg0KLmltYWdlLXRodW1ibmFpbCB7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgb2JqZWN0LWZpdDogY29udGFpbjsNCiAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4ycyBlYXNlOw0KfQ0KDQouaW1hZ2UtdGh1bWJuYWlsOmhvdmVyIHsNCiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMDUpOw0KICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMik7DQp9DQoNCi5pbWFnZS1pbmZvIHsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOw0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQouaW1hZ2UtZXJyb3Igew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogNHB4Ow0KICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQouaW1hZ2UtZXJyb3IgaSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KDQovKiBJbWFnZSBNb2RhbCBTdHlsZXMgKi8NCi5pbWFnZS1tb2RhbCB7DQogICAgcG9zaXRpb246IGZpeGVkOw0KICAgIHRvcDogMDsNCiAgICBsZWZ0OiAwOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuOCk7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIHotaW5kZXg6IDEwMDA7DQogICAgcGFkZGluZzogMjBweDsNCn0NCg0KLmltYWdlLW1vZGFsLWNvbnRlbnQgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICBtYXgtd2lkdGg6IDkwJTsNCiAgICBtYXgtaGVpZ2h0OiA5MCU7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBib3gtc2hhZG93OiAwIDRweCAyMHB4IHJnYmEoMCwwLDAsMC4zKTsNCn0NCg0KLmltYWdlLW1vZGFsLWhlYWRlciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBwYWRkaW5nOiAxNXB4IDIwcHg7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQp9DQoNCi5pbWFnZS1tb2RhbC1oZWFkZXIgc3BhbiB7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi5pbWFnZS1tb2RhbC1jbG9zZSB7DQogICAgYmFja2dyb3VuZDogbm9uZTsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgZm9udC1zaXplOiAyNHB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgcGFkZGluZzogMDsNCiAgICB3aWR0aDogMzBweDsNCiAgICBoZWlnaHQ6IDMwcHg7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQouaW1hZ2UtbW9kYWwtY2xvc2U6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4xKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi5pbWFnZS1tb2RhbC1ib2R5IHsNCiAgICBwYWRkaW5nOiAyMHB4Ow0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogMTVweDsNCiAgICBtYXgtaGVpZ2h0OiBjYWxjKDkwdmggLSAxMDBweCk7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCn0NCg0KLmltYWdlLW1vZGFsLWltYWdlIHsNCiAgICBtYXgtd2lkdGg6IDEwMCU7DQogICAgbWF4LWhlaWdodDogNzB2aDsNCiAgICBvYmplY3QtZml0OiBjb250YWluOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjEpOw0KfQ0KDQouaW1hZ2UtbW9kYWwtaW5mbyB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHBhZGRpbmc6IDEwcHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjA1KTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgd2lkdGg6IDEwMCU7DQp9DQoNCi8qIFJhbmRvbSBRdW90ZSBOb2RlIFN0eWxlcyAqLw0KLnF1b3RlLWNvbnRlbnQgew0KICAgIHBhZGRpbmc6IDEwcHg7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQoucXVvdGUtdGV4dCB7DQogICAgbWFyZ2luLWJvdHRvbTogOHB4Ow0KICAgIG1pbi1oZWlnaHQ6IDQwcHg7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KfQ0KDQoucXVvdGUtZGlzcGxheSB7DQogICAgbWFyZ2luOiAwOw0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZm9udC1zaXplOiAxM3B4Ow0KICAgIGxpbmUtaGVpZ2h0OiAxLjQ7DQogICAgbWF4LXdpZHRoOiAxMDAlOw0KICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCn0NCg0KLnF1b3RlLWluZm8gew0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgcGFkZGluZy10b3A6IDhweDsNCn0NCg0KLyogTExNIENoYXQgTm9kZSBTdHlsZXMgKi8NCi5sbG0tcmVzcG9uc2Ugew0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDIzLCAxNjIsIDE4NCwgMC4xKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgbWFyZ2luOiA0cHggMDsNCn0NCg0KLnJlc3BvbnNlLXByZXZpZXcgew0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBsaW5lLWhlaWdodDogMS4zOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgbWFyZ2luLWJvdHRvbTogNHB4Ow0KfQ0KDQoudXNhZ2UtaW5mbyB7DQogICAgZm9udC1zaXplOiAxMHB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgwLDAsMCwwLjEpOw0KICAgIHBhZGRpbmctdG9wOiA0cHg7DQp9DQoNCi5sbG0tZXJyb3Igew0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDIyMCwgNTMsIDY5LCAwLjEpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBtYXJnaW46IDRweCAwOw0KICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDZweDsNCn0NCg0KLmxsbS1lcnJvciBpIHsNCiAgICBmb250LXNpemU6IDE0cHg7DQp9DQoNCi8qIFRleHQgTm9kZSBTdHlsZXMgKi8NCi50ZXh0LWNvbnRlbnQgew0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDEwOCwgMTE3LCAxMjUsIDAuMSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG1hcmdpbjogNHB4IDA7DQp9DQoNCi50ZXh0LXByZXZpZXcgew0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBsaW5lLWhlaWdodDogMS4zOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgbWFyZ2luLWJvdHRvbTogNHB4Ow0KfQ0KDQoudGV4dC1pbmZvIHsNCiAgICBmb250LXNpemU6IDEwcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDAsMCwwLDAuMSk7DQogICAgcGFkZGluZy10b3A6IDRweDsNCn0NCg0KLyogTm9kZSBTdGF0dXMgRGlzcGxheSAqLw0KLm5vZGUtc3RhdHVzIHsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjA1KTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgbWFyZ2luOiA0cHggMDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi5zdGF0dXMtdGV4dCB7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIG1hcmdpbi1ib3R0b206IDRweDsNCn0NCg0KLnN0YXR1cy1pbmZvIHsNCiAgICBmb250LXNpemU6IDEwcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KfQ0KDQovKiBDb250ZW50IERpc3BsYXkgaW4gQ29uZmlnIFBhbmVsICovDQouY29udGVudC1kaXNwbGF5IHsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBwYWRkaW5nOiAxMnB4Ow0KICAgIG1hcmdpbi10b3A6IDhweDsNCn0NCg0KLmNvbnRlbnQtdGV4dCB7DQogICAgbWFyZ2luOiAwOw0KICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGxpbmUtaGVpZ2h0OiAxLjQ7DQogICAgd2hpdGUtc3BhY2U6IHByZS13cmFwOw0KICAgIHdvcmQtYnJlYWs6IGJyZWFrLXdvcmQ7DQogICAgbWF4LWhlaWdodDogMzAwcHg7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDNweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgdXNlci1zZWxlY3Q6IHRleHQ7DQp9DQoNCi5jb250ZW50LWluZm8gew0KICAgIG1hcmdpbi10b3A6IDhweDsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLyogVGVybWluYWwgTm9kZSBTdHlsZXMgKi8NCi50ZXJtaW5hbC1lcnJvciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHBhZGRpbmc6IDhweCAxMnB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMjIwLCA1MywgNjksIDAuMSk7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBtYXJnaW4tdG9wOiA4cHg7DQp9DQoNCi50ZXJtaW5hbC1lcnJvciBpIHsNCiAgICBtYXJnaW4tcmlnaHQ6IDhweDsNCiAgICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KfQ0KDQoNCi8qID09PT09IFN0eWxlOiBjc3MvcmVzcG9uc2l2ZS5jc3MgPT09PT0gKi8NCi8qIEZsb3cgRWRpdG9yIFJlc3BvbnNpdmUgRGVzaWduICYgRWZmZWN0cyAqLw0KDQovKiBSZXNwb25zaXZlIERlc2lnbiAqLw0KQG1lZGlhIChtYXgtd2lkdGg6IDEyMDBweCkgew0KICAgIC5mbG93LWVkaXRvciB7DQogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgICAgIGhlaWdodDogYXV0bzsNCiAgICB9DQogICAgDQogICAgLmZsb3ctdG9vbGJveCB7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICBoZWlnaHQ6IGF1dG87DQogICAgICAgIGJvcmRlci1yaWdodDogbm9uZTsNCiAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgfQ0KICAgIA0KICAgIC50b29sYm94LWNvbnRlbnQgew0KICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICBmbGV4LXdyYXA6IHdyYXA7DQogICAgICAgIGdhcDogMTBweDsNCiAgICAgICAgcGFkZGluZzogMTVweDsNCiAgICB9DQogICAgDQogICAgLm5vZGUtY2F0ZWdvcnkgew0KICAgICAgICBtYXJnaW4tYm90dG9tOiAwOw0KICAgICAgICBmbGV4OiAxOw0KICAgICAgICBtaW4td2lkdGg6IDIwMHB4Ow0KICAgIH0NCiAgICANCiAgICAuZmxvdy1jb25maWctcGFuZWwgew0KICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgYm9yZGVyLWxlZnQ6IG5vbmU7DQogICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIH0NCn0NCg0KQG1lZGlhIChtYXgtd2lkdGg6IDc2OHB4KSB7DQogICAgLmZsb3ctdG9vbGJhciB7DQogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgICAgIGdhcDogMTBweDsNCiAgICB9DQogICAgDQogICAgLnRvb2xiYXItbGVmdCwNCiAgICAudG9vbGJhci1yaWdodCB7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICB9DQogICAgDQogICAgLmZsb3ctdG9vbGJhciAuYnRuIHsNCiAgICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgICBwYWRkaW5nOiA2cHggMTBweDsNCiAgICB9DQp9DQo8L3N0eWxlPg0KPHNjcmlwdD4vLyA9PT09PSBTY3JpcHQ6IGpzL3V0aWxzLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9ub2RlLXJlZ2lzdHJ5LmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9jYW52YXMuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL25vZGUtY29uZmlnLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9ub2RlLXJlbmRlcmVyLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9kYXRhLWV4ZWN1dG9ycy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvaHR0cC1leGVjdXRvcnMuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL21lZGlhLWV4ZWN1dG9ycy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvZmxvdy1leGVjdXRvcnMuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL2FpLWV4ZWN1dG9ycy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvZXhlY3V0aW9uLWVuZ2luZS5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvd29ya2Zsb3cuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL2NhbnZhcy1tYW5hZ2VyLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy90YWctbWFuYWdlci5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvZmlsZS1tYW5hZ2VyLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy91aS1tYW5hZ2VyLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9tYWluLmpzID09PT09DQoNCg0KLy8gdXRpbHMuanMgLSBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgRmxvdyBFZGl0b3INCg0KLy8gU2NhbGUgY29tcGVuc2F0aW9uIHV0aWxpdGllcw0KbGV0IGFwcFNjYWxlID0gMS4wOw0KDQovLyBEZXRlY3QgdGhlIGN1cnJlbnQgYXBwIHNjYWxlIGZyb20gQ1NTIHRyYW5zZm9ybQ0KZnVuY3Rpb24gZGV0ZWN0QXBwU2NhbGUoKSB7DQogICAgdHJ5IHsNCiAgICAgICAgLy8gRmluZCB0aGUgYXBwIHdpbmRvdyBjb250YWluZXINCiAgICAgICAgY29uc3QgYXBwV2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFwcC13aW5kb3cnKTsNCiAgICAgICAgaWYgKCFhcHBXaW5kb3cpIHsNCiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdObyBhcHAgd2luZG93IGZvdW5kLCBhc3N1bWluZyAxMDAlIHNjYWxlJyk7DQogICAgICAgICAgICByZXR1cm4gMS4wOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ2hlY2sgZm9yIHNjYWxlIGNsYXNzZXMNCiAgICAgICAgY29uc3Qgc2NhbGVDbGFzc2VzID0gWydzY2FsZS03NScsICdzY2FsZS04MCcsICdzY2FsZS04NScsICdzY2FsZS05MCcsICdzY2FsZS05NScsDQogICAgICAgICAgICAnc2NhbGUtMTAwJywgJ3NjYWxlLTEwNScsICdzY2FsZS0xMTAnLCAnc2NhbGUtMTE1JywgJ3NjYWxlLTEyMCcsDQogICAgICAgICAgICAnc2NhbGUtMTI1JywgJ3NjYWxlLTEzMCcsICdzY2FsZS0xMzUnLCAnc2NhbGUtMTQwJywgJ3NjYWxlLTE0NScsICdzY2FsZS0xNTAnXTsNCg0KICAgICAgICBmb3IgKGNvbnN0IHNjYWxlQ2xhc3Mgb2Ygc2NhbGVDbGFzc2VzKSB7DQogICAgICAgICAgICBpZiAoYXBwV2luZG93LmNsYXNzTGlzdC5jb250YWlucyhzY2FsZUNsYXNzKSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlVmFsdWUgPSBwYXJzZUludChzY2FsZUNsYXNzLnJlcGxhY2UoJ3NjYWxlLScsICcnKSk7DQogICAgICAgICAgICAgICAgYXBwU2NhbGUgPSBzY2FsZVZhbHVlIC8gMTAwOw0KICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBEZXRlY3RlZCBhcHAgc2NhbGU6ICR7c2NhbGVWYWx1ZX0lICgke2FwcFNjYWxlfSlgKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYXBwU2NhbGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBGYWxsYmFjazogY2hlY2sgY29tcHV0ZWQgdHJhbnNmb3JtDQogICAgICAgIGNvbnN0IGNvbXB1dGVkU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShhcHBXaW5kb3cpOw0KICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBjb21wdXRlZFN0eWxlLnRyYW5zZm9ybTsNCiAgICAgICAgaWYgKHRyYW5zZm9ybSAmJiB0cmFuc2Zvcm0gIT09ICdub25lJykgew0KICAgICAgICAgICAgLy8gUGFyc2UgdHJhbnNmb3JtIG1hdHJpeCB0byBleHRyYWN0IHNjYWxlDQogICAgICAgICAgICBjb25zdCBtYXRyaXggPSB0cmFuc2Zvcm0ubWF0Y2goL21hdHJpeFwoKFteKV0rKVwpLyk7DQogICAgICAgICAgICBpZiAobWF0cml4KSB7DQogICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gbWF0cml4WzFdLnNwbGl0KCcsJykubWFwKHYgPT4gcGFyc2VGbG9hdCh2LnRyaW0oKSkpOw0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID49IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gTWF0cml4IGZvcm1hdDogbWF0cml4KGEsIGIsIGMsIGQsIHR4LCB0eSkgd2hlcmUgYSBhbmQgZCBhcmUgc2NhbGUgZmFjdG9ycw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzY2FsZVggPSB2YWx1ZXNbMF07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlWSA9IHZhbHVlc1szXTsNCiAgICAgICAgICAgICAgICAgICAgYXBwU2NhbGUgPSAoc2NhbGVYICsgc2NhbGVZKSAvIDI7IC8vIEF2ZXJhZ2Ugb2YgWCBhbmQgWSBzY2FsZQ0KICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgRGV0ZWN0ZWQgYXBwIHNjYWxlIGZyb20gdHJhbnNmb3JtOiAke2FwcFNjYWxlfWApOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBwU2NhbGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ05vIHNjYWxlIGRldGVjdGVkLCB1c2luZyAxMDAlJyk7DQogICAgICAgIHJldHVybiAxLjA7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGV0ZWN0aW5nIGFwcCBzY2FsZTonLCBlcnJvcik7DQogICAgICAgIHJldHVybiAxLjA7DQogICAgfQ0KfQ0KDQovLyBHZXQgdGhlIHRvdGFsIGVmZmVjdGl2ZSBzY2FsZSAoYXBwIHNjYWxlIMOXIHpvb20gc2NhbGUpDQpmdW5jdGlvbiBnZXRFZmZlY3RpdmVTY2FsZSgpIHsNCiAgICBjb25zdCBhcHBTY2FsZSA9IGRldGVjdEFwcFNjYWxlKCk7DQogICAgY29uc3Qgem9vbVNjYWxlID0gKHR5cGVvZiBmbG93RWRpdG9yICE9PSAndW5kZWZpbmVkJyAmJiBmbG93RWRpdG9yLnpvb21MZXZlbCkgPyBmbG93RWRpdG9yLnpvb21MZXZlbCA6IDEuMDsNCiAgICByZXR1cm4gYXBwU2NhbGUgKiB6b29tU2NhbGU7DQp9DQoNCi8vIENvbnZlcnQgc2NyZWVuIGNvb3JkaW5hdGVzIHRvIGFwcCBjb29yZGluYXRlcyAoYWNjb3VudGluZyBmb3IgYm90aCBhcHAgc2NhbGUgYW5kIHpvb20pDQpmdW5jdGlvbiBzY3JlZW5Ub0FwcENvb3JkcyhzY3JlZW5YLCBzY3JlZW5ZKSB7DQogICAgY29uc3Qgc2NhbGUgPSBnZXRFZmZlY3RpdmVTY2FsZSgpOw0KICAgIHJldHVybiB7DQogICAgICAgIHg6IHNjcmVlblggLyBzY2FsZSwNCiAgICAgICAgeTogc2NyZWVuWSAvIHNjYWxlDQogICAgfTsNCn0NCg0KLy8gQ29udmVydCBhcHAgY29vcmRpbmF0ZXMgdG8gc2NyZWVuIGNvb3JkaW5hdGVzIChhY2NvdW50aW5nIGZvciBib3RoIGFwcCBzY2FsZSBhbmQgem9vbSkNCmZ1bmN0aW9uIGFwcFRvU2NyZWVuQ29vcmRzKGFwcFgsIGFwcFkpIHsNCiAgICBjb25zdCBzY2FsZSA9IGdldEVmZmVjdGl2ZVNjYWxlKCk7DQogICAgcmV0dXJuIHsNCiAgICAgICAgeDogYXBwWCAqIHNjYWxlLA0KICAgICAgICB5OiBhcHBZICogc2NhbGUNCiAgICB9Ow0KfQ0KDQovLyBHZXQgc2NhbGVkIGVsZW1lbnQgcmVjdCAoY29tcGVuc2F0ZXMgZm9yIGFwcCBzY2FsaW5nIGFuZCB6b29tKQ0KZnVuY3Rpb24gZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGVsZW1lbnQpIHsNCiAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICBjb25zdCBhcHBTY2FsZSA9IGRldGVjdEFwcFNjYWxlKCk7DQogICAgLy8gTm90ZTogRG9uJ3QgaW5jbHVkZSB6b29tIHNjYWxlIGhlcmUgYXMgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGFscmVhZHkgYWNjb3VudHMgZm9yIENTUyB0cmFuc2Zvcm1zDQoNCiAgICByZXR1cm4gew0KICAgICAgICBsZWZ0OiByZWN0LmxlZnQgLyBhcHBTY2FsZSwNCiAgICAgICAgdG9wOiByZWN0LnRvcCAvIGFwcFNjYWxlLA0KICAgICAgICByaWdodDogcmVjdC5yaWdodCAvIGFwcFNjYWxlLA0KICAgICAgICBib3R0b206IHJlY3QuYm90dG9tIC8gYXBwU2NhbGUsDQogICAgICAgIHdpZHRoOiByZWN0LndpZHRoIC8gYXBwU2NhbGUsDQogICAgICAgIGhlaWdodDogcmVjdC5oZWlnaHQgLyBhcHBTY2FsZSwNCiAgICAgICAgeDogcmVjdC54IC8gYXBwU2NhbGUsDQogICAgICAgIHk6IHJlY3QueSAvIGFwcFNjYWxlDQogICAgfTsNCn0NCg0KLy8gR2V0IHNjYWxlZCBtb3VzZSBjb29yZGluYXRlcyBmcm9tIGV2ZW50IChjb21wZW5zYXRlcyBmb3IgYXBwIHNjYWxpbmcgb25seSkNCmZ1bmN0aW9uIGdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIHsNCiAgICBjb25zdCBhcHBTY2FsZSA9IGRldGVjdEFwcFNjYWxlKCk7DQogICAgcmV0dXJuIHsNCiAgICAgICAgeDogZS5jbGllbnRYIC8gYXBwU2NhbGUsDQogICAgICAgIHk6IGUuY2xpZW50WSAvIGFwcFNjYWxlDQogICAgfTsNCn0NCg0KLy8gSW5pdGlhbGl6ZSBzY2FsZSBkZXRlY3Rpb24NCmZ1bmN0aW9uIGluaXRTY2FsZURldGVjdGlvbigpIHsNCiAgICAvLyBEZXRlY3Qgc2NhbGUgb24gaW5pdGlhbGl6YXRpb24NCiAgICBkZXRlY3RBcHBTY2FsZSgpOw0KDQogICAgLy8gTGlzdGVuIGZvciBzY2FsZSBjaGFuZ2VzIChpZiB0aGUgYXBwIHNjYWxlIGNoYW5nZXMgZHluYW1pY2FsbHkpDQogICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zKSA9PiB7DQogICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKChtdXRhdGlvbikgPT4gew0KICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdhdHRyaWJ1dGVzJyAmJiBtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lID09PSAnY2xhc3MnKSB7DQogICAgICAgICAgICAgICAgY29uc3Qgb2xkU2NhbGUgPSBhcHBTY2FsZTsNCiAgICAgICAgICAgICAgICBjb25zdCBuZXdTY2FsZSA9IGRldGVjdEFwcFNjYWxlKCk7DQogICAgICAgICAgICAgICAgaWYgKG9sZFNjYWxlICE9PSBuZXdTY2FsZSkgew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgQXBwIHNjYWxlIGNoYW5nZWQgZnJvbSAke29sZFNjYWxlfSB0byAke25ld1NjYWxlfWApOw0KICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIGFueSBuZWNlc3NhcnkgdXBkYXRlcw0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlZHJhd0FsbENvbm5lY3Rpb25zID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZWRyYXdBbGxDb25uZWN0aW9ucygpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9KTsNCg0KICAgIC8vIE9ic2VydmUgdGhlIGFwcCB3aW5kb3cgZm9yIGNsYXNzIGNoYW5nZXMNCiAgICBjb25zdCBhcHBXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXBwLXdpbmRvdycpOw0KICAgIGlmIChhcHBXaW5kb3cpIHsNCiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShhcHBXaW5kb3csIHsNCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsDQogICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsnY2xhc3MnXQ0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICByZXR1cm4gb2JzZXJ2ZXI7DQp9DQoNCi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gZXNjYXBlIEhUTUwNCmZ1bmN0aW9uIGVzY2FwZUh0bWwodGV4dCkgew0KICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIGRpdi50ZXh0Q29udGVudCA9IHRleHQ7DQogICAgcmV0dXJuIGRpdi5pbm5lckhUTUw7DQp9DQoNCi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gZm9ybWF0IGZpbGUgc2l6ZQ0KZnVuY3Rpb24gZm9ybWF0RmlsZVNpemUoYnl0ZXMpIHsNCiAgICBpZiAoYnl0ZXMgPT09IDApIHJldHVybiAnMCBCeXRlcyc7DQogICAgY29uc3QgayA9IDEwMjQ7DQogICAgY29uc3Qgc2l6ZXMgPSBbJ0J5dGVzJywgJ0tCJywgJ01CJywgJ0dCJ107DQogICAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coaykpOw0KICAgIHJldHVybiBwYXJzZUZsb2F0KChieXRlcyAvIE1hdGgucG93KGssIGkpKS50b0ZpeGVkKDIpKSArICcgJyArIHNpemVzW2ldOw0KfQ0KDQovLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIGRlYm91bmNlIGZ1bmN0aW9uIGNhbGxzDQpmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0KSB7DQogICAgbGV0IHRpbWVvdXQ7DQogICAgcmV0dXJuIGZ1bmN0aW9uIGV4ZWN1dGVkRnVuY3Rpb24oLi4uYXJncykgew0KICAgICAgICBjb25zdCBsYXRlciA9ICgpID0+IHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsNCiAgICAgICAgICAgIGZ1bmMoLi4uYXJncyk7DQogICAgICAgIH07DQogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsNCiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpOw0KICAgIH07DQp9DQoNCg0KLy8gSGVscGVyIG1ldGhvZCBmb3IgdGVtcGxhdGUgcHJvY2Vzc2luZw0KZnVuY3Rpb24gcHJvY2Vzc1RlbXBsYXRlcyh0ZW1wbGF0ZSwgZGF0YSkgew0KICAgIC8vIFNpbXBsZSB0ZW1wbGF0ZSBwcm9jZXNzaW5nIC0gY2FuIGJlIGVuaGFuY2VkDQogICAgbGV0IHJlc3VsdCA9IHRlbXBsYXRlOw0KICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZGF0YSkpIHsNCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKG5ldyBSZWdFeHAoYHt7JHtrZXl9fX1gLCAnZycpLCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KLy8gSGVscGVyIG1ldGhvZCBmb3IgZXh0cmFjdGluZyBuZXN0ZWQgSlNPTiB2YWx1ZXMNCmZ1bmN0aW9uIGV4dHJhY3ROZXN0ZWRWYWx1ZShvYmosIHBhdGgpIHsNCiAgICBjb25zdCBrZXlzID0gcGF0aC5zcGxpdCgnLicpOw0KICAgIGxldCBjdXJyZW50ID0gb2JqOw0KDQogICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykgew0KICAgICAgICBpZiAoY3VycmVudCA9PT0gbnVsbCB8fCBjdXJyZW50ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSGFuZGxlIGFycmF5IGFjY2VzcyBsaWtlICJpdGVtc1swXS5uYW1lIg0KICAgICAgICBjb25zdCBhcnJheU1hdGNoID0ga2V5Lm1hdGNoKC9eKC4rKVxbKFxkKylcXSQvKTsNCiAgICAgICAgaWYgKGFycmF5TWF0Y2gpIHsNCiAgICAgICAgICAgIGNvbnN0IGFycmF5S2V5ID0gYXJyYXlNYXRjaFsxXTsNCiAgICAgICAgICAgIGNvbnN0IGFycmF5SW5kZXggPSBwYXJzZUludChhcnJheU1hdGNoWzJdKTsNCg0KICAgICAgICAgICAgaWYgKGN1cnJlbnRbYXJyYXlLZXldICYmIEFycmF5LmlzQXJyYXkoY3VycmVudFthcnJheUtleV0pKSB7DQogICAgICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnRbYXJyYXlLZXldW2FycmF5SW5kZXhdOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W2tleV07DQogICAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gY3VycmVudDsNCn0NCg0KLy8gSGVscGVyIG1ldGhvZCB0byBkZXRlY3QgaW1hZ2UgdHlwZSBmcm9tIGJhc2U2NCBkYXRhDQpmdW5jdGlvbiBkZXRlY3RJbWFnZVR5cGVGcm9tQmFzZTY0KGJhc2U2NERhdGEpIHsNCiAgICAvLyBDaGVjayB0aGUgZmlyc3QgZmV3IGJ5dGVzIHRvIGRldGVybWluZSBpbWFnZSB0eXBlDQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgYmluYXJ5U3RyaW5nID0gYXRvYihiYXNlNjREYXRhKTsNCiAgICAgICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShiaW5hcnlTdHJpbmcubGVuZ3RoKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnlTdHJpbmcubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGJ5dGVzW2ldID0gYmluYXJ5U3RyaW5nLmNoYXJDb2RlQXQoaSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDaGVjayBmaWxlIHNpZ25hdHVyZXMNCiAgICAgICAgaWYgKGJ5dGVzWzBdID09PSAweEZGICYmIGJ5dGVzWzFdID09PSAweEQ4ICYmIGJ5dGVzWzJdID09PSAweEZGKSB7DQogICAgICAgICAgICByZXR1cm4gJ2ltYWdlL2pwZWcnOw0KICAgICAgICB9IGVsc2UgaWYgKGJ5dGVzWzBdID09PSAweDg5ICYmIGJ5dGVzWzFdID09PSAweDUwICYmIGJ5dGVzWzJdID09PSAweDRFICYmIGJ5dGVzWzNdID09PSAweDQ3KSB7DQogICAgICAgICAgICByZXR1cm4gJ2ltYWdlL3BuZyc7DQogICAgICAgIH0gZWxzZSBpZiAoYnl0ZXNbMF0gPT09IDB4NDcgJiYgYnl0ZXNbMV0gPT09IDB4NDkgJiYgYnl0ZXNbMl0gPT09IDB4NDYpIHsNCiAgICAgICAgICAgIHJldHVybiAnaW1hZ2UvZ2lmJzsNCiAgICAgICAgfSBlbHNlIGlmIChieXRlc1swXSA9PT0gMHg1MiAmJiBieXRlc1sxXSA9PT0gMHg0OSAmJiBieXRlc1syXSA9PT0gMHg0NiAmJiBieXRlc1szXSA9PT0gMHg0Nikgew0KICAgICAgICAgICAgcmV0dXJuICdpbWFnZS93ZWJwJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIERlZmF1bHQgdG8gUE5HIGlmIHdlIGNhbid0IGRldGVybWluZQ0KICAgICAgICAgICAgcmV0dXJuICdpbWFnZS9wbmcnOw0KICAgICAgICB9DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAvLyBEZWZhdWx0IHRvIFBORyBpZiB0aGVyZSdzIGFuIGVycm9yDQogICAgICAgIHJldHVybiAnaW1hZ2UvcG5nJzsNCiAgICB9DQp9DQoNCi8vIENvbnZlcnQgdmlld3BvcnQgY29vcmRpbmF0ZXMgdG8gY2FudmFzIGNvb3JkaW5hdGVzIChhY2NvdW50aW5nIGZvciBwYW4gYW5kIHpvb20pDQpmdW5jdGlvbiB2aWV3cG9ydFRvQ2FudmFzQ29vcmRzKHZpZXdwb3J0WCwgdmlld3BvcnRZKSB7DQogICAgaWYgKHR5cGVvZiBmbG93RWRpdG9yID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICByZXR1cm4geyB4OiB2aWV3cG9ydFgsIHk6IHZpZXdwb3J0WSB9Ow0KICAgIH0NCiAgICANCiAgICByZXR1cm4gew0KICAgICAgICB4OiAodmlld3BvcnRYIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueCkgLyBmbG93RWRpdG9yLnpvb21MZXZlbCwNCiAgICAgICAgeTogKHZpZXdwb3J0WSAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkpIC8gZmxvd0VkaXRvci56b29tTGV2ZWwNCiAgICB9Ow0KfQ0KDQovLyBDb252ZXJ0IGNhbnZhcyBjb29yZGluYXRlcyB0byB2aWV3cG9ydCBjb29yZGluYXRlcyAoYWNjb3VudGluZyBmb3IgcGFuIGFuZCB6b29tKQ0KZnVuY3Rpb24gY2FudmFzVG9WaWV3cG9ydENvb3JkcyhjYW52YXNYLCBjYW52YXNZKSB7DQogICAgaWYgKHR5cGVvZiBmbG93RWRpdG9yID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICByZXR1cm4geyB4OiBjYW52YXNYLCB5OiBjYW52YXNZIH07DQogICAgfQ0KICAgIA0KICAgIHJldHVybiB7DQogICAgICAgIHg6IChjYW52YXNYICogZmxvd0VkaXRvci56b29tTGV2ZWwpICsgZmxvd0VkaXRvci5wYW5PZmZzZXQueCwNCiAgICAgICAgeTogKGNhbnZhc1kgKiBmbG93RWRpdG9yLnpvb21MZXZlbCkgKyBmbG93RWRpdG9yLnBhbk9mZnNldC55DQogICAgfTsNCn0NCg0KLy8gR2V0IHRoZSBjZW50ZXIgb2YgdGhlIGN1cnJlbnQgdmlld3BvcnQgaW4gY2FudmFzIGNvb3JkaW5hdGVzDQpmdW5jdGlvbiBnZXRWaWV3cG9ydENlbnRlckluQ2FudmFzKCkgew0KICAgIGlmICh0eXBlb2YgZmxvd0VkaXRvciA9PT0gJ3VuZGVmaW5lZCcgfHwgIWZsb3dFZGl0b3IuY2FudmFzKSB7DQogICAgICAgIHJldHVybiB7IHg6IDAsIHk6IDAgfTsNCiAgICB9DQogICAgDQogICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICBpZiAoIWNvbnRhaW5lcikgew0KICAgICAgICByZXR1cm4geyB4OiAwLCB5OiAwIH07DQogICAgfQ0KICAgIA0KICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgY29uc3Qgdmlld3BvcnRDZW50ZXJYID0gY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgY29uc3Qgdmlld3BvcnRDZW50ZXJZID0gY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyOw0KICAgIA0KICAgIHJldHVybiB2aWV3cG9ydFRvQ2FudmFzQ29vcmRzKHZpZXdwb3J0Q2VudGVyWCwgdmlld3BvcnRDZW50ZXJZKTsNCn0NCg0KLy8gQ2VudGVyIHRoZSB2aWV3cG9ydCBvbiBzcGVjaWZpYyBjYW52YXMgY29vcmRpbmF0ZXMNCmZ1bmN0aW9uIGNlbnRlclZpZXdwb3J0T25DYW52YXMoY2FudmFzWCwgY2FudmFzWSkgew0KICAgIGlmICh0eXBlb2YgZmxvd0VkaXRvciA9PT0gJ3VuZGVmaW5lZCcgfHwgIWZsb3dFZGl0b3IuY2FudmFzKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICBpZiAoIWNvbnRhaW5lcikgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgY29uc3Qgdmlld3BvcnRDZW50ZXJYID0gY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgY29uc3Qgdmlld3BvcnRDZW50ZXJZID0gY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyOw0KICAgIA0KICAgIC8vIENhbGN1bGF0ZSBwYW4gb2Zmc2V0IHRvIGNlbnRlciB0aGUgc3BlY2lmaWVkIGNhbnZhcyBjb29yZGluYXRlcyBpbiB0aGUgdmlld3BvcnQNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gdmlld3BvcnRDZW50ZXJYIC0gKGNhbnZhc1ggKiBmbG93RWRpdG9yLnpvb21MZXZlbCk7DQogICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IHZpZXdwb3J0Q2VudGVyWSAtIChjYW52YXNZICogZmxvd0VkaXRvci56b29tTGV2ZWwpOw0KICAgIA0KICAgIC8vIFVwZGF0ZSB0aGUgdHJhbnNmb3JtDQogICAgaWYgKHdpbmRvdy5jYW52YXNNYW5hZ2VyICYmIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSkgew0KICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICB9DQp9DQoNCi8vIEV4cG9ydCB1dGlsaXRpZXMgZm9yIHVzZSBpbiBvdGhlciBtb2R1bGVzDQp3aW5kb3cuZmxvd0VkaXRvclV0aWxzID0gew0KICAgIGRldGVjdEFwcFNjYWxlLA0KICAgIGdldEVmZmVjdGl2ZVNjYWxlLA0KICAgIHNjcmVlblRvQXBwQ29vcmRzLA0KICAgIGFwcFRvU2NyZWVuQ29vcmRzLA0KICAgIGdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdCwNCiAgICBnZXRTY2FsZWRNb3VzZUNvb3JkcywNCiAgICBpbml0U2NhbGVEZXRlY3Rpb24sDQogICAgZXNjYXBlSHRtbCwNCiAgICBmb3JtYXRGaWxlU2l6ZSwNCiAgICBkZWJvdW5jZSwNCiAgICBwcm9jZXNzVGVtcGxhdGVzLA0KICAgIGV4dHJhY3ROZXN0ZWRWYWx1ZSwNCiAgICBkZXRlY3RJbWFnZVR5cGVGcm9tQmFzZTY0LA0KICAgIHZpZXdwb3J0VG9DYW52YXNDb29yZHMsDQogICAgY2FudmFzVG9WaWV3cG9ydENvb3JkcywNCiAgICBnZXRWaWV3cG9ydENlbnRlckluQ2FudmFzLA0KICAgIGNlbnRlclZpZXdwb3J0T25DYW52YXMNCn07DQoNCi8vIFJlcGxhY2UgdGVtcGxhdGUgcGxhY2Vob2xkZXJzIGluIEpTT04gYm9keQ0KZnVuY3Rpb24gcmVwbGFjZVRlbXBsYXRlUGxhY2Vob2xkZXJzKGJvZHksIHRlbXBsYXRlRGF0YSkgew0KICAgIGNvbnNvbGUubG9nKCdyZXBsYWNlVGVtcGxhdGVQbGFjZWhvbGRlcnMgY2FsbGVkIHdpdGg6JywgeyBib2R5LCB0ZW1wbGF0ZURhdGEsIGJvZHlUeXBlOiB0eXBlb2YgYm9keSwgdGVtcGxhdGVEYXRhVHlwZTogdHlwZW9mIHRlbXBsYXRlRGF0YSB9KTsNCg0KICAgIGlmICghYm9keSkgew0KICAgICAgICBjb25zb2xlLmxvZygnQm9keSBpcyBlbXB0eSwgcmV0dXJuaW5nIGFzLWlzJyk7DQogICAgICAgIHJldHVybiBib2R5Ow0KICAgIH0NCg0KICAgIC8vIEhhbmRsZSBib3RoIHN0cmluZyBhbmQgb2JqZWN0IGlucHV0cw0KICAgIGxldCBib2R5U3RyaW5nOw0KICAgIGxldCBpc0pzb25TdHJpbmcgPSBmYWxzZTsNCg0KICAgIGlmICh0eXBlb2YgYm9keSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgYm9keVN0cmluZyA9IGJvZHk7DQogICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYWxyZWFkeSBhIEpTT04gc3RyaW5nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBKU09OLnBhcnNlKGJvZHkpOw0KICAgICAgICAgICAgaXNKc29uU3RyaW5nID0gdHJ1ZTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgLy8gTm90IGEgSlNPTiBzdHJpbmcsIHRyZWF0IGFzIHJlZ3VsYXIgc3RyaW5nDQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBib2R5ID09PSAnb2JqZWN0Jykgew0KICAgICAgICBib2R5U3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoYm9keSk7DQogICAgICAgIGlzSnNvblN0cmluZyA9IHRydWU7DQogICAgfSBlbHNlIHsNCiAgICAgICAgY29uc29sZS5sb2coJ0JvZHkgaXMgbmVpdGhlciBzdHJpbmcgbm9yIG9iamVjdCwgcmV0dXJuaW5nIGFzLWlzJyk7DQogICAgICAgIHJldHVybiBib2R5Ow0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCdCb2R5IHN0cmluZyBiZWZvcmUgcmVwbGFjZW1lbnQ6JywgYm9keVN0cmluZywgJ2lzSnNvblN0cmluZzonLCBpc0pzb25TdHJpbmcpOw0KDQogICAgLy8gUmVwbGFjZSBwbGFjZWhvbGRlcnMgd2l0aCB0ZW1wbGF0ZSBkYXRhDQogICAgaWYgKHRlbXBsYXRlRGF0YSAhPT0gdW5kZWZpbmVkICYmIHRlbXBsYXRlRGF0YSAhPT0gbnVsbCkgew0KICAgICAgICBjb25zdCBiZWZvcmVSZXBsYWNlID0gYm9keVN0cmluZzsNCg0KICAgICAgICBjb25zb2xlLmxvZygnU3RhcnRpbmcgdGVtcGxhdGUgcmVwbGFjZW1lbnQgd2l0aCB0ZW1wbGF0ZURhdGE6JywgdGVtcGxhdGVEYXRhKTsNCg0KICAgICAgICAvLyBTaW1wbGUgSlNPTiBmaWVsZCByZXBsYWNlbWVudCAtIGp1c3Qge3tmaWVsZH19IG9yIHt7bmVzdGVkLmZpZWxkfX0NCiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wbGF0ZURhdGEgPT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvY2Vzc2luZyBzaW1wbGUgZmllbGQgcmVwbGFjZW1lbnRzIGZvciBvYmplY3QgdGVtcGxhdGVEYXRhJyk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVGVtcGxhdGUgZGF0YSBrZXlzOicsIE9iamVjdC5rZXlzKHRlbXBsYXRlRGF0YSkpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0xvb2tpbmcgZm9yIHBhdHRlcm5zIGxpa2Uge3tmaWVsZH19IGluIGJvZHkgc3RyaW5nOicsIGJvZHlTdHJpbmcpOw0KDQogICAgICAgICAgICAvLyBVc2UgYSBzaW1wbGVyLCBtb3JlIGV4cGxpY2l0IHJlZ2V4DQogICAgICAgICAgICBjb25zdCBwbGFjZWhvbGRlclJlZ2V4ID0gL1x7XHsoW159XSspXH1cfS9nOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1VzaW5nIHJlZ2V4OicsIHBsYWNlaG9sZGVyUmVnZXgpOw0KDQogICAgICAgICAgICAvLyBUZXN0IGlmIHRoZSByZWdleCBmaW5kcyBhbnl0aGluZw0KICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IGJvZHlTdHJpbmcubWF0Y2gocGxhY2Vob2xkZXJSZWdleCk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnUmVnZXggbWF0Y2hlcyBmb3VuZDonLCBtYXRjaGVzKTsNCg0KICAgICAgICAgICAgYm9keVN0cmluZyA9IGJvZHlTdHJpbmcucmVwbGFjZShwbGFjZWhvbGRlclJlZ2V4LCAobWF0Y2gsIGZpZWxkUGF0aCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCBwYXR0ZXJuIHt7JyArIGZpZWxkUGF0aCArICd9fSwgZXh0cmFjdGluZyB2YWx1ZS4uLicpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0TmVzdGVkVmFsdWUodGVtcGxhdGVEYXRhLCBmaWVsZFBhdGgpOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0ZWQgdmFsdWUgZm9yJywgZmllbGRQYXRoLCAnOicsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVmFsdWUgdHlwZTonLCB0eXBlb2YgdmFsdWUpOw0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXBsYWNlbWVudDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBlc2NhcGUgdGhlIHN0cmluZyBwcm9wZXJseSBmb3IgSlNPTiBjb250ZXh0DQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlbWVudCA9IHZhbHVlLnJlcGxhY2UoL1xcL2csICdcXFxcJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvIi9nLCAnXFwiJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXG4vZywgJ1xcbicpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xyL2csICdcXHInKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cdC9nLCAnXFx0Jyk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3Igbm9uLXN0cmluZ3MsIGNvbnZlcnQgdG8gSlNPTiBzdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50ID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXBsYWNpbmcnLCBtYXRjaCwgJ3dpdGg6JywgcmVwbGFjZW1lbnQpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVwbGFjZW1lbnQ7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZpZWxkIG5vdCBmb3VuZCwga2VlcGluZyBvcmlnaW5hbDonLCBtYXRjaCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGVtcGxhdGVEYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgLy8gRm9yIHN0cmluZ3MsIGp1c3QgcmVwbGFjZSB7e1ZBTFVFfX0gYXMgYSBmYWxsYmFjaw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2Nlc3Npbmcgc3RyaW5nIHRlbXBsYXRlRGF0YSwgcmVwbGFjaW5nIHt7VkFMVUV9fScpOw0KICAgICAgICAgICAgYm9keVN0cmluZyA9IGJvZHlTdHJpbmcucmVwbGFjZSgve3tWQUxVRX19L2csIEpTT04uc3RyaW5naWZ5KHRlbXBsYXRlRGF0YSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgY29uc29sZS5sb2coJ1RlbXBsYXRlIHJlcGxhY2VtZW50IHJlc3VsdDonLCB7DQogICAgICAgICAgICBiZWZvcmU6IGJlZm9yZVJlcGxhY2UsDQogICAgICAgICAgICBhZnRlcjogYm9keVN0cmluZywNCiAgICAgICAgICAgIHJlcGxhY2VkOiBiZWZvcmVSZXBsYWNlICE9PSBib2R5U3RyaW5nLA0KICAgICAgICAgICAgdGVtcGxhdGVEYXRhOiB0ZW1wbGF0ZURhdGENCiAgICAgICAgfSk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgY29uc29sZS5sb2coJ05vIHRlbXBsYXRlIGRhdGEgcHJvdmlkZWQsIHNraXBwaW5nIHJlcGxhY2VtZW50Jyk7DQogICAgfQ0KDQogICAgaWYgKHR5cGVvZiBib2R5ID09PSAnb2JqZWN0Jykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoYm9keVN0cmluZyk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcGFyc2UgdGVtcGxhdGUtcmVwbGFjZWQgYm9keTonLCBlcnJvcik7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdCb2R5IHN0cmluZyB3YXM6JywgYm9keVN0cmluZyk7DQogICAgICAgICAgICByZXR1cm4gYm9keTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBib2R5U3RyaW5nOw0KICAgIH0NCn0NCg0KLy8gR2V0IG5lc3RlZCB2YWx1ZSBmcm9tIG9iamVjdCB1c2luZyBkb3Qgbm90YXRpb24NCmZ1bmN0aW9uIGdldE5lc3RlZFZhbHVlKG9iaiwgcGF0aCkgew0KICAgIGNvbnNvbGUubG9nKCdnZXROZXN0ZWRWYWx1ZSBjYWxsZWQgd2l0aDonLCB7IG9iaiwgcGF0aCB9KTsNCiAgICBjb25zdCByZXN1bHQgPSBwYXRoLnNwbGl0KCcuJykucmVkdWNlKChjdXJyZW50LCBrZXkpID0+IHsNCiAgICAgICAgY29uc29sZS5sb2coJ0NoZWNraW5nIGtleTonLCBrZXksICdpbjonLCBjdXJyZW50KTsNCiAgICAgICAgY29uc3QgdmFsdWUgPSBjdXJyZW50ICYmIGN1cnJlbnRba2V5XSAhPT0gdW5kZWZpbmVkID8gY3VycmVudFtrZXldIDogdW5kZWZpbmVkOw0KICAgICAgICBjb25zb2xlLmxvZygnVmFsdWUgZm9yIGtleScsIGtleSwgJzonLCB2YWx1ZSk7DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICB9LCBvYmopOw0KICAgIGNvbnNvbGUubG9nKCdnZXROZXN0ZWRWYWx1ZSByZXN1bHQgZm9yIHBhdGgnLCBwYXRoLCAnOicsIHJlc3VsdCk7DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KDQovLyBVcGRhdGUgSlNPTiBleHRyYWN0IG5vZGUgZGlzcGxheQ0KZnVuY3Rpb24gdXBkYXRlSnNvbkV4dHJhY3REaXNwbGF5KG5vZGVJZCwgbGFiZWwsIHZhbHVlLCBzdGF0dXMgPSAnbm9ybWFsJykgew0KICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgY29uc3QgY29udGVudEVsZW1lbnQgPSBub2RlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZmxvdy1ub2RlLWNvbnRlbnQnKTsNCiAgICAgICAgaWYgKGNvbnRlbnRFbGVtZW50KSB7DQogICAgICAgICAgICBjb25zdCBzdGF0dXNDbGFzcyA9IHN0YXR1cyA9PT0gJ2Vycm9yJyA/ICd0ZXh0LWRhbmdlcicgOiBzdGF0dXMgPT09ICdzdWNjZXNzJyA/ICd0ZXh0LXN1Y2Nlc3MnIDogJ3RleHQtbXV0ZWQnOw0KDQogICAgICAgICAgICAvLyBTaG93IGp1c3QgYSBzdGF0dXMgb24gdGhlIG5vZGUsIGZ1bGwgY29udGVudCB3aWxsIGJlIGluIGNvbmZpZyBwYW5lbA0KICAgICAgICAgICAgY29uc3QgdHJ1bmNhdGVkVmFsdWUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLmxlbmd0aCA+IDUwID8NCiAgICAgICAgICAgICAgICB2YWx1ZS5zdWJzdHJpbmcoMCwgNTApICsgJy4uLicgOiB2YWx1ZTsNCg0KICAgICAgICAgICAgY29udGVudEVsZW1lbnQuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5vZGUtc3RhdHVzIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3RhdHVzLXRleHQiPlZhbHVlIGV4dHJhY3RlZDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0dXMtaW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+JHtsYWJlbH06ICR7ZXNjYXBlSHRtbChTdHJpbmcodHJ1bmNhdGVkVmFsdWUpKX08L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIEFkZCBleGVjdXRpb24gbG9nIGVudHJ5DQpmdW5jdGlvbiBhZGRFeGVjdXRpb25Mb2cobWVzc2FnZSwgdHlwZSA9ICdpbmZvJykgew0KICAgIGNvbnN0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGVjdXRpb24tb3V0cHV0Jyk7DQogICAgaWYgKG91dHB1dCkgew0KICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpOw0KICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJsb2ctZW50cnkgJHt0eXBlfSI+WyR7dGltZXN0YW1wfV0gJHttZXNzYWdlfTwvZGl2PmA7DQogICAgICAgIG91dHB1dC5zY3JvbGxUb3AgPSBvdXRwdXQuc2Nyb2xsSGVpZ2h0Ow0KICAgIH0NCn0NCg0KLy8gQ2xlYXIgZXhlY3V0aW9uIG91dHB1dA0KZnVuY3Rpb24gY2xlYXJPdXRwdXQoKSB7DQogICAgY29uc3Qgb3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4ZWN1dGlvbi1vdXRwdXQnKTsNCiAgICBpZiAob3V0cHV0KSB7DQogICAgICAgIG91dHB1dC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9nLWVudHJ5IGluZm8iPk91dHB1dCBjbGVhcmVkPC9kaXY+JzsNCiAgICB9DQp9DQoNCg0KLy8gSW50ZXJhY3RpdmUgaGVscGVyIGZ1bmN0aW9ucyBmb3Igc3BlY2lhbCBub2RlIHR5cGVzDQoNCi8vIEF1ZGlvIGNvbnRyb2wgZnVuY3Rpb25zDQpmdW5jdGlvbiBwbGF5QXVkaW8obm9kZUlkKSB7DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKCFub2RlIHx8ICFub2RlLmxhc3RBdWRpb1VybCkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdObyBhdWRpbyBkYXRhIGF2YWlsYWJsZSBmb3Igbm9kZTonLCBub2RlSWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gQ3JlYXRlIG9yIHJldXNlIGF1ZGlvIGVsZW1lbnQNCiAgICBpZiAoIW5vZGUuYXVkaW9FbGVtZW50KSB7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50ID0gbmV3IEF1ZGlvKG5vZGUubGFzdEF1ZGlvVXJsKTsNCiAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQudm9sdW1lID0gcGFyc2VGbG9hdChub2RlLmNvbmZpZy52b2x1bWUudmFsdWUpOw0KICAgIH0NCg0KICAgIG5vZGUuYXVkaW9FbGVtZW50LnBsYXkoKS5jYXRjaChlcnJvciA9PiB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwbGF5IGF1ZGlvOicsIGVycm9yKTsNCiAgICB9KTsNCg0KICAgIGNvbnNvbGUubG9nKCdQbGF5aW5nIGF1ZGlvIGZvciBub2RlOicsIG5vZGVJZCk7DQp9DQoNCmZ1bmN0aW9uIHN0b3BBdWRpbyhub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUgfHwgIW5vZGUuYXVkaW9FbGVtZW50KSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGF1ZGlvIGVsZW1lbnQgZm91bmQgZm9yIG5vZGU6Jywgbm9kZUlkKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIG5vZGUuYXVkaW9FbGVtZW50LnBhdXNlKCk7DQogICAgbm9kZS5hdWRpb0VsZW1lbnQuY3VycmVudFRpbWUgPSAwOw0KDQogICAgY29uc29sZS5sb2coJ1N0b3BwZWQgYXVkaW8gZm9yIG5vZGU6Jywgbm9kZUlkKTsNCn0NCg0KLy8gSW1hZ2UgZGlzcGxheSBmdW5jdGlvbnMNCmZ1bmN0aW9uIHNob3dGdWxsSW1hZ2Uobm9kZUlkKSB7DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKCFub2RlIHx8ICFub2RlLmxhc3RJbWFnZVVybCkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdObyBpbWFnZSBkYXRhIGF2YWlsYWJsZSBmb3Igbm9kZTonLCBub2RlSWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gQ3JlYXRlIGEgbW9kYWwgdG8gc2hvdyB0aGUgZnVsbCBpbWFnZQ0KICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgbW9kYWwuY2xhc3NOYW1lID0gJ2ltYWdlLW1vZGFsJzsNCiAgICBtb2RhbC5zdHlsZS5jc3NUZXh0ID0gYA0KICAgICAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgICAgIHRvcDogMDsNCiAgICAgICAgbGVmdDogMDsNCiAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjgpOw0KICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgei1pbmRleDogMTAwMDA7DQogICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBgOw0KDQogICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7DQogICAgaW1nLnNyYyA9IG5vZGUubGFzdEltYWdlVXJsOw0KICAgIGltZy5zdHlsZS5jc3NUZXh0ID0gYA0KICAgICAgICBtYXgtd2lkdGg6IDkwJTsNCiAgICAgICAgbWF4LWhlaWdodDogOTAlOw0KICAgICAgICBvYmplY3QtZml0OiBjb250YWluOw0KICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7DQogICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDIwcHggcmdiYSgwLCAwLCAwLCAwLjUpOw0KICAgIGA7DQoNCiAgICBtb2RhbC5hcHBlbmRDaGlsZChpbWcpOw0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobW9kYWwpOw0KDQogICAgLy8gQ2xvc2UgbW9kYWwgb24gY2xpY2sNCiAgICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChtb2RhbCk7DQogICAgfSk7DQoNCiAgICBjb25zb2xlLmxvZygnU2hvd2luZyBmdWxsIGltYWdlIGZvciBub2RlOicsIG5vZGVJZCk7DQp9DQoNCi8vIFJlcGVhdGVyIGNvbnRyb2wgZnVuY3Rpb25zDQpmdW5jdGlvbiBzdGFydFJlcGVhdGVyKG5vZGVJZCkgew0KICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChub2RlSWQpOw0KICAgIGlmICghbm9kZSB8fCBub2RlLnR5cGUgIT09ICdyZXBlYXRlcicpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCByZXBlYXRlciBub2RlOicsIG5vZGVJZCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBFeGVjdXRlIHRoZSByZXBlYXRlciBub2RlIHRvIHN0YXJ0IGl0DQogICAgZXhlY3V0aW9uRW5naW5lLmV4ZWN1dGVOb2RlKG5vZGUsIHt9LCBuZXcgU2V0KCkpLnRoZW4oKCkgPT4gew0KICAgICAgICBjb25zb2xlLmxvZygnUmVwZWF0ZXIgc3RhcnRlZDonLCBub2RlSWQpOw0KICAgICAgICAvLyBSZWZyZXNoIHRoZSBjb25maWcgcGFuZWwgdG8gdXBkYXRlIHRoZSBVSQ0KICAgICAgICBzaG93Tm9kZUNvbmZpZyhub2RlSWQpOw0KICAgIH0pLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHN0YXJ0IHJlcGVhdGVyOicsIGVycm9yKTsNCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gc3RvcFJlcGVhdGVyKG5vZGVJZCkgew0KICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChub2RlSWQpOw0KICAgIGlmICghbm9kZSB8fCBub2RlLnR5cGUgIT09ICdyZXBlYXRlcicpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCByZXBlYXRlciBub2RlOicsIG5vZGVJZCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBTdG9wIHRoZSByZXBlYXRlciB1c2luZyB0aGUgZXhlY3V0aW9uIGVuZ2luZSBtZXRob2QNCiAgICBleGVjdXRpb25FbmdpbmUuc3RvcFJlcGVhdGVyKG5vZGUpOw0KICAgIGNvbnNvbGUubG9nKCdSZXBlYXRlciBzdG9wcGVkOicsIG5vZGVJZCk7DQoNCiAgICAvLyBSZWZyZXNoIHRoZSBjb25maWcgcGFuZWwgdG8gdXBkYXRlIHRoZSBVSQ0KICAgIHNob3dOb2RlQ29uZmlnKG5vZGVJZCk7DQp9DQoNCg0KDQovLyBVcGRhdGUgaW5wdXQgbWFwcGluZyB3aGVuIHVzZXIgc2VsZWN0cyBhIGRpZmZlcmVudCBvdXRwdXQgcG9ydA0KZnVuY3Rpb24gdXBkYXRlSW5wdXRNYXBwaW5nKG5vZGVJZCwgaW5wdXRQb3J0LCBzZWxlY3RlZE91dHB1dFBvcnQpIHsNCiAgICBjb25zb2xlLmxvZyhgVXBkYXRpbmcgaW5wdXQgbWFwcGluZzogJHtub2RlSWR9LiR7aW5wdXRQb3J0fSDihpAgJHtzZWxlY3RlZE91dHB1dFBvcnR9YCk7DQogICAgLy8gRmluZCB0aGUgY29ubmVjdGlvbiB0aGF0IGdvZXMgdG8gdGhpcyBpbnB1dCBwb3J0IChpZ25vcmUgZnJvbS5wb3J0TmFtZSkNCiAgICBjb25zdCBjb25uZWN0aW9uID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5maW5kKGNvbm4gPT4NCiAgICAgICAgY29ubi50by5ub2RlSWQgPT09IG5vZGVJZCAmJiBjb25uLnRvLnBvcnROYW1lID09PSBpbnB1dFBvcnQNCiAgICApOw0KICAgIGlmIChjb25uZWN0aW9uKSB7DQogICAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIGNvbm5lY3Rpb24NCiAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5kZWxldGUoY29ubmVjdGlvbi5pZCk7DQogICAgICAgIGlmIChjb25uZWN0aW9uLnN2ZykgY29ubmVjdGlvbi5zdmcucmVtb3ZlKCk7DQogICAgICAgIC8vIENyZWF0ZSBhIG5ldyBjb25uZWN0aW9uIHdpdGggdGhlIHVwZGF0ZWQgcG9ydCBuYW1lIGFuZCBuZXcgSUQNCiAgICAgICAgY29uc3QgbmV3Q29ubmVjdGlvbklkID0gYGNvbm5fJHtjb25uZWN0aW9uLmZyb20ubm9kZUlkfV8ke3NlbGVjdGVkT3V0cHV0UG9ydH1fJHtjb25uZWN0aW9uLnRvLm5vZGVJZH1fJHtjb25uZWN0aW9uLnRvLnBvcnROYW1lfWA7DQogICAgICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb24gPSB7DQogICAgICAgICAgICBpZDogbmV3Q29ubmVjdGlvbklkLA0KICAgICAgICAgICAgZnJvbTogeyBub2RlSWQ6IGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQsIHBvcnROYW1lOiBzZWxlY3RlZE91dHB1dFBvcnQgfSwNCiAgICAgICAgICAgIHRvOiB7IG5vZGVJZDogY29ubmVjdGlvbi50by5ub2RlSWQsIHBvcnROYW1lOiBjb25uZWN0aW9uLnRvLnBvcnROYW1lIH0NCiAgICAgICAgfTsNCiAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5zZXQobmV3Q29ubmVjdGlvbklkLCBuZXdDb25uZWN0aW9uKTsNCiAgICAgICAgZHJhd0Nvbm5lY3Rpb24obmV3Q29ubmVjdGlvbik7DQogICAgICAgIC8vIFJlZnJlc2ggdGhlIG5vZGUgY29uZmlnIHBhbmVsIHRvIHNob3cgdXBkYXRlZCBzdGF0ZQ0KICAgICAgICBpZiAoZmxvd0VkaXRvci5zZWxlY3RlZE5vZGUgPT09IG5vZGVJZCkgew0KICAgICAgICAgICAgc2hvd05vZGVDb25maWcobm9kZUlkKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBdXRvLXNhdmUgdGhlIHdvcmtmbG93IHRvIHBlcnNpc3QgdGhlIG1hcHBpbmcgY2hhbmdlDQogICAgICAgIGlmICh3aW5kb3cuZmlsZU1hbmFnZXIuc2F2ZUZsb3cpIHsNCiAgICAgICAgICAgIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvdygpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyBVcGRhdGUgb3V0cHV0IG1hcHBpbmcgd2hlbiB1c2VyIHNlbGVjdHMgYSBkaWZmZXJlbnQgb3V0cHV0IHBvcnQNCmZ1bmN0aW9uIHVwZGF0ZU91dHB1dE1hcHBpbmcobm9kZUlkLCBvdXRwdXRQb3J0LCB0YXJnZXROb2RlSWQsIHNlbGVjdGVkT3V0cHV0UG9ydCkgew0KICAgIGNvbnNvbGUubG9nKGBVcGRhdGluZyBvdXRwdXQgbWFwcGluZzogJHtub2RlSWR9LiR7b3V0cHV0UG9ydH0g4oaSICR7dGFyZ2V0Tm9kZUlkfSAobmV3IG91dHB1dDogJHtzZWxlY3RlZE91dHB1dFBvcnR9KWApOw0KICAgIC8vIFJlbW92ZSBhbGwgY29ubmVjdGlvbnMgZnJvbSB0aGlzIG5vZGUgdG8gdGhlIHRhcmdldCBub2RlIChyZWdhcmRsZXNzIG9mIHBvcnQpDQogICAgY29uc3QgY29ubmVjdGlvbnNUb1JlbW92ZSA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkuZmlsdGVyKGNvbm4gPT4NCiAgICAgICAgY29ubi5mcm9tLm5vZGVJZCA9PT0gbm9kZUlkICYmIGNvbm4udG8ubm9kZUlkID09PSB0YXJnZXROb2RlSWQNCiAgICApOw0KICAgIGNvbm5lY3Rpb25zVG9SZW1vdmUuZm9yRWFjaChjb25uID0+IHsNCiAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5kZWxldGUoY29ubi5pZCk7DQogICAgICAgIGlmIChjb25uLnN2ZykgY29ubi5zdmcucmVtb3ZlKCk7DQogICAgfSk7DQogICAgLy8gQWRkIHRoZSBuZXcgY29ubmVjdGlvbg0KICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb25JZCA9IGBjb25uXyR7bm9kZUlkfV8ke3NlbGVjdGVkT3V0cHV0UG9ydH1fJHt0YXJnZXROb2RlSWR9YDsNCiAgICBjb25zdCBuZXdDb25uZWN0aW9uID0gew0KICAgICAgICBpZDogbmV3Q29ubmVjdGlvbklkLA0KICAgICAgICBmcm9tOiB7IG5vZGVJZDogbm9kZUlkLCBwb3J0TmFtZTogc2VsZWN0ZWRPdXRwdXRQb3J0IH0sDQogICAgICAgIHRvOiB7IG5vZGVJZDogdGFyZ2V0Tm9kZUlkLCBwb3J0TmFtZTogY29ubmVjdGlvbnNUb1JlbW92ZVswXT8udG8ucG9ydE5hbWUgfHwgJ2RhdGEnIH0NCiAgICB9Ow0KICAgIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuc2V0KG5ld0Nvbm5lY3Rpb25JZCwgbmV3Q29ubmVjdGlvbik7DQogICAgZHJhd0Nvbm5lY3Rpb24obmV3Q29ubmVjdGlvbik7DQogICAgLy8gUmVmcmVzaCB0aGUgdGFyZ2V0IG5vZGUgaWYgc2VsZWN0ZWQNCiAgICBpZiAoZmxvd0VkaXRvci5zZWxlY3RlZE5vZGUgPT09IHRhcmdldE5vZGVJZCkgew0KICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIHNob3dOb2RlQ29uZmlnKHRhcmdldE5vZGVJZCk7DQogICAgICAgIH0sIDEwKTsNCiAgICB9DQogICAgLy8gQXV0by1zYXZlDQogICAgaWYgKHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvdykgd2luZG93LmZpbGVNYW5hZ2VyLnNhdmVGbG93KCk7DQp9DQoNCg0KLy8gbm9kZS1yZWdpc3RyeS5qcyAtIER5bmFtaWMgbm9kZSByZWdpc3RyeSBmb3IgRmxvdyBFZGl0b3INCg0KY2xhc3MgTm9kZVJlZ2lzdHJ5IHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgY29uc29sZS5sb2coJ05vZGVSZWdpc3RyeSBjb25zdHJ1Y3RvciBjYWxsZWQnKTsNCiAgICAgICAgdGhpcy5ub2RlVHlwZXMgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMuZXhlY3V0b3JzID0gbmV3IE1hcCgpOw0KICAgICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOw0KICAgICAgICBjb25zb2xlLmxvZygnTm9kZVJlZ2lzdHJ5IGluaXRpYWxpemVkJyk7DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIGxvYWROb2Rlc0Zyb21WRlMoKSB7DQogICAgICAgIGlmICh0aGlzLmxvYWRlZCkgcmV0dXJuOw0KICAgICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIG5vZGVzIGZyb20gVkZTIHBhY2tlZCBmaWxlLi4uJyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIExvYWQgdGhlIHBhY2tlZCBub2RlcyBmaWxlIGRpcmVjdGx5DQogICAgICAgICAgICBjb25zdCBwYWNrRmlsZVBhdGggPSAnL25vZGVzL25vZGVzLXBhY2suanNvbic7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTG9hZGluZyBwYWNrZWQgbm9kZXMgZnJvbTogJHtwYWNrRmlsZVBhdGh9YCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlVGV4dChwYWNrRmlsZVBhdGgpOw0KICAgICAgICAgICAgY29uc3QgcGFja0RhdGEgPSBKU09OLnBhcnNlKGNvbnRlbnQpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTG9hZGVkIHBhY2tlZCBub2RlcyAodmVyc2lvbiAke3BhY2tEYXRhLnZlcnNpb259KSwgdG90YWwgbm9kZXM6ICR7cGFja0RhdGEudG90YWxfbm9kZXN9YCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIGFsbCBub2RlcyBmcm9tIHRoZSBwYWNrDQogICAgICAgICAgICBmb3IgKGNvbnN0IFtub2RlSWQsIG5vZGVEZWZdIG9mIE9iamVjdC5lbnRyaWVzKHBhY2tEYXRhLm5vZGVzKSkgew0KICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJOb2RlKG5vZGVEZWYpOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZWdpc3RlcmVkIG5vZGU6ICR7bm9kZUlkfWApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWU7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTG9hZGVkICR7dGhpcy5ub2RlVHlwZXMuc2l6ZX0gbm9kZSB0eXBlczpgLCBBcnJheS5mcm9tKHRoaXMubm9kZVR5cGVzLmtleXMoKSkpOw0KICAgICAgICAgICAgDQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBub2RlcyBmcm9tIFZGUyBwYWNrZWQgZmlsZTonLCBlcnJvcik7DQogICAgICAgICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgdG8gaW5kaWNhdGUgZmFpbHVyZQ0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIGxvYWROb2RlRmlsZShmaWxlUGF0aCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coYExvYWRpbmcgbm9kZSBmcm9tOiAke2ZpbGVQYXRofWApOw0KICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHN5cG5leEFQSS5yZWFkVmlydHVhbEZpbGVUZXh0KGZpbGVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IG5vZGVEZWYgPSBKU09OLnBhcnNlKGNvbnRlbnQpOw0KICAgICAgICAgICAgdGhpcy5yZWdpc3Rlck5vZGUobm9kZURlZik7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTG9hZGVkIG5vZGU6ICR7bm9kZURlZi5pZH1gKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIG5vZGUgZnJvbSAke2ZpbGVQYXRofTpgLCBlcnJvcik7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmVnaXN0ZXJOb2RlKG5vZGVEZWYpIHsNCiAgICAgICAgdGhpcy5ub2RlVHlwZXMuc2V0KG5vZGVEZWYuaWQsIG5vZGVEZWYpOw0KICAgIH0NCiAgICANCiAgICByZWdpc3RlckV4ZWN1dG9yKG5hbWUsIGV4ZWN1dG9yKSB7DQogICAgICAgIHRoaXMuZXhlY3V0b3JzLnNldChuYW1lLCBleGVjdXRvcik7DQogICAgfQ0KICAgIA0KICAgIGdldE5vZGVUeXBlKGlkKSB7DQogICAgICAgIHJldHVybiB0aGlzLm5vZGVUeXBlcy5nZXQoaWQpOw0KICAgIH0NCiAgICANCiAgICBnZXRFeGVjdXRvcihuYW1lKSB7DQogICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dG9ycy5nZXQobmFtZSk7DQogICAgfQ0KICAgIA0KICAgIGdldEFsbE5vZGVUeXBlcygpIHsNCiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5ub2RlVHlwZXMudmFsdWVzKCkpOw0KICAgIH0NCiAgICANCiAgICBnZXROb2RlVHlwZXNCeUNhdGVnb3J5KGNhdGVnb3J5KSB7DQogICAgICAgIHJldHVybiB0aGlzLmdldEFsbE5vZGVUeXBlcygpLmZpbHRlcihub2RlID0+IG5vZGUuY2F0ZWdvcnkgPT09IGNhdGVnb3J5KTsNCiAgICB9DQp9DQoNCi8vIEdsb2JhbCBub2RlIHJlZ2lzdHJ5IGluc3RhbmNlDQpjb25zb2xlLmxvZygnQ3JlYXRpbmcgZ2xvYmFsIG5vZGVSZWdpc3RyeSBpbnN0YW5jZS4uLicpOw0KY29uc3Qgbm9kZVJlZ2lzdHJ5ID0gbmV3IE5vZGVSZWdpc3RyeSgpOw0KY29uc29sZS5sb2coJ0dsb2JhbCBub2RlUmVnaXN0cnkgY3JlYXRlZDonLCBub2RlUmVnaXN0cnkpOyANCg0KLy8gY2FudmFzLmpzIC0gQ2FudmFzIGV2ZW50IGhhbmRsZXJzIGFuZCBkcmF3aW5nIGxvZ2ljIGZvciBGbG93IEVkaXRvcg0KDQovLyBTdGFydCBkcmFnZ2luZyBhIG5vZGUNCmZ1bmN0aW9uIHN0YXJ0RHJhZ2dpbmdOb2RlKG5vZGVJZCwgZSkgew0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgIA0KICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChub2RlSWQpOw0KICAgIGlmICghbm9kZSkgcmV0dXJuOw0KICAgIA0KICAgIGZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlID0gbm9kZUlkOw0KICAgIA0KICAgIC8vIENhbGN1bGF0ZSBvZmZzZXQgZnJvbSBtb3VzZSB0byBub2RlIGNvcm5lciB1c2luZyBzY2FsZWQgY29vcmRpbmF0ZXMNCiAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGVJZCk7DQogICAgY29uc3QgcmVjdCA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPyANCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3Qobm9kZUVsZW1lbnQpIDogDQogICAgICAgIG5vZGVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDogDQogICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICANCiAgICBmbG93RWRpdG9yLmRyYWdPZmZzZXQgPSB7DQogICAgICAgIHg6IG1vdXNlQ29vcmRzLnggLSByZWN0LmxlZnQsDQogICAgICAgIHk6IG1vdXNlQ29vcmRzLnkgLSByZWN0LnRvcA0KICAgIH07DQogICAgDQogICAgbm9kZUVsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ2dyYWJiaW5nJzsNCiAgICBub2RlRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMTAwMCc7IC8vIEJyaW5nIHRvIGZyb250IHdoaWxlIGRyYWdnaW5nDQogICAgDQogICAgLy8gQ2FjaGUgY2FudmFzIHJlY3QgZm9yIHBlcmZvcm1hbmNlIChzY2FsZWQpDQogICAgZmxvd0VkaXRvci5jYW52YXNSZWN0ID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChmbG93RWRpdG9yLmNhbnZhcykgOiANCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQp9DQoNCi8vIFNlbGVjdCBhIG5vZGUNCmZ1bmN0aW9uIHNlbGVjdE5vZGUobm9kZUlkKSB7DQogICAgLy8gUmVtb3ZlIHByZXZpb3VzIHNlbGVjdGlvbg0KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mbG93LW5vZGUuc2VsZWN0ZWQnKS5mb3JFYWNoKG5vZGUgPT4gew0KICAgICAgICBub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7DQogICAgfSk7DQogICAgDQogICAgLy8gU2VsZWN0IG5ldyBub2RlDQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub2RlSWQpOw0KICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOw0KICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG5vZGVJZDsNCiAgICAgICAgc2hvd05vZGVDb25maWcobm9kZUlkKTsNCiAgICB9DQp9DQoNCg0KLy8gU3RhcnQgYSBjb25uZWN0aW9uIGZyb20gYSBwb3J0DQpmdW5jdGlvbiBzdGFydENvbm5lY3Rpb24obm9kZUlkLCBwb3J0TmFtZSwgaXNPdXRwdXQpIHsNCiAgICBpZiAoaXNPdXRwdXQpIHsNCiAgICAgICAgLy8gU3RhcnRpbmcgZnJvbSBvdXRwdXQgcG9ydA0KICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tID0gew0KICAgICAgICAgICAgbm9kZUlkOiBub2RlSWQsDQogICAgICAgICAgICBwb3J0TmFtZTogcG9ydE5hbWUsDQogICAgICAgICAgICBpc091dHB1dDogdHJ1ZQ0KICAgICAgICB9Ow0KICAgICAgICBjb25zb2xlLmxvZygnU3RhcnRlZCBjb25uZWN0aW9uIGZyb20gb3V0cHV0OicsIG5vZGVJZCwgcG9ydE5hbWUpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIFN0YXJ0aW5nIGZyb20gaW5wdXQgcG9ydCAtIGNoZWNrIGlmIHdlIGhhdmUgYSBwZW5kaW5nIGNvbm5lY3Rpb24NCiAgICAgICAgaWYgKGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20gJiYgZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbS5pc091dHB1dCkgew0KICAgICAgICAgICAgLy8gQ29tcGxldGUgdGhlIGNvbm5lY3Rpb24NCiAgICAgICAgICAgIGNvbnN0IGZyb21Ob2RlSWQgPSBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tLm5vZGVJZDsNCiAgICAgICAgICAgIGNvbnN0IGZyb21Qb3J0ID0gZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbS5wb3J0TmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY3JlYXRlQ29ubmVjdGlvbihmcm9tTm9kZUlkLCBmcm9tUG9ydCwgbm9kZUlkLCBwb3J0TmFtZSk7DQogICAgICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tID0gbnVsbDsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb21wbGV0ZWQgY29ubmVjdGlvbjonLCBmcm9tTm9kZUlkLCBmcm9tUG9ydCwgJy0+Jywgbm9kZUlkLCBwb3J0TmFtZSk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFVwZGF0ZSBjb25uZWN0aW9ucyBmb3IgYSBzcGVjaWZpYyBub2RlDQpmdW5jdGlvbiB1cGRhdGVDb25uZWN0aW9uc0Zvck5vZGUobm9kZUlkKSB7DQogICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpIHsNCiAgICAgICAgaWYgKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgPT09IG5vZGVJZCB8fCBjb25uZWN0aW9uLnRvLm5vZGVJZCA9PT0gbm9kZUlkKSB7DQogICAgICAgICAgICB1cGRhdGVDb25uZWN0aW9uKGNvbm5lY3Rpb24pOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyBVcGRhdGUgYSBzaW5nbGUgY29ubmVjdGlvbg0KZnVuY3Rpb24gdXBkYXRlQ29ubmVjdGlvbihjb25uZWN0aW9uKSB7DQogICAgY29uc3QgZnJvbU5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25uZWN0aW9uLmZyb20ubm9kZUlkKTsNCiAgICBjb25zdCB0b05vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25uZWN0aW9uLnRvLm5vZGVJZCk7DQogICAgDQogICAgaWYgKCFmcm9tTm9kZSB8fCAhdG9Ob2RlIHx8ICFjb25uZWN0aW9uLnN2Zykgew0KICAgICAgICBjb25zb2xlLmxvZygnTWlzc2luZyBlbGVtZW50cyBmb3IgY29ubmVjdGlvbjonLCBjb25uZWN0aW9uLmlkKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBHZXQgbm9kZSBkYXRhIHBvc2l0aW9ucw0KICAgIGNvbnN0IGZyb21Ob2RlRGF0YSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQpOw0KICAgIGNvbnN0IHRvTm9kZURhdGEgPSBmbG93RWRpdG9yLm5vZGVzLmdldChjb25uZWN0aW9uLnRvLm5vZGVJZCk7DQogICAgDQogICAgaWYgKCFmcm9tTm9kZURhdGEgfHwgIXRvTm9kZURhdGEpIHsNCiAgICAgICAgY29uc29sZS5sb2coJ01pc3Npbmcgbm9kZSBkYXRhIGZvciBjb25uZWN0aW9uOicsIGNvbm5lY3Rpb24uaWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIEdldCBhY3R1YWwgbm9kZSBkaW1lbnNpb25zIGZyb20gY29tcHV0ZWQgc3R5bGVzDQogICAgY29uc3QgZnJvbVN0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGZyb21Ob2RlKTsNCiAgICBjb25zdCB0b1N0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRvTm9kZSk7DQogICAgDQogICAgY29uc3QgZnJvbVdpZHRoID0gcGFyc2VGbG9hdChmcm9tU3R5bGVzLndpZHRoKSB8fCAyMDA7DQogICAgY29uc3QgZnJvbUhlaWdodCA9IHBhcnNlRmxvYXQoZnJvbVN0eWxlcy5oZWlnaHQpIHx8IDgwOw0KICAgIGNvbnN0IHRvV2lkdGggPSBwYXJzZUZsb2F0KHRvU3R5bGVzLndpZHRoKSB8fCAyMDA7DQogICAgY29uc3QgdG9IZWlnaHQgPSBwYXJzZUZsb2F0KHRvU3R5bGVzLmhlaWdodCkgfHwgODA7DQogICAgDQogICAgLy8gQ2FsY3VsYXRlIGNvbm5lY3Rpb24gcG9zaXRpb25zIGRpcmVjdGx5IGZyb20gbm9kZSBkYXRhIChubyBleHRyYSB0cmFuc2Zvcm1zKQ0KICAgIC8vIEZyb20gb3V0cHV0IHBvcnQgKHJpZ2h0IHNpZGUgb2YgZnJvbSBub2RlLCBtaWRkbGUgdmVydGljYWxseSkNCiAgICBjb25zdCBmcm9tWCA9IGZyb21Ob2RlRGF0YS54ICsgZnJvbVdpZHRoOw0KICAgIGNvbnN0IGZyb21ZID0gZnJvbU5vZGVEYXRhLnkgKyBmcm9tSGVpZ2h0IC8gMjsNCiAgICANCiAgICAvLyBUbyBpbnB1dCBwb3J0IChsZWZ0IHNpZGUgb2YgdG8gbm9kZSwgbWlkZGxlIHZlcnRpY2FsbHkpICANCiAgICBjb25zdCB0b1ggPSB0b05vZGVEYXRhLng7DQogICAgY29uc3QgdG9ZID0gdG9Ob2RlRGF0YS55ICsgdG9IZWlnaHQgLyAyOw0KICAgIA0KICAgIGNvbnNvbGUubG9nKCdDb25uZWN0aW9uIGNvb3JkczonLCBjb25uZWN0aW9uLmlkLCAnZnJvbTonLCBmcm9tWCwgZnJvbVksICd0bzonLCB0b1gsIHRvWSk7DQogICAgDQogICAgLy8gVXBkYXRlIHRoZSBwYXRoDQogICAgY29uc3QgcGF0aCA9IGNvbm5lY3Rpb24uc3ZnLnF1ZXJ5U2VsZWN0b3IoJ3BhdGgnKTsNCiAgICBpZiAocGF0aCkgew0KICAgICAgICBjb25zdCBjb250cm9sUG9pbnQxWCA9IGZyb21YICsgKHRvWCAtIGZyb21YKSAqIDAuNTsNCiAgICAgICAgY29uc3QgY29udHJvbFBvaW50MlggPSBmcm9tWCArICh0b1ggLSBmcm9tWCkgKiAwLjU7DQogICAgICAgIGNvbnN0IHBhdGhEID0gYE0gJHtmcm9tWH0gJHtmcm9tWX0gQyAke2NvbnRyb2xQb2ludDFYfSAke2Zyb21ZfSAke2NvbnRyb2xQb2ludDJYfSAke3RvWX0gJHt0b1h9ICR7dG9ZfWA7DQogICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdkJywgcGF0aEQpOw0KICAgICAgICBjb25zb2xlLmxvZygnU2V0IHBhdGg6JywgcGF0aEQpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdObyBwYXRoIGVsZW1lbnQgZm91bmQgZm9yIGNvbm5lY3Rpb246JywgY29ubmVjdGlvbi5pZCk7DQogICAgfQ0KfQ0KDQovLyBSZWRyYXcgYWxsIGNvbm5lY3Rpb25zIChmb3Igd2luZG93IHJlc2l6ZSwgZXRjLikNCmZ1bmN0aW9uIHJlZHJhd0FsbENvbm5lY3Rpb25zKCkgew0KICAgIGZvciAoY29uc3QgY29ubmVjdGlvbiBvZiBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKSB7DQogICAgICAgIHVwZGF0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7DQogICAgfQ0KfQ0KDQovLyBEZWxldGUgYSBub2RlIGFuZCBhbGwgaXRzIGNvbm5lY3Rpb25zDQpmdW5jdGlvbiBkZWxldGVOb2RlKG5vZGVJZCkgew0KICAgIGlmIChjb25maXJtKGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgbm9kZT9gKSkgew0KICAgICAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICAgICAgDQogICAgICAgIC8vIENsZWFuIHVwIGF1ZGlvIGVsZW1lbnRzIGlmIHRoaXMgaXMgYW4gYXVkaW8gbm9kZQ0KICAgICAgICBpZiAobm9kZSAmJiBub2RlLnR5cGUgPT09ICdhdWRpbycgJiYgbm9kZS5hdWRpb0VsZW1lbnQpIHsNCiAgICAgICAgICAgIC8vIFBhdXNlIGFuZCBzdG9wIHRoZSBhdWRpbw0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQucGF1c2UoKTsNCiAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LmN1cnJlbnRUaW1lID0gMDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gUmVtb3ZlIGV2ZW50IGxpc3RlbmVycyBwcm9wZXJseQ0KICAgICAgICAgICAgaWYgKG5vZGUuYXVkaW9FdmVudExpc3RlbmVycykgew0KICAgICAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgbm9kZS5hdWRpb0V2ZW50TGlzdGVuZXJzLmVuZGVkKTsNCiAgICAgICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIG5vZGUuYXVkaW9FdmVudExpc3RlbmVycy5lcnJvcik7DQogICAgICAgICAgICAgICAgbm9kZS5hdWRpb0V2ZW50TGlzdGVuZXJzID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gU3RvcmUgdGhlIHNyYyBiZWZvcmUgY2xlYXJpbmcgaXQgZm9yIGNsZWFudXANCiAgICAgICAgICAgIGNvbnN0IGF1ZGlvU3JjID0gbm9kZS5hdWRpb0VsZW1lbnQuc3JjOw0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuc3JjID0gJyc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFJldm9rZSBibG9iIFVSTCBpZiBpdCBleGlzdHMNCiAgICAgICAgICAgIGlmIChhdWRpb1NyYyAmJiBhdWRpb1NyYy5zdGFydHNXaXRoKCdibG9iOicpKSB7DQogICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChhdWRpb1NyYyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENsZWFyIHRoZSBhdWRpbyBlbGVtZW50IHJlZmVyZW5jZQ0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBSZW1vdmUgYWxsIGNvbm5lY3Rpb25zIGludm9sdmluZyB0aGlzIG5vZGUNCiAgICAgICAgY29uc3QgY29ubmVjdGlvbnNUb0RlbGV0ZSA9IFtdOw0KICAgICAgICBmb3IgKGNvbnN0IFtjb25uZWN0aW9uSWQsIGNvbm5lY3Rpb25dIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuZW50cmllcygpKSB7DQogICAgICAgICAgICBpZiAoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCA9PT0gbm9kZUlkIHx8IGNvbm5lY3Rpb24udG8ubm9kZUlkID09PSBub2RlSWQpIHsNCiAgICAgICAgICAgICAgICBjb25uZWN0aW9uc1RvRGVsZXRlLnB1c2goY29ubmVjdGlvbklkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRGVsZXRlIGNvbm5lY3Rpb25zDQogICAgICAgIGZvciAoY29uc3QgY29ubmVjdGlvbklkIG9mIGNvbm5lY3Rpb25zVG9EZWxldGUpIHsNCiAgICAgICAgICAgIGRlbGV0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbklkKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gUmVtb3ZlIG5vZGUgZnJvbSBkYXRhIHN0cnVjdHVyZQ0KICAgICAgICBmbG93RWRpdG9yLm5vZGVzLmRlbGV0ZShub2RlSWQpOw0KICAgICAgICANCiAgICAgICAgLy8gUmVtb3ZlIG5vZGUgZWxlbWVudCBmcm9tIERPTQ0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGVJZCk7DQogICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgbm9kZUVsZW1lbnQucmVtb3ZlKCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIERlc2VsZWN0IGlmIHRoaXMgd2FzIHRoZSBzZWxlY3RlZCBub2RlDQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9PT0gbm9kZUlkKSB7DQogICAgICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG51bGw7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9kZS1jb25maWcnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPic7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGNvbnNvbGUubG9nKGBEZWxldGVkIG5vZGU6ICR7bm9kZUlkfWApOw0KICAgIH0NCn0NCg0KLy8gRGVsZXRlIGEgY29ubmVjdGlvbg0KZnVuY3Rpb24gZGVsZXRlQ29ubmVjdGlvbihjb25uZWN0aW9uSWQpIHsNCiAgICBjb25zdCBjb25uZWN0aW9uID0gZmxvd0VkaXRvci5jb25uZWN0aW9ucy5nZXQoY29ubmVjdGlvbklkKTsNCiAgICBpZiAoY29ubmVjdGlvbiAmJiBjb25uZWN0aW9uLnN2Zykgew0KICAgICAgICBjb25uZWN0aW9uLnN2Zy5yZW1vdmUoKTsNCiAgICB9DQogICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5kZWxldGUoY29ubmVjdGlvbklkKTsNCiAgICBjb25zb2xlLmxvZyhgRGVsZXRlZCBjb25uZWN0aW9uOiAke2Nvbm5lY3Rpb25JZH1gKTsNCn0NCg0KLy8gRGVsZXRlIHNlbGVjdGVkIG5vZGUNCmZ1bmN0aW9uIGRlbGV0ZVNlbGVjdGVkTm9kZSgpIHsNCiAgICBpZiAoZmxvd0VkaXRvci5zZWxlY3RlZE5vZGUpIHsNCiAgICAgICAgZGVsZXRlTm9kZShmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSk7DQogICAgfQ0KfQ0KDQovLyBIYW5kbGUga2V5Ym9hcmQgc2hvcnRjdXRzDQpmdW5jdGlvbiBoYW5kbGVLZXlEb3duKGUpIHsNCiAgICBpZiAoZS5rZXkgPT09ICdEZWxldGUnIHx8IChlLmtleSA9PT0gJ0JhY2tzcGFjZScgJiYgZS5jdHJsS2V5KSkgew0KICAgICAgICBpZiAoZmxvd0VkaXRvci5zZWxlY3RlZE5vZGUpIHsNCiAgICAgICAgICAgIGRlbGV0ZVNlbGVjdGVkTm9kZSgpOw0KICAgICAgICB9DQogICAgfSBlbHNlIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsNCiAgICAgICAgLy8gRGVzZWxlY3Qgbm9kZQ0KICAgICAgICBpZiAoZmxvd0VkaXRvci5zZWxlY3RlZE5vZGUpIHsNCiAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmxvd0VkaXRvci5zZWxlY3RlZE5vZGUpOw0KICAgICAgICAgICAgaWYgKG5vZGVFbGVtZW50KSBub2RlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpOw0KICAgICAgICAgICAgZmxvd0VkaXRvci5zZWxlY3RlZE5vZGUgPSBudWxsOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vZGUtY29uZmlnJykuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LW11dGVkIj5TZWxlY3QgYSBub2RlIHRvIGNvbmZpZ3VyZSBpdDwvcD4nOw0KICAgICAgICB9DQogICAgfSBlbHNlIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgZS5rZXkgPT09ICdzJyAmJiAhZS5zaGlmdEtleSkgew0KICAgICAgICAvLyBDdHJsL0NtZCArIFM6IFNhdmUNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIuc2F2ZUZsb3coKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLnNoaWZ0S2V5ICYmIGUua2V5ID09PSAnUycpIHsNCiAgICAgICAgLy8gQ3RybC9DbWQgKyBTaGlmdCArIFM6IFNhdmUgQXMNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIuc2F2ZUZsb3dBcygpOw0KICAgIH0gZWxzZSBpZiAoKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpICYmIGUua2V5ID09PSAnbycpIHsNCiAgICAgICAgLy8gQ3RybC9DbWQgKyBPOiBMb2FkDQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgd2luZG93LmZpbGVNYW5hZ2VyLmxvYWRGbG93KCk7DQogICAgfSBlbHNlIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgZS5rZXkgPT09ICc9Jykgew0KICAgICAgICAvLyBDdHJsL0NtZCArID06IFpvb20gSW4NCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci56b29tSW4oKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJy0nKSB7DQogICAgICAgIC8vIEN0cmwvQ21kICsgLTogWm9vbSBPdXQNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci56b29tT3V0KCk7DQogICAgfSBlbHNlIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgZS5rZXkgPT09ICcwJykgew0KICAgICAgICAvLyBDdHJsL0NtZCArIDA6IFJlc2V0IHpvb20gYW5kIHBhbg0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnJlc2V0Q2FudmFzUGFuKCk7DQogICAgfSBlbHNlIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgKGUuc2hpZnRLZXkpICYmIGUua2V5ID09PSAnRicpIHsNCiAgICAgICAgLy8gQ3RybC9DbWQgKyBTaGlmdCArIEY6IFpvb20gdG8gZml0DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgd2luZG93LmNhbnZhc01hbmFnZXIuem9vbVRvRml0KCk7DQogICAgfQ0KfQ0KDQovLyBIYW5kbGUgcG9ydCBtb3VzZSBldmVudHMgZm9yIGNvbm5lY3Rpb25zDQpmdW5jdGlvbiBoYW5kbGVQb3J0TW91c2VEb3duKGUsIG5vZGVJZCwgcG9ydE5hbWUsIGlzT3V0cHV0KSB7DQogICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgDQogICAgaWYgKGlzT3V0cHV0KSB7DQogICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20gPSB7IG5vZGVJZCwgcG9ydE5hbWUgfTsNCiAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmFkZCgnY29ubmVjdGluZycpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tKSB7DQogICAgICAgICAgICBjcmVhdGVDb25uZWN0aW9uKGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20ubm9kZUlkLCBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tLnBvcnROYW1lLCBub2RlSWQsIHBvcnROYW1lKTsNCiAgICAgICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20gPSBudWxsOw0KICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZsb3ctbm9kZS1wb3J0JykuZm9yRWFjaChwb3J0ID0+IHBvcnQuY2xhc3NMaXN0LnJlbW92ZSgnY29ubmVjdGluZycpKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gQ3JlYXRlIGEgY29ubmVjdGlvbiBiZXR3ZWVuIG5vZGVzDQpmdW5jdGlvbiBjcmVhdGVDb25uZWN0aW9uKGZyb21Ob2RlSWQsIGZyb21Qb3J0LCB0b05vZGVJZCwgdG9Qb3J0KSB7DQogICAgLy8gQ2hlY2sgaWYgY29ubmVjdGlvbiBhbHJlYWR5IGV4aXN0cw0KICAgIGZvciAoY29uc3QgY29ubmVjdGlvbiBvZiBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKSB7DQogICAgICAgIGlmIChjb25uZWN0aW9uLmZyb20ubm9kZUlkID09PSBmcm9tTm9kZUlkICYmIA0KICAgICAgICAgICAgY29ubmVjdGlvbi5mcm9tLnBvcnROYW1lID09PSBmcm9tUG9ydCAmJg0KICAgICAgICAgICAgY29ubmVjdGlvbi50by5ub2RlSWQgPT09IHRvTm9kZUlkICYmIA0KICAgICAgICAgICAgY29ubmVjdGlvbi50by5wb3J0TmFtZSA9PT0gdG9Qb3J0KSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiBhbHJlYWR5IGV4aXN0cycpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGNvbnN0IGNvbm5lY3Rpb25JZCA9IGBjb25uXyR7ZnJvbU5vZGVJZH1fJHtmcm9tUG9ydH1fJHt0b05vZGVJZH1fJHt0b1BvcnR9YDsNCiAgICBjb25zdCBjb25uZWN0aW9uID0gew0KICAgICAgICBpZDogY29ubmVjdGlvbklkLA0KICAgICAgICBmcm9tOiB7IG5vZGVJZDogZnJvbU5vZGVJZCwgcG9ydE5hbWU6IGZyb21Qb3J0IH0sDQogICAgICAgIHRvOiB7IG5vZGVJZDogdG9Ob2RlSWQsIHBvcnROYW1lOiB0b1BvcnQgfQ0KICAgIH07DQogICAgDQogICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5zZXQoY29ubmVjdGlvbklkLCBjb25uZWN0aW9uKTsNCiAgICBkcmF3Q29ubmVjdGlvbihjb25uZWN0aW9uKTsNCiAgICANCiAgICBjb25zb2xlLmxvZyhgQ3JlYXRlZCBjb25uZWN0aW9uOiAke2Nvbm5lY3Rpb25JZH1gKTsNCn0NCg0KLy8gRHJhdyBhIGNvbm5lY3Rpb24gb24gdGhlIGNhbnZhcw0KZnVuY3Rpb24gZHJhd0Nvbm5lY3Rpb24oY29ubmVjdGlvbikgew0KICAgIGNvbnN0IGZyb21Ob2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCk7DQogICAgY29uc3QgdG9Ob2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29ubmVjdGlvbi50by5ub2RlSWQpOw0KICAgIA0KICAgIGlmICghZnJvbU5vZGUgfHwgIXRvTm9kZSkgcmV0dXJuOw0KICAgIA0KICAgIC8vIENyZWF0ZSBTVkcgZWxlbWVudCBmb3IgdGhlIGNvbm5lY3Rpb24NCiAgICBjb25zdCBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpOw0KICAgIHN2Zy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7DQogICAgc3ZnLnN0eWxlLnRvcCA9ICcwJzsNCiAgICBzdmcuc3R5bGUubGVmdCA9ICcwJzsNCiAgICBzdmcuc3R5bGUud2lkdGggPSAnMTAwJSc7DQogICAgc3ZnLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsNCiAgICBzdmcuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsgLy8gRG9uJ3QgY2FwdHVyZSBldmVudHMgYnkgZGVmYXVsdA0KICAgIHN2Zy5zdHlsZS56SW5kZXggPSAnMSc7DQogICAgc3ZnLmRhdGFzZXQuY29ubmVjdGlvbklkID0gY29ubmVjdGlvbi5pZDsNCiAgICANCiAgICBjb25zdCBwYXRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdwYXRoJyk7DQogICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICcjNENBRjUwJyk7DQogICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcyJyk7DQogICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnbm9uZScpOw0KICAgIHBhdGguc2V0QXR0cmlidXRlKCdtYXJrZXItZW5kJywgJ3VybCgjYXJyb3doZWFkKScpOw0KICAgIHBhdGguc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInOw0KICAgIHBhdGguc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJzsgLy8gT25seSB0aGUgcGF0aCBjYXB0dXJlcyBldmVudHMNCiAgICANCiAgICAvLyBBZGQgaG92ZXIgZWZmZWN0cw0KICAgIHBhdGguYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHsNCiAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICc0Jyk7DQogICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnI2ZmNmI2YicpOw0KICAgICAgICAvLyBTaG93IGRlbGV0ZSB0b29sdGlwDQogICAgICAgIHNob3dDb25uZWN0aW9uVG9vbHRpcChjb25uZWN0aW9uLmlkLCAnQ2xpY2sgdG8gZGVsZXRlIGNvbm5lY3Rpb24nKTsNCiAgICB9KTsNCiAgICANCiAgICBwYXRoLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiB7DQogICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpOw0KICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyM0Q0FGNTAnKTsNCiAgICAgICAgaGlkZUNvbm5lY3Rpb25Ub29sdGlwKCk7DQogICAgfSk7DQogICAgDQogICAgLy8gQWRkIGNsaWNrIHRvIGRlbGV0ZQ0KICAgIHBhdGguYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICBpZiAoY29uZmlybSgnRGVsZXRlIHRoaXMgY29ubmVjdGlvbj8nKSkgew0KICAgICAgICAgICAgZGVsZXRlQ29ubmVjdGlvbihjb25uZWN0aW9uLmlkKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIA0KICAgIHN2Zy5hcHBlbmRDaGlsZChwYXRoKTsNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5hcHBlbmRDaGlsZChzdmcpOw0KICAgIA0KICAgIC8vIFN0b3JlIFNWRyByZWZlcmVuY2UNCiAgICBjb25uZWN0aW9uLnN2ZyA9IHN2ZzsNCiAgICANCiAgICAvLyBVcGRhdGUgY29ubmVjdGlvbiBwb3NpdGlvbg0KICAgIHVwZGF0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7DQp9DQoNCi8vIFNob3cgY29ubmVjdGlvbiB0b29sdGlwDQpmdW5jdGlvbiBzaG93Q29ubmVjdGlvblRvb2x0aXAoY29ubmVjdGlvbklkLCBtZXNzYWdlKSB7DQogICAgLy8gQ2hlY2sgaWYgYXBwIGlzIHN0aWxsIGFjdGl2ZQ0KICAgIGlmICghZmxvd0VkaXRvci5pc0FjdGl2ZSkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIFJlbW92ZSBleGlzdGluZyB0b29sdGlwDQogICAgaGlkZUNvbm5lY3Rpb25Ub29sdGlwKCk7DQogICAgDQogICAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIHRvb2x0aXAuY2xhc3NOYW1lID0gJ2Nvbm5lY3Rpb24tdG9vbHRpcCc7DQogICAgdG9vbHRpcC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7DQogICAgdG9vbHRpcC5zdHlsZS5jc3NUZXh0ID0gYA0KICAgICAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC44KTsNCiAgICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQogICAgICAgIHotaW5kZXg6IDEwMDAwOw0KICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgICAgICBkaXNwbGF5OiBub25lOw0KICAgIGA7DQogICAgDQogICAgdG9vbHRpcC5pZCA9ICdjb25uZWN0aW9uLXRvb2x0aXAnOw0KICAgIA0KICAgIC8vIFRyeSB0byBhcHBlbmQgdG8gYXBwIGNvbnRhaW5lciBmaXJzdCwgZmFsbGJhY2sgdG8gYm9keQ0KICAgIGNvbnN0IGFwcENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hcHAtY29udGFpbmVyJyk7DQogICAgY29uc3QgY29udGFpbmVyID0gYXBwQ29udGFpbmVyIHx8IGRvY3VtZW50LmJvZHk7DQogICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRvb2x0aXApOw0KICAgIA0KICAgIC8vIFBvc2l0aW9uIHRvb2x0aXAgbmVhciBtb3VzZSAod2lsbCBiZSB1cGRhdGVkIG9uIG1vdXNlbW92ZSkNCiAgICBjb25zdCB0b29sdGlwTW91c2VNb3ZlSGFuZGxlciA9IChlKSA9PiB1cGRhdGVUb29sdGlwUG9zaXRpb24oZSk7DQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdG9vbHRpcE1vdXNlTW92ZUhhbmRsZXIpOw0KICAgIA0KICAgIC8vIFN0b3JlIHRoZSBoYW5kbGVyIHJlZmVyZW5jZSBmb3IgY2xlYW51cA0KICAgIHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIgPSB0b29sdGlwTW91c2VNb3ZlSGFuZGxlcjsNCiAgICANCiAgICAvLyBTaG93IHRoZSB0b29sdGlwIGFmdGVyIGEgc21hbGwgZGVsYXkgdG8gcHJldmVudCBmbGlja2VyaW5nDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGlmICh0b29sdGlwLnBhcmVudE5vZGUgJiYgZmxvd0VkaXRvci5pc0FjdGl2ZSkgew0KICAgICAgICAgICAgdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgfQ0KICAgIH0sIDEwKTsNCn0NCg0KLy8gVXBkYXRlIHRvb2x0aXAgcG9zaXRpb24NCmZ1bmN0aW9uIHVwZGF0ZVRvb2x0aXBQb3NpdGlvbihlKSB7DQogICAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25uZWN0aW9uLXRvb2x0aXAnKTsNCiAgICBpZiAodG9vbHRpcCkgew0KICAgICAgICAvLyBVc2Ugc2NhbGVkIGNvb3JkaW5hdGVzIGZvciB0b29sdGlwIHBvc2l0aW9uaW5nDQogICAgICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRNb3VzZUNvb3JkcyhlKSA6IA0KICAgICAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgICAgICB0b29sdGlwLnN0eWxlLmxlZnQgPSAobW91c2VDb29yZHMueCArIDEwKSArICdweCc7DQogICAgICAgIHRvb2x0aXAuc3R5bGUudG9wID0gKG1vdXNlQ29vcmRzLnkgLSAxMCkgKyAncHgnOw0KICAgIH0NCn0NCg0KLy8gSGlkZSBjb25uZWN0aW9uIHRvb2x0aXANCmZ1bmN0aW9uIGhpZGVDb25uZWN0aW9uVG9vbHRpcCgpIHsNCiAgICBjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvbm5lY3Rpb24tdG9vbHRpcCcpOw0KICAgIGlmICh0b29sdGlwKSB7DQogICAgICAgIC8vIFJlbW92ZSB0aGUgc3BlY2lmaWMgZXZlbnQgbGlzdGVuZXIgd2UgYWRkZWQNCiAgICAgICAgaWYgKHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIpIHsNCiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIpOw0KICAgICAgICAgICAgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlciA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEhpZGUgYW5kIHJlbW92ZSB0aGUgdG9vbHRpcA0KICAgICAgICB0b29sdGlwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIGlmICh0b29sdGlwLnBhcmVudE5vZGUpIHsNCiAgICAgICAgICAgIHRvb2x0aXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0b29sdGlwKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gQ2xlYXIgdGhlIGNhbnZhcw0KZnVuY3Rpb24gY2xlYXJDYW52YXMoKSB7DQogICAgaWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciB0aGUgY2FudmFzPyBUaGlzIHdpbGwgZGVsZXRlIGFsbCBub2RlcyBhbmQgY29ubmVjdGlvbnMuJykpIHsNCiAgICAgICAgLy8gSGlkZSBhbnkgYWN0aXZlIHRvb2x0aXBzDQogICAgICAgIGhpZGVDb25uZWN0aW9uVG9vbHRpcCgpOw0KICAgICAgICANCiAgICAgICAgLy8gQ2xlYXIgYWxsIGNvbm5lY3Rpb25zDQogICAgICAgIGZvciAoY29uc3QgY29ubmVjdGlvbiBvZiBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKSB7DQogICAgICAgICAgICBpZiAoY29ubmVjdGlvbi5zdmcpIHsNCiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnN2Zy5yZW1vdmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmNsZWFyKCk7DQogICAgICAgIA0KICAgICAgICAvLyBDbGVhciBhbGwgbm9kZXMNCiAgICAgICAgZm9yIChjb25zdCBub2RlSWQgb2YgZmxvd0VkaXRvci5ub2Rlcy5rZXlzKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICAgICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LnJlbW92ZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZsb3dFZGl0b3Iubm9kZXMuY2xlYXIoKTsNCiAgICAgICAgDQogICAgICAgIC8vIENsZWFyIGFsbCB0YWdzDQogICAgICAgIGZvciAoY29uc3QgdGFnSWQgb2YgZmxvd0VkaXRvci50YWdzLmtleXMoKSkgew0KICAgICAgICAgICAgY29uc3QgdGFnRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhZ0lkKTsNCiAgICAgICAgICAgIGlmICh0YWdFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgdGFnRWxlbWVudC5yZW1vdmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmbG93RWRpdG9yLnRhZ3MuY2xlYXIoKTsNCiAgICAgICAgDQogICAgICAgIC8vIFJlc2V0IGNvdW50ZXJzDQogICAgICAgIGZsb3dFZGl0b3Iubm9kZUNvdW50ZXIgPSAwOw0KICAgICAgICBmbG93RWRpdG9yLnRhZ0NvdW50ZXIgPSAwOw0KICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAvLyBDbGVhciBjdXJyZW50IGZpbGUgcGF0aA0KICAgICAgICBmbG93RWRpdG9yLmN1cnJlbnRGaWxlUGF0aCA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAvLyBSZXNldCBwYW4gb2Zmc2V0IHRvIGNlbnRlciBvZiBsYXJnZSBjYW52YXMNCiAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQgPSB7IHg6IC01MDAwLCB5OiAtNTAwMCB9Ow0KICAgICAgICANCiAgICAgICAgLy8gUmVzZXQgem9vbSBsZXZlbA0KICAgICAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IDEuMDsNCiAgICAgICAgDQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93LmNhbnZhc01hbmFnZXIudXBkYXRlQ2FudmFzVHJhbnNmb3JtID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gVXBkYXRlIGZpbGVuYW1lIGRpc3BsYXkNCiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuZmlsZU1hbmFnZXIudXBkYXRlRmlsZW5hbWVEaXNwbGF5ID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIudXBkYXRlRmlsZW5hbWVEaXNwbGF5KCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIENsZWFyIGNvbmZpZyBwYW5lbA0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9kZS1jb25maWcnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPic7DQogICAgICAgIA0KICAgICAgICBjb25zb2xlLmxvZygnQ2FudmFzIGNsZWFyZWQnKTsNCiAgICB9DQp9IA0KDQoNCi8vIFNob3cgbm9kZSBjb25maWd1cmF0aW9uDQpmdW5jdGlvbiBzaG93Tm9kZUNvbmZpZyhub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUpIHJldHVybjsNCiAgICANCiAgICBjb25zdCBub2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKG5vZGUudHlwZSk7DQogICAgaWYgKCFub2RlRGVmKSByZXR1cm47DQogICAgDQogICAgLy8gU2hvdyBjb25maWcgcGFuZWwgd2l0aCBub2RlIGNvbmZpZ3VyYXRpb24NCiAgICBjb25zdCBjb25maWdQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2RlLWNvbmZpZycpOw0KICAgIGlmIChjb25maWdQYW5lbCkgew0KICAgICAgICBsZXQgY29uZmlnSHRtbCA9IGA8aDQ+JHtub2RlRGVmLm5hbWV9IENvbmZpZ3VyYXRpb248L2g0PmA7DQogICAgICAgIA0KICAgICAgICAvLyBBZGQgc3BlY2lhbCBjb250ZW50IGRpc3BsYXkgZm9yIGRpZmZlcmVudCBub2RlIHR5cGVzDQogICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdkaXNwbGF5JyAmJiBub2RlLmxhc3RDb250ZW50KSB7DQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+TGFzdCBDb250ZW50PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1kaXNwbGF5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwcmUgY2xhc3M9ImNvbnRlbnQtdGV4dCI+JHtlc2NhcGVIdG1sKG5vZGUubGFzdENvbnRlbnQpfTwvcHJlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+Rm9ybWF0OiAke25vZGUubGFzdEZvcm1hdH0g4oCiIExlbmd0aDogJHtub2RlLmxhc3RDb250ZW50Lmxlbmd0aH0gY2hhcnM8L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdpbWFnZScgJiYgbm9kZS5sYXN0SW1hZ2VEYXRhKSB7DQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+SW1hZ2UgUHJldmlldzwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImltYWdlLWRpc3BsYXkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9IiR7bm9kZS5sYXN0SW1hZ2VVcmx9IiBhbHQ9IkltYWdlIHByZXZpZXciIHN0eWxlPSJtYXgtd2lkdGg6IDIwMHB4OyBtYXgtaGVpZ2h0OiAxNTBweDsgYm9yZGVyOiAxcHggc29saWQgI2NjYzsgYm9yZGVyLXJhZGl1czogNHB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbWFnZS1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+U2l6ZTogJHtub2RlLmxhc3RJbWFnZUluZm8/LndpZHRoIHx8ICc/J314JHtub2RlLmxhc3RJbWFnZUluZm8/LmhlaWdodCB8fCAnPyd9IOKAoiBGb3JtYXQ6ICR7bm9kZS5sYXN0SW1hZ2VJbmZvPy5mb3JtYXQgfHwgJz8nfTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLXByaW1hcnkgbXQtMiB2aWV3LWZ1bGwtaW1hZ2UtYnRuIiBkYXRhLW5vZGUtaWQ9IiR7bm9kZUlkfSI+VmlldyBGdWxsIEltYWdlPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdhdWRpbycgJiYgbm9kZS5sYXN0QXVkaW9EYXRhKSB7DQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+QXVkaW8gQ29udHJvbHM8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhdWRpby1kaXNwbGF5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImF1ZGlvLWluZm8iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5BdWRpbyBsb2FkZWQgc3VjY2Vzc2Z1bGx5PC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYXVkaW8tY29udHJvbHMgbXQtMiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tc3VjY2VzcyBwbGF5LWF1ZGlvLWJ0biIgZGF0YS1ub2RlLWlkPSIke25vZGVJZH0iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBsYXkiPjwvaT4gUGxheQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLWRhbmdlciBzdG9wLWF1ZGlvLWJ0biIgZGF0YS1ub2RlLWlkPSIke25vZGVJZH0iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXN0b3AiPjwvaT4gU3RvcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICd2ZnNfbG9hZCcpIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5WRlMgTG9hZCBTdGF0dXM8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZnMtbG9hZC1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5MYXN0IGxvYWRlZDogJHtub2RlLmxhc3RMb2FkZWRGaWxlIHx8ICdOb25lJ308L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAnbGxtX2NoYXQnICYmIG5vZGUubGFzdFJlc3BvbnNlKSB7DQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+TGFzdCBSZXNwb25zZTwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRlbnQtZGlzcGxheSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8cHJlIGNsYXNzPSJjb250ZW50LXRleHQiPiR7ZXNjYXBlSHRtbChub2RlLmxhc3RSZXNwb25zZSl9PC9wcmU+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LWluZm8iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5Ub2tlbnM6ICR7bm9kZS5sYXN0VXNhZ2U/LnRvdGFsX3Rva2VucyB8fCAwfSDigKIgTW9kZWw6ICR7bm9kZS5sYXN0TW9kZWwgfHwgJ1Vua25vd24nfTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ3JlcGVhdGVyJykgew0KICAgICAgICAgICAgY29uc3QgaXNSdW5uaW5nID0gbm9kZS5yZXBlYXRlclN0YXRlICYmIG5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmc7DQogICAgICAgICAgICBjb25zdCBjb3VudCA9IG5vZGUucmVwZWF0ZXJTdGF0ZSA/IG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCA6IDA7DQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+UmVwZWF0ZXIgQ29udHJvbHM8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZXBlYXRlci1kaXNwbGF5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlcGVhdGVyLWluZm8iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5TdGF0dXM6ICR7aXNSdW5uaW5nID8gJ1J1bm5pbmcnIDogJ1N0b3BwZWQnfSDigKIgQ291bnQ6ICR7Y291bnR9PC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVwZWF0ZXItY29udHJvbHMgbXQtMiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tc3VjY2VzcyBzdGFydC1yZXBlYXRlci1idG4iIGRhdGEtbm9kZS1pZD0iJHtub2RlSWR9IiAke2lzUnVubmluZyA/ICdkaXNhYmxlZCcgOiAnJ30+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGxheSI+PC9pPiBTdGFydA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLWRhbmdlciBzdG9wLXJlcGVhdGVyLWJ0biIgZGF0YS1ub2RlLWlkPSIke25vZGVJZH0iICR7IWlzUnVubmluZyA/ICdkaXNhYmxlZCcgOiAnJ30+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc3RvcCI+PC9pPiBTdG9wDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBTaG93IGlucHV0IG1hcHBpbmdzIGNvbmZpZ3VyYXRpb24gKHdoYXQgdGhpcyBub2RlIHJlY2VpdmVzIGZyb20gb3RoZXIgbm9kZXMpDQogICAgICAgIGNvbnN0IGlucHV0Q29ubmVjdGlvbnMgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpDQogICAgICAgICAgICAuZmlsdGVyKGNvbm4gPT4gY29ubi50by5ub2RlSWQgPT09IG5vZGVJZCk7DQogICAgICAgIA0KICAgICAgICBpZiAoaW5wdXRDb25uZWN0aW9ucy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+UmVjZWl2aW5nIEZyb208L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnB1dC1tYXBwaW5ncy1jb25maWciPg0KICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIChjb25zdCBjb25uIG9mIGlucHV0Q29ubmVjdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VOb2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubi5mcm9tLm5vZGVJZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlTm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZShzb3VyY2VOb2RlPy50eXBlIHx8ICd1bmtub3duJyk7DQogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlTm9kZU5hbWUgPSBzb3VyY2VOb2RlRGVmPy5uYW1lIHx8IHNvdXJjZU5vZGU/LnR5cGUgfHwgJ3Vua25vd24nOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkT3V0cHV0ID0gc291cmNlTm9kZURlZj8ub3V0cHV0cz8uZmluZChvdXRwdXQgPT4gb3V0cHV0LmlkID09PSBjb25uLmZyb20ucG9ydE5hbWUpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dE5hbWUgPSBzZWxlY3RlZE91dHB1dCA/IHNlbGVjdGVkT3V0cHV0Lm5hbWUgOiBjb25uLmZyb20ucG9ydE5hbWU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2ltcGxlOiBTaG93IHdoYXQgSSdtIHJlY2VpdmluZyBhbmQgbGV0IG1lIGNob29zZSBteSBpbnB1dCBwb3J0DQogICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LW1hcHBpbmctY29uZmlnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbm5lY3Rpb24taGVhZGVyIj5Gcm9tICR7c291cmNlTm9kZU5hbWV9ICgke291dHB1dE5hbWV9KTwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29ubmVjdGlvbi1jb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+VG8gbXkgaW5wdXQ6PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0iaW5wdXRfdGFyZ2V0XyR7bm9kZUlkfXwke2Nvbm4udG8ucG9ydE5hbWV9IiBjbGFzcz0iaW5wdXQtdGFyZ2V0LXNlbGVjdCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPlNlbGVjdC4uLjwvb3B0aW9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtub2RlRGVmLmlucHV0cy5tYXAoaW5wdXQgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxvcHRpb24gdmFsdWU9IiR7aW5wdXQuaWR9IiAke2Nvbm4udG8ucG9ydE5hbWUgPT09IGlucHV0LmlkID8gJ3NlbGVjdGVkJyA6ICcnfT4ke2lucHV0Lm5hbWV9PC9vcHRpb24+YA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5qb2luKCcnKX0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gU2hvdyBvdXRwdXQgbWFwcGluZ3MgY29uZmlndXJhdGlvbiAod2hhdCBvdGhlciBub2RlcyByZWNlaXZlIGZyb20gdGhpcyBub2RlKQ0KICAgICAgICBjb25zdCBvdXRwdXRDb25uZWN0aW9ucyA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkNCiAgICAgICAgICAgIC5maWx0ZXIoY29ubiA9PiBjb25uLmZyb20ubm9kZUlkID09PSBub2RlSWQpOw0KICAgICAgICANCiAgICAgICAgaWYgKG91dHB1dENvbm5lY3Rpb25zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5TZW5kaW5nIFRvPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3V0cHV0LW1hcHBpbmdzLWNvbmZpZyI+DQogICAgICAgICAgICBgOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgKGNvbnN0IGNvbm4gb2Ygb3V0cHV0Q29ubmVjdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubi50by5ub2RlSWQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUodGFyZ2V0Tm9kZT8udHlwZSB8fCAndW5rbm93bicpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGVOYW1lID0gdGFyZ2V0Tm9kZURlZj8ubmFtZSB8fCB0YXJnZXROb2RlPy50eXBlIHx8ICd1bmtub3duJzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHZXQgYXZhaWxhYmxlIG91dHB1dHMgZnJvbSBUSElTIG5vZGUgKHNvdXJjZSBub2RlKQ0KICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZU5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUobm9kZS50eXBlKTsNCiAgICAgICAgICAgICAgICBjb25zdCBhdmFpbGFibGVPdXRwdXRzID0gc291cmNlTm9kZURlZj8ub3V0cHV0cyB8fCBbXTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3V0cHV0LW1hcHBpbmctY29uZmlnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbm5lY3Rpb24taGVhZGVyIj5UbyAke3RhcmdldE5vZGVOYW1lfTwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29ubmVjdGlvbi1jb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+U2VuZCBvdXRwdXQ6PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0ib3V0cHV0X21hcHBpbmdfJHtub2RlSWR9fCR7Y29ubi5mcm9tLnBvcnROYW1lfXwke2Nvbm4udG8ubm9kZUlkfSIgY2xhc3M9Im91dHB1dC1tYXBwaW5nLXNlbGVjdCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPlNlbGVjdC4uLjwvb3B0aW9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHthdmFpbGFibGVPdXRwdXRzLm1hcChvdXRwdXQgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxvcHRpb24gdmFsdWU9IiR7b3V0cHV0LmlkfSIgJHtjb25uLmZyb20ucG9ydE5hbWUgPT09IG91dHB1dC5pZCA/ICdzZWxlY3RlZCcgOiAnJ30+JHtvdXRwdXQubmFtZX08L29wdGlvbj5gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmpvaW4oJycpfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBHZW5lcmF0ZSBjb25maWd1cmF0aW9uIGZpZWxkcw0KICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGNvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXMobm9kZURlZi5jb25maWcpKSB7DQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjb25maWdfJHtub2RlSWR9XyR7a2V5fSI+JHtjb25maWcubGFiZWx9PC9sYWJlbD4NCiAgICAgICAgICAgIGA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChjb25maWcudHlwZSA9PT0gJ3NlbGVjdCcpIHsNCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGA8c2VsZWN0IGlkPSJjb25maWdfJHtub2RlSWR9XyR7a2V5fSI+YDsNCiAgICAgICAgICAgICAgICBjb25maWcub3B0aW9ucy5mb3JFYWNoKG9wdGlvbiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gbm9kZS5jb25maWdba2V5XS52YWx1ZSA9PT0gb3B0aW9uID8gJ3NlbGVjdGVkJyA6ICcnOw0KICAgICAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGA8b3B0aW9uIHZhbHVlPSIke29wdGlvbn0iICR7c2VsZWN0ZWR9PiR7b3B0aW9ufTwvb3B0aW9uPmA7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPC9zZWxlY3Q+YDsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLnR5cGUgPT09ICd0ZXh0YXJlYScpIHsNCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGA8dGV4dGFyZWEgaWQ9ImNvbmZpZ18ke25vZGVJZH1fJHtrZXl9Ij4ke25vZGUuY29uZmlnW2tleV0udmFsdWV9PC90ZXh0YXJlYT5gOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb25maWcudHlwZSA9PT0gJ251bWJlcicpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBtaW4gPSBjb25maWcubWluID8gYCBtaW49IiR7Y29uZmlnLm1pbn0iYCA6ICcnOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IGNvbmZpZy5tYXggPyBgIG1heD0iJHtjb25maWcubWF4fSJgIDogJyc7DQogICAgICAgICAgICAgICAgY29uc3Qgc3RlcCA9IGNvbmZpZy5zdGVwID8gYCBzdGVwPSIke2NvbmZpZy5zdGVwfSJgIDogJyc7DQogICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImNvbmZpZ18ke25vZGVJZH1fJHtrZXl9IiB2YWx1ZT0iJHtub2RlLmNvbmZpZ1trZXldLnZhbHVlfSIke21pbn0ke21heH0ke3N0ZXB9PmA7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxpbnB1dCB0eXBlPSIke2NvbmZpZy50eXBlfSIgaWQ9ImNvbmZpZ18ke25vZGVJZH1fJHtrZXl9IiB2YWx1ZT0iJHtub2RlLmNvbmZpZ1trZXldLnZhbHVlfSI+YDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPC9kaXY+YDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uZmlnUGFuZWwuaW5uZXJIVE1MID0gY29uZmlnSHRtbDsNCiAgICAgICAgDQogICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgZm9yIG1hcHBpbmcgc2VsZWN0cw0KICAgICAgICAvLyBObyBpbnB1dCBtYXBwaW5nIHNlbGVjdHMgYW55bW9yZSAtIG5vZGVzIGNhbid0IGNvbnRyb2wgd2hhdCB0aGV5IHJlY2VpdmUNCiAgICAgICAgDQogICAgICAgIGNvbnN0IGlucHV0VGFyZ2V0U2VsZWN0cyA9IGNvbmZpZ1BhbmVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC10YXJnZXQtc2VsZWN0Jyk7DQogICAgICAgIGlucHV0VGFyZ2V0U2VsZWN0cy5mb3JFYWNoKHNlbGVjdCA9PiB7DQogICAgICAgICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBbbm9kZUlkLCBjdXJyZW50SW5wdXRQb3J0XSA9IGUudGFyZ2V0LmlkLnJlcGxhY2UoJ2lucHV0X3RhcmdldF8nLCAnJykuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZElucHV0UG9ydCA9IGUudGFyZ2V0LnZhbHVlOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDaGFuZ2luZyBpbnB1dCB0YXJnZXQ6Jywgbm9kZUlkLCBjdXJyZW50SW5wdXRQb3J0LCAn4oaSJywgc2VsZWN0ZWRJbnB1dFBvcnQpOw0KICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIGNvbm5lY3Rpb24NCiAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5maW5kKGNvbm4gPT4NCiAgICAgICAgICAgICAgICAgICAgY29ubi50by5ub2RlSWQgPT09IG5vZGVJZCAmJiBjb25uLnRvLnBvcnROYW1lID09PSBjdXJyZW50SW5wdXRQb3J0DQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGlvbiAmJiBzZWxlY3RlZElucHV0UG9ydCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYWxsIGNvbm5lY3Rpb25zIGZyb20gdGhlIHNhbWUgZnJvbU5vZGUgdG8gdGhpcyBub2RlIChyZWdhcmRsZXNzIG9mIHBvcnQpDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25zVG9SZW1vdmUgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLmZpbHRlcihjb25uID0+DQogICAgICAgICAgICAgICAgICAgICAgICBjb25uLmZyb20ubm9kZUlkID09PSBjb25uZWN0aW9uLmZyb20ubm9kZUlkICYmIGNvbm4udG8ubm9kZUlkID09PSBub2RlSWQNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbnNUb1JlbW92ZS5mb3JFYWNoKGNvbm4gPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5kZWxldGUoY29ubi5pZCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ubi5zdmcpIGNvbm4uc3ZnLnJlbW92ZSgpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBuZXcgY29ubmVjdGlvbg0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb25uZWN0aW9uSWQgPSBgY29ubl8ke2Nvbm5lY3Rpb24uZnJvbS5ub2RlSWR9XyR7Y29ubmVjdGlvbi5mcm9tLnBvcnROYW1lfV8ke25vZGVJZH1fJHtzZWxlY3RlZElucHV0UG9ydH1gOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb25uZWN0aW9uID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IG5ld0Nvbm5lY3Rpb25JZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZyb206IHsgbm9kZUlkOiBjb25uZWN0aW9uLmZyb20ubm9kZUlkLCBwb3J0TmFtZTogY29ubmVjdGlvbi5mcm9tLnBvcnROYW1lIH0sDQogICAgICAgICAgICAgICAgICAgICAgICB0bzogeyBub2RlSWQ6IG5vZGVJZCwgcG9ydE5hbWU6IHNlbGVjdGVkSW5wdXRQb3J0IH0NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5zZXQobmV3Q29ubmVjdGlvbklkLCBuZXdDb25uZWN0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgZHJhd0Nvbm5lY3Rpb24obmV3Q29ubmVjdGlvbik7DQogICAgICAgICAgICAgICAgICAgIC8vIEF1dG8tc2F2ZQ0KICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LnNhdmVGbG93KSB3aW5kb3cuc2F2ZUZsb3coKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBjb25zdCBvdXRwdXRNYXBwaW5nU2VsZWN0cyA9IGNvbmZpZ1BhbmVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5vdXRwdXQtbWFwcGluZy1zZWxlY3QnKTsNCiAgICAgICAgb3V0cHV0TWFwcGluZ1NlbGVjdHMuZm9yRWFjaChzZWxlY3QgPT4gew0KICAgICAgICAgICAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBlLnRhcmdldC5pZC5yZXBsYWNlKCdvdXRwdXRfbWFwcGluZ18nLCAnJykuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWQgPSBwYXJ0c1swXTsNCiAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRQb3J0ID0gcGFydHNbMV07DQogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Tm9kZUlkID0gcGFydHNbMl07DQogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPdXRwdXRQb3J0ID0gZS50YXJnZXQudmFsdWU7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ091dHB1dCBtYXBwaW5nIGNoYW5nZTonLCBub2RlSWQsIG91dHB1dFBvcnQsICfihpInLCBzZWxlY3RlZE91dHB1dFBvcnQsICd0bycsIHRhcmdldE5vZGVJZCk7DQogICAgICAgICAgICAgICAgdXBkYXRlT3V0cHV0TWFwcGluZyhub2RlSWQsIG91dHB1dFBvcnQsIHRhcmdldE5vZGVJZCwgc2VsZWN0ZWRPdXRwdXRQb3J0KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgZm9yIHNwZWNpYWwgYnV0dG9ucw0KICAgICAgICBjb25zdCB2aWV3RnVsbEltYWdlQnRuID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvcignLnZpZXctZnVsbC1pbWFnZS1idG4nKTsNCiAgICAgICAgaWYgKHZpZXdGdWxsSW1hZ2VCdG4pIHsNCiAgICAgICAgICAgIHZpZXdGdWxsSW1hZ2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1ub2RlLWlkJyk7DQogICAgICAgICAgICAgICAgc2hvd0Z1bGxJbWFnZShub2RlSWQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGNvbnN0IHBsYXlBdWRpb0J0biA9IGNvbmZpZ1BhbmVsLnF1ZXJ5U2VsZWN0b3IoJy5wbGF5LWF1ZGlvLWJ0bicpOw0KICAgICAgICBpZiAocGxheUF1ZGlvQnRuKSB7DQogICAgICAgICAgICBwbGF5QXVkaW9CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1ub2RlLWlkJyk7DQogICAgICAgICAgICAgICAgcGxheUF1ZGlvKG5vZGVJZCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uc3Qgc3RvcEF1ZGlvQnRuID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvcignLnN0b3AtYXVkaW8tYnRuJyk7DQogICAgICAgIGlmIChzdG9wQXVkaW9CdG4pIHsNCiAgICAgICAgICAgIHN0b3BBdWRpb0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtaWQnKTsNCiAgICAgICAgICAgICAgICBzdG9wQXVkaW8obm9kZUlkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCBzdGFydFJlcGVhdGVyQnRuID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvcignLnN0YXJ0LXJlcGVhdGVyLWJ0bicpOw0KICAgICAgICBpZiAoc3RhcnRSZXBlYXRlckJ0bikgew0KICAgICAgICAgICAgc3RhcnRSZXBlYXRlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtaWQnKTsNCiAgICAgICAgICAgICAgICBzdGFydFJlcGVhdGVyKG5vZGVJZCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uc3Qgc3RvcFJlcGVhdGVyQnRuID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvcignLnN0b3AtcmVwZWF0ZXItYnRuJyk7DQogICAgICAgIGlmIChzdG9wUmVwZWF0ZXJCdG4pIHsNCiAgICAgICAgICAgIHN0b3BSZXBlYXRlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtaWQnKTsNCiAgICAgICAgICAgICAgICBzdG9wUmVwZWF0ZXIobm9kZUlkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBBZGQgY2hhbmdlIGxpc3RlbmVycw0KICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGNvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXMobm9kZURlZi5jb25maWcpKSB7DQogICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGNvbmZpZ18ke25vZGVJZH1fJHtrZXl9YCk7DQogICAgICAgICAgICBpZiAoZWxlbWVudCkgew0KICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgbm9kZS5jb25maWdba2V5XS52YWx1ZSA9IGUudGFyZ2V0LnZhbHVlOw0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVXBkYXRlZCBjb25maWc6Jywgbm9kZUlkLCBrZXksIGUudGFyZ2V0LnZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIGRpc3BsYXkgbm9kZSBmb3JtYXQgY2hhbmdlcw0KICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnZGlzcGxheScgJiYga2V5ID09PSAnZm9ybWF0Jykgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybWF0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBkaXNwbGF5LWZvcm1hdC0ke25vZGVJZH1gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXRFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0RWxlbWVudC50ZXh0Q29udGVudCA9IGUudGFyZ2V0LnZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIG5vZGUtcmVuZGVyZXIuanMgLSBEeW5hbWljIG5vZGUgcmVuZGVyaW5nIGZvciBGbG93IEVkaXRvcg0KDQpjbGFzcyBOb2RlUmVuZGVyZXIgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLnRlbXBsYXRlcyA9IG5ldyBNYXAoKTsNCiAgICAgICAgdGhpcy5zZXR1cFN0YW5kYXJkVGVtcGxhdGUoKTsNCiAgICB9DQogICAgDQogICAgc2V0dXBTdGFuZGFyZFRlbXBsYXRlKCkgew0KICAgICAgICB0aGlzLnRlbXBsYXRlcy5zZXQoJ3N0YW5kYXJkJywgew0KICAgICAgICAgICAgcmVuZGVyOiAobm9kZSwgbm9kZURlZikgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9IG5vZGVEZWYuaW5wdXRzIHx8IFtdOw0KICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dHMgPSBub2RlRGVmLm91dHB1dHMgfHwgW107DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGANCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy1ub2RlLWhlYWRlciI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iJHtub2RlRGVmLmljb259Ij48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke25vZGVEZWYubmFtZX08L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZmxvdy1ub2RlLXR5cGUgJHtub2RlLnR5cGV9Ij4ke25vZGUudHlwZS50b1VwcGVyQ2FzZSgpfTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im5vZGUtZGVsZXRlLWJ0biIgdGl0bGU9IkRlbGV0ZSBub2RlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctbm9kZS1jb250ZW50Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5vZGUtZGVmYXVsdC1jb250ZW50Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGwgY2xhc3M9InRleHQtbXV0ZWQiPiR7bm9kZURlZi5kZXNjcmlwdGlvbn08L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LW5vZGUtcG9ydHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgJHtpbnB1dHMubWFwKGlucHV0ID0+IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGNsYXNzPSJmbG93LW5vZGUtcG9ydCBpbnB1dCIgZGF0YS1wb3J0PSIke2lucHV0LmlkfSI+PC9kaXY+YA0KICAgICAgICAgICAgICAgICAgICAgICAgKS5qb2luKCcnKX0NCiAgICAgICAgICAgICAgICAgICAgICAgICR7b3V0cHV0cy5tYXAob3V0cHV0ID0+IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGNsYXNzPSJmbG93LW5vZGUtcG9ydCBvdXRwdXQiIGRhdGEtcG9ydD0iJHtvdXRwdXQuaWR9Ij48L2Rpdj5gDQogICAgICAgICAgICAgICAgICAgICAgICApLmpvaW4oJycpfQ0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgDQogICAgcmVnaXN0ZXJUZW1wbGF0ZShuYW1lLCB0ZW1wbGF0ZSkgew0KICAgICAgICB0aGlzLnRlbXBsYXRlcy5zZXQobmFtZSwgdGVtcGxhdGUpOw0KICAgIH0NCiAgICANCiAgICByZW5kZXJOb2RlKG5vZGUpIHsNCiAgICAgICAgY29uc3Qgbm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZShub2RlLnR5cGUpOw0KICAgICAgICBpZiAoIW5vZGVEZWYpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYE5vIG5vZGUgZGVmaW5pdGlvbiBmb3VuZCBmb3IgdHlwZTogJHtub2RlLnR5cGV9YCk7DQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGNvbnN0IHRlbXBsYXRlTmFtZSA9IG5vZGVEZWYudGVtcGxhdGUgfHwgJ3N0YW5kYXJkJzsNCiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlcy5nZXQodGVtcGxhdGVOYW1lKTsNCiAgICAgICAgDQogICAgICAgIGlmICghdGVtcGxhdGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYE5vIHRlbXBsYXRlIGZvdW5kOiAke3RlbXBsYXRlTmFtZX1gKTsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRlbXBsYXRlLnJlbmRlcihub2RlLCBub2RlRGVmKTsNCiAgICB9DQogICAgDQogICAgY3JlYXRlTm9kZUVsZW1lbnQobm9kZSkgew0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgICBub2RlRWxlbWVudC5jbGFzc05hbWUgPSBgZmxvdy1ub2RlICR7bm9kZS50eXBlfS1ub2RlYDsNCiAgICAgICAgbm9kZUVsZW1lbnQuaWQgPSBub2RlLmlkOw0KICAgICAgICBub2RlRWxlbWVudC5zdHlsZS5sZWZ0ID0gbm9kZS54ICsgJ3B4JzsNCiAgICAgICAgbm9kZUVsZW1lbnQuc3R5bGUudG9wID0gbm9kZS55ICsgJ3B4JzsNCiAgICAgICAgDQogICAgICAgIC8vIFJlbmRlciB0aGUgbm9kZSBjb250ZW50DQogICAgICAgIG5vZGVFbGVtZW50LmlubmVySFRNTCA9IHRoaXMucmVuZGVyTm9kZShub2RlKTsNCiAgICAgICAgDQogICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgYW5kIGdldCB0aGUgdXBkYXRlZCBlbGVtZW50DQogICAgICAgIGNvbnN0IGZpbmFsRWxlbWVudCA9IHRoaXMuYWRkTm9kZUV2ZW50TGlzdGVuZXJzKG5vZGVFbGVtZW50LCBub2RlKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBmaW5hbEVsZW1lbnQ7DQogICAgfQ0KICAgIA0KICAgIGFkZE5vZGVFdmVudExpc3RlbmVycyhub2RlRWxlbWVudCwgbm9kZSkgew0KICAgICAgICAvLyBEZWxldGUgYnV0dG9uDQogICAgICAgIGNvbnN0IGRlbGV0ZUJ0biA9IG5vZGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ub2RlLWRlbGV0ZS1idG4nKTsNCiAgICAgICAgaWYgKGRlbGV0ZUJ0bikgew0KICAgICAgICAgICAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgICAgIGRlbGV0ZU5vZGUobm9kZS5pZCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gTm9kZSBzZWxlY3Rpb24NCiAgICAgICAgbm9kZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJy5ub2RlLWRlbGV0ZS1idG4nKSkgcmV0dXJuOw0KICAgICAgICAgICAgc2VsZWN0Tm9kZShub2RlLmlkKTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBOb2RlIGRyYWdnaW5nDQogICAgICAgIG5vZGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiB7DQogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLm5vZGUtZGVsZXRlLWJ0bicpKSByZXR1cm47DQogICAgICAgICAgICBzdGFydERyYWdnaW5nTm9kZShub2RlLmlkLCBlKTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBQb3J0IGNvbm5lY3Rpb25zDQogICAgICAgIGNvbnN0IHBvcnRzID0gbm9kZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZsb3ctbm9kZS1wb3J0Jyk7DQogICAgICAgIHBvcnRzLmZvckVhY2gocG9ydCA9PiB7DQogICAgICAgICAgICBwb3J0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgICAgICBzdGFydENvbm5lY3Rpb24obm9kZS5pZCwgcG9ydC5kYXRhc2V0LnBvcnQsIHBvcnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdvdXRwdXQnKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gbm9kZUVsZW1lbnQ7DQogICAgfQ0KfQ0KDQovLyBHbG9iYWwgbm9kZSByZW5kZXJlciBpbnN0YW5jZQ0KY29uc29sZS5sb2coJ0NyZWF0aW5nIGdsb2JhbCBub2RlUmVuZGVyZXIgaW5zdGFuY2UuLi4nKTsNCmNvbnN0IG5vZGVSZW5kZXJlciA9IG5ldyBOb2RlUmVuZGVyZXIoKTsNCmNvbnNvbGUubG9nKCdHbG9iYWwgbm9kZVJlbmRlcmVyIGNyZWF0ZWQ6Jywgbm9kZVJlbmRlcmVyKTsgDQoNCi8vIFRleHQgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVRleHROb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IHRleHRDb250ZW50ID0gbm9kZS5jb25maWcudGV4dF9jb250ZW50LnZhbHVlOw0KDQogICAgcmV0dXJuIHsgdGV4dDogdGV4dENvbnRlbnQgfTsNCn0NCg0KDQovLyBKU09OIEV4dHJhY3QgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUpzb25FeHRyYWN0Tm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBmaWVsZFBhdGggPSBub2RlLmNvbmZpZy5maWVsZF9wYXRoLnZhbHVlOw0KICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IG5vZGUuY29uZmlnLmRlZmF1bHRfdmFsdWU/LnZhbHVlIHx8ICcnOw0KDQogICAgLy8gQWNjZXB0IGFueSBpbnB1dCBkYXRhLCBub3QganVzdCBqc29uX2RhdGENCiAgICBsZXQganNvbkRhdGEgPSBudWxsOw0KDQogICAgLy8gVHJ5IHRvIGZpbmQgSlNPTiBkYXRhIGZyb20gYW55IGlucHV0DQogICAgaWYgKGlucHV0RGF0YS5qc29uX2RhdGEpIHsNCiAgICAgICAganNvbkRhdGEgPSBpbnB1dERhdGEuanNvbl9kYXRhOw0KICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmRhdGEpIHsNCiAgICAgICAganNvbkRhdGEgPSBpbnB1dERhdGEuZGF0YTsNCiAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS50ZXh0KSB7DQogICAgICAgIGpzb25EYXRhID0gaW5wdXREYXRhLnRleHQ7DQogICAgfSBlbHNlIGlmIChpbnB1dERhdGEucmVzcG9uc2UpIHsNCiAgICAgICAganNvbkRhdGEgPSBpbnB1dERhdGEucmVzcG9uc2U7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gVXNlIHRoZSBmaXJzdCBhdmFpbGFibGUgaW5wdXQNCiAgICAgICAgY29uc3QgZmlyc3RJbnB1dCA9IE9iamVjdC52YWx1ZXMoaW5wdXREYXRhKVswXTsNCiAgICAgICAganNvbkRhdGEgPSBmaXJzdElucHV0Ow0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCdKU09OIEV4dHJhY3QgaW5wdXQgZGF0YTonLCBpbnB1dERhdGEpOw0KICAgIGNvbnNvbGUubG9nKCdKU09OIEV4dHJhY3Qgc2VsZWN0ZWQganNvbkRhdGE6JywganNvbkRhdGEpOw0KICAgIGNvbnNvbGUubG9nKCdKU09OIEV4dHJhY3QganNvbkRhdGEgdHlwZTonLCB0eXBlb2YganNvbkRhdGEpOw0KDQogICAgbGV0IGV4dHJhY3RlZFZhbHVlID0gbnVsbDsNCg0KICAgIHRyeSB7DQogICAgICAgIC8vIFBhcnNlIEpTT04gaWYgaXQncyBhIHN0cmluZw0KICAgICAgICBpZiAodHlwZW9mIGpzb25EYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAganNvbkRhdGEgPSBKU09OLnBhcnNlKGpzb25EYXRhKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEV4dHJhY3QgdmFsdWUgdXNpbmcgZG90IG5vdGF0aW9uDQogICAgICAgIGV4dHJhY3RlZFZhbHVlID0gd2luZG93LmZsb3dFZGl0b3JVdGlscy5leHRyYWN0TmVzdGVkVmFsdWUoanNvbkRhdGEsIGZpZWxkUGF0aCk7DQoNCiAgICAgICAgLy8gVXNlIGRlZmF1bHQgdmFsdWUgaWYgZXh0cmFjdGlvbiBmYWlsZWQNCiAgICAgICAgaWYgKGV4dHJhY3RlZFZhbHVlID09PSBudWxsIHx8IGV4dHJhY3RlZFZhbHVlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGV4dHJhY3RlZFZhbHVlID0gZGVmYXVsdFZhbHVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRm9ybWF0IHRoZSBvdXRwdXQgYXMgc3RyaW5nIGZvciBjb25zaXN0ZW5jeQ0KICAgICAgICBsZXQgZm9ybWF0dGVkVmFsdWUgPSBTdHJpbmcoZXh0cmFjdGVkVmFsdWUpOw0KDQogICAgICAgIC8vIFN0b3JlIGZvciBkaXNwbGF5IGluIGNvbmZpZyBwYW5lbA0KICAgICAgICBub2RlLmxhc3RFeHRyYWN0ZWRWYWx1ZSA9IGZvcm1hdHRlZFZhbHVlOw0KICAgICAgICBub2RlLmxhc3RGaWVsZFBhdGggPSBmaWVsZFBhdGg7DQoNCiAgICAgICAgLy8gRGVidWcgbG9nZ2luZw0KICAgICAgICBjb25zb2xlLmxvZygnSlNPTiBFeHRyYWN0IGRlYnVnOicpOw0KICAgICAgICBjb25zb2xlLmxvZygnICBGaWVsZCBwYXRoOicsIGZpZWxkUGF0aCk7DQogICAgICAgIGNvbnNvbGUubG9nKCcgIFJhdyBleHRyYWN0ZWQgdmFsdWU6JywgZXh0cmFjdGVkVmFsdWUsICdUeXBlOicsIHR5cGVvZiBleHRyYWN0ZWRWYWx1ZSk7DQogICAgICAgIGNvbnNvbGUubG9nKCcgIERlZmF1bHQgdmFsdWU6JywgZGVmYXVsdFZhbHVlKTsNCiAgICAgICAgY29uc29sZS5sb2coJyAgRm9ybWF0dGVkIHZhbHVlOicsIGZvcm1hdHRlZFZhbHVlLCAnVHlwZTonLCB0eXBlb2YgZm9ybWF0dGVkVmFsdWUpOw0KICAgICAgICBjb25zb2xlLmxvZygnICBSZXR1cm5pbmc6Jywgew0KICAgICAgICAgICAgb3JpZ2luYWxfZGF0YToganNvbkRhdGEsDQogICAgICAgICAgICBleHRyYWN0ZWRfdmFsdWU6IGZvcm1hdHRlZFZhbHVlLA0KICAgICAgICAgICAgcHJvY2Vzc2VkX2RhdGE6IGZvcm1hdHRlZFZhbHVlDQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBkYXRhOiBmb3JtYXR0ZWRWYWx1ZSwNCiAgICAgICAgICAgIHRleHQ6IGZvcm1hdHRlZFZhbHVlLA0KICAgICAgICAgICAganNvbjogZXh0cmFjdGVkVmFsdWUsDQogICAgICAgICAgICBleHRyYWN0ZWRfdmFsdWU6IGZvcm1hdHRlZFZhbHVlLA0KICAgICAgICAgICAgZmllbGRfcGF0aDogZmllbGRQYXRoLA0KICAgICAgICAgICAgb3JpZ2luYWw6IGpzb25EYXRhDQogICAgICAgIH07DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignSlNPTiBFeHRyYWN0IGVycm9yOicsIGVycm9yKTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGRhdGE6IGRlZmF1bHRWYWx1ZSwNCiAgICAgICAgICAgIHRleHQ6IGRlZmF1bHRWYWx1ZSwNCiAgICAgICAgICAgIGpzb246IG51bGwsDQogICAgICAgICAgICBleHRyYWN0ZWRfdmFsdWU6IGRlZmF1bHRWYWx1ZSwNCiAgICAgICAgICAgIGZpZWxkX3BhdGg6IGZpZWxkUGF0aCwNCiAgICAgICAgICAgIG9yaWdpbmFsOiBqc29uRGF0YSwNCiAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlDQogICAgICAgIH07DQogICAgfQ0KfQ0KDQoNCi8vIFJhbmRvbSBMaW5lIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVSYW5kb21RdW90ZU5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3Qgc2tpcEVtcHR5ID0gbm9kZS5jb25maWcuc2tpcF9lbXB0eS52YWx1ZSA9PT0gJ3RydWUnOw0KICAgIGNvbnN0IHRyaW1XaGl0ZXNwYWNlID0gbm9kZS5jb25maWcudHJpbV93aGl0ZXNwYWNlLnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3QgbWF4TGVuZ3RoID0gcGFyc2VJbnQobm9kZS5jb25maWcubWF4X2xlbmd0aC52YWx1ZSk7DQoNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgaW5wdXREYXRhOicsIGlucHV0RGF0YSk7DQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIGlucHV0RGF0YS50ZXh0OicsIGlucHV0RGF0YS50ZXh0KTsNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgaW5wdXREYXRhLnRleHQgdHlwZTonLCB0eXBlb2YgaW5wdXREYXRhLnRleHQpOw0KDQogICAgbGV0IHRleHQgPSBpbnB1dERhdGEudGV4dDsNCiAgICBpZiAodHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7DQogICAgICAgIHRleHQgPSBKU09OLnN0cmluZ2lmeSh0ZXh0KTsNCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgcHJvY2Vzc2VkIHRleHQ6JywgdGV4dCk7DQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIHRleHQgbGVuZ3RoOicsIHRleHQubGVuZ3RoKTsNCg0KICAgIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdCgnXG4nKTsNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgc3BsaXQgbGluZXM6JywgbGluZXMubGVuZ3RoLCAnbGluZXMnKTsNCg0KICAgIGxldCB2YWxpZExpbmVzID0gbGluZXM7DQoNCiAgICBpZiAoc2tpcEVtcHR5KSB7DQogICAgICAgIHZhbGlkTGluZXMgPSBsaW5lcy5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKS5sZW5ndGggPiAwKTsNCiAgICAgICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIGFmdGVyIHNraXBFbXB0eTonLCB2YWxpZExpbmVzLmxlbmd0aCwgJ2xpbmVzJyk7DQogICAgfQ0KDQogICAgaWYgKHRyaW1XaGl0ZXNwYWNlKSB7DQogICAgICAgIHZhbGlkTGluZXMgPSB2YWxpZExpbmVzLm1hcChsaW5lID0+IGxpbmUudHJpbSgpKTsNCiAgICAgICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIGFmdGVyIHRyaW1XaGl0ZXNwYWNlOicsIHZhbGlkTGluZXMubGVuZ3RoLCAnbGluZXMnKTsNCiAgICB9DQoNCiAgICBpZiAodmFsaWRMaW5lcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lOiBObyB2YWxpZCBsaW5lcyBmb3VuZCcpOw0KICAgICAgICByZXR1cm4geyByYW5kb21fbGluZTogbnVsbCwgbGluZV9udW1iZXI6IDAsIHRvdGFsX2xpbmVzOiAwIH07DQogICAgfQ0KDQogICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZExpbmVzLmxlbmd0aCk7DQogICAgbGV0IHJhbmRvbUxpbmUgPSB2YWxpZExpbmVzW3JhbmRvbUluZGV4XTsNCg0KICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSBNYXRoLnJhbmRvbSgpOicsIE1hdGgucmFuZG9tKCkpOw0KICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSB2YWxpZExpbmVzLmxlbmd0aDonLCB2YWxpZExpbmVzLmxlbmd0aCk7DQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIGNhbGN1bGF0ZWQgaW5kZXg6JywgcmFuZG9tSW5kZXgsICdvdXQgb2YnLCB2YWxpZExpbmVzLmxlbmd0aCk7DQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIHNlbGVjdGVkIGxpbmU6JywgcmFuZG9tTGluZSk7DQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIGFsbCB2YWxpZCBsaW5lczonLCB2YWxpZExpbmVzKTsNCg0KICAgIGlmIChtYXhMZW5ndGggPiAwICYmIHJhbmRvbUxpbmUubGVuZ3RoID4gbWF4TGVuZ3RoKSB7DQogICAgICAgIHJhbmRvbUxpbmUgPSByYW5kb21MaW5lLnN1YnN0cmluZygwLCBtYXhMZW5ndGgpICsgJy4uLic7DQogICAgICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSB0cnVuY2F0ZWQgdG86JywgcmFuZG9tTGluZSk7DQogICAgfQ0KDQogICAgY29uc3QgcmVzdWx0ID0gew0KICAgICAgICByYW5kb21fbGluZTogcmFuZG9tTGluZSwNCiAgICAgICAgbGluZV9udW1iZXI6IHJhbmRvbUluZGV4ICsgMSwNCiAgICAgICAgdG90YWxfbGluZXM6IHZhbGlkTGluZXMubGVuZ3RoDQogICAgfTsNCg0KICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSByZXR1cm5pbmc6JywgcmVzdWx0KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQoNCi8vIEV4cG9ydCB0byBnbG9iYWwgc2NvcGUNCndpbmRvdy5kYXRhRXhlY3V0b3JzID0gew0KICAgIGV4ZWN1dGVUZXh0Tm9kZSwNCiAgICBleGVjdXRlSnNvbkV4dHJhY3ROb2RlLA0KICAgIGV4ZWN1dGVSYW5kb21RdW90ZU5vZGUNCn07DQoNCg0KLy8gSFRUUCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlSHR0cE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgdXJsID0gbm9kZS5jb25maWcudXJsLnZhbHVlOw0KICAgIGNvbnN0IG1ldGhvZCA9IG5vZGUuY29uZmlnLm1ldGhvZC52YWx1ZTsNCiAgICBjb25zdCBoZWFkZXJzID0gSlNPTi5wYXJzZShub2RlLmNvbmZpZy5oZWFkZXJzLnZhbHVlIHx8ICd7fScpOw0KICAgIGNvbnN0IGJvZHkgPSBub2RlLmNvbmZpZy5ib2R5LnZhbHVlOw0KICAgIGNvbnN0IHVzZVRlbXBsYXRlID0gKG5vZGUuY29uZmlnLnVzZV90ZW1wbGF0ZT8udmFsdWUgfHwgJ2ZhbHNlJykgPT09ICd0cnVlJzsNCg0KICAgIGxldCBwcm9jZXNzZWRCb2R5ID0gYm9keTsNCg0KICAgIC8vIFBhcnNlIGJvZHkgYXMgSlNPTiBpZiBpdCdzIGEgc3RyaW5nIGFuZCBsb29rcyBsaWtlIEpTT04NCiAgICBpZiAodHlwZW9mIHByb2Nlc3NlZEJvZHkgPT09ICdzdHJpbmcnICYmIHByb2Nlc3NlZEJvZHkudHJpbSgpLnN0YXJ0c1dpdGgoJ3snKSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcHJvY2Vzc2VkQm9keSA9IEpTT04ucGFyc2UocHJvY2Vzc2VkQm9keSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIHBhcnNlIGJvZHkgYXMgSlNPTiwgdXNpbmcgYXMgc3RyaW5nOicsIGUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgaWYgKHVzZVRlbXBsYXRlICYmIGlucHV0RGF0YS50ZW1wbGF0ZV9kYXRhKSB7DQogICAgICAgIHByb2Nlc3NlZEJvZHkgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLnByb2Nlc3NUZW1wbGF0ZXMocHJvY2Vzc2VkQm9keSwgaW5wdXREYXRhLnRlbXBsYXRlX2RhdGEpOw0KICAgIH0NCg0KICAgIC8vIFVzZSBPUyBwcm94eSB0byBieXBhc3MgQ09SUw0KICAgIGNvbnN0IHByb3h5UmVxdWVzdCA9IHsNCiAgICAgICAgdXJsOiB1cmwsDQogICAgICAgIG1ldGhvZDogbWV0aG9kLA0KICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLA0KICAgICAgICBib2R5OiBwcm9jZXNzZWRCb2R5LA0KICAgICAgICB0aW1lb3V0OiAzMA0KICAgIH07DQoNCiAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBTZW5kaW5nIHByb3h5IHJlcXVlc3Q6JywgcHJveHlSZXF1ZXN0KTsNCiAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBCb2R5IHR5cGU6JywgdHlwZW9mIHByb2Nlc3NlZEJvZHkpOw0KICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IEJvZHkgY29udGVudDonLCBwcm9jZXNzZWRCb2R5KTsNCiAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBKU09OIHN0cmluZ2lmaWVkIGJvZHk6JywgSlNPTi5zdHJpbmdpZnkocHJveHlSZXF1ZXN0KSk7DQoNCiAgICBjb25zdCBwcm94eVJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvcHJveHkvaHR0cCcsIHsNCiAgICAgICAgbWV0aG9kOiAnUE9TVCcsDQogICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsDQogICAgICAgIH0sDQogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHByb3h5UmVxdWVzdCkNCiAgICB9KTsNCg0KICAgIGlmICghcHJveHlSZXNwb25zZS5vaykgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFByb3h5IHJlcXVlc3QgZmFpbGVkOiAke3Byb3h5UmVzcG9uc2Uuc3RhdHVzfWApOw0KICAgIH0NCg0KICAgIGNvbnN0IHByb3h5RGF0YSA9IGF3YWl0IHByb3h5UmVzcG9uc2UuanNvbigpOw0KDQogICAgaWYgKHByb3h5RGF0YS5lcnJvcikgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgcmVxdWVzdCBmYWlsZWQ6ICR7cHJveHlEYXRhLmVycm9yfWApOw0KICAgIH0NCg0KICAgIC8vIENoZWNrIGlmIHJlc3BvbnNlIGlzIGJpbmFyeSAoYXVkaW8sIGltYWdlLCBldGMuKQ0KICAgIGlmIChwcm94eURhdGEuaXNfYmluYXJ5KSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IFByb2Nlc3NpbmcgYmluYXJ5IHJlc3BvbnNlJyk7DQogICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IENvbnRlbnQgdHlwZTonLCBwcm94eURhdGEuaGVhZGVyc1snY29udGVudC10eXBlJ10gfHwgcHJveHlEYXRhLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddKTsNCiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogQ29udGVudCBsZW5ndGg6JywgcHJveHlEYXRhLmNvbnRlbnQubGVuZ3RoKTsNCg0KICAgICAgICAvLyBDb252ZXJ0IGJhc2U2NCBjb250ZW50IHRvIGJsb2IgZm9yIGJpbmFyeSBkYXRhDQogICAgICAgIGNvbnN0IGJpbmFyeURhdGEgPSBhdG9iKHByb3h5RGF0YS5jb250ZW50KTsNCiAgICAgICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShiaW5hcnlEYXRhLmxlbmd0aCk7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmluYXJ5RGF0YS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlEYXRhLmNoYXJDb2RlQXQoaSk7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSBwcm94eURhdGEuaGVhZGVyc1snY29udGVudC10eXBlJ10gfHwgcHJveHlEYXRhLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddIHx8ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOw0KICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2J5dGVzXSwgeyB0eXBlOiBjb250ZW50VHlwZSB9KTsNCiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogQ3JlYXRlZCBCbG9iOicsIGJsb2IpOw0KICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBCbG9iIHNpemU6JywgYmxvYi5zaXplKTsNCiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogQmxvYiB0eXBlOicsIGJsb2IudHlwZSk7DQoNCiAgICAgICAgLy8gUmV0dXJuIGJsb2IgZGlyZWN0bHkgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd2l0aCBpbWFnZS9hdWRpbyBub2Rlcw0KICAgICAgICAvLyBUaGUgd29ya2Zsb3cgZXhlY3V0aW9uIHdpbGwgaGFuZGxlIG1hcHBpbmcgdG8gdGhlIGNvcnJlY3QgcG9ydHMNCiAgICAgICAgcmV0dXJuIGJsb2I7DQogICAgfQ0KDQogICAgLy8gRm9yIHRleHQgcmVzcG9uc2VzLCB0cnkgdG8gcGFyc2UgYXMgSlNPTiBhbmQgcmV0dXJuIHN0cnVjdHVyZWQgb3V0cHV0DQogICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogUHJvY2Vzc2luZyB0ZXh0IHJlc3BvbnNlJyk7DQogICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogU3RhdHVzIGNvZGU6JywgcHJveHlEYXRhLnN0YXR1cyB8fCAyMDApOw0KICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IENvbnRlbnQgcHJldmlldzonLCBwcm94eURhdGEuY29udGVudC5zdWJzdHJpbmcoMCwgMjAwKSk7DQoNCiAgICBsZXQgcGFyc2VkSnNvbiA9IG51bGw7DQogICAgdHJ5IHsNCiAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFzIEpTT04NCiAgICAgICAgcGFyc2VkSnNvbiA9IEpTT04ucGFyc2UocHJveHlEYXRhLmNvbnRlbnQpOw0KICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBTdWNjZXNzZnVsbHkgcGFyc2VkIEpTT04gcmVzcG9uc2UnKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IFJlc3BvbnNlIGlzIG5vdCB2YWxpZCBKU09OLCBwYXJzZWRfanNvbiB3aWxsIGJlIG51bGwnKTsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm4gc3RydWN0dXJlZCBvdXRwdXQgZm9yIHRleHQgcmVzcG9uc2VzIG1hdGNoaW5nIG5ldyBub2RlIGFyY2hpdGVjdHVyZQ0KICAgIHJldHVybiB7DQogICAgICAgIG9yaWdpbmFsX2RhdGE6IHByb3h5RGF0YS5jb250ZW50LA0KICAgICAgICBwcm9jZXNzZWRfZGF0YTogcGFyc2VkSnNvbiB8fCBwcm94eURhdGEuY29udGVudCwNCiAgICAgICAgcmVzcG9uc2U6IHByb3h5RGF0YS5jb250ZW50LA0KICAgICAgICBzdGF0dXNfY29kZTogcHJveHlEYXRhLnN0YXR1cyB8fCAyMDAsDQogICAgICAgIGhlYWRlcnM6IHByb3h5RGF0YS5oZWFkZXJzIHx8IHt9LA0KICAgICAgICBwYXJzZWRfanNvbjogcGFyc2VkSnNvbiwNCiAgICAgICAgLy8gQWxzbyBwcm92aWRlIHRoZSByYXcgcmVzcG9uc2UgYXMgJ2RhdGEnIGZvciBjb21wYXRpYmlsaXR5DQogICAgICAgIGRhdGE6IHByb3h5RGF0YS5jb250ZW50LA0KICAgICAgICAvLyBBZGQgdGhlIG1pc3Npbmcgb3V0cHV0IHBvcnRzIGZyb20gbm9kZSBkZWZpbml0aW9uDQogICAgICAgIHRleHQ6IHByb3h5RGF0YS5jb250ZW50LA0KICAgICAgICBqc29uOiBwYXJzZWRKc29uLA0KICAgICAgICB1cmw6IHVybA0KICAgIH07DQp9DQoNCi8vIFZGUyBMb2FkIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVWZnNMb2FkTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBmaWxlUGF0aCA9IG5vZGUuY29uZmlnLmZpbGVfcGF0aC52YWx1ZTsNCiAgICBjb25zdCBmb3JtYXQgPSBub2RlLmNvbmZpZy5mb3JtYXQudmFsdWU7DQoNCiAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgZXhlY3V0aW5nOicsIGZpbGVQYXRoLCAnZm9ybWF0OicsIGZvcm1hdCk7DQoNCiAgICB0cnkgew0KICAgICAgICBsZXQgZGF0YSA9IG51bGw7DQoNCiAgICAgICAgaWYgKGZvcm1hdCA9PT0gJ2pzb24nKSB7DQogICAgICAgICAgICBkYXRhID0gYXdhaXQgc3lwbmV4QVBJLnJlYWRWaXJ0dWFsRmlsZUpTT04oZmlsZVBhdGgpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIEpTT04gZGF0YTonLCBkYXRhKTsNCiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09ICd0ZXh0Jykgew0KICAgICAgICAgICAgZGF0YSA9IGF3YWl0IHN5cG5leEFQSS5yZWFkVmlydHVhbEZpbGVUZXh0KGZpbGVQYXRoKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCB0ZXh0IGRhdGEgbGVuZ3RoOicsIGRhdGEgPyBkYXRhLmxlbmd0aCA6IDApOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIHRleHQgZGF0YSBwcmV2aWV3OicsIGRhdGEgPyBkYXRhLnN1YnN0cmluZygwLCAxMDApICsgJy4uLicgOiAnbnVsbCcpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gRm9yIGJpbmFyeSBmaWxlcywgdXNlIHRoZSBkaXJlY3QgVVJMIG1ldGhvZA0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIGJpbmFyeSBmaWxlLCB1c2luZyBkaXJlY3QgVVJMIG1ldGhvZCcpOw0KICAgICAgICAgICAgY29uc3QgZmlsZVVybCA9IHN5cG5leEFQSS5nZXRWaXJ0dWFsRmlsZVVybChmaWxlUGF0aCk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgYmluYXJ5IGZpbGUgVVJMOicsIGZpbGVVcmwpOw0KDQogICAgICAgICAgICAvLyBDaGVjayBmaWxlIGV4dGVuc2lvbiB0byBkZXRlcm1pbmUgaWYgaXQncyBhdWRpbw0KICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZVBhdGguc3BsaXQoJy4nKS5wb3AoKT8udG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgIGNvbnN0IGlzQXVkaW9GaWxlID0gWydtcDMnLCAnd2F2JywgJ29nZycsICdtNGEnLCAnYWFjJywgJ2ZsYWMnXS5pbmNsdWRlcyhleHRlbnNpb24pOw0KICAgICAgICAgICAgY29uc3QgaXNJbWFnZUZpbGUgPSBbJ3BuZycsICdqcGcnLCAnanBlZycsICdnaWYnLCAnd2VicCcsICdzdmcnXS5pbmNsdWRlcyhleHRlbnNpb24pOw0KDQogICAgICAgICAgICBpZiAoaXNBdWRpb0ZpbGUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgZGV0ZWN0ZWQgYXVkaW8gZmlsZTonLCBleHRlbnNpb24pOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChpc0ltYWdlRmlsZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCBkZXRlY3RlZCBpbWFnZSBmaWxlOicsIGV4dGVuc2lvbik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCBkZXRlY3RlZCBiaW5hcnkgZmlsZTonLCBleHRlbnNpb24pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBGZXRjaCB0aGUgYmluYXJ5IGRhdGEgYXMgYSBCbG9iDQogICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGVVcmwpOw0KICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGJpbmFyeSBmaWxlOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIGJpbmFyeSBkYXRhIGFzIEJsb2I6JywgZGF0YSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgYmluYXJ5IGRhdGEgdHlwZTonLCBkYXRhLnR5cGUpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIGJpbmFyeSBkYXRhIHNpemU6JywgZGF0YS5zaXplKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN0b3JlIHRoZSBsb2FkZWQgZGF0YSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICAgICAgbm9kZS5sYXN0TG9hZGVkRmlsZSA9IGZpbGVQYXRoOw0KICAgICAgICBub2RlLmxhc3RMb2FkZWREYXRhID0gZGF0YTsNCg0KICAgICAgICAvLyBSZXR1cm4gc3RydWN0dXJlZCBvdXRwdXQgd2l0aCBhcHByb3ByaWF0ZSBwb3J0IG5hbWVzDQogICAgICAgIGNvbnN0IHJlc3VsdCA9IHsNCiAgICAgICAgICAgIGRhdGE6IGRhdGEsDQogICAgICAgICAgICBmaWxlX3BhdGg6IGZpbGVQYXRoLCAgLy8gUmV0dXJuIHRoZSBhY3R1YWwgZmlsZSBwYXRoIHN0cmluZw0KICAgICAgICAgICAganNvbl9kYXRhOiBmb3JtYXQgPT09ICdqc29uJyA/IGRhdGEgOiBudWxsDQogICAgICAgIH07DQogICAgICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCByZXR1cm5pbmc6JywgcmVzdWx0KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdWRlMgTG9hZCBlcnJvcjonLCBlcnJvcik7DQogICAgICAgIHJldHVybiB7IGRhdGE6IG51bGwsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07DQogICAgfQ0KfQ0KDQoNCi8vIFZGUyBTYXZlIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVWZnNTYXZlTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBmaWxlUGF0aCA9IG5vZGUuY29uZmlnLmZpbGVfcGF0aC52YWx1ZTsNCiAgICBjb25zdCBmb3JtYXQgPSBub2RlLmNvbmZpZy5mb3JtYXQudmFsdWU7DQogICAgY29uc3Qgb3ZlcndyaXRlID0gbm9kZS5jb25maWcub3ZlcndyaXRlLnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3QgYXBwZW5kID0gbm9kZS5jb25maWcuYXBwZW5kLnZhbHVlID09PSAndHJ1ZSc7DQoNCiAgICB0cnkgew0KICAgICAgICBsZXQgZGF0YSA9IGlucHV0RGF0YS5kYXRhOw0KICAgICAgICBsZXQgc3VjY2VzcyA9IGZhbHNlOw0KDQogICAgICAgIGNvbnNvbGUubG9nKCdWRlMgU2F2ZSBpbnB1dCB2YWx1ZSBpbnN0YW5jZW9mIEJsb2I6JywgZGF0YSBpbnN0YW5jZW9mIEJsb2IpOw0KICAgICAgICBjb25zb2xlLmxvZygnVkZTIFNhdmUgaW5wdXQgZGF0YSB0eXBlOicsIHR5cGVvZiBkYXRhKTsNCg0KICAgICAgICBpZiAoZm9ybWF0ID09PSAnanNvbicpIHsNCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZUpTT04oZmlsZVBhdGgsIGRhdGEpOw0KICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gJ3RleHQnKSB7DQogICAgICAgICAgICBjb25zdCB0ZXh0RGF0YSA9IHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyA/IGRhdGEgOiBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKTsNCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZShmaWxlUGF0aCwgdGV4dERhdGEpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gRm9yIGJpbmFyeSBkYXRhIChsaWtlIEJsb2JzKSwgY29udmVydCB0byBkYXRhIFVSTA0KICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBCbG9iKSB7DQogICAgICAgICAgICAgICAgLy8gQ29udmVydCBCbG9iIHRvIGRhdGEgVVJMDQogICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBkYXRhVXJsID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4gcmVzb2x2ZShyZWFkZXIucmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSByZWplY3Q7DQogICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGRhdGEpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZShmaWxlUGF0aCwgZGF0YVVybCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgIC8vIElmIGl0J3MgYWxyZWFkeSBhIGRhdGEgVVJMLCBzYXZlIGl0IGRpcmVjdGx5DQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IGF3YWl0IHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlKGZpbGVQYXRoLCBkYXRhKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gSlNPTiBzdHJpbmcNCiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0RGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpOw0KICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZShmaWxlUGF0aCwgdGV4dERhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHsgc3VjY2Vzczogc3VjY2VzcyB9Ow0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1ZGUyBTYXZlIGVycm9yOicsIGVycm9yKTsNCiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07DQogICAgfQ0KfQ0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cuaHR0cEV4ZWN1dG9ycyA9IHsNCiAgICBleGVjdXRlSHR0cE5vZGUsDQogICAgZXhlY3V0ZVZmc0xvYWROb2RlLA0KICAgIGV4ZWN1dGVWZnNTYXZlTm9kZQ0KfTsNCg0KLy8gSW1hZ2UgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUltYWdlTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBtYXhQcmV2aWV3U2l6ZSA9IG5vZGUuY29uZmlnLm1heF9wcmV2aWV3X3NpemUudmFsdWU7DQogICAgY29uc3Qgc2hvd0luZm8gPSBub2RlLmNvbmZpZy5zaG93X2luZm8udmFsdWUgPT09ICd0cnVlJzsNCg0KICAgIGxldCBpbWFnZURhdGEgPSBpbnB1dERhdGEuaW1hZ2VfZGF0YTsNCiAgICBsZXQgaW1hZ2VVcmwgPSBudWxsOw0KICAgIGxldCBpbWFnZUluZm8gPSBudWxsOw0KDQogICAgLy8gSGFuZGxlIGRpZmZlcmVudCB0eXBlcyBvZiBpbWFnZSBkYXRhDQogICAgaWYgKGltYWdlRGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgLy8gQ3JlYXRlIG9iamVjdCBVUkwgZm9yIEJsb2IgZGF0YQ0KICAgICAgICBpbWFnZVVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoaW1hZ2VEYXRhKTsNCiAgICAgICAgaW1hZ2VJbmZvID0gew0KICAgICAgICAgICAgdHlwZTogaW1hZ2VEYXRhLnR5cGUgfHwgJ2ltYWdlJywNCiAgICAgICAgICAgIHNpemU6IGltYWdlRGF0YS5zaXplDQogICAgICAgIH07DQogICAgfSBlbHNlIGlmICh0eXBlb2YgaW1hZ2VEYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGJhc2U2NCBkYXRhDQogICAgICAgIGlmIChpbWFnZURhdGEuc3RhcnRzV2l0aCgnZGF0YTppbWFnZS8nKSB8fCBpbWFnZURhdGEuc3RhcnRzV2l0aCgnZGF0YTphcHBsaWNhdGlvbi8nKSkgew0KICAgICAgICAgICAgLy8gQWxyZWFkeSBhIGRhdGEgVVJMDQogICAgICAgICAgICBpbWFnZVVybCA9IGltYWdlRGF0YTsNCiAgICAgICAgfSBlbHNlIGlmIChpbWFnZURhdGEubWF0Y2goL15bQS1aYS16MC05Ky9dKj17MCwyfSQvKSkgew0KICAgICAgICAgICAgLy8gTG9va3MgbGlrZSBiYXNlNjQgZGF0YSwgY29udmVydCB0byBkYXRhIFVSTA0KICAgICAgICAgICAgLy8gVHJ5IHRvIGRldGVjdCBpbWFnZSB0eXBlIGZyb20gdGhlIGRhdGENCiAgICAgICAgICAgIGNvbnN0IGltYWdlVHlwZSA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZGV0ZWN0SW1hZ2VUeXBlRnJvbUJhc2U2NChpbWFnZURhdGEpOw0KICAgICAgICAgICAgaW1hZ2VVcmwgPSBgZGF0YToke2ltYWdlVHlwZX07YmFzZTY0LCR7aW1hZ2VEYXRhfWA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBc3N1bWUgaXQncyBhIHJlZ3VsYXIgVVJMDQogICAgICAgICAgICBpbWFnZVVybCA9IGltYWdlRGF0YTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoaW1hZ2VEYXRhICYmIHR5cGVvZiBpbWFnZURhdGEgPT09ICdvYmplY3QnKSB7DQogICAgICAgIC8vIEhhbmRsZSBvYmplY3Qgd2l0aCBpbWFnZSBkYXRhDQogICAgICAgIGlmIChpbWFnZURhdGEudXJsKSB7DQogICAgICAgICAgICBpbWFnZVVybCA9IGltYWdlRGF0YS51cmw7DQogICAgICAgIH0gZWxzZSBpZiAoaW1hZ2VEYXRhLmRhdGEpIHsNCiAgICAgICAgICAgIGltYWdlVXJsID0gaW1hZ2VEYXRhLmRhdGE7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoaW1hZ2VEYXRhLmluZm8pIHsNCiAgICAgICAgICAgIGltYWdlSW5mbyA9IGltYWdlRGF0YS5pbmZvOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gTm90ZTogUmVtb3ZlZCBpbWFnZSBkaW1lbnNpb24gZGV0ZWN0aW9uIGFzIGl0J3Mgbm90IG5lZWRlZA0KDQogICAgLy8gU3RvcmUgaW1hZ2UgZGF0YSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICBub2RlLmxhc3RJbWFnZURhdGEgPSBpbWFnZURhdGE7DQogICAgbm9kZS5sYXN0SW1hZ2VVcmwgPSBpbWFnZVVybDsNCiAgICBub2RlLmxhc3RJbWFnZUluZm8gPSBpbWFnZUluZm87DQoNCiAgICByZXR1cm4gew0KICAgICAgICBpbWFnZV9kYXRhOiBpbWFnZURhdGEsDQogICAgICAgIGltYWdlX3VybDogaW1hZ2VVcmwsDQogICAgICAgIGltYWdlX2luZm86IGltYWdlSW5mbywNCiAgICAgICAgZGF0YTogaW1hZ2VEYXRhDQogICAgfTsNCn0NCg0KLy8gQXVkaW8gTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUF1ZGlvTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBhdXRvUGxheSA9IG5vZGUuY29uZmlnLmF1dG9QbGF5LnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3Qgdm9sdW1lID0gcGFyc2VGbG9hdChub2RlLmNvbmZpZy52b2x1bWUudmFsdWUpOw0KDQogICAgbGV0IGF1ZGlvRGF0YSA9IGlucHV0RGF0YS5hdWRpb19kYXRhOw0KDQogICAgY29uc29sZS5sb2coJ0F1ZGlvIG5vZGUgZXhlY3V0aW9uIC0gaW5wdXREYXRhOicsIGlucHV0RGF0YSk7DQogICAgY29uc29sZS5sb2coJ0F1ZGlvIG5vZGUgZXhlY3V0aW9uIC0gYXVkaW9EYXRhOicsIGF1ZGlvRGF0YSk7DQogICAgY29uc29sZS5sb2coJ0F1ZGlvIGRhdGEgdHlwZTonLCB0eXBlb2YgYXVkaW9EYXRhKTsNCiAgICBjb25zb2xlLmxvZygnQXVkaW8gZGF0YSBpbnN0YW5jZW9mIEJsb2I6JywgYXVkaW9EYXRhIGluc3RhbmNlb2YgQmxvYik7DQoNCiAgICBpZiAoIWF1ZGlvRGF0YSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGF1ZGlvIGRhdGEgcHJvdmlkZWQnKTsNCiAgICB9DQoNCiAgICAvLyBTdG9yZSBhdWRpbyBkYXRhIGZvciBtYW51YWwgcGxheSBidXR0b24gc3lzdGVtIChsaWtlIG9sZCBzeXN0ZW0pDQogICAgbm9kZS5hdWRpb0RhdGEgPSBhdWRpb0RhdGE7DQogICAgbm9kZS52b2x1bWUgPSB2b2x1bWU7DQoNCiAgICAvLyBDcmVhdGUgYXVkaW8gZWxlbWVudCBpZiBpdCBkb2Vzbid0IGV4aXN0IChsaWtlIG9sZCBzeXN0ZW0pDQogICAgaWYgKCFub2RlLmF1ZGlvRWxlbWVudCkgew0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudCA9IG5ldyBBdWRpbygpOw0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5jb250cm9scyA9IHRydWU7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnN0eWxlLndpZHRoID0gJzEwMCUnOw0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7DQogICAgfQ0KDQogICAgLy8gU2V0IGF1ZGlvIHNvdXJjZSAobGlrZSBvbGQgc3lzdGVtKQ0KICAgIGlmIChhdWRpb0RhdGEgaW5zdGFuY2VvZiBCbG9iKSB7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYXVkaW9EYXRhKTsNCiAgICAgICAgY29uc29sZS5sb2coJ1NldCBhdWRpbyBzb3VyY2UgZnJvbSBCbG9iJyk7DQogICAgICAgIGNvbnNvbGUubG9nKCdBdWRpbyBlbGVtZW50IHNyYzonLCBub2RlLmF1ZGlvRWxlbWVudC5zcmMpOw0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGF1ZGlvRGF0YSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgaWYgKGF1ZGlvRGF0YS5zdGFydHNXaXRoKCdkYXRhOmF1ZGlvLycpIHx8IGF1ZGlvRGF0YS5zdGFydHNXaXRoKCdkYXRhOmFwcGxpY2F0aW9uLycpKSB7DQogICAgICAgICAgICAvLyBBbHJlYWR5IGEgZGF0YSBVUkwNCiAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnNyYyA9IGF1ZGlvRGF0YTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZXQgYXVkaW8gc291cmNlIGZyb20gZGF0YSBVUkwnKTsNCiAgICAgICAgfSBlbHNlIGlmIChhdWRpb0RhdGEubWF0Y2goL15bQS1aYS16MC05Ky9dKj17MCwyfSQvKSkgew0KICAgICAgICAgICAgLy8gTG9va3MgbGlrZSBiYXNlNjQgZGF0YSwgY29udmVydCB0byBkYXRhIFVSTA0KICAgICAgICAgICAgY29uc3QgYXVkaW9UeXBlID0gJ2F1ZGlvL21wZWcnOyAvLyBEZWZhdWx0IHRvIE1QMywgY291bGQgYmUgZW5oYW5jZWQgdG8gZGV0ZWN0IHR5cGUNCiAgICAgICAgICAgIGNvbnN0IGRhdGFVcmwgPSBgZGF0YToke2F1ZGlvVHlwZX07YmFzZTY0LCR7YXVkaW9EYXRhfWA7DQogICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5zcmMgPSBkYXRhVXJsOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1NldCBhdWRpbyBzb3VyY2UgZnJvbSBiYXNlNjQgZGF0YScpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSByZWd1bGFyIFVSTA0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuc3JjID0gYXVkaW9EYXRhOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1NldCBhdWRpbyBzb3VyY2UgZnJvbSBVUkwnKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZWxlbWVudCBzcmM6Jywgbm9kZS5hdWRpb0VsZW1lbnQuc3JjKTsNCiAgICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIGRhdGEgcmVjZWl2ZWQ6JywgYXVkaW9EYXRhKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25zb2xlLmxvZygnU2V0IGF1ZGlvIHNvdXJjZSBmcm9tIHVua25vd24gZGF0YSB0eXBlOicsIHR5cGVvZiBhdWRpb0RhdGEpOw0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5zcmMgPSBhdWRpb0RhdGE7DQogICAgfQ0KDQogICAgLy8gU2V0IHZvbHVtZQ0KICAgIG5vZGUuYXVkaW9FbGVtZW50LnZvbHVtZSA9IHZvbHVtZTsNCg0KICAgIC8vIFN0b3JlIGZvciBjb25maWcgcGFuZWwgY29tcGF0aWJpbGl0eQ0KICAgIG5vZGUubGFzdEF1ZGlvRGF0YSA9IGF1ZGlvRGF0YTsNCiAgICBub2RlLmxhc3RBdWRpb1VybCA9IG5vZGUuYXVkaW9FbGVtZW50LnNyYzsNCg0KICAgIC8vIEF1dG8tcGxheSBpZiBjb25maWd1cmVkDQogICAgaWYgKGF1dG9QbGF5KSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhd2FpdCBub2RlLmF1ZGlvRWxlbWVudC5wbGF5KCk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQXV0by1wbGF5IHN0YXJ0ZWQnKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dG8tcGxheSBmYWlsZWQ6JywgZXJyb3IpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gQ29udmVydCBhdWRpbyBkYXRhIHRvIHByb3BlciBkYXRhIFVSTCBmb3IgVkZTIFNhdmUNCiAgICBsZXQgZGF0YVVybEZvclNhdmUgPSBudWxsOw0KDQogICAgaWYgKGF1ZGlvRGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgLy8gQ29udmVydCBCbG9iIHRvIGRhdGEgVVJMDQogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCk7DQogICAgICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDsNCiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGF1ZGlvRGF0YSk7DQogICAgICAgIH0pOw0KICAgICAgICBjb25zb2xlLmxvZygnQ29udmVydGVkIEJsb2IgdG8gZGF0YSBVUkwgZm9yIHNhdmU6JywgZGF0YVVybEZvclNhdmUuc3Vic3RyaW5nKDAsIDUwKSArICcuLi4nKTsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhdWRpb0RhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIGlmIChhdWRpb0RhdGEuc3RhcnRzV2l0aCgnZGF0YTphdWRpby8nKSB8fCBhdWRpb0RhdGEuc3RhcnRzV2l0aCgnZGF0YTphcHBsaWNhdGlvbi8nKSkgew0KICAgICAgICAgICAgLy8gQWxyZWFkeSBhIGRhdGEgVVJMDQogICAgICAgICAgICBkYXRhVXJsRm9yU2F2ZSA9IGF1ZGlvRGF0YTsNCiAgICAgICAgfSBlbHNlIGlmIChhdWRpb0RhdGEubWF0Y2goL15bQS1aYS16MC05Ky9dKj17MCwyfSQvKSkgew0KICAgICAgICAgICAgLy8gQmFzZTY0IGRhdGEsIGNvbnZlcnQgdG8gZGF0YSBVUkwNCiAgICAgICAgICAgIGNvbnN0IGF1ZGlvVHlwZSA9ICdhdWRpby9tcGVnJzsgLy8gRGVmYXVsdCB0byBNUDMsIGNvdWxkIGJlIGVuaGFuY2VkIHRvIGRldGVjdCB0eXBlDQogICAgICAgICAgICBkYXRhVXJsRm9yU2F2ZSA9IGBkYXRhOiR7YXVkaW9UeXBlfTtiYXNlNjQsJHthdWRpb0RhdGF9YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIFJlZ3VsYXIgVVJMLCBrZWVwIGFzIGlzDQogICAgICAgICAgICBkYXRhVXJsRm9yU2F2ZSA9IGF1ZGlvRGF0YTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIEZhbGxiYWNrDQogICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYXVkaW9EYXRhOw0KICAgIH0NCg0KICAgIHJldHVybiB7DQogICAgICAgIGF1ZGlvX2RhdGE6IGF1ZGlvRGF0YSwNCiAgICAgICAgYXVkaW9fdXJsOiBub2RlLmF1ZGlvRWxlbWVudC5zcmMsDQogICAgICAgIGRhdGE6IGRhdGFVcmxGb3JTYXZlICAvLyBSZXR1cm4gdGhlIGFjdHVhbCBhdWRpbyBkYXRhIGFzIGRhdGEgVVJMDQogICAgfTsNCn0NCg0KLy8gRXhwb3J0IHRvIGdsb2JhbCBzY29wZQ0Kd2luZG93Lm1lZGlhRXhlY3V0b3JzID0gew0KICAgIGV4ZWN1dGVJbWFnZU5vZGUsDQogICAgZXhlY3V0ZUF1ZGlvTm9kZQ0KfTsNCg0KDQovLyBUaW1lciBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlVGltZXJOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGludGVydmFsID0gbm9kZS5jb25maWcuaW50ZXJ2YWwudmFsdWU7DQogICAgY29uc3QgY291bnQgPSBub2RlLmNvbmZpZy5jb3VudC52YWx1ZTsNCg0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7DQogICAgICAgICAgICByZXNvbHZlKHsNCiAgICAgICAgICAgICAgICB0cmlnZ2VyOiB0aW1lc3RhbXAsDQogICAgICAgICAgICAgICAgb3JpZ2luYWxfZGF0YTogdGltZXN0YW1wLA0KICAgICAgICAgICAgICAgIHByb2Nlc3NlZF9kYXRhOiB0aW1lc3RhbXAsDQogICAgICAgICAgICAgICAgdGltZXN0YW1wOiB0aW1lc3RhbXAsDQogICAgICAgICAgICAgICAgZWxhcHNlZDogaW50ZXJ2YWwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9LCBpbnRlcnZhbCk7DQogICAgfSk7DQp9DQoNCi8vIERpc3BsYXkgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZURpc3BsYXlOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGZvcm1hdCA9IG5vZGUuY29uZmlnLmZvcm1hdC52YWx1ZTsNCiAgICBjb25zdCBtYXhMZW5ndGggPSBub2RlLmNvbmZpZy5tYXhMZW5ndGgudmFsdWU7DQogICAgY29uc3QgaW5wdXRQb3J0ID0gbm9kZS5jb25maWcuaW5wdXRfcG9ydD8udmFsdWUgfHwgJ2F1dG8nOw0KDQogICAgLy8gVHJ5IHRvIGZpbmQgY29udGVudCBiYXNlZCBvbiBjb25maWd1cmVkIGlucHV0IHBvcnQgb3IgYXV0by1kZXRlY3QNCiAgICBsZXQgY29udGVudCA9IG51bGw7DQoNCiAgICBpZiAoaW5wdXRQb3J0ICE9PSAnYXV0bycpIHsNCiAgICAgICAgLy8gVXNlIHRoZSBzcGVjaWZpZWQgaW5wdXQgcG9ydA0KICAgICAgICBjb250ZW50ID0gaW5wdXREYXRhW2lucHV0UG9ydF07DQogICAgICAgIGNvbnNvbGUubG9nKGBEaXNwbGF5IG5vZGUgdXNpbmcgc3BlY2lmaWVkIGlucHV0IHBvcnQgJyR7aW5wdXRQb3J0fSc6YCwgY29udGVudCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gQXV0by1kZXRlY3Q6IFByaW9yaXR5IG9yZGVyOiB0ZXh0LCBqc29uLCBkYXRhLCBiaW5hcnkNCiAgICAgICAgaWYgKGlucHV0RGF0YS50ZXh0ICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGNvbnRlbnQgPSBpbnB1dERhdGEudGV4dDsNCiAgICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEuanNvbiAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjb250ZW50ID0gaW5wdXREYXRhLmpzb247DQogICAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmRhdGEgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgY29udGVudCA9IGlucHV0RGF0YS5kYXRhOw0KICAgICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5iaW5hcnkgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgY29udGVudCA9IGlucHV0RGF0YS5iaW5hcnk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBVc2UgdGhlIGZpcnN0IGF2YWlsYWJsZSBpbnB1dA0KICAgICAgICAgICAgY29uc3QgZmlyc3RJbnB1dCA9IE9iamVjdC52YWx1ZXMoaW5wdXREYXRhKVswXTsNCiAgICAgICAgICAgIGNvbnRlbnQgPSBmaXJzdElucHV0Ow0KICAgICAgICB9DQogICAgICAgIGNvbnNvbGUubG9nKCdEaXNwbGF5IG5vZGUgYXV0by1kZXRlY3RlZCBpbnB1dCBwb3J0Jyk7DQogICAgfQ0KDQogICAgY29uc29sZS5sb2coJ0Rpc3BsYXkgbm9kZSBpbnB1dCBkYXRhOicsIGlucHV0RGF0YSk7DQogICAgY29uc29sZS5sb2coJ0Rpc3BsYXkgbm9kZSBzZWxlY3RlZCBjb250ZW50OicsIGNvbnRlbnQpOw0KICAgIGNvbnNvbGUubG9nKCdEaXNwbGF5IG5vZGUgY29udGVudCB0eXBlOicsIHR5cGVvZiBjb250ZW50KTsNCg0KICAgIC8vIE9ubHkgY29udmVydCB0byBKU09OIHN0cmluZyBpZiBmb3JtYXQgaXMgJ2pzb24nIG9yIGlmIGl0J3MgYW4gb2JqZWN0IGFuZCBmb3JtYXQgaXMgbm90IHNwZWNpZmllZA0KICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ29iamVjdCcgJiYgZm9ybWF0ID09PSAnanNvbicpIHsNCiAgICAgICAgY29udGVudCA9IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsIDIpOw0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdvYmplY3QnICYmIGZvcm1hdCA9PT0gJ3RleHQnKSB7DQogICAgICAgIC8vIEZvciB0ZXh0IGZvcm1hdCwgZXh0cmFjdCB0aGUgYWN0dWFsIHZhbHVlIGZyb20gY29tbW9uIGZpZWxkcw0KICAgICAgICBpZiAoY29udGVudCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgY29udGVudCA9ICdudWxsJzsNCiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGNvbnRlbnQpKSB7DQogICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5qb2luKCcsICcpOw0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnb2JqZWN0Jykgew0KICAgICAgICAgICAgLy8gTG9vayBmb3IgdGhlIGFjdHVhbCB2YWx1ZSBpbiBjb21tb24gZmllbGRzDQogICAgICAgICAgICBpZiAoY29udGVudC5leHRyYWN0ZWRfdmFsdWUgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoY29udGVudC5leHRyYWN0ZWRfdmFsdWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZW50LnZhbHVlICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU3RyaW5nKGNvbnRlbnQudmFsdWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZW50LnRleHQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoY29udGVudC50ZXh0KTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVudC5kYXRhICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU3RyaW5nKGNvbnRlbnQuZGF0YSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIElmIG5vIGNvbW1vbiBmaWVsZHMgZm91bmQsIGp1c3Qgc2hvdyB0aGUgZmlyc3QgdmFsdWUNCiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFZhbHVlID0gT2JqZWN0LnZhbHVlcyhjb250ZW50KVswXTsNCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU3RyaW5nKGZpcnN0VmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgaWYgKGNvbnRlbnQgJiYgY29udGVudC5sZW5ndGggPiBtYXhMZW5ndGgpIHsNCiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIG1heExlbmd0aCkgKyAnLi4uJzsNCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgZGlzcGxheSBub2RlIGNvbnRlbnQNCiAgICB1cGRhdGVEaXNwbGF5Tm9kZUNvbnRlbnQobm9kZS5pZCwgY29udGVudCwgZm9ybWF0KTsNCg0KICAgIHJldHVybiB7DQogICAgICAgIG9yaWdpbmFsX2RhdGE6IGNvbnRlbnQsDQogICAgICAgIGRpc3BsYXllZDogY29udGVudCwNCiAgICAgICAgcHJvY2Vzc2VkX2RhdGE6IGNvbnRlbnQNCiAgICB9Ow0KfQ0KDQoNCi8vIFJlcGVhdGVyIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVSZXBlYXRlck5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgaW50ZXJ2YWwgPSBwYXJzZUludChub2RlLmNvbmZpZy5pbnRlcnZhbC52YWx1ZSk7DQogICAgY29uc3QgY291bnQgPSBwYXJzZUludChub2RlLmNvbmZpZy5jb3VudC52YWx1ZSk7DQoNCiAgICAvLyBJbml0aWFsaXplIHJlcGVhdGVyIHN0YXRlIGlmIG5vdCBleGlzdHMNCiAgICBpZiAoIW5vZGUucmVwZWF0ZXJTdGF0ZSkgew0KICAgICAgICBub2RlLnJlcGVhdGVyU3RhdGUgPSB7DQogICAgICAgICAgICBjb3VudDogMCwNCiAgICAgICAgICAgIGludGVydmFsOiBudWxsLA0KICAgICAgICAgICAgaXNSdW5uaW5nOiBmYWxzZQ0KICAgICAgICB9Ow0KICAgIH0NCg0KICAgIC8vIElmIHRoaXMgaXMgYSBtYW51YWwgdHJpZ2dlciAobm90IGZyb20gaW50ZXJ2YWwpLCBzdGFydCB0aGUgcmVwZWF0ZXINCiAgICBpZiAoIW5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmcpIHsNCiAgICAgICAgbm9kZS5yZXBlYXRlclN0YXRlLmlzUnVubmluZyA9IHRydWU7DQogICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCA9IDA7DQoNCiAgICAgICAgLy8gU3RhcnQgdGhlIGludGVydmFsDQogICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5pbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCsrOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlcGVhdGVyIHRyaWdnZXJlZDonLCBub2RlLmlkLCAnY291bnQ6Jywgbm9kZS5yZXBlYXRlclN0YXRlLmNvdW50KTsNCg0KICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgY29ubmVjdGVkIHdvcmtmbG93DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3RlZE5vZGVzID0gZmluZENvbm5lY3RlZE5vZGVzKG5vZGUuaWQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGVkID0gbmV3IFNldCgpOw0KDQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb25uZWN0ZWROb2RlIG9mIGNvbm5lY3RlZE5vZGVzKSB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVOb2RlKGNvbm5lY3RlZE5vZGUubm9kZSwgeyB0cmlnZ2VyOiBEYXRlLm5vdygpIH0sIGV4ZWN1dGVkKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV4ZWN1dGluZyByZXBlYXRlciB3b3JrZmxvdzonLCBlcnJvcik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFN0b3AgaWYgY291bnQgbGltaXQgcmVhY2hlZA0KICAgICAgICAgICAgaWYgKGNvdW50ID4gMCAmJiBub2RlLnJlcGVhdGVyU3RhdGUuY291bnQgPj0gY291bnQpIHsNCiAgICAgICAgICAgICAgICBlbmdpbmUuc3RvcFJlcGVhdGVyKG5vZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCBpbnRlcnZhbCk7DQogICAgfQ0KDQogICAgcmV0dXJuIHsgdHJpZ2dlcjogRGF0ZS5ub3coKSwgY291bnQ6IG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCwgaXNSdW5uaW5nOiBub2RlLnJlcGVhdGVyU3RhdGUuaXNSdW5uaW5nIH07DQp9DQoNCi8vIENvbmRpdGlvbiBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlQ29uZGl0aW9uTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBvcGVyYXRvciA9IG5vZGUuY29uZmlnLm9wZXJhdG9yLnZhbHVlOw0KICAgIGNvbnN0IGNvbXBhcmVWYWx1ZSA9IG5vZGUuY29uZmlnLmNvbXBhcmVfdmFsdWUudmFsdWU7DQogICAgY29uc3QgY2FzZVNlbnNpdGl2ZSA9IG5vZGUuY29uZmlnLmNhc2Vfc2Vuc2l0aXZlLnZhbHVlID09PSAndHJ1ZSc7DQoNCiAgICBsZXQgaW5wdXRWYWx1ZSA9IGlucHV0RGF0YS52YWx1ZTsNCiAgICBsZXQgcmVzdWx0ID0gZmFsc2U7DQoNCiAgICAvLyBDb252ZXJ0IGlucHV0IHRvIHN0cmluZyBmb3IgY29tcGFyaXNvbiBpZiBuZWVkZWQNCiAgICBsZXQgaW5wdXRTdHIgPSBTdHJpbmcoaW5wdXRWYWx1ZSk7DQogICAgbGV0IGNvbXBhcmVTdHIgPSBTdHJpbmcoY29tcGFyZVZhbHVlKTsNCg0KICAgIC8vIERlYnVnIGxvZ2dpbmcgZm9yIHN0cmluZyBjb21wYXJpc29ucw0KICAgIGNvbnNvbGUubG9nKCdDb25kaXRpb24gbm9kZSBkZWJ1ZzonKTsNCiAgICBjb25zb2xlLmxvZygnICBJbnB1dCB2YWx1ZTonLCBpbnB1dFZhbHVlLCAnVHlwZTonLCB0eXBlb2YgaW5wdXRWYWx1ZSk7DQogICAgY29uc29sZS5sb2coJyAgQ29tcGFyZSB2YWx1ZTonLCBjb21wYXJlVmFsdWUsICdUeXBlOicsIHR5cGVvZiBjb21wYXJlVmFsdWUpOw0KICAgIGNvbnNvbGUubG9nKCcgIElucHV0IHN0cmluZzonLCBpbnB1dFN0ciwgJ0xlbmd0aDonLCBpbnB1dFN0ci5sZW5ndGgpOw0KICAgIGNvbnNvbGUubG9nKCcgIENvbXBhcmUgc3RyaW5nOicsIGNvbXBhcmVTdHIsICdMZW5ndGg6JywgY29tcGFyZVN0ci5sZW5ndGgpOw0KICAgIGNvbnNvbGUubG9nKCcgIENhc2Ugc2Vuc2l0aXZlOicsIGNhc2VTZW5zaXRpdmUpOw0KDQogICAgLy8gSGFuZGxlIGNhc2Ugc2Vuc2l0aXZpdHkNCiAgICBpZiAoIWNhc2VTZW5zaXRpdmUpIHsNCiAgICAgICAgaW5wdXRTdHIgPSBpbnB1dFN0ci50b0xvd2VyQ2FzZSgpOw0KICAgICAgICBjb21wYXJlU3RyID0gY29tcGFyZVN0ci50b0xvd2VyQ2FzZSgpOw0KICAgICAgICBjb25zb2xlLmxvZygnICBBZnRlciBjYXNlIGNvbnZlcnNpb24gLSBJbnB1dDonLCBpbnB1dFN0ciwgJ0NvbXBhcmU6JywgY29tcGFyZVN0cik7DQogICAgfQ0KDQogICAgLy8gUGVyZm9ybSBjb21wYXJpc29uIGJhc2VkIG9uIG9wZXJhdG9yDQogICAgc3dpdGNoIChvcGVyYXRvcikgew0KICAgICAgICBjYXNlICdlcXVhbHMnOg0KICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXRTdHIgPT09IGNvbXBhcmVTdHI7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnbm90X2VxdWFscyc6DQogICAgICAgICAgICByZXN1bHQgPSBpbnB1dFN0ciAhPT0gY29tcGFyZVN0cjsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdncmVhdGVyX3RoYW4nOg0KICAgICAgICAgICAgcmVzdWx0ID0gTnVtYmVyKGlucHV0VmFsdWUpID4gTnVtYmVyKGNvbXBhcmVWYWx1ZSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnbGVzc190aGFuJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IE51bWJlcihpbnB1dFZhbHVlKSA8IE51bWJlcihjb21wYXJlVmFsdWUpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2dyZWF0ZXJfdGhhbl9vcl9lcXVhbCc6DQogICAgICAgICAgICByZXN1bHQgPSBOdW1iZXIoaW5wdXRWYWx1ZSkgPj0gTnVtYmVyKGNvbXBhcmVWYWx1ZSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnbGVzc190aGFuX29yX2VxdWFsJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IE51bWJlcihpbnB1dFZhbHVlKSA8PSBOdW1iZXIoY29tcGFyZVZhbHVlKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdjb250YWlucyc6DQogICAgICAgICAgICByZXN1bHQgPSBpbnB1dFN0ci5pbmNsdWRlcyhjb21wYXJlU3RyKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdub3RfY29udGFpbnMnOg0KICAgICAgICAgICAgcmVzdWx0ID0gIWlucHV0U3RyLmluY2x1ZGVzKGNvbXBhcmVTdHIpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ3N0YXJ0c193aXRoJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLnN0YXJ0c1dpdGgoY29tcGFyZVN0cik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnZW5kc193aXRoJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLmVuZHNXaXRoKGNvbXBhcmVTdHIpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2lzX2VtcHR5JzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLnRyaW0oKSA9PT0gJyc7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnaXNfbm90X2VtcHR5JzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLnRyaW0oKSAhPT0gJyc7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOw0KICAgIH0NCg0KICAgIC8vIFN0b3JlIGZvciBkaXNwbGF5IGluIGNvbmZpZyBwYW5lbA0KICAgIG5vZGUubGFzdElucHV0VmFsdWUgPSBpbnB1dFZhbHVlOw0KICAgIG5vZGUubGFzdENvbXBhcmVWYWx1ZSA9IGNvbXBhcmVWYWx1ZTsNCiAgICBub2RlLmxhc3RSZXN1bHQgPSByZXN1bHQ7DQogICAgbm9kZS5sYXN0T3BlcmF0b3IgPSBvcGVyYXRvcjsNCg0KICAgIHJldHVybiB7IHJlc3VsdDogcmVzdWx0IH07DQp9DQoNCi8vIExvZ2ljYWwgR2F0ZSBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlTG9naWNhbEdhdGVOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGludmVydCA9IG5vZGUuY29uZmlnLmludmVydC52YWx1ZSA9PT0gJ3RydWUnOw0KICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gbm9kZS5jb25maWcuZGVzY3JpcHRpb24udmFsdWU7DQoNCiAgICBsZXQgY29uZGl0aW9uID0gaW5wdXREYXRhLmNvbmRpdGlvbjsNCg0KICAgIC8vIENvbnZlcnQgdG8gYm9vbGVhbiBpZiBuZWVkZWQNCiAgICBpZiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgY29uZGl0aW9uID0gY29uZGl0aW9uLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJzsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25kaXRpb24gPT09ICdudW1iZXInKSB7DQogICAgICAgIGNvbmRpdGlvbiA9IGNvbmRpdGlvbiAhPT0gMDsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25kaXRpb24gPT09ICdvYmplY3QnKSB7DQogICAgICAgIC8vIElmIGl0J3MgYW4gb2JqZWN0IHdpdGggYSByZXN1bHQgZmllbGQgKGZyb20gY29uZGl0aW9uIG5vZGUpDQogICAgICAgIGNvbmRpdGlvbiA9IGNvbmRpdGlvbi5yZXN1bHQgPT09IHRydWU7DQogICAgfQ0KDQogICAgLy8gQXBwbHkgaW52ZXJzaW9uIGlmIGNvbmZpZ3VyZWQNCiAgICBpZiAoaW52ZXJ0KSB7DQogICAgICAgIGNvbmRpdGlvbiA9ICFjb25kaXRpb247DQogICAgfQ0KDQogICAgLy8gU3RvcmUgZm9yIGRpc3BsYXkgaW4gY29uZmlnIHBhbmVsDQogICAgbm9kZS5sYXN0Q29uZGl0aW9uID0gY29uZGl0aW9uOw0KICAgIG5vZGUubGFzdEludmVydGVkID0gaW52ZXJ0Ow0KICAgIG5vZGUubGFzdERlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247DQoNCiAgICAvLyBPbmx5IHJldHVybiB0cmlnZ2VyIGlmIGNvbmRpdGlvbiBpcyB0cnVlDQogICAgaWYgKGNvbmRpdGlvbikgew0KICAgICAgICByZXR1cm4geyB0cmlnZ2VyOiBEYXRlLm5vdygpIH07DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gUmV0dXJuIHNwZWNpYWwgb2JqZWN0IHRvIGluZGljYXRlIGV4ZWN1dGlvbiBzaG91bGQgc3RvcA0KICAgICAgICByZXR1cm4geyBfX3N0b3BfZXhlY3V0aW9uOiB0cnVlIH07DQogICAgfQ0KfQ0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cuZmxvd0V4ZWN1dG9ycyA9IHsNCiAgICBleGVjdXRlVGltZXJOb2RlLA0KICAgIGV4ZWN1dGVEaXNwbGF5Tm9kZSwNCiAgICBleGVjdXRlUmVwZWF0ZXJOb2RlLA0KICAgIGV4ZWN1dGVDb25kaXRpb25Ob2RlLA0KICAgIGV4ZWN1dGVMb2dpY2FsR2F0ZU5vZGUNCn07DQoNCg0KLy8gTExNIENoYXQgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUxsbUNoYXROb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGVuZHBvaW50ID0gbm9kZS5jb25maWcuZW5kcG9pbnQudmFsdWU7DQogICAgY29uc3QgbW9kZWwgPSBub2RlLmNvbmZpZy5tb2RlbC52YWx1ZTsNCiAgICBjb25zdCB0ZW1wZXJhdHVyZSA9IHBhcnNlRmxvYXQobm9kZS5jb25maWcudGVtcGVyYXR1cmUudmFsdWUpOw0KICAgIGNvbnN0IG1heFRva2VucyA9IHBhcnNlSW50KG5vZGUuY29uZmlnLm1heF90b2tlbnMudmFsdWUpOw0KICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IG5vZGUuY29uZmlnLnN5c3RlbV9wcm9tcHQudmFsdWU7DQogICAgY29uc3QgaW5jbHVkZUNvbnRleHQgPSBub2RlLmNvbmZpZy5pbmNsdWRlX2NvbnRleHQudmFsdWUgPT09ICd0cnVlJzsNCg0KICAgIC8vIEFjY2VwdCBwcm9tcHQgZnJvbSBlaXRoZXIgJ3Byb21wdCcgb3IgJ3RleHQnIGlucHV0DQogICAgbGV0IHByb21wdCA9IGlucHV0RGF0YS5wcm9tcHQ7DQogICAgaWYgKCFwcm9tcHQgJiYgaW5wdXREYXRhLnRleHQpIHsNCiAgICAgICAgcHJvbXB0ID0gaW5wdXREYXRhLnRleHQ7DQogICAgfQ0KICAgIGlmICghcHJvbXB0ICYmIGlucHV0RGF0YS5jb250ZXh0KSB7DQogICAgICAgIC8vIElmIGNvbnRleHQgaXMgYSBzdHJpbmcsIHVzZSBpdCBhcyBwcm9tcHQNCiAgICAgICAgaWYgKHR5cGVvZiBpbnB1dERhdGEuY29udGV4dCA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIHByb21wdCA9IGlucHV0RGF0YS5jb250ZXh0Ow0KICAgICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5jb250ZXh0ICYmIHR5cGVvZiBpbnB1dERhdGEuY29udGV4dCA9PT0gJ29iamVjdCcgJiYgaW5wdXREYXRhLmNvbnRleHQudGV4dCkgew0KICAgICAgICAgICAgLy8gSWYgY29udGV4dCBpcyBhbiBvYmplY3Qgd2l0aCB0ZXh0IGZpZWxkLCB1c2UgdGhhdA0KICAgICAgICAgICAgcHJvbXB0ID0gaW5wdXREYXRhLmNvbnRleHQudGV4dDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIXByb21wdCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xMTSBDaGF0IHJlcXVpcmVzIGEgcHJvbXB0IGlucHV0LiBDb25uZWN0IGEgVGV4dCBub2RlIHRvIHByb3ZpZGUgdGhlIHByb21wdC4nKTsNCiAgICB9DQoNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBtZXNzYWdlcyA9IFtdOw0KDQogICAgICAgIGlmIChzeXN0ZW1Qcm9tcHQpIHsNCiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2goeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogc3lzdGVtUHJvbXB0IH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGluY2x1ZGVDb250ZXh0ICYmIGlucHV0RGF0YS5jb250ZXh0KSB7DQogICAgICAgICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiBgQ29udGV4dDogJHtKU09OLnN0cmluZ2lmeShpbnB1dERhdGEuY29udGV4dCl9XG5cblByb21wdDogJHtwcm9tcHR9YCB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2goeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHByb21wdCB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7ZW5kcG9pbnR9L2NoYXQvY29tcGxldGlvbnNgLCB7DQogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgICAgIG1vZGVsOiBtb2RlbCwNCiAgICAgICAgICAgICAgICBtZXNzYWdlczogbWVzc2FnZXMsDQogICAgICAgICAgICAgICAgdGVtcGVyYXR1cmU6IHRlbXBlcmF0dXJlLA0KICAgICAgICAgICAgICAgIG1heF90b2tlbnM6IG1heFRva2Vucw0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSk7DQoNCiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsNCg0KICAgICAgICBpZiAoZGF0YS5lcnJvcikgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IubWVzc2FnZSB8fCAnTExNIEFQSSBlcnJvcicpOw0KICAgICAgICB9DQoNCiAgICAgICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gZGF0YS5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50IHx8ICcnOw0KDQogICAgICAgIC8vIFN0b3JlIGZvciBkaXNwbGF5IGluIGNvbmZpZyBwYW5lbA0KICAgICAgICBub2RlLmxhc3RSZXNwb25zZSA9IHJlc3BvbnNlVGV4dDsNCiAgICAgICAgbm9kZS5sYXN0VXNhZ2UgPSBkYXRhLnVzYWdlOw0KICAgICAgICBub2RlLmxhc3RNb2RlbCA9IG1vZGVsOw0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICByZXNwb25zZTogcmVzcG9uc2VUZXh0LA0KICAgICAgICAgICAgdG9rZW5zX3VzZWQ6IGRhdGEudXNhZ2U/LnRvdGFsX3Rva2VucyB8fCAwLA0KICAgICAgICAgICAgbW9kZWxfdXNlZDogbW9kZWwsDQogICAgICAgICAgICBmdWxsX3Jlc3BvbnNlOiBkYXRhDQogICAgICAgIH07DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignTExNIENoYXQgZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4geyByZXNwb25zZTogbnVsbCwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTsNCiAgICB9DQp9DQoNCg0KLy8gVGVybWluYWwgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVRlcm1pbmFsTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBjb21tYW5kID0gbm9kZS5jb25maWcuY29tbWFuZC52YWx1ZTsNCiAgICBjb25zdCB1c2VJbnB1dENvbW1hbmQgPSBub2RlLmNvbmZpZy51c2VfaW5wdXRfY29tbWFuZC52YWx1ZSA9PT0gJ3RydWUnOw0KICAgIGNvbnN0IHdvcmtpbmdEaXJlY3RvcnkgPSBub2RlLmNvbmZpZy53b3JraW5nX2RpcmVjdG9yeS52YWx1ZTsNCiAgICBjb25zdCB0aW1lb3V0ID0gcGFyc2VJbnQobm9kZS5jb25maWcudGltZW91dC52YWx1ZSk7DQoNCiAgICBsZXQgZmluYWxDb21tYW5kID0gY29tbWFuZDsNCiAgICBpZiAodXNlSW5wdXRDb21tYW5kICYmIGlucHV0RGF0YS5jb21tYW5kKSB7DQogICAgICAgIGZpbmFsQ29tbWFuZCA9IGlucHV0RGF0YS5jb21tYW5kOw0KICAgIH0NCg0KICAgIHRyeSB7DQogICAgICAgIC8vIFRoaXMgd291bGQgbmVlZCB0byBiZSBpbXBsZW1lbnRlZCB3aXRoIGFjdHVhbCB0ZXJtaW5hbCBleGVjdXRpb24NCiAgICAgICAgLy8gRm9yIG5vdywgd2UnbGwgcmV0dXJuIGEgcGxhY2Vob2xkZXINCiAgICAgICAgY29uc29sZS5sb2coJ1Rlcm1pbmFsIGNvbW1hbmQgd291bGQgZXhlY3V0ZTonLCBmaW5hbENvbW1hbmQpOw0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBvdXRwdXQ6IGBDb21tYW5kIGV4ZWN1dGVkOiAke2ZpbmFsQ29tbWFuZH1gLA0KICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSwNCiAgICAgICAgICAgIGVycm9yOiBudWxsLA0KICAgICAgICAgICAgZXhpdF9jb2RlOiAwDQogICAgICAgIH07DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignVGVybWluYWwgZXhlY3V0aW9uIGVycm9yOicsIGVycm9yKTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIG91dHB1dDogbnVsbCwNCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLA0KICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsDQogICAgICAgICAgICBleGl0X2NvZGU6IDENCiAgICAgICAgfTsNCiAgICB9DQp9DQoNCi8vIEV4cG9ydCB0byBnbG9iYWwgc2NvcGUNCndpbmRvdy5haUV4ZWN1dG9ycyA9IHsNCiAgICBleGVjdXRlTGxtQ2hhdE5vZGUsDQogICAgZXhlY3V0ZVRlcm1pbmFsTm9kZQ0KfTsNCg0KLy8gZXhlY3V0aW9uLWVuZ2luZS5qcyAtIER5bmFtaWMgZXhlY3V0aW9uIGVuZ2luZSBmb3IgRmxvdyBFZGl0b3INCg0KY2xhc3MgRXhlY3V0aW9uRW5naW5lIHsNCiAgICBjb25zdHJ1Y3RvcihyZWdpc3RyeSkgew0KICAgICAgICB0aGlzLnJlZ2lzdHJ5ID0gcmVnaXN0cnk7DQogICAgICAgIHRoaXMuc2V0dXBFeGVjdXRvcnMoKTsNCiAgICB9DQoNCiAgICBzZXR1cEV4ZWN1dG9ycygpIHsNCiAgICAgICAgLy8gUmVnaXN0ZXIgZXhlY3V0b3JzIGZyb20gZXh0ZXJuYWwgZmlsZXMgd2l0aCBlbmdpbmUgaW5zdGFuY2UgcGFzc2VkIGFzIGZpcnN0IHBhcmFtZXRlcg0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ2h0dHBfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuaHR0cEV4ZWN1dG9ycy5leGVjdXRlSHR0cE5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3Zmc19zYXZlX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93Lmh0dHBFeGVjdXRvcnMuZXhlY3V0ZVZmc1NhdmVOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCd2ZnNfbG9hZF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5odHRwRXhlY3V0b3JzLmV4ZWN1dGVWZnNMb2FkTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgICAgICANCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCd0aW1lcl9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5mbG93RXhlY3V0b3JzLmV4ZWN1dGVUaW1lck5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ2Rpc3BsYXlfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZmxvd0V4ZWN1dG9ycy5leGVjdXRlRGlzcGxheU5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3JlcGVhdGVyX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFeGVjdXRvcnMuZXhlY3V0ZVJlcGVhdGVyTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignY29uZGl0aW9uX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFeGVjdXRvcnMuZXhlY3V0ZUNvbmRpdGlvbk5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ2xvZ2ljYWxfZ2F0ZV9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5mbG93RXhlY3V0b3JzLmV4ZWN1dGVMb2dpY2FsR2F0ZU5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICAgICAgDQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignYXVkaW9fZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cubWVkaWFFeGVjdXRvcnMuZXhlY3V0ZUF1ZGlvTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignaW1hZ2VfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cubWVkaWFFeGVjdXRvcnMuZXhlY3V0ZUltYWdlTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgICAgICANCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdqc29uX2V4dHJhY3RfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZGF0YUV4ZWN1dG9ycy5leGVjdXRlSnNvbkV4dHJhY3ROb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdyYW5kb21fbGluZV9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5kYXRhRXhlY3V0b3JzLmV4ZWN1dGVSYW5kb21RdW90ZU5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3RleHRfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZGF0YUV4ZWN1dG9ycy5leGVjdXRlVGV4dE5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICAgICAgDQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignbGxtX2NoYXRfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuYWlFeGVjdXRvcnMuZXhlY3V0ZUxsbUNoYXROb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCd0ZXJtaW5hbF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5haUV4ZWN1dG9ycy5leGVjdXRlVGVybWluYWxOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICB9DQoNCiAgICBhc3luYyBleGVjdXRlTm9kZShub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgICAgIGNvbnN0IG5vZGVEZWYgPSB0aGlzLnJlZ2lzdHJ5LmdldE5vZGVUeXBlKG5vZGUudHlwZSk7DQogICAgICAgIGlmICghbm9kZURlZikgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBub2RlIGRlZmluaXRpb24gZm91bmQgZm9yIHR5cGU6ICR7bm9kZS50eXBlfWApOw0KICAgICAgICB9DQoNCiAgICAgICAgY29uc3QgZXhlY3V0b3JOYW1lID0gbm9kZURlZi5leGVjdXRvcjsNCiAgICAgICAgY29uc3QgZXhlY3V0b3IgPSB0aGlzLnJlZ2lzdHJ5LmdldEV4ZWN1dG9yKGV4ZWN1dG9yTmFtZSk7DQoNCiAgICAgICAgaWYgKCFleGVjdXRvcikgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBleGVjdXRvciBmb3VuZCBmb3I6ICR7ZXhlY3V0b3JOYW1lfWApOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGF3YWl0IGV4ZWN1dG9yKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpOw0KICAgIH0NCg0KDQoNCiAgICAvLyBTdG9wIHJlcGVhdGVyIG1ldGhvZA0KICAgIHN0b3BSZXBlYXRlcihub2RlKSB7DQogICAgICAgIGlmIChub2RlLnJlcGVhdGVyU3RhdGUgJiYgbm9kZS5yZXBlYXRlclN0YXRlLmludGVydmFsKSB7DQogICAgICAgICAgICBjbGVhckludGVydmFsKG5vZGUucmVwZWF0ZXJTdGF0ZS5pbnRlcnZhbCk7DQogICAgICAgICAgICBub2RlLnJlcGVhdGVyU3RhdGUuaW50ZXJ2YWwgPSBudWxsOw0KICAgICAgICAgICAgbm9kZS5yZXBlYXRlclN0YXRlLmlzUnVubmluZyA9IGZhbHNlOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlcGVhdGVyIHN0b3BwZWQ6Jywgbm9kZS5pZCk7DQogICAgICAgIH0NCiAgICB9DQoNCg0KDQoNCn0NCg0KLy8gR2xvYmFsIGV4ZWN1dGlvbiBlbmdpbmUgaW5zdGFuY2UNCmNvbnNvbGUubG9nKCdDcmVhdGluZyBnbG9iYWwgZXhlY3V0aW9uRW5naW5lIGluc3RhbmNlLi4uJyk7DQpjb25zdCBleGVjdXRpb25FbmdpbmUgPSBuZXcgRXhlY3V0aW9uRW5naW5lKG5vZGVSZWdpc3RyeSk7DQpjb25zb2xlLmxvZygnR2xvYmFsIGV4ZWN1dGlvbkVuZ2luZSBjcmVhdGVkOicsIGV4ZWN1dGlvbkVuZ2luZSk7IA0KDQovLyB3b3JrZmxvdy5qcyAtIFdvcmtmbG93IGV4ZWN1dGlvbiBsb2dpYyBmb3IgRmxvdyBFZGl0b3INCg0KLy8gUnVuIHRoZSB3b3JrZmxvdw0KYXN5bmMgZnVuY3Rpb24gcnVuV29ya2Zsb3coKSB7DQogICAgaWYgKGZsb3dFZGl0b3IuaXNSdW5uaW5nKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdXb3JrZmxvdyBhbHJlYWR5IHJ1bm5pbmcnKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBmbG93RWRpdG9yLmlzUnVubmluZyA9IHRydWU7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3J1bi13b3JrZmxvdycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3Atd29ya2Zsb3cnKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1mbGV4JzsNCiAgICANCiAgICAvLyBDbGVhciBvdXRwdXQNCiAgICBjb25zdCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhlY3V0aW9uLW91dHB1dCcpOw0KICAgIG91dHB1dC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9nLWVudHJ5IGluZm8iPlN0YXJ0aW5nIHdvcmtmbG93IGV4ZWN1dGlvbi4uLjwvZGl2Pic7DQogICAgDQogICAgdHJ5IHsNCiAgICAgICAgLy8gRmluZCBzdGFydCBub2RlcyAobm9kZXMgd2l0aCBubyBpbnB1dHMgdGhhdCBhcmUgcGFydCBvZiBhIGNvbm5lY3RlZCB3b3JrZmxvdykNCiAgICAgICAgY29uc3Qgc3RhcnROb2RlcyA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5ub2Rlcy52YWx1ZXMoKSkuZmlsdGVyKG5vZGUgPT4gew0KICAgICAgICAgICAgY29uc3Qgbm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZShub2RlLnR5cGUpOw0KICAgICAgICAgICAgaWYgKCFub2RlRGVmKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBObyBub2RlIGRlZmluaXRpb24gZm91bmQgZm9yIHR5cGU6ICR7bm9kZS50eXBlfWApOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc29sZS5sb2coYENoZWNraW5nIG5vZGUgJHtub2RlLnR5cGV9ICgke25vZGUuaWR9KTogaW5wdXRzPSR7bm9kZURlZi5pbnB1dHMubGVuZ3RofSwgb3V0cHV0cz0ke25vZGVEZWYub3V0cHV0cy5sZW5ndGh9YCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFRpbWVyIGFuZCBSZXBlYXRlciBub2RlcyBhcmUgc3RhcnQgbm9kZXMgKGNhbiB0cmlnZ2VyIHRoZW1zZWx2ZXMpDQogICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAndGltZXInIHx8IG5vZGUudHlwZSA9PT0gJ3JlcGVhdGVyJykgew0KICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdyZXBlYXRlcicpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNSdW5uaW5nID0gbm9kZS5yZXBlYXRlclN0YXRlICYmIG5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmc7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZXBlYXRlciAke25vZGUuaWR9OiBpc1J1bm5pbmc9JHtpc1J1bm5pbmd9LCByZXBlYXRlclN0YXRlPWAsIG5vZGUucmVwZWF0ZXJTdGF0ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIFRpbWVyL1JlcGVhdGVyIGlzIGEgc3RhcnQgbm9kZSBpZiBpdCBoYXMgY29ubmVjdGVkIG91dHB1dHMNCiAgICAgICAgICAgICAgICBjb25zdCBoYXNDb25uZWN0ZWRPdXRwdXRzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5zb21lKGNvbm4gPT4gDQogICAgICAgICAgICAgICAgICAgIGNvbm4uZnJvbS5ub2RlSWQgPT09IG5vZGUuaWQNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke25vZGUudHlwZX0gJHtub2RlLmlkfTogaGFzQ29ubmVjdGVkT3V0cHV0cz0ke2hhc0Nvbm5lY3RlZE91dHB1dHN9YCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc0Nvbm5lY3RlZE91dHB1dHM7IC8vIFRpbWVyL1JlcGVhdGVyIGlzIGEgc3RhcnQgbm9kZSBpZiBjb25uZWN0ZWQNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gSWYgbm9kZSBoYXMgbm8gaW5wdXRzLCBjaGVjayBpZiBpdCdzIHBhcnQgb2YgYSBjb25uZWN0ZWQgd29ya2Zsb3cNCiAgICAgICAgICAgIGlmIChub2RlRGVmLmlucHV0cy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGlzIG5vZGUgaGFzIGFueSBvdXRwdXRzIHRoYXQgYXJlIGNvbm5lY3RlZCB0byBvdGhlciBub2Rlcw0KICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Nvbm5lY3RlZE91dHB1dHMgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLnNvbWUoY29ubiA9PiANCiAgICAgICAgICAgICAgICAgICAgY29ubi5mcm9tLm5vZGVJZCA9PT0gbm9kZS5pZA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLnR5cGV9ICgke25vZGUuaWR9KTogbm8gaW5wdXRzLCBoYXNDb25uZWN0ZWRPdXRwdXRzPSR7aGFzQ29ubmVjdGVkT3V0cHV0c31gKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBPbmx5IGluY2x1ZGUgaWYgaXQncyBjb25uZWN0ZWQgdG8gdGhlIHdvcmtmbG93DQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc0Nvbm5lY3RlZE91dHB1dHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIG5vZGVzIHdpdGggb3B0aW9uYWwgaW5wdXRzDQogICAgICAgICAgICBjb25zdCBvcHRpb25hbElucHV0cyA9IG5vZGVEZWYuaW5wdXRzLmZpbHRlcihpbnB1dCA9PiBpbnB1dC5vcHRpb25hbCk7DQogICAgICAgICAgICBpZiAob3B0aW9uYWxJbnB1dHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgbm9kZSBoYXMgY29ubmVjdGVkIG91dHB1dHMNCiAgICAgICAgICAgICAgICBjb25zdCBoYXNDb25uZWN0ZWRPdXRwdXRzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5zb21lKGNvbm4gPT4gDQogICAgICAgICAgICAgICAgICAgIGNvbm4uZnJvbS5ub2RlSWQgPT09IG5vZGUuaWQNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb2RlICR7bm9kZS50eXBlfSAoJHtub2RlLmlkfSk6IGhhcyBvcHRpb25hbCBpbnB1dHMsIGhhc0Nvbm5lY3RlZE91dHB1dHM9JHtoYXNDb25uZWN0ZWRPdXRwdXRzfWApOw0KICAgICAgICAgICAgICAgIHJldHVybiBoYXNDb25uZWN0ZWRPdXRwdXRzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBOb2RlcyB3aXRoIHJlcXVpcmVkIGlucHV0cyBhcmUgbm90IHN0YXJ0IG5vZGVzIC0gdGhleSBzaG91bGQgYmUgdHJpZ2dlcmVkIGJ5IG90aGVyIG5vZGVzDQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUudHlwZX0gKCR7bm9kZS5pZH0pOiBoYXMgcmVxdWlyZWQgaW5wdXRzLCBub3QgYSBzdGFydCBub2RlYCk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgaWYgKHN0YXJ0Tm9kZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHN0YXJ0IG5vZGVzIGZvdW5kLiBBZGQgbm9kZXMgd2l0aCBubyBpbnB1dHMgKFRpbWVyKSBvciBub2RlcyB3aXRoIG9wdGlvbmFsIGlucHV0cyB0aGF0IGFyZW5cJ3QgY29ubmVjdGVkIChIVFRQIFJlcXVlc3QpJyk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEV4ZWN1dGUgd29ya2Zsb3cNCiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGV4ZWN1dGVXb3JrZmxvdyhzdGFydE5vZGVzKTsNCiAgICAgICAgDQogICAgICAgIC8vIERpc3BsYXkgcmVzdWx0cw0KICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPSJsb2ctZW50cnkgc3VjY2VzcyI+V29ya2Zsb3cgY29tcGxldGVkIHN1Y2Nlc3NmdWxseSE8L2Rpdj4nOw0KICAgICAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiByZXN1bHRzKSB7DQogICAgICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJsb2ctZW50cnkgaW5mbyI+JHtyZXN1bHQubm9kZUlkfTogJHtyZXN1bHQub3V0cHV0fTwvZGl2PmA7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFNlbmQgY29tcGxldGlvbiB2aWEgV2ViU29ja2V0DQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNlbmRNZXNzYWdlKSB7DQogICAgICAgICAgICBzeXBuZXhBUEkuc2VuZE1lc3NhZ2UoJ3dvcmtmbG93X2NvbXBsZXRlZCcsIHsNCiAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLA0KICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQ0KICAgICAgICAgICAgfSwgJ2Zsb3ctZWRpdG9yJyk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignV29ya2Zsb3cgZXhlY3V0aW9uIGVycm9yOicsIGVycm9yKTsNCiAgICAgICAgb3V0cHV0LmlubmVySFRNTCArPSBgPGRpdiBjbGFzcz0ibG9nLWVudHJ5IGVycm9yIj5FcnJvcjogJHtlcnJvci5tZXNzYWdlfTwvZGl2PmA7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgICAgZmxvd0VkaXRvci5pc1J1bm5pbmcgPSBmYWxzZTsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3J1bi13b3JrZmxvdycpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWZsZXgnOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcC13b3JrZmxvdycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgfQ0KfQ0KDQovLyBFeGVjdXRlIHdvcmtmbG93DQphc3luYyBmdW5jdGlvbiBleGVjdXRlV29ya2Zsb3coc3RhcnROb2Rlcykgew0KICAgIGNvbnN0IHJlc3VsdHMgPSBbXTsNCiAgICBjb25zdCBleGVjdXRlZCA9IG5ldyBTZXQoKTsNCiAgICANCiAgICBmb3IgKGNvbnN0IHN0YXJ0Tm9kZSBvZiBzdGFydE5vZGVzKSB7DQogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4ZWN1dGVOb2RlKHN0YXJ0Tm9kZSwge30sIGV4ZWN1dGVkKTsNCiAgICAgICAgaWYgKHJlc3VsdCkgcmVzdWx0cy5wdXNoKHJlc3VsdCk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiByZXN1bHRzOw0KfQ0KDQovLyBFeGVjdXRlIGEgc2luZ2xlIG5vZGUgKGR5bmFtaWMgdmVyc2lvbikNCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVOb2RlKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBpZiAoZXhlY3V0ZWQuaGFzKG5vZGUuaWQpKSB7DQogICAgICAgIGNvbnNvbGUubG9nKGBOb2RlICR7bm9kZS5pZH0gYWxyZWFkeSBleGVjdXRlZCwgc2tpcHBpbmcgdG8gcHJldmVudCBjeWNsZXNgKTsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGV4ZWN1dGVkLmFkZChub2RlLmlkKTsNCiAgICANCiAgICAvLyBNYXJrIG5vZGUgYXMgcnVubmluZw0KICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZS5pZCk7DQogICAgaWYgKG5vZGVFbGVtZW50KSBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdydW5uaW5nJyk7DQogICAgDQogICAgdHJ5IHsNCiAgICAgICAgLy8gVXNlIHRoZSBkeW5hbWljIGV4ZWN1dGlvbiBlbmdpbmUNCiAgICAgICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgZXhlY3V0aW9uRW5naW5lLmV4ZWN1dGVOb2RlKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpOw0KICAgICAgICANCiAgICAgICAgLy8gQ2hlY2sgaWYgb3V0cHV0IGluZGljYXRlcyBleGVjdXRpb24gc2hvdWxkIHN0b3AgKGxvZ2ljYWwgZ2F0ZSBzcGVjaWZpYykNCiAgICAgICAgaWYgKG91dHB1dCAmJiB0eXBlb2Ygb3V0cHV0ID09PSAnb2JqZWN0JyAmJiBvdXRwdXQuX19zdG9wX2V4ZWN1dGlvbiA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLmlkfSByZXR1cm5lZCBzdG9wIGV4ZWN1dGlvbiBzaWduYWwsIHN0b3BwaW5nIHdvcmtmbG93YCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIE1hcmsgbm9kZSBhcyBjb21wbGV0ZWQNCiAgICAgICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHsgbm9kZUlkOiBub2RlLmlkLCBvdXRwdXQ6IG51bGwgfTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRmluZCBjb25uZWN0ZWQgbm9kZXMgYW5kIGV4ZWN1dGUgdGhlbQ0KICAgICAgICBjb25zdCBjb25uZWN0ZWROb2RlcyA9IGZpbmRDb25uZWN0ZWROb2Rlcyhub2RlLmlkKTsNCiAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLmlkfSBoYXMgJHtjb25uZWN0ZWROb2Rlcy5sZW5ndGh9IGNvbm5lY3RlZCBub2Rlc2ApOw0KICAgICAgICANCiAgICAgICAgZm9yIChjb25zdCBjb25uZWN0ZWROb2RlIG9mIGNvbm5lY3RlZE5vZGVzKSB7DQogICAgICAgICAgICAvLyBDaGVjayBmb3IgY3ljbGVzIGJlZm9yZSBleGVjdXRpbmcNCiAgICAgICAgICAgIGlmIChleGVjdXRlZC5oYXMoY29ubmVjdGVkTm9kZS5ub2RlLmlkKSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTa2lwcGluZyBjb25uZWN0ZWQgbm9kZSAke2Nvbm5lY3RlZE5vZGUubm9kZS5pZH0gdG8gcHJldmVudCBjeWNsZWApOw0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zb2xlLmxvZyhgPT09IFByb2Nlc3NpbmcgY29ubmVjdGlvbiAke25vZGUuaWR9IC0+ICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfSA9PT1gKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBDb25uZWN0aW9uIGRldGFpbHM6ICR7Y29ubmVjdGVkTm9kZS5vdXRwdXRQb3J0fSAtPiAke2Nvbm5lY3RlZE5vZGUuaW5wdXRQb3J0fWApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBIYW5kbGUgb3V0cHV0IG1hcHBpbmcgdG8gaW5wdXQgcG9ydHMgLSBESVJFQ1QgTUFQUElORw0KICAgICAgICAgICAgbGV0IGlucHV0VmFsdWUgPSBvdXRwdXQ7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IG91dHB1dDpgLCBvdXRwdXQpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLmlkfSBvdXRwdXQgdHlwZTpgLCB0eXBlb2Ygb3V0cHV0KTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTb3VyY2Ugb3V0cHV0IHBvcnQ6YCwgY29ubmVjdGVkTm9kZS5vdXRwdXRQb3J0KTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBUYXJnZXQgaW5wdXQgcG9ydDpgLCBjb25uZWN0ZWROb2RlLmlucHV0UG9ydCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChvdXRwdXQgaW5zdGFuY2VvZiBCbG9iKSB7DQogICAgICAgICAgICAgICAgLy8gQmxvYiBvdXRwdXQgLSBwYXNzIGRpcmVjdGx5IHRvIHRoZSBpbnB1dCBwb3J0DQogICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IG91dHB1dDsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IC0+ICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTogUGFzc2luZyBCbG9iIGRpcmVjdGx5ID1gLCBpbnB1dFZhbHVlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG91dHB1dCA9PT0gJ29iamVjdCcgJiYgb3V0cHV0ICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgLy8gT2JqZWN0IG91dHB1dCAtIGV4dHJhY3QgdGhlIEVYQUNUIG91dHB1dCBwb3J0IGZpZWxkDQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLmlkfSBvdXRwdXQgb2JqZWN0IGtleXM6YCwgT2JqZWN0LmtleXMob3V0cHV0KSk7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLmlkfSBvdXRwdXQgb2JqZWN0IHZhbHVlczpgLCBPYmplY3QudmFsdWVzKG91dHB1dCkpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChjb25uZWN0ZWROb2RlLm91dHB1dFBvcnQgaW4gb3V0cHV0KSB7DQogICAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUgPSBvdXRwdXRbY29ubmVjdGVkTm9kZS5vdXRwdXRQb3J0XTsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLmlkfSAtPiAke2Nvbm5lY3RlZE5vZGUubm9kZS5pZH06IERJUkVDVCBNQVBQSU5HICR7Y29ubmVjdGVkTm9kZS5vdXRwdXRQb3J0fSAtPiAke2Nvbm5lY3RlZE5vZGUuaW5wdXRQb3J0fSA9YCwgaW5wdXRWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbnB1dCB2YWx1ZSB0eXBlOmAsIHR5cGVvZiBpbnB1dFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYElucHV0IHZhbHVlIGlzIG51bGw6YCwgaW5wdXRWYWx1ZSA9PT0gbnVsbCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbnB1dCB2YWx1ZSBpcyB1bmRlZmluZWQ6YCwgaW5wdXRWYWx1ZSA9PT0gdW5kZWZpbmVkKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBOb2RlICR7bm9kZS5pZH0gLT4gJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9OiBFUlJPUiAtIE91dHB1dCBwb3J0ICcke2Nvbm5lY3RlZE5vZGUub3V0cHV0UG9ydH0nIG5vdCBmb3VuZCBpbiBvdXRwdXQhYCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEF2YWlsYWJsZSBmaWVsZHM6YCwgT2JqZWN0LmtleXMob3V0cHV0KSk7DQogICAgICAgICAgICAgICAgICAgIC8vIFNraXAgdGhpcyBjb25uZWN0aW9uIGluc3RlYWQgb2YgcGFzc2luZyBudWxsDQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTa2lwcGluZyBjb25uZWN0aW9uICR7bm9kZS5pZH0gLT4gJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9IGR1ZSB0byBtaXNzaW5nIG91dHB1dCBwb3J0YCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gU2ltcGxlIHZhbHVlIG91dHB1dCAtIHBhc3MgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IC0+ICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTogUGFzc2luZyBzaW1wbGUgdmFsdWUgPWAsIGlucHV0VmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zb2xlLmxvZyhgRmluYWwgaW5wdXQgdmFsdWUgZm9yICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTpgLCBpbnB1dFZhbHVlKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbnB1dCB2YWx1ZSB0eXBlOmAsIHR5cGVvZiBpbnB1dFZhbHVlKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbnB1dCB2YWx1ZSBpbnN0YW5jZW9mIEJsb2I6YCwgaW5wdXRWYWx1ZSBpbnN0YW5jZW9mIEJsb2IpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVOb2RlKGNvbm5lY3RlZE5vZGUubm9kZSwgeyBbY29ubmVjdGVkTm9kZS5pbnB1dFBvcnRdOiBpbnB1dFZhbHVlIH0sIGV4ZWN1dGVkKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZXhlY3V0aW5nIGNvbm5lY3RlZCBub2RlICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTpgLCBlcnJvcik7DQogICAgICAgICAgICAgICAgY29uc3Qgb3V0cHV0UGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhlY3V0aW9uLW91dHB1dCcpOw0KICAgICAgICAgICAgICAgIG91dHB1dFBhbmVsLmlubmVySFRNTCArPSBgPGRpdiBjbGFzcz0ibG9nLWVudHJ5IGVycm9yIj5FcnJvciBpbiBjb25uZWN0ZWQgbm9kZSAke2Nvbm5lY3RlZE5vZGUubm9kZS5pZH06ICR7ZXJyb3IubWVzc2FnZX08L2Rpdj5gOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBNYXJrIG5vZGUgYXMgY29tcGxldGVkDQogICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgncnVubmluZycpOw0KICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY29tcGxldGVkJyk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHJldHVybiB7IG5vZGVJZDogbm9kZS5pZCwgb3V0cHV0OiBvdXRwdXQgfTsNCiAgICAgICAgDQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZXhlY3V0aW5nIG5vZGUgJHtub2RlLmlkfTpgLCBlcnJvcik7DQogICAgICAgIA0KICAgICAgICAvLyBNYXJrIG5vZGUgYXMgZXJyb3INCiAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJyk7DQogICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdlcnJvcicpOw0KICAgIH0NCiAgICANCiAgICAgICAgdGhyb3cgZXJyb3I7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgICAgLy8gUmVtb3ZlIHJ1bm5pbmcgc3RhdGUNCiAgICAgICAgaWYgKG5vZGVFbGVtZW50KSBub2RlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJyk7DQogICAgfQ0KICAgIH0NCiAgICANCi8vIEhlbHBlciBmdW5jdGlvbiB0byB1cGRhdGUgZGlzcGxheSBub2RlIGNvbnRlbnQgKHVzZWQgYnkgZXhlY3V0aW9uIGVuZ2luZSkNCmZ1bmN0aW9uIHVwZGF0ZURpc3BsYXlOb2RlQ29udGVudChub2RlSWQsIGNvbnRlbnQsIGZvcm1hdCkgew0KICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGVFbGVtZW50KSByZXR1cm47DQogICAgDQogICAgY29uc3QgZGlzcGxheVRleHQgPSBub2RlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZGlzcGxheS10ZXh0Jyk7DQogICAgY29uc3QgZm9ybWF0RWxlbWVudCA9IG5vZGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kaXNwbGF5LWZvcm1hdCBzcGFuJyk7DQogICAgDQogICAgaWYgKGRpc3BsYXlUZXh0KSB7DQogICAgICAgIGxldCBmb3JtYXR0ZWRDb250ZW50ID0gY29udGVudDsNCiAgICAgICAgDQogICAgc3dpdGNoIChmb3JtYXQpIHsNCiAgICAgICAgY2FzZSAnanNvbic6DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSB0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGNvbnRlbnQpIDogY29udGVudDsNCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KHBhcnNlZCwgbnVsbCwgMik7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2h0bWwnOg0KICAgICAgICAgICAgICAgIGZvcm1hdHRlZENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ3RleHQnOg0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIGZvcm1hdHRlZENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIA0KICAgICAgICBkaXNwbGF5VGV4dC5pbm5lckhUTUwgPSBgPHByZSBjbGFzcz0iY29udGVudC10ZXh0Ij4ke2VzY2FwZUh0bWwoZm9ybWF0dGVkQ29udGVudCl9PC9wcmU+YDsNCiAgICB9DQogICAgDQogICAgaWYgKGZvcm1hdEVsZW1lbnQpIHsNCiAgICAgICAgZm9ybWF0RWxlbWVudC50ZXh0Q29udGVudCA9IGZvcm1hdDsNCiAgICB9DQogICAgDQogICAgLy8gU3RvcmUgZm9yIGNvbmZpZyBwYW5lbCBkaXNwbGF5DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKG5vZGUpIHsNCiAgICAgICAgbm9kZS5sYXN0Q29udGVudCA9IGNvbnRlbnQ7DQogICAgICAgIG5vZGUubGFzdEZvcm1hdCA9IGZvcm1hdDsNCiAgICB9DQp9DQoNCi8vIEhlbHBlciBmdW5jdGlvbiB0byBlc2NhcGUgSFRNTA0KZnVuY3Rpb24gZXNjYXBlSHRtbCh0ZXh0KSB7DQogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgZGl2LnRleHRDb250ZW50ID0gdGV4dDsNCiAgICByZXR1cm4gZGl2LmlubmVySFRNTDsNCn0NCg0KLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHJlcGxhY2UgdGVtcGxhdGUgcGxhY2Vob2xkZXJzDQpmdW5jdGlvbiByZXBsYWNlVGVtcGxhdGVQbGFjZWhvbGRlcnModGVtcGxhdGUsIGRhdGEpIHsNCiAgICBpZiAodHlwZW9mIHRlbXBsYXRlICE9PSAnb2JqZWN0JyB8fCB0ZW1wbGF0ZSA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdGVtcGxhdGU7DQogICAgfQ0KICAgIA0KICAgIGlmIChBcnJheS5pc0FycmF5KHRlbXBsYXRlKSkgew0KICAgICAgICByZXR1cm4gdGVtcGxhdGUubWFwKGl0ZW0gPT4gcmVwbGFjZVRlbXBsYXRlUGxhY2Vob2xkZXJzKGl0ZW0sIGRhdGEpKTsNCiAgICB9DQogICAgDQogICAgY29uc3QgcmVzdWx0ID0ge307DQogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXModGVtcGxhdGUpKSB7DQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICBsZXQgcmVwbGFjZWRWYWx1ZSA9IHZhbHVlOw0KICAgIA0KICAgICAgICAgICAgLy8gUmVwbGFjZSB7e1ZBTFVFfX0gd2l0aCB0aGUgZnVsbCBkYXRhIG9iamVjdA0KICAgICAgICAgICAgaWYgKHZhbHVlLmluY2x1ZGVzKCd7e1ZBTFVFfX0nKSkgew0KICAgICAgICAgICAgICAgIHJlcGxhY2VkVmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCd7e1ZBTFVFfX0nLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7DQp9DQoNCiAgICAgICAgICAgIC8vIFJlcGxhY2Uge3tKU09OOmZpZWxkfX0gd2l0aCBzcGVjaWZpYyBmaWVsZA0KICAgICAgICAgICAgY29uc3QganNvbk1hdGNoZXMgPSB2YWx1ZS5tYXRjaCgvXHtce0pTT046KFtefV0rKVx9XH0vZyk7DQogICAgICAgICAgICBpZiAoanNvbk1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIGpzb25NYXRjaGVzKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gbWF0Y2gubWF0Y2goL1x7XHtKU09OOihbXn1dKylcfVx9LylbMV07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSBnZXROZXN0ZWRWYWx1ZShkYXRhLCBmaWVsZCk7DQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VkVmFsdWUgPSByZXBsYWNlZFZhbHVlLnJlcGxhY2UobWF0Y2gsIEpTT04uc3RyaW5naWZ5KGZpZWxkVmFsdWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgICAgICAgICAgLy8gUmVwbGFjZSB7e2ZpZWxkfX0gd2l0aCBzcGVjaWZpYyBmaWVsZCB2YWx1ZQ0KICAgICAgICAgICAgY29uc3QgZmllbGRNYXRjaGVzID0gdmFsdWUubWF0Y2goL1x7XHsoW159XSspXH1cfS9nKTsNCiAgICAgICAgICAgIGlmIChmaWVsZE1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIGZpZWxkTWF0Y2hlcykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IG1hdGNoLm1hdGNoKC9ce1x7KFtefV0rKVx9XH0vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkICE9PSAnVkFMVUUnICYmICFmaWVsZC5zdGFydHNXaXRoKCdKU09OOicpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZFZhbHVlID0gZ2V0TmVzdGVkVmFsdWUoZGF0YSwgZmllbGQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZWRWYWx1ZSA9IHJlcGxhY2VkVmFsdWUucmVwbGFjZShtYXRjaCwgZmllbGRWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gcmVwbGFjZWRWYWx1ZTsNCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7DQogICAgICAgICAgICByZXN1bHRba2V5XSA9IHJlcGxhY2VUZW1wbGF0ZVBsYWNlaG9sZGVycyh2YWx1ZSwgZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIHJldHVybiByZXN1bHQ7DQp9DQoNCi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgbmVzdGVkIG9iamVjdCB2YWx1ZXMNCmZ1bmN0aW9uIGdldE5lc3RlZFZhbHVlKG9iaiwgcGF0aCkgew0KICAgIGNvbnN0IGtleXMgPSBwYXRoLnNwbGl0KCcuJyk7DQogICAgbGV0IGN1cnJlbnQgPSBvYmo7DQogICAgDQogICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykgew0KICAgICAgICBpZiAoY3VycmVudCA9PT0gbnVsbCB8fCBjdXJyZW50ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBIYW5kbGUgYXJyYXkgYWNjZXNzIGxpa2UgIml0ZW1zWzBdLm5hbWUiDQogICAgICAgIGNvbnN0IGFycmF5TWF0Y2ggPSBrZXkubWF0Y2goL14oLispXFsoXGQrKVxdJC8pOw0KICAgICAgICBpZiAoYXJyYXlNYXRjaCkgew0KICAgICAgICAgICAgY29uc3QgYXJyYXlLZXkgPSBhcnJheU1hdGNoWzFdOw0KICAgICAgICAgICAgY29uc3QgYXJyYXlJbmRleCA9IHBhcnNlSW50KGFycmF5TWF0Y2hbMl0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoY3VycmVudFthcnJheUtleV0gJiYgQXJyYXkuaXNBcnJheShjdXJyZW50W2FycmF5S2V5XSkpIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudFthcnJheUtleV1bYXJyYXlJbmRleF07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudFtrZXldOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBjdXJyZW50Ow0KfQ0KDQovLyBTdG9wIHdvcmtmbG93IGV4ZWN1dGlvbg0KZnVuY3Rpb24gc3RvcFdvcmtmbG93KCkgew0KICAgICAgICBmbG93RWRpdG9yLmlzUnVubmluZyA9IGZhbHNlOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtZmxleCc7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgDQogICAgLy8gQ2xlYXIgcnVubmluZyBzdGF0ZXMgZnJvbSBhbGwgbm9kZXMNCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZsb3ctbm9kZS5ydW5uaW5nJykuZm9yRWFjaChub2RlID0+IHsNCiAgICAgICAgICAgIG5vZGUuY2xhc3NMaXN0LnJlbW92ZSgncnVubmluZycpOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgY29uc3Qgb3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4ZWN1dGlvbi1vdXRwdXQnKTsNCiAgICBvdXRwdXQuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPSJsb2ctZW50cnkgd2FybmluZyI+V29ya2Zsb3cgZXhlY3V0aW9uIHN0b3BwZWQgYnkgdXNlcjwvZGl2Pic7DQogICAgDQogICAgY29uc29sZS5sb2coJ1dvcmtmbG93IGV4ZWN1dGlvbiBzdG9wcGVkJyk7DQp9DQoNCi8vIEZpbmQgbm9kZXMgY29ubmVjdGVkIHRvIGEgc3BlY2lmaWMgbm9kZQ0KZnVuY3Rpb24gZmluZENvbm5lY3RlZE5vZGVzKG5vZGVJZCkgew0KICAgIGNvbnN0IGNvbm5lY3RlZE5vZGVzID0gW107DQogICAgDQogICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpIHsNCiAgICAgICAgaWYgKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgPT09IG5vZGVJZCkgew0KICAgICAgICAgICAgY29uc3QgdGFyZ2V0Tm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KGNvbm5lY3Rpb24udG8ubm9kZUlkKTsNCiAgICAgICAgICAgIGlmICh0YXJnZXROb2RlKSB7DQogICAgICAgICAgICAgICAgY29ubmVjdGVkTm9kZXMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIG5vZGU6IHRhcmdldE5vZGUsDQogICAgICAgICAgICAgICAgICAgIGlucHV0UG9ydDogY29ubmVjdGlvbi50by5wb3J0TmFtZSwNCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0UG9ydDogY29ubmVjdGlvbi5mcm9tLnBvcnROYW1lDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIGNvbm5lY3RlZE5vZGVzOw0KfSANCg0KLy8gVXBkYXRlIGNhbnZhcyB0cmFuc2Zvcm0gZm9yIHBhbm5pbmcgYW5kIHpvb21pbmcNCmZ1bmN0aW9uIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpIHsNCiAgICBpZiAoZmxvd0VkaXRvci5jYW52YXMpIHsNCiAgICAgICAgY29uc3QgdHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke2Zsb3dFZGl0b3IucGFuT2Zmc2V0Lnh9cHgsICR7Zmxvd0VkaXRvci5wYW5PZmZzZXQueX1weCkgc2NhbGUoJHtmbG93RWRpdG9yLnpvb21MZXZlbH0pYDsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNmb3JtID0gdHJhbnNmb3JtOw0KICAgICAgICANCiAgICAgICAgLy8gVXBkYXRlIHpvb20gbGV2ZWwgZGlzcGxheQ0KICAgICAgICBjb25zdCB6b29tRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6b29tLWxldmVsJyk7DQogICAgICAgIGlmICh6b29tRGlzcGxheSkgew0KICAgICAgICAgICAgem9vbURpc3BsYXkudGV4dENvbnRlbnQgPSBNYXRoLnJvdW5kKGZsb3dFZGl0b3Iuem9vbUxldmVsICogMTAwKSArICclJzsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gU3RhcnQgY2FudmFzIHBhbm5pbmcNCmZ1bmN0aW9uIHN0YXJ0Q2FudmFzUGFuKGUpIHsNCiAgICAvLyBPbmx5IHN0YXJ0IHBhbm5pbmcgaWYgY2xpY2tpbmcgZGlyZWN0bHkgb24gY2FudmFzIChub3Qgb24gbm9kZXMgb3Igb3RoZXIgZWxlbWVudHMpDQogICAgLy8gYW5kIG5vdCBhbHJlYWR5IGRyYWdnaW5nIGEgbm9kZQ0KICAgIGlmIChlLnRhcmdldCA9PT0gZmxvd0VkaXRvci5jYW52YXMgJiYgIWZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlKSB7DQogICAgICAgIGZsb3dFZGl0b3IuaXNQYW5uaW5nID0gdHJ1ZTsNCiAgICAgICAgY29uc3QgbW91c2VDb29yZHMgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8NCiAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOg0KICAgICAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgICAgICBmbG93RWRpdG9yLnBhblN0YXJ0ID0geyB4OiBtb3VzZUNvb3Jkcy54LCB5OiBtb3VzZUNvb3Jkcy55IH07DQogICAgICAgIGZsb3dFZGl0b3IubGFzdFBhbk9mZnNldCA9IHsgLi4uZmxvd0VkaXRvci5wYW5PZmZzZXQgfTsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUuY3Vyc29yID0gJ2dyYWJiaW5nJzsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuY2xhc3NMaXN0LmFkZCgncGFubmluZycpOw0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgfQ0KfQ0KDQovLyBVcGRhdGUgY2FudmFzIHBhbm5pbmcNCmZ1bmN0aW9uIHVwZGF0ZUNhbnZhc1BhbihlKSB7DQogICAgaWYgKGZsb3dFZGl0b3IuaXNQYW5uaW5nKSB7DQogICAgICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/DQogICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDoNCiAgICAgICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICAgICAgY29uc3QgZGVsdGFYID0gbW91c2VDb29yZHMueCAtIGZsb3dFZGl0b3IucGFuU3RhcnQueDsNCiAgICAgICAgY29uc3QgZGVsdGFZID0gbW91c2VDb29yZHMueSAtIGZsb3dFZGl0b3IucGFuU3RhcnQueTsNCg0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gZmxvd0VkaXRvci5sYXN0UGFuT2Zmc2V0LnggKyBkZWx0YVg7DQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkgPSBmbG93RWRpdG9yLmxhc3RQYW5PZmZzZXQueSArIGRlbHRhWTsNCg0KICAgICAgICB1cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIH0NCn0NCg0KLy8gU3RvcCBjYW52YXMgcGFubmluZw0KZnVuY3Rpb24gc3RvcENhbnZhc1BhbigpIHsNCiAgICBpZiAoZmxvd0VkaXRvci5pc1Bhbm5pbmcpIHsNCiAgICAgICAgZmxvd0VkaXRvci5pc1Bhbm5pbmcgPSBmYWxzZTsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUuY3Vyc29yID0gJ2dyYWInOw0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5jbGFzc0xpc3QucmVtb3ZlKCdwYW5uaW5nJyk7DQogICAgfQ0KfQ0KDQovLyBSZXNldCBjYW52YXMgcGFuIHRvIGNlbnRlcg0KZnVuY3Rpb24gcmVzZXRDYW52YXNQYW4oKSB7DQogICAgLy8gQWRkIHNtb290aCB0cmFuc2l0aW9uIGZvciByZXNldA0KICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLnRyYW5zaXRpb24gPSAndHJhbnNmb3JtIDAuM3MgZWFzZS1vdXQnOw0KDQogICAgLy8gQ2FsY3VsYXRlIGNlbnRlciBvZiBhbGwgbm9kZXMgaWYgYW55IGV4aXN0DQogICAgaWYgKGZsb3dFZGl0b3Iubm9kZXMuc2l6ZSA+IDApIHsNCiAgICAgICAgY29uc3Qgbm9kZXMgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3Iubm9kZXMudmFsdWVzKCkpOw0KICAgICAgICBjb25zdCBtaW5YID0gTWF0aC5taW4oLi4ubm9kZXMubWFwKG4gPT4gbi54KSk7DQogICAgICAgIGNvbnN0IG1heFggPSBNYXRoLm1heCguLi5ub2Rlcy5tYXAobiA9PiBuLngpKTsNCiAgICAgICAgY29uc3QgbWluWSA9IE1hdGgubWluKC4uLm5vZGVzLm1hcChuID0+IG4ueSkpOw0KICAgICAgICBjb25zdCBtYXhZID0gTWF0aC5tYXgoLi4ubm9kZXMubWFwKG4gPT4gbi55KSk7DQoNCiAgICAgICAgY29uc3QgY2VudGVyWCA9IChtaW5YICsgbWF4WCkgLyAyOw0KICAgICAgICBjb25zdCBjZW50ZXJZID0gKG1pblkgKyBtYXhZKSAvIDI7DQoNCiAgICAgICAgLy8gR2V0IGNhbnZhcyBjb250YWluZXIgZGltZW5zaW9ucyAoc2NhbGVkKQ0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/DQogICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChjb250YWluZXIpIDoNCiAgICAgICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCg0KICAgICAgICAvLyBDYWxjdWxhdGUgcGFuIG9mZnNldCB0byBjZW50ZXIgdGhlIG5vZGVzIGluIHRoZSB2aWV3cG9ydA0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gLWNlbnRlclggKyBjb250YWluZXJSZWN0LndpZHRoIC8gMjsNCiAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IC1jZW50ZXJZICsgY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIElmIG5vIG5vZGVzLCByZXNldCB0byBjZW50ZXIgb2YgdGhlIGxhcmdlIGNhbnZhcw0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldCA9IHsgeDogLTUwMDAsIHk6IC01MDAwIH07DQogICAgfQ0KDQogICAgLy8gUmVzZXQgem9vbSB0byAxMDAlDQogICAgZmxvd0VkaXRvci56b29tTGV2ZWwgPSAxLjA7DQoNCiAgICB1cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCg0KICAgIC8vIFJlbW92ZSB0cmFuc2l0aW9uIGFmdGVyIGFuaW1hdGlvbiBjb21wbGV0ZXMNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNpdGlvbiA9ICcnOw0KICAgIH0sIDMwMCk7DQp9DQoNCi8vIFpvb20gZnVuY3Rpb25zDQpmdW5jdGlvbiB6b29tSW4oKSB7DQogICAgY29uc3QgbmV3Wm9vbSA9IE1hdGgubWluKGZsb3dFZGl0b3Iuem9vbUxldmVsICsgZmxvd0VkaXRvci56b29tU3RlcCwgZmxvd0VkaXRvci5tYXhab29tKTsNCiAgICBzZXRab29tTGV2ZWwobmV3Wm9vbSk7DQp9DQoNCmZ1bmN0aW9uIHpvb21PdXQoKSB7DQogICAgY29uc3QgbmV3Wm9vbSA9IE1hdGgubWF4KGZsb3dFZGl0b3Iuem9vbUxldmVsIC0gZmxvd0VkaXRvci56b29tU3RlcCwgZmxvd0VkaXRvci5taW5ab29tKTsNCiAgICBzZXRab29tTGV2ZWwobmV3Wm9vbSk7DQp9DQoNCmZ1bmN0aW9uIHNldFpvb21MZXZlbCh6b29tTGV2ZWwpIHsNCiAgICAvLyBHZXQgdGhlIGNlbnRlciBvZiB0aGUgY2FudmFzIGNvbnRhaW5lciBmb3Igem9vbSBvcmlnaW4NCiAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8NCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QoY29udGFpbmVyKSA6DQogICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICANCiAgICBjb25zdCBjZW50ZXJYID0gY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgY29uc3QgY2VudGVyWSA9IGNvbnRhaW5lclJlY3QuaGVpZ2h0IC8gMjsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgdGhlIHBvaW50IGluIGNhbnZhcyBjb29yZGluYXRlcyB0aGF0IHNob3VsZCByZW1haW4gZml4ZWQNCiAgICBjb25zdCBjYW52YXNYID0gKGNlbnRlclggLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIGNvbnN0IGNhbnZhc1kgPSAoY2VudGVyWSAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgDQogICAgLy8gVXBkYXRlIHpvb20gbGV2ZWwNCiAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IE1hdGgubWF4KGZsb3dFZGl0b3IubWluWm9vbSwgTWF0aC5taW4oZmxvd0VkaXRvci5tYXhab29tLCB6b29tTGV2ZWwpKTsNCiAgICANCiAgICAvLyBBZGp1c3QgcGFuIG9mZnNldCB0byBrZWVwIHRoZSBjZW50ZXIgcG9pbnQgZml4ZWQNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gY2VudGVyWCAtIGNhbnZhc1ggKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gY2VudGVyWSAtIGNhbnZhc1kgKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICANCiAgICB1cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICANCiAgICAvLyBSZWRyYXcgY29ubmVjdGlvbnMgYWZ0ZXIgem9vbQ0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICByZWRyYXdBbGxDb25uZWN0aW9ucygpOw0KICAgIH0sIDE2KTsNCn0NCg0KZnVuY3Rpb24gem9vbVRvRml0KCkgew0KICAgIGlmIChmbG93RWRpdG9yLm5vZGVzLnNpemUgPT09IDApIHsNCiAgICAgICAgLy8gSWYgbm8gbm9kZXMsIHJlc2V0IHRvIDEwMCUgem9vbSBhbmQgY2VudGVyDQogICAgICAgIGZsb3dFZGl0b3Iuem9vbUxldmVsID0gMS4wOw0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldCA9IHsgeDogLTUwMDAsIHk6IC01MDAwIH07DQogICAgICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIEZpbmQgYm91bmRzIG9mIGFsbCBub2Rlcw0KICAgIGNvbnN0IG5vZGVzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKTsNCiAgICBjb25zdCBwYWRkaW5nID0gMTAwOyAvLyBFeHRyYSBwYWRkaW5nIGFyb3VuZCBub2Rlcw0KICAgIA0KICAgIGxldCBtaW5YID0gSW5maW5pdHksIG1heFggPSAtSW5maW5pdHk7DQogICAgbGV0IG1pblkgPSBJbmZpbml0eSwgbWF4WSA9IC1JbmZpbml0eTsNCiAgICANCiAgICBub2Rlcy5mb3JFYWNoKG5vZGUgPT4gew0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGUuaWQpOw0KICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgIGNvbnN0IHJlY3QgPSBub2RlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBub2RlLngpOw0KICAgICAgICAgICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIG5vZGUueCArIHJlY3Qud2lkdGgpOw0KICAgICAgICAgICAgbWluWSA9IE1hdGgubWluKG1pblksIG5vZGUueSk7DQogICAgICAgICAgICBtYXhZID0gTWF0aC5tYXgobWF4WSwgbm9kZS55ICsgcmVjdC5oZWlnaHQpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgLy8gQWRkIHBhZGRpbmcNCiAgICBtaW5YIC09IHBhZGRpbmc7DQogICAgbWF4WCArPSBwYWRkaW5nOw0KICAgIG1pblkgLT0gcGFkZGluZzsNCiAgICBtYXhZICs9IHBhZGRpbmc7DQogICAgDQogICAgY29uc3QgY29udGVudFdpZHRoID0gbWF4WCAtIG1pblg7DQogICAgY29uc3QgY29udGVudEhlaWdodCA9IG1heFkgLSBtaW5ZOw0KICAgIA0KICAgIC8vIEdldCBjb250YWluZXIgZGltZW5zaW9ucw0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPw0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChjb250YWluZXIpIDoNCiAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIA0KICAgIC8vIENhbGN1bGF0ZSB6b29tIHRvIGZpdA0KICAgIGNvbnN0IHpvb21YID0gY29udGFpbmVyUmVjdC53aWR0aCAvIGNvbnRlbnRXaWR0aDsNCiAgICBjb25zdCB6b29tWSA9IGNvbnRhaW5lclJlY3QuaGVpZ2h0IC8gY29udGVudEhlaWdodDsNCiAgICBjb25zdCBuZXdab29tID0gTWF0aC5taW4oem9vbVgsIHpvb21ZLCBmbG93RWRpdG9yLm1heFpvb20pOw0KICAgIA0KICAgIC8vIFNldCB6b29tIGxldmVsDQogICAgZmxvd0VkaXRvci56b29tTGV2ZWwgPSBNYXRoLm1heChmbG93RWRpdG9yLm1pblpvb20sIG5ld1pvb20pOw0KICAgIA0KICAgIC8vIENlbnRlciB0aGUgY29udGVudA0KICAgIGNvbnN0IGNlbnRlclggPSAobWluWCArIG1heFgpIC8gMjsNCiAgICBjb25zdCBjZW50ZXJZID0gKG1pblkgKyBtYXhZKSAvIDI7DQogICAgDQogICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueCA9IGNvbnRhaW5lclJlY3Qud2lkdGggLyAyIC0gY2VudGVyWCAqIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkgPSBjb250YWluZXJSZWN0LmhlaWdodCAvIDIgLSBjZW50ZXJZICogZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgDQogICAgLy8gQWRkIHNtb290aCB0cmFuc2l0aW9uDQogICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC4zcyBlYXNlLW91dCc7DQogICAgdXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgDQogICAgLy8gUmVtb3ZlIHRyYW5zaXRpb24gYWZ0ZXIgYW5pbWF0aW9uDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLnRyYW5zaXRpb24gPSAnJzsNCiAgICAgICAgcmVkcmF3QWxsQ29ubmVjdGlvbnMoKTsNCiAgICB9LCAzMDApOw0KfQ0KDQovLyBIYW5kbGUgbW91c2Ugd2hlZWwgem9vbQ0KZnVuY3Rpb24gaGFuZGxlTW91c2VXaGVlbChlKSB7DQogICAgaWYgKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICANCiAgICAgICAgLy8gR2V0IG1vdXNlIHBvc2l0aW9uIHJlbGF0aXZlIHRvIGNvbnRhaW5lcg0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/DQogICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChjb250YWluZXIpIDoNCiAgICAgICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/DQogICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDoNCiAgICAgICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICAgICAgDQogICAgICAgIGNvbnN0IG1vdXNlWCA9IG1vdXNlQ29vcmRzLnggLSBjb250YWluZXJSZWN0LmxlZnQ7DQogICAgICAgIGNvbnN0IG1vdXNlWSA9IG1vdXNlQ29vcmRzLnkgLSBjb250YWluZXJSZWN0LnRvcDsNCiAgICAgICAgDQogICAgICAgIC8vIENhbGN1bGF0ZSB6b29tIGRlbHRhDQogICAgICAgIGNvbnN0IHpvb21EZWx0YSA9IGUuZGVsdGFZID4gMCA/IC1mbG93RWRpdG9yLnpvb21TdGVwIDogZmxvd0VkaXRvci56b29tU3RlcDsNCiAgICAgICAgY29uc3QgbmV3Wm9vbSA9IE1hdGgubWF4KGZsb3dFZGl0b3IubWluWm9vbSwgTWF0aC5taW4oZmxvd0VkaXRvci5tYXhab29tLCBmbG93RWRpdG9yLnpvb21MZXZlbCArIHpvb21EZWx0YSkpOw0KICAgICAgICANCiAgICAgICAgaWYgKG5ld1pvb20gIT09IGZsb3dFZGl0b3Iuem9vbUxldmVsKSB7DQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHBvaW50IGluIGNhbnZhcyBjb29yZGluYXRlcyB0aGF0IHNob3VsZCByZW1haW4gZml4ZWQgKHVuZGVyIG1vdXNlKQ0KICAgICAgICAgICAgY29uc3QgY2FudmFzWCA9IChtb3VzZVggLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgY29uc3QgY2FudmFzWSA9IChtb3VzZVkgLSBmbG93RWRpdG9yLnBhbk9mZnNldC55KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBVcGRhdGUgem9vbSBsZXZlbA0KICAgICAgICAgICAgZmxvd0VkaXRvci56b29tTGV2ZWwgPSBuZXdab29tOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBBZGp1c3QgcGFuIG9mZnNldCB0byBrZWVwIHRoZSBtb3VzZSBwb2ludCBmaXhlZA0KICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueCA9IG1vdXNlWCAtIGNhbnZhc1ggKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkgPSBtb3VzZVkgLSBjYW52YXNZICogZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBSZWRyYXcgY29ubmVjdGlvbnMgYWZ0ZXIgem9vbQ0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGZsb3dFZGl0b3Iuem9vbVJlZHJhd1RpbWVvdXQpOw0KICAgICAgICAgICAgZmxvd0VkaXRvci56b29tUmVkcmF3VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgICAgICAgICB9LCA1MCk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIEhhbmRsZSBjYW52YXMgY2xpY2sgZXZlbnRzDQpmdW5jdGlvbiBoYW5kbGVDYW52YXNDbGljayhlKSB7DQogICAgaWYgKGUudGFyZ2V0ID09PSBmbG93RWRpdG9yLmNhbnZhcykgew0KICAgICAgICAvLyBEZXNlbGVjdCBub2RlDQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSkgew0KICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSk7DQogICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQpIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7DQogICAgICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG51bGw7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9kZS1jb25maWcnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPic7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIEhhbmRsZSBkb2N1bWVudCBtb3VzZSBldmVudHMgZm9yIHNtb290aCBkcmFnZ2luZw0KZnVuY3Rpb24gaGFuZGxlRG9jdW1lbnRNb3VzZURvd24oZSkgew0KICAgIC8vIERvbid0IHN0YXJ0IGRyYWdnaW5nIGlmIGNsaWNraW5nIG9uIFVJIGVsZW1lbnRzDQogICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJy5mbG93LXRvb2xiYXInKSB8fCANCiAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnLmZsb3ctY29uZmlnLXBhbmVsJykgfHwgDQogICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJy5mbG93LW91dHB1dC1wYW5lbCcpIHx8DQogICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJy5ub2RlLWRlbGV0ZS1idG4nKSkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIERvbid0IHN0YXJ0IGRyYWdnaW5nIGlmIHdlJ3JlIHBhbm5pbmcNCiAgICBpZiAoZmxvd0VkaXRvci5pc1Bhbm5pbmcpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBPbmx5IGFsbG93IGRyYWdnaW5nIGZyb20gdGhlIG5vZGUgaGVhZGVyDQogICAgY29uc3QgaGVhZGVyRWxlbWVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5mbG93LW5vZGUtaGVhZGVyJyk7DQogICAgaWYgKCFoZWFkZXJFbGVtZW50KSByZXR1cm47DQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBoZWFkZXJFbGVtZW50LmNsb3Nlc3QoJy5mbG93LW5vZGUnKTsNCiAgICBpZiAoIW5vZGVFbGVtZW50KSByZXR1cm47DQogICAgDQogICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgY29uc3Qgbm9kZUlkID0gbm9kZUVsZW1lbnQuaWQ7DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgDQogICAgaWYgKG5vZGUpIHsNCiAgICAgICAgZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUgPSBub2RlSWQ7DQogICAgICAgIA0KICAgICAgICAvLyBDYWxjdWxhdGUgb2Zmc2V0IGZyb20gbW91c2UgdG8gbm9kZSBjb3JuZXIsIGFjY291bnRpbmcgZm9yIHpvb20NCiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPyANCiAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOiANCiAgICAgICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRNb3VzZUNvb3JkcyhlKSA6IA0KICAgICAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgICAgICANCiAgICAgICAgLy8gQ29udmVydCBtb3VzZSBwb3NpdGlvbiB0byBjYW52YXMgY29vcmRpbmF0ZXMNCiAgICAgICAgY29uc3QgY2FudmFzTW91c2VYID0gKG1vdXNlQ29vcmRzLnggLSBjb250YWluZXJSZWN0LmxlZnQgLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICBjb25zdCBjYW52YXNNb3VzZVkgPSAobW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgDQogICAgICAgIC8vIENhbGN1bGF0ZSBvZmZzZXQgaW4gY2FudmFzIGNvb3JkaW5hdGVzDQogICAgICAgIGZsb3dFZGl0b3IuZHJhZ09mZnNldCA9IHsNCiAgICAgICAgICAgIHg6IChjYW52YXNNb3VzZVggLSBub2RlLngpICogZmxvd0VkaXRvci56b29tTGV2ZWwsDQogICAgICAgICAgICB5OiAoY2FudmFzTW91c2VZIC0gbm9kZS55KSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsDQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBub2RlRWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZ3JhYmJpbmcnOw0KICAgICAgICBub2RlRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMTAwMCc7IC8vIEJyaW5nIHRvIGZyb250IHdoaWxlIGRyYWdnaW5nDQogICAgICAgIA0KICAgICAgICAvLyBDYWNoZSBjb250YWluZXIgcmVjdCBmb3IgcGVyZm9ybWFuY2UNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXNSZWN0ID0gY29udGFpbmVyUmVjdDsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGhhbmRsZURvY3VtZW50TW91c2VNb3ZlKGUpIHsNCiAgICAvLyBIYW5kbGUgY2FudmFzIHBhbm5pbmcNCiAgICBpZiAoZmxvd0VkaXRvci5pc1Bhbm5pbmcpIHsNCiAgICAgICAgdXBkYXRlQ2FudmFzUGFuKGUpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIEdldCBzY2FsZWQgY29vcmRpbmF0ZXMNCiAgICBjb25zdCBtb3VzZUNvb3JkcyA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPyANCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRNb3VzZUNvb3JkcyhlKSA6IA0KICAgICAgICB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07DQogICAgDQogICAgLy8gSGFuZGxlIHRhZyBkcmFnZ2luZw0KICAgIGlmIChmbG93RWRpdG9yLmRyYWdnaW5nVGFnICYmIGZsb3dFZGl0b3IudGFnRHJhZ09mZnNldCkgew0KICAgICAgICBjb25zdCB0YWcgPSBmbG93RWRpdG9yLnRhZ3MuZ2V0KGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcpOw0KICAgICAgICBpZiAodGFnKSB7DQogICAgICAgICAgICAvLyBHZXQgY29udGFpbmVyIGRpbWVuc2lvbnMgZm9yIGNvb3JkaW5hdGUgY29udmVyc2lvbg0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgICAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QoY29udGFpbmVyKSA6IA0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQ29udmVydCBtb3VzZSBjb29yZGluYXRlcyB0byBjYW52YXMgY29vcmRpbmF0ZXMsIGFjY291bnRpbmcgZm9yIHBhbiBhbmQgem9vbQ0KICAgICAgICAgICAgY29uc3QgY2FudmFzTW91c2VYID0gKG1vdXNlQ29vcmRzLnggLSBjb250YWluZXJSZWN0LmxlZnQgLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgY29uc3QgY2FudmFzTW91c2VZID0gKG1vdXNlQ29vcmRzLnkgLSBjb250YWluZXJSZWN0LnRvcCAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBuZXcgcG9zaXRpb24gd2l0aCBvZmZzZXQgKGRyYWcgb2Zmc2V0IGlzIGFsc28gaW4gc2NyZWVuIGNvb3JkaW5hdGVzLCBzbyBjb252ZXJ0IGl0KQ0KICAgICAgICAgICAgY29uc3QgZHJhZ09mZnNldFggPSBmbG93RWRpdG9yLnRhZ0RyYWdPZmZzZXQueCAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgY29uc3QgZHJhZ09mZnNldFkgPSBmbG93RWRpdG9yLnRhZ0RyYWdPZmZzZXQueSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB0YWcueCA9IGNhbnZhc01vdXNlWCAtIGRyYWdPZmZzZXRYOw0KICAgICAgICAgICAgdGFnLnkgPSBjYW52YXNNb3VzZVkgLSBkcmFnT2Zmc2V0WTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgdGFnRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcpOw0KICAgICAgICAgICAgaWYgKHRhZ0VsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICAvLyBVc2UgbGVmdC90b3AgZm9yIHBvc2l0aW9uaW5nDQogICAgICAgICAgICAgICAgdGFnRWxlbWVudC5zdHlsZS5sZWZ0ID0gdGFnLnggKyAncHgnOw0KICAgICAgICAgICAgICAgIHRhZ0VsZW1lbnQuc3R5bGUudG9wID0gdGFnLnkgKyAncHgnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBUaHJvdHRsZSB1cGRhdGVzIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2UNCiAgICAgICAgICAgIGlmICghZmxvd0VkaXRvci50YWdVcGRhdGVUaW1lb3V0KSB7DQogICAgICAgICAgICAgICAgZmxvd0VkaXRvci50YWdVcGRhdGVUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IudGFnVXBkYXRlVGltZW91dCA9IG51bGw7DQogICAgICAgICAgICAgICAgfSwgMTYpOyAvLyB+NjBmcHMNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGlmIChmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSAmJiBmbG93RWRpdG9yLmRyYWdPZmZzZXQpIHsNCiAgICAgICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KGZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlKTsNCiAgICAgICAgaWYgKG5vZGUpIHsNCiAgICAgICAgICAgIC8vIEdldCBjb250YWluZXIgZGltZW5zaW9ucyBmb3IgY29vcmRpbmF0ZSBjb252ZXJzaW9uDQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPyANCiAgICAgICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChjb250YWluZXIpIDogDQogICAgICAgICAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDb252ZXJ0IG1vdXNlIGNvb3JkaW5hdGVzIHRvIGNhbnZhcyBjb29yZGluYXRlcywgYWNjb3VudGluZyBmb3IgcGFuIGFuZCB6b29tDQogICAgICAgICAgICBjb25zdCBjYW52YXNNb3VzZVggPSAobW91c2VDb29yZHMueCAtIGNvbnRhaW5lclJlY3QubGVmdCAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LngpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICBjb25zdCBjYW52YXNNb3VzZVkgPSAobW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyBwb3NpdGlvbiB3aXRoIG9mZnNldCAoZHJhZyBvZmZzZXQgaXMgYWxzbyBpbiBzY3JlZW4gY29vcmRpbmF0ZXMsIHNvIGNvbnZlcnQgaXQpDQogICAgICAgICAgICBjb25zdCBkcmFnT2Zmc2V0WCA9IGZsb3dFZGl0b3IuZHJhZ09mZnNldC54IC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICBjb25zdCBkcmFnT2Zmc2V0WSA9IGZsb3dFZGl0b3IuZHJhZ09mZnNldC55IC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIG5vZGUueCA9IGNhbnZhc01vdXNlWCAtIGRyYWdPZmZzZXRYOw0KICAgICAgICAgICAgbm9kZS55ID0gY2FudmFzTW91c2VZIC0gZHJhZ09mZnNldFk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUpOw0KICAgICAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuc3R5bGUubGVmdCA9IG5vZGUueCArICdweCc7DQogICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuc3R5bGUudG9wID0gbm9kZS55ICsgJ3B4JzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGNvbm5lY3Rpb25zIGZvciB0aGlzIG5vZGUgKHRocm90dGxlZCBmb3IgcGVyZm9ybWFuY2UpDQogICAgICAgICAgICAgICAgaWYgKCFmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQpIHsNCiAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci51cGRhdGVUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDb25uZWN0aW9uc0Zvck5vZGUobm9kZS5pZCk7DQogICAgICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9LCAxNik7IC8vIH42MGZwcw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gaGFuZGxlRG9jdW1lbnRNb3VzZVVwKGUpIHsNCiAgICAvLyBIYW5kbGUgY2FudmFzIHBhbm5pbmcgc3RvcA0KICAgIGlmIChmbG93RWRpdG9yLmlzUGFubmluZykgew0KICAgICAgICBzdG9wQ2FudmFzUGFuKCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gSGFuZGxlIHRhZyBkcmFnZ2luZyBzdG9wDQogICAgaWYgKGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcpIHsNCiAgICAgICAgY29uc3QgdGFnRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcpOw0KICAgICAgICBpZiAodGFnRWxlbWVudCkgew0KICAgICAgICAgICAgdGFnRWxlbWVudC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7DQogICAgICAgICAgICB0YWdFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxMDAnOw0KICAgICAgICAgICAgdGFnRWxlbWVudC5zdHlsZS50cmFuc2l0aW9uID0gJ2JveC1zaGFkb3cgMC4ycyBlYXNlLCB0cmFuc2Zvcm0gMC4ycyBlYXNlJzsgLy8gUmVzdG9yZSB0cmFuc2l0aW9ucw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmbG93RWRpdG9yLmRyYWdnaW5nVGFnID0gbnVsbDsNCiAgICAgICAgZmxvd0VkaXRvci50YWdEcmFnT2Zmc2V0ID0gbnVsbDsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBpZiAoZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUpIHsNCiAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSk7DQogICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgbm9kZUVsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ2dyYWInOw0KICAgICAgICAgICAgbm9kZUVsZW1lbnQuc3R5bGUuekluZGV4ID0gJyc7IC8vIFJlc2V0IHotaW5kZXgNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gQ2xlYXIgYW55IHBlbmRpbmcgY29ubmVjdGlvbiB1cGRhdGVzDQogICAgICAgIGlmIChmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQpIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dChmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQpOw0KICAgICAgICAgICAgZmxvd0VkaXRvci51cGRhdGVUaW1lb3V0ID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRmluYWwgY29ubmVjdGlvbiB1cGRhdGUNCiAgICAgICAgdXBkYXRlQ29ubmVjdGlvbnNGb3JOb2RlKGZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlKTsNCiAgICAgICAgDQogICAgICAgIGZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlID0gbnVsbDsNCiAgICAgICAgZmxvd0VkaXRvci5kcmFnT2Zmc2V0ID0gbnVsbDsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXNSZWN0ID0gbnVsbDsNCiAgICB9DQp9DQoNCg0KLy8gRXhhbXBsZTogY2FudmFzLW1hbmFnZXIuanMNCndpbmRvdy5jYW52YXNNYW5hZ2VyID0gew0KICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSwNCiAgICBzdGFydENhbnZhc1BhbiwNCiAgICB1cGRhdGVDYW52YXNQYW4sDQogICAgc3RvcENhbnZhc1BhbiwNCiAgICByZXNldENhbnZhc1BhbiwNCiAgICBoYW5kbGVDYW52YXNDbGljaywNCiAgICBoYW5kbGVEb2N1bWVudE1vdXNlRG93biwNCiAgICBoYW5kbGVEb2N1bWVudE1vdXNlTW92ZSwNCiAgICBoYW5kbGVEb2N1bWVudE1vdXNlVXAsDQogICAgem9vbUluLA0KICAgIHpvb21PdXQsDQogICAgc2V0Wm9vbUxldmVsLA0KICAgIHpvb21Ub0ZpdCwNCiAgICBoYW5kbGVNb3VzZVdoZWVsDQp9Ow0KDQoNCi8vIEFkZCBhIG5ldyB0YWcgYXQgY3VycmVudCB2aWV3cG9ydCBjZW50ZXINCmZ1bmN0aW9uIGFkZFRhZygpIHsNCiAgICBjb25zdCB0YWdOYW1lID0gcHJvbXB0KCdFbnRlciB0YWcgbmFtZTonKTsNCiAgICBpZiAoIXRhZ05hbWUgfHwgdGFnTmFtZS50cmltKCkgPT09ICcnKSByZXR1cm47DQoNCiAgICBjb25zdCB0YWdJZCA9IGB0YWdfJHsrK2Zsb3dFZGl0b3IudGFnQ291bnRlcn1gOw0KDQogICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIGF0IGN1cnJlbnQgdmlld3BvcnQgY2VudGVyDQogICAgLy8gR2V0IGNlbnRlciBwb3NpdGlvbiBpbiBjYW52YXMgY29vcmRpbmF0ZXMNCiAgICBjb25zdCBjZW50ZXIgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0Vmlld3BvcnRDZW50ZXJJbkNhbnZhcygpIDoNCiAgICAgICAgeyB4OiA1MDAwLCB5OiA1MDAwIH07IC8vIEZhbGxiYWNrIHRvIGNhbnZhcyBjZW50ZXINCg0KICAgIGNvbnN0IHRhZyA9IHsNCiAgICAgICAgaWQ6IHRhZ0lkLA0KICAgICAgICBuYW1lOiB0YWdOYW1lLnRyaW0oKSwNCiAgICAgICAgZGVzY3JpcHRpb246ICcnLA0KICAgICAgICB4OiBjZW50ZXIueCwNCiAgICAgICAgeTogY2VudGVyLnksDQogICAgICAgIGNvbG9yOiAnIzRDQUY1MCcgLy8gR3JlZW4gY29sb3INCiAgICB9Ow0KDQogICAgZmxvd0VkaXRvci50YWdzLnNldCh0YWdJZCwgdGFnKTsNCiAgICBjcmVhdGVUYWdFbGVtZW50KHRhZyk7DQogICAgdXBkYXRlVGFnUGFuZWwoKTsNCg0KICAgIGNvbnNvbGUubG9nKCdBZGRlZCB0YWc6JywgdGFnKTsNCn0NCg0KLy8gQ3JlYXRlIHRhZyBlbGVtZW50IG9uIGNhbnZhcw0KZnVuY3Rpb24gY3JlYXRlVGFnRWxlbWVudCh0YWcpIHsNCiAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgdGFnRWxlbWVudC5pZCA9IHRhZy5pZDsNCiAgICB0YWdFbGVtZW50LmNsYXNzTmFtZSA9ICdjYW52YXMtdGFnJzsNCiAgICB0YWdFbGVtZW50LnN0eWxlLmNzc1RleHQgPSBgDQogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgbGVmdDogJHt0YWcueH1weDsNCiAgICAgICAgdG9wOiAke3RhZy55fXB4Ow0KICAgICAgICBiYWNrZ3JvdW5kOiAke3RhZy5jb2xvcn07DQogICAgICAgIGNvbG9yOiB3aGl0ZTsNCiAgICAgICAgcGFkZGluZzogNHB4IDhweDsNCiAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsNCiAgICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgICBmb250LXdlaWdodDogNTAwOw0KICAgICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgICAgICB6LWluZGV4OiAxMDA7DQogICAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMik7DQogICAgICAgIHRyYW5zaXRpb246IGJveC1zaGFkb3cgMC4ycyBlYXNlLCB0cmFuc2Zvcm0gMC4ycyBlYXNlOw0KICAgIGA7DQogICAgdGFnRWxlbWVudC50ZXh0Q29udGVudCA9IHRhZy5uYW1lOw0KDQogICAgLy8gTWFrZSB0YWcgZHJhZ2dhYmxlDQogICAgdGFnRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZSkgPT4gew0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgIHN0YXJ0RHJhZ2dpbmdUYWcodGFnLmlkLCBlKTsNCiAgICB9KTsNCg0KICAgIC8vIENsaWNrIHRvIGp1bXAgdG8gdGFnDQogICAgdGFnRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgIGlmICghZmxvd0VkaXRvci5kcmFnZ2luZ1RhZykgew0KICAgICAgICAgICAganVtcFRvVGFnKHRhZy5pZCk7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8vIEhvdmVyIGVmZmVjdHMNCiAgICB0YWdFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoKSA9PiB7DQogICAgICAgIHRhZ0VsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEuMDUpJzsNCiAgICAgICAgdGFnRWxlbWVudC5zdHlsZS5ib3hTaGFkb3cgPSAnMCA0cHggOHB4IHJnYmEoMCwwLDAsMC4zKSc7DQogICAgfSk7DQoNCiAgICB0YWdFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiB7DQogICAgICAgIHRhZ0VsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEpJzsNCiAgICAgICAgdGFnRWxlbWVudC5zdHlsZS5ib3hTaGFkb3cgPSAnMCAycHggNHB4IHJnYmEoMCwwLDAsMC4yKSc7DQogICAgfSk7DQoNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5hcHBlbmRDaGlsZCh0YWdFbGVtZW50KTsNCn0NCg0KLy8gU3RhcnQgZHJhZ2dpbmcgYSB0YWcNCmZ1bmN0aW9uIHN0YXJ0RHJhZ2dpbmdUYWcodGFnSWQsIGUpIHsNCiAgICBjb25zdCB0YWcgPSBmbG93RWRpdG9yLnRhZ3MuZ2V0KHRhZ0lkKTsNCiAgICBpZiAoIXRhZykgcmV0dXJuOw0KDQogICAgZmxvd0VkaXRvci5kcmFnZ2luZ1RhZyA9IHRhZ0lkOw0KDQogICAgLy8gQ2FsY3VsYXRlIG9mZnNldCBmcm9tIG1vdXNlIHRvIHRhZyBjb3JuZXIsIGFjY291bnRpbmcgZm9yIHpvb20NCiAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOiANCiAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIA0KICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDogDQogICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICANCiAgICAvLyBDb252ZXJ0IG1vdXNlIHBvc2l0aW9uIHRvIGNhbnZhcyBjb29yZGluYXRlcw0KICAgIGNvbnN0IGNhbnZhc01vdXNlWCA9IChtb3VzZUNvb3Jkcy54IC0gY29udGFpbmVyUmVjdC5sZWZ0IC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueCkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICBjb25zdCBjYW52YXNNb3VzZVkgPSAobW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgb2Zmc2V0IGluIGNhbnZhcyBjb29yZGluYXRlcw0KICAgIGZsb3dFZGl0b3IudGFnRHJhZ09mZnNldCA9IHsNCiAgICAgICAgeDogKGNhbnZhc01vdXNlWCAtIHRhZy54KSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsLA0KICAgICAgICB5OiAoY2FudmFzTW91c2VZIC0gdGFnLnkpICogZmxvd0VkaXRvci56b29tTGV2ZWwNCiAgICB9Ow0KDQogICAgY29uc3QgdGFnRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhZ0lkKTsNCiAgICB0YWdFbGVtZW50LnN0eWxlLmN1cnNvciA9ICdncmFiYmluZyc7DQogICAgdGFnRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMTAwMSc7DQogICAgdGFnRWxlbWVudC5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnOyAvLyBEaXNhYmxlIHRyYW5zaXRpb25zIGR1cmluZyBkcmFnDQp9DQoNCi8vIEp1bXAgdG8gdGFnIGxvY2F0aW9uDQpmdW5jdGlvbiBqdW1wVG9UYWcodGFnSWQpIHsNCiAgICBjb25zdCB0YWcgPSBmbG93RWRpdG9yLnRhZ3MuZ2V0KHRhZ0lkKTsNCiAgICBpZiAoIXRhZykgcmV0dXJuOw0KDQogICAgLy8gQWRkIHNtb290aCB0cmFuc2l0aW9uDQogICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC41cyBlYXNlLW91dCc7DQoNCiAgICAvLyBVc2UgdXRpbGl0eSBmdW5jdGlvbiB0byBjZW50ZXIgdmlld3BvcnQgb24gdGFnIGNvb3JkaW5hdGVzDQogICAgaWYgKHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgJiYgd2luZG93LmZsb3dFZGl0b3JVdGlscy5jZW50ZXJWaWV3cG9ydE9uQ2FudmFzKSB7DQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuY2VudGVyVmlld3BvcnRPbkNhbnZhcyh0YWcueCwgdGFnLnkpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIEZhbGxiYWNrIG1ldGhvZA0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICANCiAgICAgICAgY29uc3Qgdmlld3BvcnRDZW50ZXJYID0gY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgICAgIGNvbnN0IHZpZXdwb3J0Q2VudGVyWSA9IGNvbnRhaW5lclJlY3QuaGVpZ2h0IC8gMjsNCiAgICAgICAgDQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSB2aWV3cG9ydENlbnRlclggLSAodGFnLnggKiBmbG93RWRpdG9yLnpvb21MZXZlbCk7DQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkgPSB2aWV3cG9ydENlbnRlclkgLSAodGFnLnkgKiBmbG93RWRpdG9yLnpvb21MZXZlbCk7DQogICAgICAgIA0KICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICB9DQoNCiAgICAvLyBSZW1vdmUgdHJhbnNpdGlvbiBhZnRlciBhbmltYXRpb24gY29tcGxldGVzDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLnRyYW5zaXRpb24gPSAnJzsNCiAgICB9LCA1MDApOw0KfQ0KDQovLyBVcGRhdGUgdGFnIHBhbmVsDQpmdW5jdGlvbiB1cGRhdGVUYWdQYW5lbCgpIHsNCiAgICBjb25zdCB0YWdQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWctcGFuZWwnKTsNCiAgICBpZiAoIXRhZ1BhbmVsKSByZXR1cm47DQoNCiAgICBpZiAoZmxvd0VkaXRvci50YWdzLnNpemUgPT09IDApIHsNCiAgICAgICAgdGFnUGFuZWwuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LW11dGVkIj5ObyB0YWdzIHlldDwvcD4nOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IHRhZ0h0bWwgPSAnJzsNCiAgICBmbG93RWRpdG9yLnRhZ3MuZm9yRWFjaCh0YWcgPT4gew0KICAgICAgICB0YWdIdG1sICs9IGANCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhZy1pdGVtIiBkYXRhLXRhZy1pZD0iJHt0YWcuaWR9Ij4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWctY29sb3IiIHN0eWxlPSJiYWNrZ3JvdW5kOiAke3RhZy5jb2xvcn0iPjwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhZy1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFnLW5hbWUiPiR7dGFnLm5hbWV9PC9kaXY+DQogICAgICAgICAgICAgICAgICAgICR7dGFnLmRlc2NyaXB0aW9uID8gYDxkaXYgY2xhc3M9InRhZy1kZXNjcmlwdGlvbiI+JHt0YWcuZGVzY3JpcHRpb259PC9kaXY+YCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhZy1kZWxldGUiIGRhdGEtdGFnLWlkPSIke3RhZy5pZH0iPg0KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+DQogICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgYDsNCiAgICB9KTsNCg0KICAgIHRhZ1BhbmVsLmlubmVySFRNTCA9IHRhZ0h0bWw7DQoNCiAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzDQogICAgdGFnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLnRhZy1pdGVtJykuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy50YWctZGVsZXRlJykpIHsNCiAgICAgICAgICAgICAgICBjb25zdCB0YWdJZCA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXRhZy1pZCcpOw0KICAgICAgICAgICAgICAgIGp1bXBUb1RhZyh0YWdJZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0pOw0KDQogICAgdGFnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLnRhZy1kZWxldGUnKS5mb3JFYWNoKGJ0biA9PiB7DQogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgY29uc3QgdGFnSWQgPSBidG4uZ2V0QXR0cmlidXRlKCdkYXRhLXRhZy1pZCcpOw0KICAgICAgICAgICAgZGVsZXRlVGFnKHRhZ0lkKTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQoNCi8vIERlbGV0ZSBhIHRhZw0KZnVuY3Rpb24gZGVsZXRlVGFnKHRhZ0lkKSB7DQogICAgaWYgKGNvbmZpcm0oJ0RlbGV0ZSB0aGlzIHRhZz8nKSkgew0KICAgICAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFnSWQpOw0KICAgICAgICBpZiAodGFnRWxlbWVudCkgew0KICAgICAgICAgICAgdGFnRWxlbWVudC5yZW1vdmUoKTsNCiAgICAgICAgfQ0KICAgICAgICBmbG93RWRpdG9yLnRhZ3MuZGVsZXRlKHRhZ0lkKTsNCiAgICAgICAgdXBkYXRlVGFnUGFuZWwoKTsNCiAgICB9DQp9DQoNCi8vIEV4YW1wbGU6IHRhZy1tYW5hZ2VyLmpzDQp3aW5kb3cudGFnTWFuYWdlciA9IHsNCiAgICBhZGRUYWcsDQogICAgY3JlYXRlVGFnRWxlbWVudCwNCiAgICBzdGFydERyYWdnaW5nVGFnLA0KICAgIGp1bXBUb1RhZywNCiAgICB1cGRhdGVUYWdQYW5lbCwNCiAgICBkZWxldGVUYWcNCn07DQoNCi8vIFNhdmUgZmxvdyB0byB2aXJ0dWFsIGZpbGUgc3lzdGVtDQphc3luYyBmdW5jdGlvbiBzYXZlRmxvdygpIHsNCiAgICBjb25zdCBmbG93RGF0YSA9IHsNCiAgICAgICAgbm9kZXM6IEFycmF5LmZyb20oZmxvd0VkaXRvci5ub2Rlcy52YWx1ZXMoKSkubWFwKG5vZGUgPT4gKHsNCiAgICAgICAgICAgIGlkOiBub2RlLmlkLA0KICAgICAgICAgICAgdHlwZTogbm9kZS50eXBlLA0KICAgICAgICAgICAgeDogbm9kZS54LA0KICAgICAgICAgICAgeTogbm9kZS55LA0KICAgICAgICAgICAgY29uZmlnOiBub2RlLmNvbmZpZw0KICAgICAgICB9KSksDQogICAgICAgIGNvbm5lY3Rpb25zOiBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLm1hcChjb25uID0+ICh7DQogICAgICAgICAgICBpZDogY29ubi5pZCwNCiAgICAgICAgICAgIGZyb206IGNvbm4uZnJvbSwNCiAgICAgICAgICAgIHRvOiBjb25uLnRvDQogICAgICAgIH0pKSwNCiAgICAgICAgdGFnczogQXJyYXkuZnJvbShmbG93RWRpdG9yLnRhZ3MudmFsdWVzKCkpLA0KICAgICAgICBtZXRhZGF0YTogew0KICAgICAgICAgICAgc2F2ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgICAgICAgICAgbm9kZUNvdW50OiBmbG93RWRpdG9yLm5vZGVzLnNpemUsDQogICAgICAgICAgICBjb25uZWN0aW9uQ291bnQ6IGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuc2l6ZSwNCiAgICAgICAgICAgIHRhZ0NvdW50OiBmbG93RWRpdG9yLnRhZ3Muc2l6ZQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHRyeSB7DQogICAgICAgIGxldCBmaWxlUGF0aCA9IGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoOw0KICAgICAgICANCiAgICAgICAgLy8gSWYgbm8gY3VycmVudCBmaWxlIHBhdGgsIHNob3cgZmlsZSBleHBsb3Jlcg0KICAgICAgICBpZiAoIWZpbGVQYXRoKSB7DQogICAgICAgICAgICBmaWxlUGF0aCA9IGF3YWl0IHN5cG5leEFQSS5zaG93RmlsZUV4cGxvcmVyKHsNCiAgICAgICAgICAgICAgICBtb2RlOiAnc2F2ZScsDQogICAgICAgICAgICAgICAgdGl0bGU6ICdTYXZlIEZsb3cgRmlsZScsDQogICAgICAgICAgICAgICAgaW5pdGlhbFBhdGg6ICcvJywNCiAgICAgICAgICAgICAgICBmaWxlTmFtZTogJ2Zsb3dfd29ya2Zsb3cuanNvbicsDQogICAgICAgICAgICAgICAgZmlsZUV4dGVuc2lvbjogJy5qc29uJywNCiAgICAgICAgICAgICAgICBvblNlbGVjdDogKHNlbGVjdGVkUGF0aCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBzZWxlY3RlZCBmb3Igc2F2aW5nOicsIHNlbGVjdGVkUGF0aCk7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBzZWxlY3Rpb24gY2FuY2VsbGVkJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGlmICghZmlsZVBhdGgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47IC8vIFVzZXIgY2FuY2VsbGVkDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTYXZlIHRvIHZpcnR1YWwgZmlsZSBzeXN0ZW0NCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZUpTT04pIHsNCiAgICAgICAgICAgIGF3YWl0IHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlSlNPTihmaWxlUGF0aCwgZmxvd0RhdGEpOw0KICAgICAgICAgICAgZmxvd0VkaXRvci5jdXJyZW50RmlsZVBhdGggPSBmaWxlUGF0aDsNCiAgICAgICAgICAgIHVwZGF0ZUZpbGVuYW1lRGlzcGxheSgpOw0KICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oYEZsb3cgc2F2ZWQgdG86ICR7ZmlsZVBhdGh9YCwgJ3N1Y2Nlc3MnKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsU3RvcmFnZQ0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2Zsb3dfZWRpdG9yX3NhdmVkX2Zsb3cnLCBKU09OLnN0cmluZ2lmeShmbG93RGF0YSkpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0Zsb3cgc2F2ZWQgdG8gbG9jYWxTdG9yYWdlOicsIGZsb3dEYXRhKTsNCiAgICAgICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbignRmxvdyBzYXZlZCB0byBsb2NhbCBzdG9yYWdlIScsICdzdWNjZXNzJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29uc29sZS5sb2coJ0Zsb3cgc2F2ZWQ6JywgZmxvd0RhdGEpOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzYXZlIGZsb3c6JywgZXJyb3IpOw0KICAgICAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKSB7DQogICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbignRmFpbGVkIHRvIHNhdmUgZmxvdzogJyArIGVycm9yLm1lc3NhZ2UsICdlcnJvcicpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyBTYXZlIGZsb3cgYXMgKGFsd2F5cyBzaG93IGZpbGUgZXhwbG9yZXIpDQphc3luYyBmdW5jdGlvbiBzYXZlRmxvd0FzKCkgew0KICAgIGNvbnN0IGZsb3dEYXRhID0gew0KICAgICAgICBub2RlczogQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKS5tYXAobm9kZSA9PiAoew0KICAgICAgICAgICAgaWQ6IG5vZGUuaWQsDQogICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsDQogICAgICAgICAgICB4OiBub2RlLngsDQogICAgICAgICAgICB5OiBub2RlLnksDQogICAgICAgICAgICBjb25maWc6IG5vZGUuY29uZmlnDQogICAgICAgIH0pKSwNCiAgICAgICAgY29ubmVjdGlvbnM6IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkubWFwKGNvbm4gPT4gKHsNCiAgICAgICAgICAgIGlkOiBjb25uLmlkLA0KICAgICAgICAgICAgZnJvbTogY29ubi5mcm9tLA0KICAgICAgICAgICAgdG86IGNvbm4udG8NCiAgICAgICAgfSkpLA0KICAgICAgICB0YWdzOiBBcnJheS5mcm9tKGZsb3dFZGl0b3IudGFncy52YWx1ZXMoKSksDQogICAgICAgIG1ldGFkYXRhOiB7DQogICAgICAgICAgICBzYXZlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksDQogICAgICAgICAgICBub2RlQ291bnQ6IGZsb3dFZGl0b3Iubm9kZXMuc2l6ZSwNCiAgICAgICAgICAgIGNvbm5lY3Rpb25Db3VudDogZmxvd0VkaXRvci5jb25uZWN0aW9ucy5zaXplLA0KICAgICAgICAgICAgdGFnQ291bnQ6IGZsb3dFZGl0b3IudGFncy5zaXplDQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdHJ5IHsNCiAgICAgICAgLy8gU2hvdyBmaWxlIGV4cGxvcmVyIGZvciBzYXZpbmcNCiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBhd2FpdCBzeXBuZXhBUEkuc2hvd0ZpbGVFeHBsb3Jlcih7DQogICAgICAgICAgICBtb2RlOiAnc2F2ZScsDQogICAgICAgICAgICB0aXRsZTogJ1NhdmUgRmxvdyBGaWxlIEFzJywNCiAgICAgICAgICAgIGluaXRpYWxQYXRoOiAnLycsDQogICAgICAgICAgICBmaWxlTmFtZTogJ2Zsb3dfd29ya2Zsb3cuanNvbicsDQogICAgICAgICAgICBmaWxlRXh0ZW5zaW9uOiAnLmpzb24nLA0KICAgICAgICAgICAgb25TZWxlY3Q6IChzZWxlY3RlZFBhdGgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBzZWxlY3RlZCBmb3Igc2F2aW5nIGFzOicsIHNlbGVjdGVkUGF0aCk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgb25DYW5jZWw6ICgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBzZWxlY3Rpb24gY2FuY2VsbGVkJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIGlmICghZmlsZVBhdGgpIHsNCiAgICAgICAgICAgIHJldHVybjsgLy8gVXNlciBjYW5jZWxsZWQNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFNhdmUgdG8gdmlydHVhbCBmaWxlIHN5c3RlbQ0KICAgICAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlSlNPTikgew0KICAgICAgICAgICAgYXdhaXQgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGVKU09OKGZpbGVQYXRoLCBmbG93RGF0YSk7DQogICAgICAgICAgICBmbG93RWRpdG9yLmN1cnJlbnRGaWxlUGF0aCA9IGZpbGVQYXRoOw0KICAgICAgICAgICAgdXBkYXRlRmlsZW5hbWVEaXNwbGF5KCk7DQogICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbihgRmxvdyBzYXZlZCBhczogJHtmaWxlUGF0aH1gLCAnc3VjY2VzcycpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gbG9jYWxTdG9yYWdlDQogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZmxvd19lZGl0b3Jfc2F2ZWRfZmxvdycsIEpTT04uc3RyaW5naWZ5KGZsb3dEYXRhKSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnRmxvdyBzYXZlZCB0byBsb2NhbFN0b3JhZ2U6JywgZmxvd0RhdGEpOw0KICAgICAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKCdGbG93IHNhdmVkIHRvIGxvY2FsIHN0b3JhZ2UhJywgJ3N1Y2Nlc3MnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjb25zb2xlLmxvZygnRmxvdyBzYXZlZCBhczonLCBmbG93RGF0YSk7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgZmxvdyBhczonLCBlcnJvcik7DQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKCdGYWlsZWQgdG8gc2F2ZSBmbG93IGFzOiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIExvYWQgZmxvdyBmcm9tIHZpcnR1YWwgZmlsZSBzeXN0ZW0NCmFzeW5jIGZ1bmN0aW9uIGxvYWRGbG93KCkgew0KICAgIHRyeSB7DQogICAgICAgIC8vIFNob3cgZmlsZSBleHBsb3JlciBmb3IgbG9hZGluZw0KICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGF3YWl0IHN5cG5leEFQSS5zaG93RmlsZUV4cGxvcmVyKHsNCiAgICAgICAgICAgIG1vZGU6ICdvcGVuJywNCiAgICAgICAgICAgIHRpdGxlOiAnTG9hZCBGbG93IEZpbGUnLA0KICAgICAgICAgICAgaW5pdGlhbFBhdGg6ICcvJywNCiAgICAgICAgICAgIG9uU2VsZWN0OiAoc2VsZWN0ZWRQYXRoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZpbGUgc2VsZWN0ZWQgZm9yIGxvYWRpbmc6Jywgc2VsZWN0ZWRQYXRoKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHNlbGVjdGlvbiBjYW5jZWxsZWQnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgaWYgKCFmaWxlUGF0aCkgew0KICAgICAgICAgICAgcmV0dXJuOyAvLyBVc2VyIGNhbmNlbGxlZA0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IGZsb3dEYXRhID0gbnVsbDsNCiAgICAgICAgDQogICAgICAgIC8vIFRyeSB2aXJ0dWFsIGZpbGUgc3lzdGVtIGZpcnN0DQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnJlYWRWaXJ0dWFsRmlsZUpTT04pIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgZmxvd0RhdGEgPSBhd2FpdCBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlSlNPTihmaWxlUGF0aCk7DQogICAgICAgICAgICB9IGNhdGNoICh2ZnNFcnJvcikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGYWlsZWQgdG8gbG9hZCBmcm9tIHZpcnR1YWwgZmlsZSBzeXN0ZW0sIHRyeWluZyBsb2NhbFN0b3JhZ2UuLi4nKTsNCiAgICAgICAgICAgICAgICB0aHJvdyB2ZnNFcnJvcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRmFsbGJhY2sgdG8gbG9jYWxTdG9yYWdlIChmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSkNCiAgICAgICAgaWYgKCFmbG93RGF0YSkgew0KICAgICAgICAgICAgY29uc3QgbG9jYWxEYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2Zsb3dfZWRpdG9yX3NhdmVkX2Zsb3cnKTsNCiAgICAgICAgICAgIGlmIChsb2NhbERhdGEpIHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YSA9IEpTT04ucGFyc2UobG9jYWxEYXRhKTsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmxvdyBsb2FkZWQgZnJvbSBsb2NhbFN0b3JhZ2UnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKGZsb3dEYXRhKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnRmxvdyBsb2FkZWQ6JywgZmxvd0RhdGEpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDbGVhciBjdXJyZW50IGNhbnZhcw0KICAgICAgICAgICAgY2xlYXJDYW52YXMoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gUmVzZXQgcGFuIG9mZnNldCB0byBjZW50ZXIgb2YgbGFyZ2UgY2FudmFzIGZvciBuZXcgd29ya2Zsb3cNCiAgICAgICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0ID0geyB4OiAtNTAwMCwgeTogLTUwMDAgfTsNCiAgICAgICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBSZXNldCBub2RlIGNvdW50ZXIgdG8gYXZvaWQgSUQgY29uZmxpY3RzDQogICAgICAgICAgICBmbG93RWRpdG9yLm5vZGVDb3VudGVyID0gMDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gTG9hZCBub2Rlcw0KICAgICAgICAgICAgaWYgKGZsb3dEYXRhLm5vZGVzKSB7DQogICAgICAgICAgICAgICAgZmxvd0RhdGEubm9kZXMuZm9yRWFjaChub2RlRGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBub2RlIHdpdGggcHJvcGVyIElEDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZCA9IG5vZGVEYXRhLmlkOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IG5vZGVJZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG5vZGVEYXRhLnR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICB4OiBub2RlRGF0YS54LA0KICAgICAgICAgICAgICAgICAgICAgICAgeTogbm9kZURhdGEueSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZzogbm9kZURhdGEuY29uZmlnLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge30NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBub2RlIGNvdW50ZXINCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZU51bSA9IHBhcnNlSW50KG5vZGVJZC5yZXBsYWNlKCdub2RlXycsICcnKSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChub2RlTnVtID4gZmxvd0VkaXRvci5ub2RlQ291bnRlcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci5ub2RlQ291bnRlciA9IG5vZGVOdW07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZsb3dFZGl0b3Iubm9kZXMuc2V0KG5vZGVJZCwgbm9kZSk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgbm9kZSBlbGVtZW50IHVzaW5nIHRoZSByZW5kZXJlciBhbmQgYWRkIHRvIGNhbnZhcw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IG5vZGVSZW5kZXJlci5jcmVhdGVOb2RlRWxlbWVudChub2RlKTsNCiAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuYXBwZW5kQ2hpbGQobm9kZUVsZW1lbnQpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBMb2FkIGNvbm5lY3Rpb25zIGFmdGVyIG5vZGVzIGFyZSBmdWxseSBjcmVhdGVkIGFuZCBwb3NpdGlvbmVkDQogICAgICAgICAgICBpZiAoZmxvd0RhdGEuY29ubmVjdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YS5jb25uZWN0aW9ucy5mb3JFYWNoKGNvbm5EYXRhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlQ29ubmVjdGlvbihjb25uRGF0YS5mcm9tLm5vZGVJZCwgY29ubkRhdGEuZnJvbS5wb3J0TmFtZSwgY29ubkRhdGEudG8ubm9kZUlkLCBjb25uRGF0YS50by5wb3J0TmFtZSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gSW1tZWRpYXRlbHkgcmVkcmF3IGNvbm5lY3Rpb25zIG5vdyB0aGF0IGFsbCBTVkcgZWxlbWVudHMgZXhpc3QNCiAgICAgICAgICAgICAgICByZWRyYXdBbGxDb25uZWN0aW9ucygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBMb2FkIHRhZ3MNCiAgICAgICAgICAgIGlmIChmbG93RGF0YS50YWdzKSB7DQogICAgICAgICAgICAgICAgZmxvd0RhdGEudGFncy5mb3JFYWNoKHRhZ0RhdGEgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWcgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZDogdGFnRGF0YS5pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRhZ0RhdGEubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0YWdEYXRhLmRlc2NyaXB0aW9uIHx8ICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgeDogdGFnRGF0YS54LA0KICAgICAgICAgICAgICAgICAgICAgICAgeTogdGFnRGF0YS55LA0KICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRhZ0RhdGEuY29sb3IgfHwgJyM0Q0FGNTAnDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGFnIGNvdW50ZXINCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFnTnVtID0gcGFyc2VJbnQodGFnRGF0YS5pZC5yZXBsYWNlKCd0YWdfJywgJycpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ051bSA+IGZsb3dFZGl0b3IudGFnQ291bnRlcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci50YWdDb3VudGVyID0gdGFnTnVtOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnRhZ3Muc2V0KHRhZ0RhdGEuaWQsIHRhZyk7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy50YWdNYW5hZ2VyLmNyZWF0ZVRhZ0VsZW1lbnQodGFnKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGNlbnRlciBvZiBsb2FkZWQgbm9kZXMgYW5kIGFkanVzdCBwYW4gdG8gY2VudGVyIHRoZW0NCiAgICAgICAgICAgIGlmIChmbG93RGF0YS5ub2RlcyAmJiBmbG93RGF0YS5ub2Rlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgY29uc3QgbWluWCA9IE1hdGgubWluKC4uLmZsb3dEYXRhLm5vZGVzLm1hcChuID0+IG4ueCkpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1heFggPSBNYXRoLm1heCguLi5mbG93RGF0YS5ub2Rlcy5tYXAobiA9PiBuLngpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBtaW5ZID0gTWF0aC5taW4oLi4uZmxvd0RhdGEubm9kZXMubWFwKG4gPT4gbi55KSk7DQogICAgICAgICAgICAgICAgY29uc3QgbWF4WSA9IE1hdGgubWF4KC4uLmZsb3dEYXRhLm5vZGVzLm1hcChuID0+IG4ueSkpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IGNlbnRlclggPSAobWluWCArIG1heFgpIC8gMjsNCiAgICAgICAgICAgICAgICBjb25zdCBjZW50ZXJZID0gKG1pblkgKyBtYXhZKSAvIDI7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gR2V0IGNhbnZhcyBjb250YWluZXIgZGltZW5zaW9ucw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcGFuIG9mZnNldCB0byBjZW50ZXIgdGhlIG5vZGVzIGluIHRoZSB2aWV3cG9ydA0KICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSAtY2VudGVyWCArIGNvbnRhaW5lclJlY3Qud2lkdGggLyAyOw0KICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkgPSAtY2VudGVyWSArIGNvbnRhaW5lclJlY3QuaGVpZ2h0IC8gMjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gRmluYWwgY29ubmVjdGlvbiByZWRyYXcgYWZ0ZXIgYWxsIHBvc2l0aW9uaW5nIGlzIGNvbXBsZXRlDQogICAgICAgICAgICByZWRyYXdBbGxDb25uZWN0aW9ucygpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBVcGRhdGUgdGFnIHBhbmVsDQogICAgICAgICAgICB3aW5kb3cudGFnTWFuYWdlci51cGRhdGVUYWdQYW5lbCgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBVcGRhdGUgY3VycmVudCBmaWxlIHBhdGgNCiAgICAgICAgICAgIGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoID0gZmlsZVBhdGg7DQogICAgICAgICAgICB1cGRhdGVGaWxlbmFtZURpc3BsYXkoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKGBGbG93IGxvYWRlZCBmcm9tOiAke2ZpbGVQYXRofWAsICdzdWNjZXNzJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKSB7DQogICAgICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oJ05vIHZhbGlkIGZsb3cgZGF0YSBmb3VuZCBpbiB0aGUgc2VsZWN0ZWQgZmlsZS4nLCAnd2FybmluZycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgZmxvdzonLCBlcnJvcik7DQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKCdGYWlsZWQgdG8gbG9hZCBmbG93OiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFVwZGF0ZSBmaWxlbmFtZSBkaXNwbGF5DQpmdW5jdGlvbiB1cGRhdGVGaWxlbmFtZURpc3BsYXkoKSB7DQogICAgY29uc3QgZmlsZW5hbWVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnQtZmlsZW5hbWUnKTsNCiAgICBpZiAoZmlsZW5hbWVFbGVtZW50KSB7DQogICAgICAgIGNvbnN0IGZpbGVuYW1lID0gZmxvd0VkaXRvci5jdXJyZW50RmlsZVBhdGggPyBmbG93RWRpdG9yLmN1cnJlbnRGaWxlUGF0aC5zcGxpdCgnLycpLnBvcCgpIDogJ3VudGl0bGVkLmZsb3cnOw0KICAgICAgICBmaWxlbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBmaWxlbmFtZTsNCiAgICB9DQp9DQoNCg0KLy8gRXhwb3J0IHRvIGdsb2JhbCBzY29wZQ0Kd2luZG93LmZpbGVNYW5hZ2VyID0gew0KICAgIHNhdmVGbG93LA0KICAgIHNhdmVGbG93QXMsDQogICAgbG9hZEZsb3csDQogICAgdXBkYXRlRmlsZW5hbWVEaXNwbGF5DQp9Ow0KDQoNCi8vIFBvcHVsYXRlIHRvb2xib3ggd2l0aCBsb2FkZWQgbm9kZXMNCmZ1bmN0aW9uIHBvcHVsYXRlVG9vbGJveCgpIHsNCiAgICBjb25zb2xlLmxvZygncG9wdWxhdGVUb29sYm94IGNhbGxlZCcpOw0KICAgIGNvbnN0IHRvb2xib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmxvdy10b29sYm94Jyk7DQogICAgY29uc29sZS5sb2coJ1Rvb2xib3ggZWxlbWVudDonLCB0b29sYm94KTsNCiAgICBpZiAoIXRvb2xib3gpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignVG9vbGJveCBub3QgZm91bmQnKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBDbGVhciBleGlzdGluZyB0b29sYm94IGNvbnRlbnQNCiAgICBjb25zdCB0b29sYm94Q29udGVudCA9IHRvb2xib3gucXVlcnlTZWxlY3RvcignLnRvb2xib3gtY29udGVudCcpOw0KICAgIGlmICh0b29sYm94Q29udGVudCkgew0KICAgICAgICB0b29sYm94Q29udGVudC5pbm5lckhUTUwgPSAnJzsNCiAgICB9DQogICAgDQogICAgLy8gR3JvdXAgbm9kZXMgYnkgY2F0ZWdvcnkNCiAgICBjb25zdCBjYXRlZ29yaWVzID0ge307DQogICAgY29uc3QgYWxsTm9kZXMgPSBub2RlUmVnaXN0cnkuZ2V0QWxsTm9kZVR5cGVzKCk7DQogICAgDQogICAgY29uc29sZS5sb2coJ0FsbCBsb2FkZWQgbm9kZXM6JywgYWxsTm9kZXMpOw0KICAgIA0KICAgIGFsbE5vZGVzLmZvckVhY2gobm9kZURlZiA9PiB7DQogICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gbm9kZURlZi5jYXRlZ29yeSB8fCAnb3RoZXInOw0KICAgICAgICBpZiAoIWNhdGVnb3JpZXNbY2F0ZWdvcnldKSB7DQogICAgICAgICAgICBjYXRlZ29yaWVzW2NhdGVnb3J5XSA9IFtdOw0KICAgICAgICB9DQogICAgICAgIGNhdGVnb3JpZXNbY2F0ZWdvcnldLnB1c2gobm9kZURlZik7DQogICAgfSk7DQogICAgDQogICAgY29uc29sZS5sb2coJ05vZGUgY2F0ZWdvcmllczonLCBjYXRlZ29yaWVzKTsNCiAgICANCiAgICAvLyBDcmVhdGUgdG9vbGJveCBzZWN0aW9ucyBmb3IgZWFjaCBjYXRlZ29yeQ0KICAgIE9iamVjdC5lbnRyaWVzKGNhdGVnb3JpZXMpLmZvckVhY2goKFtjYXRlZ29yeSwgbm9kZXNdKSA9PiB7DQogICAgICAgIGNvbnN0IGNhdGVnb3J5U2VjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgICBjYXRlZ29yeVNlY3Rpb24uY2xhc3NOYW1lID0gJ25vZGUtY2F0ZWdvcnknOw0KICAgICAgICBjYXRlZ29yeVNlY3Rpb24uaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgPGg1PiR7Y2F0ZWdvcnkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXRlZ29yeS5zbGljZSgxKX08L2g1Pg0KICAgICAgICAgICAgJHtub2Rlcy5tYXAobm9kZURlZiA9PiBgDQogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0idG9vbGJveC1ub2RlLWJ0biIgZGF0YS1ub2RlLXR5cGU9IiR7bm9kZURlZi5pZH0iIHRpdGxlPSIke25vZGVEZWYuZGVzY3JpcHRpb259Ij4NCiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9IiR7bm9kZURlZi5pY29ufSI+PC9pPg0KICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke25vZGVEZWYubmFtZX08L3NwYW4+DQogICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICBgKS5qb2luKCcnKX0NCiAgICAgICAgYDsNCiAgICAgICAgDQogICAgICAgIGlmICh0b29sYm94Q29udGVudCkgew0KICAgICAgICAgICAgdG9vbGJveENvbnRlbnQuYXBwZW5kQ2hpbGQoY2F0ZWdvcnlTZWN0aW9uKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIA0KICAgIC8vIFJlLWF0dGFjaCBldmVudCBsaXN0ZW5lcnMNCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9vbGJveC1ub2RlLWJ0bicpLmZvckVhY2goYnRuID0+IHsNCiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGNvbnN0IG5vZGVUeXBlID0gYnRuLmdldEF0dHJpYnV0ZSgnZGF0YS1ub2RlLXR5cGUnKTsNCiAgICAgICAgICAgIGlmIChub2RlVHlwZSkgew0KICAgICAgICAgICAgICAgIGFkZE5vZGUobm9kZVR5cGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9KTsNCiAgICANCiAgICBjb25zb2xlLmxvZygnVG9vbGJveCBwb3B1bGF0ZWQgd2l0aCcsIGFsbE5vZGVzLmxlbmd0aCwgJ25vZGVzJyk7DQp9DQoNCi8vIFNldCB1cCBldmVudCBoYW5kbGVycw0KZnVuY3Rpb24gc2V0dXBFdmVudEhhbmRsZXJzKCkgew0KICAgIC8vIE5vdGU6IFRvb2xib3ggbm9kZSBidXR0b24gZXZlbnQgbGlzdGVuZXJzIGFyZSBzZXQgdXAgaW4gcG9wdWxhdGVUb29sYm94KCkNCiAgICAvLyB0byBhdm9pZCBkdXBsaWNhdGVzIHdoZW4gdGhlIHRvb2xib3ggaXMgcmVwb3B1bGF0ZWQNCiAgICANCiAgICAvLyBXb3JrZmxvdyBhY3Rpb25zDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3J1bi13b3JrZmxvdycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJ1bldvcmtmbG93KTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcC13b3JrZmxvdycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN0b3BXb3JrZmxvdyk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZS1zZWxlY3RlZCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRlbGV0ZVNlbGVjdGVkTm9kZSk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyLWNhbnZhcycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFyQ2FudmFzKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXRhZycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy50YWdNYW5hZ2VyLmFkZFRhZyk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0LXBhbicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnJlc2V0Q2FudmFzUGFuKTsNCiAgICANCiAgICAvLyBab29tIGNvbnRyb2xzDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb20taW4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB3aW5kb3cuY2FudmFzTWFuYWdlci56b29tSW4pOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6b29tLW91dCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21PdXQpOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6b29tLWZpdCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21Ub0ZpdCk7DQogICAgDQogICAgLy8gRmlsZSBvcGVyYXRpb25zDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtZmxvdycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvdyk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtZmxvdy1hcycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvd0FzKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZC1mbG93Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmZpbGVNYW5hZ2VyLmxvYWRGbG93KTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItb3V0cHV0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYXJPdXRwdXQpOw0KICAgIA0KICAgIC8vIENvbmZpZyBwYW5lbCB0b2dnbGUNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLWNvbmZpZycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZUNvbmZpZ1BhbmVsKTsNCiAgICANCiAgICAvLyBJbml0aWFsaXplIGNvbmZpZyBwYW5lbCBzdGF0ZSAod2l0aG91dCBvdmVycmlkaW5nIGljb25zKQ0KICAgIGNvbnN0IGNvbmZpZ1BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zsb3ctY29uZmlnLXBhbmVsJyk7DQogICAgaWYgKGNvbmZpZ1BhbmVsKSB7DQogICAgICAgIC8vIERlZmF1bHQgZXhwYW5kZWQgKG5vdCBjb2xsYXBzZWQpDQogICAgICAgIGNvbmZpZ1BhbmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbGxhcHNlZCcpOw0KICAgIH0NCiAgICANCiAgICAvLyBUb29sYm94IHRvZ2dsZQ0KICAgIGNvbnN0IHRvb2xib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvdy10b29sYm94Jyk7DQogICAgY29uc3QgdG9vbGJveENvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9vbGJveC1jb250ZW50Jyk7DQogICAgY29uc3QgdG9nZ2xlVG9vbGJveEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtdG9vbGJveCcpOw0KICAgIGlmICh0b29sYm94ICYmIHRvb2xib3hDb250ZW50ICYmIHRvZ2dsZVRvb2xib3hCdG4pIHsNCiAgICAgICAgLy8gRGVmYXVsdCBleHBhbmRlZCAobm90IGNvbGxhcHNlZCkNCiAgICAgICAgdG9vbGJveC5jbGFzc0xpc3QucmVtb3ZlKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgdG9vbGJveENvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICcnOw0KDQogICAgICAgIHRvZ2dsZVRvb2xib3hCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgIHRvZ2dsZVRvb2xib3goKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIA0KICAgIC8vIE91dHB1dCBwYW5lbCB0b2dnbGUNCiAgICBjb25zdCBvdXRwdXRQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmbG93LW91dHB1dC1wYW5lbCcpOw0KICAgIGNvbnN0IG91dHB1dENvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3V0cHV0LWNvbnRlbnQnKTsNCiAgICBjb25zdCB0b2dnbGVPdXRwdXRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLW91dHB1dCcpOw0KICAgIGlmIChvdXRwdXRQYW5lbCAmJiBvdXRwdXRDb250ZW50ICYmIHRvZ2dsZU91dHB1dEJ0bikgew0KICAgICAgICAvLyBEZWZhdWx0IGNvbGxhcHNlZA0KICAgICAgICBvdXRwdXRQYW5lbC5jbGFzc0xpc3QuYWRkKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgb3V0cHV0Q29udGVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICB0b2dnbGVPdXRwdXRCdG4ucXVlcnlTZWxlY3RvcignaScpLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1kb3duJzsNCg0KICAgICAgICB0b2dnbGVPdXRwdXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgIGNvbnN0IGlzQ29sbGFwc2VkID0gb3V0cHV0UGFuZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgICAgIGlmIChpc0NvbGxhcHNlZCkgew0KICAgICAgICAgICAgICAgIG91dHB1dFBhbmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbGxhcHNlZCcpOw0KICAgICAgICAgICAgICAgIG91dHB1dENvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICcnOw0KICAgICAgICAgICAgICAgIHRvZ2dsZU91dHB1dEJ0bi5xdWVyeVNlbGVjdG9yKCdpJykuY2xhc3NOYW1lID0gJ2ZhcyBmYS1jaGV2cm9uLXVwJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgb3V0cHV0UGFuZWwuY2xhc3NMaXN0LmFkZCgnY29sbGFwc2VkJyk7DQogICAgICAgICAgICAgICAgb3V0cHV0Q29udGVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgIHRvZ2dsZU91dHB1dEJ0bi5xdWVyeVNlbGVjdG9yKCdpJykuY2xhc3NOYW1lID0gJ2ZhcyBmYS1jaGV2cm9uLWRvd24nOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgDQogICAgLy8gQ2FudmFzIGV2ZW50cw0KICAgIGZsb3dFZGl0b3IuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmNhbnZhc01hbmFnZXIuaGFuZGxlQ2FudmFzQ2xpY2spOw0KICAgIGZsb3dFZGl0b3IuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnN0YXJ0Q2FudmFzUGFuKTsNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLmhhbmRsZU1vdXNlV2hlZWwsIHsgcGFzc2l2ZTogZmFsc2UgfSk7DQogICAgDQogICAgLy8gRG9jdW1lbnQtbGV2ZWwgbW91c2UgZXZlbnRzIGZvciBzbW9vdGggZHJhZ2dpbmcgYW5kIHBhbm5pbmcNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB3aW5kb3cuY2FudmFzTWFuYWdlci5oYW5kbGVEb2N1bWVudE1vdXNlRG93bik7DQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgd2luZG93LmNhbnZhc01hbmFnZXIuaGFuZGxlRG9jdW1lbnRNb3VzZU1vdmUpOw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB3aW5kb3cuY2FudmFzTWFuYWdlci5oYW5kbGVEb2N1bWVudE1vdXNlVXApOw0KICAgIA0KICAgIC8vIEtleWJvYXJkIHNob3J0Y3V0cw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duKTsNCn0NCg0KLy8gVG9nZ2xlIGNvbmZpZyBwYW5lbA0KZnVuY3Rpb24gdG9nZ2xlQ29uZmlnUGFuZWwoKSB7DQogICAgY29uc3QgY29uZmlnUGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvdy1jb25maWctcGFuZWwnKTsNCiAgICBjb25zdCB0b2dnbGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLWNvbmZpZycpOw0KICAgIGNvbnN0IGljb24gPSB0b2dnbGVCdG4ucXVlcnlTZWxlY3RvcignaScpOw0KICAgIA0KICAgIGlmIChjb25maWdQYW5lbC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbGxhcHNlZCcpKSB7DQogICAgICAgIC8vIEV4cGFuZA0KICAgICAgICBjb25maWdQYW5lbC5jbGFzc0xpc3QucmVtb3ZlKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgaWNvbi5jbGFzc05hbWUgPSAnZmFzIGZhLWNoZXZyb24tcmlnaHQnOw0KICAgICAgICB0b2dnbGVCdG4udGl0bGUgPSAnQ29sbGFwc2UgQ29uZmlndXJhdGlvbiBQYW5lbCc7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gQ29sbGFwc2UNCiAgICAgICAgY29uZmlnUGFuZWwuY2xhc3NMaXN0LmFkZCgnY29sbGFwc2VkJyk7DQogICAgICAgIGljb24uY2xhc3NOYW1lID0gJ2ZhcyBmYS1jaGV2cm9uLWxlZnQnOw0KICAgICAgICB0b2dnbGVCdG4udGl0bGUgPSAnRXhwYW5kIENvbmZpZ3VyYXRpb24gUGFuZWwnOw0KICAgIH0NCn0NCg0KLy8gVG9nZ2xlIHRvb2xib3gNCmZ1bmN0aW9uIHRvZ2dsZVRvb2xib3goKSB7DQogICAgY29uc3QgdG9vbGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmbG93LXRvb2xib3gnKTsNCiAgICBjb25zdCB0b29sYm94Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b29sYm94LWNvbnRlbnQnKTsNCiAgICBjb25zdCB0b2dnbGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXRvb2xib3gnKTsNCiAgICBjb25zdCBpY29uID0gdG9nZ2xlQnRuLnF1ZXJ5U2VsZWN0b3IoJ2knKTsNCiAgICANCiAgICBpZiAodG9vbGJveC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbGxhcHNlZCcpKSB7DQogICAgICAgIC8vIEV4cGFuZA0KICAgICAgICB0b29sYm94LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbGxhcHNlZCcpOw0KICAgICAgICB0b29sYm94Q29udGVudC5zdHlsZS5kaXNwbGF5ID0gJyc7DQogICAgICAgIGljb24uY2xhc3NOYW1lID0gJ2ZhcyBmYS1jaGV2cm9uLWxlZnQnOw0KICAgICAgICB0b2dnbGVCdG4udGl0bGUgPSAnQ29sbGFwc2UgVG9vbGJveCc7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gQ29sbGFwc2UNCiAgICAgICAgdG9vbGJveC5jbGFzc0xpc3QuYWRkKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgdG9vbGJveENvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgaWNvbi5jbGFzc05hbWUgPSAnZmFzIGZhLWNoZXZyb24tcmlnaHQnOw0KICAgICAgICB0b2dnbGVCdG4udGl0bGUgPSAnRXhwYW5kIFRvb2xib3gnOw0KICAgIH0NCn0NCg0KLy8gRXhhbXBsZTogdWktbWFuYWdlci5qcw0Kd2luZG93LnVpTWFuYWdlciA9IHsNCiAgICBwb3B1bGF0ZVRvb2xib3gsDQogICAgc2V0dXBFdmVudEhhbmRsZXJzLA0KICAgIHRvZ2dsZUNvbmZpZ1BhbmVsLA0KICAgIHRvZ2dsZVRvb2xib3gNCn07DQoNCi8vIG1haW4uanMgLSBFbnRyeSBwb2ludCBmb3IgRmxvdyBFZGl0b3INCmNvbnNvbGUubG9nKCdGbG93IEVkaXRvciBhcHAgbG9hZGluZy4uLicpOw0KDQovLyBHbG9iYWwgdmFyaWFibGVzIChzY29wZWQgdG8gYXZvaWQgZ2xvYmFsIHBvbGx1dGlvbikNCmxldCBmbG93RWRpdG9yID0gew0KICAgIG5vZGVzOiBuZXcgTWFwKCksDQogICAgY29ubmVjdGlvbnM6IG5ldyBNYXAoKSwNCiAgICBzZWxlY3RlZE5vZGU6IG51bGwsDQogICAgZHJhZ2dpbmdOb2RlOiBudWxsLA0KICAgIGNvbm5lY3RpbmdGcm9tOiBudWxsLA0KICAgIGNhbnZhczogbnVsbCwNCiAgICBub2RlQ291bnRlcjogMCwNCiAgICBpc1J1bm5pbmc6IGZhbHNlLA0KICAgIGN1cnJlbnRGaWxlUGF0aDogbnVsbCwNCiAgICBpc0FjdGl2ZTogdHJ1ZSwNCiAgICAvLyBDYW52YXMgcGFubmluZyBzdGF0ZQ0KICAgIGlzUGFubmluZzogZmFsc2UsDQogICAgcGFuU3RhcnQ6IHsgeDogMCwgeTogMCB9LA0KICAgIHBhbk9mZnNldDogeyB4OiAtNTAwMCwgeTogLTUwMDAgfSwgLy8gQ2VudGVyIHRoZSBsYXJnZSBjYW52YXMgaW5pdGlhbGx5DQogICAgbGFzdFBhbk9mZnNldDogeyB4OiAtNTAwMCwgeTogLTUwMDAgfSwNCiAgICAvLyBab29tIHN0YXRlDQogICAgem9vbUxldmVsOiAxLjAsDQogICAgbWluWm9vbTogMC4xLA0KICAgIG1heFpvb206IDMuMCwNCiAgICB6b29tU3RlcDogMC4xLA0KICAgIC8vIFRhZyBzeXN0ZW0NCiAgICB0YWdzOiBuZXcgTWFwKCksDQogICAgdGFnQ291bnRlcjogMCwNCiAgICBkcmFnZ2luZ1RhZzogbnVsbCwNCiAgICB0YWdEcmFnT2Zmc2V0OiBudWxsLA0KICAgIHRhZ1VwZGF0ZVRpbWVvdXQ6IG51bGwNCn07DQoNCi8vIEluaXRpYWxpemUgd2hlbiBET00gaXMgcmVhZHkNCmFzeW5jIGZ1bmN0aW9uIGluaXRGbG93RWRpdG9yKCkgew0KICAgIGNvbnNvbGUubG9nKCdGbG93IEVkaXRvciBpbml0aWFsaXppbmcuLi4nKTsNCiAgICANCiAgICAvLyBDaGVjayBpZiBTeXBuZXhBUEkgaXMgYXZhaWxhYmxlIChsb2NhbCB2YXJpYWJsZSBpbiBzYW5kYm94ZWQgZW52aXJvbm1lbnQpDQogICAgaWYgKHR5cGVvZiBzeXBuZXhBUEkgPT09ICd1bmRlZmluZWQnIHx8ICFzeXBuZXhBUEkpIHsNCiAgICAgICAgY29uc29sZS53YXJuKCdTeXBuZXhBUEkgbm90IGF2YWlsYWJsZSAtIHJ1bm5pbmcgaW4gc3RhbmRhbG9uZSBtb2RlJyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZygnU3lwbmV4QVBJIGF2YWlsYWJsZTonLCBzeXBuZXhBUEkpOw0KICAgIGNvbnNvbGUubG9nKCdBcHAgSUQ6Jywgc3lwbmV4QVBJLmdldEFwcElkKCkpOw0KICAgIGNvbnNvbGUubG9nKCdJbml0aWFsaXplZDonLCBzeXBuZXhBUEkuaXNJbml0aWFsaXplZCgpKTsNCiAgICANCiAgICAvLyBJbml0aWFsaXplIHNjYWxlIGRldGVjdGlvbiBmb3IgYXBwIHNjYWxpbmcgY29tcGVuc2F0aW9uDQogICAgaWYgKHdpbmRvdy5mbG93RWRpdG9yVXRpbHMpIHsNCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5pbml0U2NhbGVEZXRlY3Rpb24oKTsNCiAgICAgICAgY29uc29sZS5sb2coJ1NjYWxlIGRldGVjdGlvbiBpbml0aWFsaXplZCcpOw0KICAgIH0NCiAgICANCiAgICAvLyBUZXN0IFZGUyBBUEkNCiAgICB0cnkgew0KICAgICAgICBjb25zb2xlLmxvZygnVGVzdGluZyBWRlMgQVBJLi4uJyk7DQogICAgICAgIGNvbnN0IHRlc3RSZXN1bHQgPSBhd2FpdCBzeXBuZXhBUEkubGlzdFZpcnR1YWxGaWxlcygnLycpOw0KICAgICAgICBjb25zb2xlLmxvZygnVkZTIHRlc3QgcmVzdWx0OicsIHRlc3RSZXN1bHQpOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1ZGUyBBUEkgdGVzdCBmYWlsZWQ6JywgZXJyb3IpOw0KICAgIH0NCiAgICANCiAgICAvLyBJbml0aWFsaXplIGNhbnZhcw0KICAgIGZsb3dFZGl0b3IuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zsb3ctY2FudmFzJyk7DQogICAgaWYgKCFmbG93RWRpdG9yLmNhbnZhcykgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdGbG93IGNhbnZhcyBub3QgZm91bmQnKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBDcmVhdGUgU1ZHIG1hcmtlciBkZWZpbml0aW9ucyBmb3IgY29ubmVjdGlvbiBhcnJvd3MNCiAgICBjb25zdCBkZWZzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdkZWZzJyk7DQogICAgY29uc3QgbWFya2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdtYXJrZXInKTsNCiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKCdpZCcsICdhcnJvd2hlYWQnKTsNCiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKCdtYXJrZXJXaWR0aCcsICcxMCcpOw0KICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoJ21hcmtlckhlaWdodCcsICc3Jyk7DQogICAgbWFya2VyLnNldEF0dHJpYnV0ZSgncmVmWCcsICc5Jyk7DQogICAgbWFya2VyLnNldEF0dHJpYnV0ZSgncmVmWScsICczLjUnKTsNCiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKCdvcmllbnQnLCAnYXV0bycpOw0KICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoJ21hcmtlclVuaXRzJywgJ3N0cm9rZVdpZHRoJyk7DQogICAgDQogICAgY29uc3QgcG9seWdvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncG9seWdvbicpOw0KICAgIHBvbHlnb24uc2V0QXR0cmlidXRlKCdwb2ludHMnLCAnMCAwLCAxMCAzLjUsIDAgNycpOw0KICAgIHBvbHlnb24uc2V0QXR0cmlidXRlKCdmaWxsJywgJyM0Q0FGNTAnKTsNCiAgICANCiAgICBtYXJrZXIuYXBwZW5kQ2hpbGQocG9seWdvbik7DQogICAgZGVmcy5hcHBlbmRDaGlsZChtYXJrZXIpOw0KICAgIA0KICAgIC8vIENyZWF0ZSBhIHRlbXBvcmFyeSBTVkcgY29udGFpbmVyIGZvciB0aGUgbWFya2VyIGRlZmluaXRpb24NCiAgICBjb25zdCBtYXJrZXJTdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpOw0KICAgIG1hcmtlclN2Zy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7DQogICAgbWFya2VyU3ZnLnN0eWxlLndpZHRoID0gJzAnOw0KICAgIG1hcmtlclN2Zy5zdHlsZS5oZWlnaHQgPSAnMCc7DQogICAgbWFya2VyU3ZnLmFwcGVuZENoaWxkKGRlZnMpOw0KICAgIGZsb3dFZGl0b3IuY2FudmFzLmFwcGVuZENoaWxkKG1hcmtlclN2Zyk7DQogICAgDQogICAgLy8gSW5pdGlhbGl6ZSBjYW52YXMgdHJhbnNmb3JtIGZvciBwYW5uaW5nDQogICAgd2luZG93LmNhbnZhc01hbmFnZXIudXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgDQogICAgLy8gTG9hZCBub2RlcyBmcm9tIFZGUw0KICAgIGNvbnNvbGUubG9nKCdBYm91dCB0byBsb2FkIG5vZGVzIGZyb20gVkZTLi4uJyk7DQogICAgYXdhaXQgbm9kZVJlZ2lzdHJ5LmxvYWROb2Rlc0Zyb21WRlMoKTsNCiAgICBjb25zb2xlLmxvZygnRmluaXNoZWQgbG9hZGluZyBub2RlcyBmcm9tIFZGUycpOw0KICAgIA0KICAgIC8vIFBvcHVsYXRlIHRvb2xib3ggd2l0aCBsb2FkZWQgbm9kZXMNCiAgICBjb25zb2xlLmxvZygnQWJvdXQgdG8gcG9wdWxhdGUgdG9vbGJveC4uLicpOw0KICAgIHdpbmRvdy51aU1hbmFnZXIucG9wdWxhdGVUb29sYm94KCk7DQogICAgY29uc29sZS5sb2coJ0ZpbmlzaGVkIHBvcHVsYXRpbmcgdG9vbGJveCcpOw0KICAgIA0KICAgIC8vIFNldCB1cCBldmVudCBoYW5kbGVycw0KICAgIHdpbmRvdy51aU1hbmFnZXIuc2V0dXBFdmVudEhhbmRsZXJzKCk7DQogICAgDQogICAgLy8gQ29ubmVjdCB0byBXZWJTb2NrZXQgZm9yIHJlYWwtdGltZSB1cGRhdGVzDQogICAgY29ubmVjdFdlYlNvY2tldCgpOw0KICAgIA0KICAgIC8vIEhhbmRsZSB3aW5kb3cgcmVzaXplIHRvIHVwZGF0ZSBjb25uZWN0aW9ucw0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7DQogICAgICAgIHNldFRpbWVvdXQocmVkcmF3QWxsQ29ubmVjdGlvbnMsIDEwMCk7DQogICAgfSk7DQogICAgDQogICAgLy8gSGFuZGxlIGFwcCBjbGVhbnVwIHdoZW4gd2luZG93IGlzIHVubG9hZGVkDQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGNsZWFudXBGbG93RWRpdG9yKTsNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncGFnZWhpZGUnLCBjbGVhbnVwRmxvd0VkaXRvcik7DQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3VubG9hZCcsIGNsZWFudXBGbG93RWRpdG9yKTsNCiAgICANCiAgICAvLyBGbG93IEVkaXRvciBsb2FkZWQgc3VjY2Vzc2Z1bGx5IChubyBub3RpZmljYXRpb24gbmVlZGVkKQ0KICAgIA0KICAgIC8vIFVwZGF0ZSBmaWxlbmFtZSBkaXNwbGF5DQogICAgd2luZG93LmZpbGVNYW5hZ2VyLnVwZGF0ZUZpbGVuYW1lRGlzcGxheSgpOw0KICAgIA0KICAgIGNvbnNvbGUubG9nKCdGbG93IEVkaXRvciBpbml0aWFsaXphdGlvbiBjb21wbGV0ZScpOw0KfQ0KDQovLyBDbGVhbnVwIGZ1bmN0aW9uIHRvIHJlbW92ZSB0b29sdGlwcyBhbmQgZXZlbnQgbGlzdGVuZXJzDQpmdW5jdGlvbiBjbGVhbnVwRmxvd0VkaXRvcigpIHsNCiAgICAvLyBNYXJrIGFwcCBhcyBpbmFjdGl2ZSB0byBwcmV2ZW50IG5ldyB0b29sdGlwcw0KICAgIGZsb3dFZGl0b3IuaXNBY3RpdmUgPSBmYWxzZTsNCiAgICANCiAgICAvLyBSZW1vdmUgYW55IGxpbmdlcmluZyB0b29sdGlwcyAoY2hlY2sgbXVsdGlwbGUgcG9zc2libGUgbG9jYXRpb25zKQ0KICAgIGNvbnN0IHRvb2x0aXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbm5lY3Rpb24tdG9vbHRpcCwgI2Nvbm5lY3Rpb24tdG9vbHRpcCcpOw0KICAgIHRvb2x0aXBzLmZvckVhY2godG9vbHRpcCA9PiB7DQogICAgICAgIGlmICh0b29sdGlwLnBhcmVudE5vZGUpIHsNCiAgICAgICAgICAgIHRvb2x0aXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0b29sdGlwKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIA0KICAgIC8vIFJlbW92ZSBnbG9iYWwgZXZlbnQgbGlzdGVuZXJzDQogICAgaWYgKHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIpIHsNCiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcik7DQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIgPSBudWxsOw0KICAgIH0NCiAgICANCiAgICAvLyBDbGVhciBhbnkgb3RoZXIgZ2xvYmFsIHJlZmVyZW5jZXMNCiAgICBpZiAod2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcikgew0KICAgICAgICBkZWxldGUgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcjsNCiAgICB9DQogICAgDQogICAgLy8gQWxzbyByZW1vdmUgYW55IHRvb2x0aXBzIHRoYXQgbWlnaHQgYmUgaW4gdGhlIGJvZHkNCiAgICBjb25zdCBib2R5VG9vbHRpcHMgPSBkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb25uZWN0aW9uLXRvb2x0aXAnKTsNCiAgICBib2R5VG9vbHRpcHMuZm9yRWFjaCh0b29sdGlwID0+IHsNCiAgICAgICAgaWYgKHRvb2x0aXAucGFyZW50Tm9kZSkgew0KICAgICAgICAgICAgdG9vbHRpcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRvb2x0aXApOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgY29uc29sZS5sb2coJ0Zsb3cgRWRpdG9yIGNsZWFudXAgY29tcGxldGVkJyk7DQp9DQoNCi8vIENvbm5lY3QgdG8gV2ViU29ja2V0IHNlcnZlcg0KYXN5bmMgZnVuY3Rpb24gY29ubmVjdFdlYlNvY2tldCgpIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBjb25uZWN0ZWQgPSBhd2FpdCBzeXBuZXhBUEkuY29ubmVjdFNvY2tldCgpOw0KICAgICAgICBpZiAoY29ubmVjdGVkKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGVkIHRvIFdlYlNvY2tldCBzZXJ2ZXInKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gSm9pbiBmbG93IGVkaXRvciByb29tDQogICAgICAgICAgICBzeXBuZXhBUEkuam9pblJvb20oJ2Zsb3ctZWRpdG9yJyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIExpc3RlbiBmb3IgbWVzc2FnZXMNCiAgICAgICAgICAgIHN5cG5leEFQSS5vbignZmxvd191cGRhdGUnLCAoZGF0YSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZWNlaXZlZCBmbG93IHVwZGF0ZTonLCBkYXRhKTsNCiAgICAgICAgICAgICAgICBoYW5kbGVGbG93VXBkYXRlKGRhdGEpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFNlbmQgaW5pdGlhbCBjb25uZWN0aW9uIG1lc3NhZ2UNCiAgICAgICAgICAgIHN5cG5leEFQSS5zZW5kTWVzc2FnZSgnZmxvd19jb25uZWN0ZWQnLCB7DQogICAgICAgICAgICAgICAgYXBwSWQ6IHN5cG5leEFQSS5nZXRBcHBJZCgpLA0KICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQ0KICAgICAgICAgICAgfSwgJ2Zsb3ctZWRpdG9yJyk7DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIFdlYlNvY2tldCBzZXJ2ZXInKTsNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBjb25uZWN0aW9uIGVycm9yOicsIGVycm9yKTsNCiAgICB9DQp9DQoNCi8vIEFkZCBhIG5ldyBub2RlIHRvIHRoZSBjYW52YXMgKGR5bmFtaWMgdmVyc2lvbikNCmZ1bmN0aW9uIGFkZE5vZGUodHlwZSkgew0KICAgIGNvbnN0IG5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUodHlwZSk7DQogICAgaWYgKCFub2RlRGVmKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Vua25vd24gbm9kZSB0eXBlOicsIHR5cGUpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGNvbnN0IG5vZGVJZCA9IGBub2RlXyR7KytmbG93RWRpdG9yLm5vZGVDb3VudGVyfWA7DQogICAgDQogICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIHJlbGF0aXZlIHRvIGN1cnJlbnQgdmlld3BvcnQgY2VudGVyDQogICAgY29uc3QgY2VudGVyID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFZpZXdwb3J0Q2VudGVySW5DYW52YXMoKSA6DQogICAgICAgIHsgeDogNTAwMCwgeTogNTAwMCB9OyAvLyBGYWxsYmFjayB0byBjYW52YXMgY2VudGVyDQogICAgDQogICAgLy8gQWRkIHNvbWUgcmFuZG9tIG9mZnNldCBhcm91bmQgdGhlIGNlbnRlcg0KICAgIGNvbnN0IG9mZnNldFggPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMDA7IC8vIC0xMDAgdG8gKzEwMA0KICAgIGNvbnN0IG9mZnNldFkgPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMDA7IC8vIC0xMDAgdG8gKzEwMA0KICAgIA0KICAgIGNvbnN0IG5vZGUgPSB7DQogICAgICAgIGlkOiBub2RlSWQsDQogICAgICAgIHR5cGU6IHR5cGUsDQogICAgICAgIHg6IGNlbnRlci54ICsgb2Zmc2V0WCwNCiAgICAgICAgeTogY2VudGVyLnkgKyBvZmZzZXRZLA0KICAgICAgICBjb25maWc6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobm9kZURlZi5jb25maWcpKSwgLy8gRGVlcCBjb3B5DQogICAgICAgIGRhdGE6IHt9DQogICAgfTsNCiAgICANCiAgICAvLyBJbml0aWFsaXplIHNwZWNpYWwgbm9kZSBzdGF0ZXMNCiAgICBpZiAodHlwZSA9PT0gJ3JlcGVhdGVyJykgew0KICAgICAgICBub2RlLnJlcGVhdGVyU3RhdGUgPSB7DQogICAgICAgICAgICBjb3VudDogMCwNCiAgICAgICAgICAgIGludGVydmFsOiBudWxsLA0KICAgICAgICAgICAgaXNSdW5uaW5nOiBmYWxzZQ0KICAgICAgICB9Ow0KICAgIH0NCiAgICANCiAgICBmbG93RWRpdG9yLm5vZGVzLnNldChub2RlSWQsIG5vZGUpOw0KICAgIA0KICAgIC8vIENyZWF0ZSBub2RlIGVsZW1lbnQgdXNpbmcgdGhlIHJlbmRlcmVyDQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBub2RlUmVuZGVyZXIuY3JlYXRlTm9kZUVsZW1lbnQobm9kZSk7DQogICAgZmxvd0VkaXRvci5jYW52YXMuYXBwZW5kQ2hpbGQobm9kZUVsZW1lbnQpOw0KICAgIA0KICAgIC8vIFNlbmQgdXBkYXRlIHZpYSBXZWJTb2NrZXQNCiAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS5zZW5kTWVzc2FnZSkgew0KICAgICAgICBzeXBuZXhBUEkuc2VuZE1lc3NhZ2UoJ25vZGVfYWRkZWQnLCB7DQogICAgICAgICAgICBub2RlSWQ6IG5vZGVJZCwNCiAgICAgICAgICAgIHR5cGU6IHR5cGUsDQogICAgICAgICAgICBwb3NpdGlvbjogeyB4OiBub2RlLngsIHk6IG5vZGUueSB9DQogICAgICAgIH0sICdmbG93LWVkaXRvcicpOw0KICAgIH0NCiAgICANCiAgICBjb25zb2xlLmxvZygnQWRkZWQgbm9kZTonLCBub2RlSWQsIHR5cGUpOw0KfQ0KDQovLyBIYW5kbGUgZmxvdyB1cGRhdGVzIGZyb20gV2ViU29ja2V0DQpmdW5jdGlvbiBoYW5kbGVGbG93VXBkYXRlKGRhdGEpIHsNCiAgICBjb25zb2xlLmxvZygnSGFuZGxpbmcgZmxvdyB1cGRhdGU6JywgZGF0YSk7DQogICAgLy8gSGFuZGxlIHJlYWwtdGltZSB1cGRhdGVzIGZyb20gb3RoZXIgaW5zdGFuY2VzDQp9DQoNCi8vIEluaXRpYWxpemUgd2hlbiBET00gaXMgcmVhZHkNCmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnbG9hZGluZycpIHsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaW5pdEZsb3dFZGl0b3IpOw0KfSBlbHNlIHsNCiAgICAvLyBET00gaXMgYWxyZWFkeSBsb2FkZWQNCiAgICBpbml0Rmxvd0VkaXRvcigpOw0KfQ0KDQoNCmNvbnNvbGUubG9nKCdGbG93IEVkaXRvciBzY3JpcHQgbG9hZGVkJyk7IDwvc2NyaXB0Pg=="
  },
  "package_info": {
    "format_version": "1.0",
    "created_at": "2025-07-22T01:20:49.958079",
    "packaged_by": "Sypnex OS App Packager",
    "source_directory": ".\\flow_editor"
  },
  "additional_files": [
    {
      "vfs_path": "/nodes/nodes-pack.json",
      "filename": "nodes-pack.json",
      "data": "ew0KICAidmVyc2lvbiI6ICIxLjAuMCIsDQogICJwYWNrZWRfYXQiOiAiMjAyNS0wNy0yMVQyMzo0MjowMC44MzYwMzMiLA0KICAidG90YWxfbm9kZXMiOiAxMywNCiAgIm5vZGVzIjogew0KICAgICJhdWRpbyI6IHsNCiAgICAgICJpZCI6ICJhdWRpbyIsDQogICAgICAibmFtZSI6ICJBdWRpbyBQbGF5ZXIiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXkgYXVkaW8gZmlsZXMgYW5kIGNvbnRyb2wgcGxheWJhY2siLA0KICAgICAgImljb24iOiAiZmFzIGZhLXZvbHVtZS11cCIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAibWVkaWEiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImZyb250ZW5kX29ubHkiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJpbmFyeSIsDQogICAgICAgICAgIm5hbWUiOiAiQmluYXJ5IiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYXVkaW9fZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiQXVkaW8gRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInVybCIsDQogICAgICAgICAgIm5hbWUiOiAiVVJMIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJiaW5hcnkiLA0KICAgICAgICAgICJuYW1lIjogIkJpbmFyeSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImF1ZGlvX2RhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkF1ZGlvIERhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJhdWRpb191cmwiLA0KICAgICAgICAgICJuYW1lIjogIkF1ZGlvIFVSTCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkdXJhdGlvbiIsDQogICAgICAgICAgIm5hbWUiOiAiRHVyYXRpb24iLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJvcmlnaW5hbCIsDQogICAgICAgICAgIm5hbWUiOiAiT3JpZ2luYWwiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJhdXRvUGxheSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJBdXRvIFBsYXkiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJmYWxzZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAidm9sdW1lIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIlZvbHVtZSAoMC0xKSIsDQogICAgICAgICAgInZhbHVlIjogMSwNCiAgICAgICAgICAibWluIjogMCwNCiAgICAgICAgICAibWF4IjogMSwNCiAgICAgICAgICAic3RlcCI6IDAuMQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImF1ZGlvX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJjb25kaXRpb24iOiB7DQogICAgICAiaWQiOiAiY29uZGl0aW9uIiwNCiAgICAgICJuYW1lIjogIkNvbmRpdGlvbiIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiQ29tcGFyZSBpbnB1dCB2YWx1ZSB0byBhIGNvbmRpdGlvbiBhbmQgb3V0cHV0IHRydWUvZmFsc2UiLA0KICAgICAgImljb24iOiAiZmFzIGZhLXF1ZXN0aW9uLWNpcmNsZSIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAibG9naWMiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ2YWx1ZSIsDQogICAgICAgICAgIm5hbWUiOiAiVmFsdWUiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJyZXN1bHQiLA0KICAgICAgICAgICJuYW1lIjogIlJlc3VsdCIsDQogICAgICAgICAgInR5cGUiOiAiYm9vbGVhbiINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJvcGVyYXRvciI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJPcGVyYXRvciIsDQogICAgICAgICAgInZhbHVlIjogImVxdWFscyIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAiZXF1YWxzIiwNCiAgICAgICAgICAgICJub3RfZXF1YWxzIiwNCiAgICAgICAgICAgICJncmVhdGVyX3RoYW4iLA0KICAgICAgICAgICAgImxlc3NfdGhhbiIsDQogICAgICAgICAgICAiZ3JlYXRlcl90aGFuX29yX2VxdWFsIiwNCiAgICAgICAgICAgICJsZXNzX3RoYW5fb3JfZXF1YWwiLA0KICAgICAgICAgICAgImNvbnRhaW5zIiwNCiAgICAgICAgICAgICJub3RfY29udGFpbnMiLA0KICAgICAgICAgICAgInN0YXJ0c193aXRoIiwNCiAgICAgICAgICAgICJlbmRzX3dpdGgiLA0KICAgICAgICAgICAgImlzX2VtcHR5IiwNCiAgICAgICAgICAgICJpc19ub3RfZW1wdHkiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiY29tcGFyZV92YWx1ZSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiQ29tcGFyZSBUbyIsDQogICAgICAgICAgInZhbHVlIjogIiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlZhbHVlIHRvIGNvbXBhcmUgYWdhaW5zdCINCiAgICAgICAgfSwNCiAgICAgICAgImNhc2Vfc2Vuc2l0aXZlIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkNhc2UgU2Vuc2l0aXZlIiwNCiAgICAgICAgICAidmFsdWUiOiAidHJ1ZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImNvbmRpdGlvbl9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAiZGlzcGxheSI6IHsNCiAgICAgICJpZCI6ICJkaXNwbGF5IiwNCiAgICAgICJuYW1lIjogIkRpc3BsYXkgVGV4dCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRGlzcGxheSB0ZXh0IGRhdGEgaW4gdmFyaW91cyBmb3JtYXRzIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1leWUiLA0KICAgICAgImNvbG9yIjogInN1Y2Nlc3MiLA0KICAgICAgImNhdGVnb3J5IjogIm91dHB1dCIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiZnJvbnRlbmRfb25seSIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJqc29uIiwNCiAgICAgICAgICAibmFtZSI6ICJKU09OIiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJpbmFyeSIsDQogICAgICAgICAgIm5hbWUiOiAiQmluYXJ5IiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGlzcGxheWVkIiwNCiAgICAgICAgICAibmFtZSI6ICJEaXNwbGF5ZWQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiaW5wdXRfcG9ydCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbnB1dCBQb3J0IiwNCiAgICAgICAgICAidmFsdWUiOiAiYXV0byIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAiYXV0byIsDQogICAgICAgICAgICAidGV4dCIsDQogICAgICAgICAgICAianNvbiIsDQogICAgICAgICAgICAiZGF0YSIsDQogICAgICAgICAgICAiYmluYXJ5Ig0KICAgICAgICAgIF0NCiAgICAgICAgfSwNCiAgICAgICAgImZvcm1hdCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJGb3JtYXQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0ZXh0IiwNCiAgICAgICAgICAgICJqc29uIiwNCiAgICAgICAgICAgICJodG1sIg0KICAgICAgICAgIF0NCiAgICAgICAgfSwNCiAgICAgICAgIm1heExlbmd0aCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJNYXggTGVuZ3RoIiwNCiAgICAgICAgICAidmFsdWUiOiAxMDAwLA0KICAgICAgICAgICJtaW4iOiAxLA0KICAgICAgICAgICJtYXgiOiAxMDAwMCwNCiAgICAgICAgICAic3RlcCI6IDEwMA0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImRpc3BsYXlfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgImh0dHAiOiB7DQogICAgICAiaWQiOiAiaHR0cCIsDQogICAgICAibmFtZSI6ICJIVFRQIFJlcXVlc3QiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIk1ha2UgSFRUUCByZXF1ZXN0cyB0byBleHRlcm5hbCBBUElzIGFuZCBzZXJ2aWNlcyIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtZ2xvYmUiLA0KICAgICAgImNvbG9yIjogInByaW1hcnkiLA0KICAgICAgImNhdGVnb3J5IjogIm5ldHdvcmsiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAianNvbiIsDQogICAgICAgICAgIm5hbWUiOiAiSlNPTiIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJiaW5hcnkiLA0KICAgICAgICAgICJuYW1lIjogIkJpbmFyeSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInN0YXR1c19jb2RlIiwNCiAgICAgICAgICAibmFtZSI6ICJTdGF0dXMgQ29kZSIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImhlYWRlcnMiLA0KICAgICAgICAgICJuYW1lIjogIkhlYWRlcnMiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidXJsIiwNCiAgICAgICAgICAibmFtZSI6ICJVUkwiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAidXJsIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJVUkwiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJodHRwczovL2pzb25wbGFjZWhvbGRlci50eXBpY29kZS5jb20vcG9zdHMvMSINCiAgICAgICAgfSwNCiAgICAgICAgIm1ldGhvZCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJNZXRob2QiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJHRVQiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgIkdFVCIsDQogICAgICAgICAgICAiUE9TVCIsDQogICAgICAgICAgICAiUFVUIiwNCiAgICAgICAgICAgICJERUxFVEUiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiaGVhZGVycyI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0YXJlYSIsDQogICAgICAgICAgImxhYmVsIjogIkhlYWRlcnMgKEpTT04pIiwNCiAgICAgICAgICAidmFsdWUiOiAie1wiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwifSINCiAgICAgICAgfSwNCiAgICAgICAgImJvZHkiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dGFyZWEiLA0KICAgICAgICAgICJsYWJlbCI6ICJCb2R5IChKU09OKSIsDQogICAgICAgICAgInZhbHVlIjogIntcIm1lc3NhZ2VcIjogXCJ7e1ZBTFVFfX1cIiwgXCJ0aW1lc3RhbXBcIjogXCJ7e0pTT046dGltZXN0YW1wfX1cIn0iDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAiaHR0cF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAiaW1hZ2UiOiB7DQogICAgICAiaWQiOiAiaW1hZ2UiLA0KICAgICAgIm5hbWUiOiAiSW1hZ2UgRGlzcGxheSIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRGlzcGxheSBpbWFnZXMgYW5kIGNvbnRyb2wgdmlzdWFsaXphdGlvbiIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtaW1hZ2UiLA0KICAgICAgImNvbG9yIjogImluZm8iLA0KICAgICAgImNhdGVnb3J5IjogIm1lZGlhIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJmcm9udGVuZF9vbmx5IiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJiaW5hcnkiLA0KICAgICAgICAgICJuYW1lIjogIkJpbmFyeSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImltYWdlX2RhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkltYWdlIERhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ1cmwiLA0KICAgICAgICAgICJuYW1lIjogIlVSTCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYmluYXJ5IiwNCiAgICAgICAgICAibmFtZSI6ICJCaW5hcnkiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJpbWFnZV9kYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJJbWFnZSBEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiaW1hZ2VfdXJsIiwNCiAgICAgICAgICAibmFtZSI6ICJJbWFnZSBVUkwiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGltZW5zaW9ucyIsDQogICAgICAgICAgIm5hbWUiOiAiRGltZW5zaW9ucyIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJvcmlnaW5hbCIsDQogICAgICAgICAgIm5hbWUiOiAiT3JpZ2luYWwiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJtYXhfcHJldmlld19zaXplIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIk1heCBQcmV2aWV3IFNpemUiLA0KICAgICAgICAgICJ2YWx1ZSI6IDMwMCwNCiAgICAgICAgICAibWluIjogNTAsDQogICAgICAgICAgIm1heCI6IDgwMCwNCiAgICAgICAgICAic3RlcCI6IDUwDQogICAgICAgIH0sDQogICAgICAgICJzaG93X2luZm8iOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiU2hvdyBJbmZvIiwNCiAgICAgICAgICAidmFsdWUiOiAidHJ1ZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImltYWdlX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJqc29uX2V4dHJhY3QiOiB7DQogICAgICAiaWQiOiAianNvbl9leHRyYWN0IiwNCiAgICAgICJuYW1lIjogIkpTT04gRXh0cmFjdCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRXh0cmFjdCB2YWx1ZXMgZnJvbSBKU09OIGRhdGEgdXNpbmcgZG90IG5vdGF0aW9uIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1jb2RlLWJyYW5jaCIsDQogICAgICAiY29sb3IiOiAiaW5mbyIsDQogICAgICAiY2F0ZWdvcnkiOiAiZGF0YSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAianNvbiIsDQogICAgICAgICAgIm5hbWUiOiAiSlNPTiIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJUZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJUZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImpzb24iLA0KICAgICAgICAgICJuYW1lIjogIkpTT04iLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZXh0cmFjdGVkX3ZhbHVlIiwNCiAgICAgICAgICAibmFtZSI6ICJFeHRyYWN0ZWQgVmFsdWUiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZmllbGRfcGF0aCIsDQogICAgICAgICAgIm5hbWUiOiAiRmllbGQgUGF0aCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJvcmlnaW5hbCIsDQogICAgICAgICAgIm5hbWUiOiAiT3JpZ2luYWwiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZmllbGRfcGF0aCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiRmllbGQgUGF0aCIsDQogICAgICAgICAgInZhbHVlIjogImRhdGEuaXRlbXMiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJVc2UgZG90IG5vdGF0aW9uIChlLmcuLCBkYXRhLml0ZW1zLjAubmFtZSkiDQogICAgICAgIH0sDQogICAgICAgICJkaXNwbGF5X2Zvcm1hdCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJEaXNwbGF5IEZvcm1hdCIsDQogICAgICAgICAgInZhbHVlIjogInRleHQiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRleHQiLA0KICAgICAgICAgICAgImpzb24iDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImpzb25fZXh0cmFjdF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAibGxtX2NoYXQiOiB7DQogICAgICAiaWQiOiAibGxtX2NoYXQiLA0KICAgICAgIm5hbWUiOiAiTExNIENoYXQiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIkNoYXQgd2l0aCBMYXJnZSBMYW5ndWFnZSBNb2RlbHMgdXNpbmcgT2xsYW1hIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1yb2JvdCIsDQogICAgICAiY29sb3IiOiAiaW5mbyIsDQogICAgICAiY2F0ZWdvcnkiOiAiYWkiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJwcm9tcHQiLA0KICAgICAgICAgICJuYW1lIjogIlByb21wdCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJzeXN0ZW1fbWVzc2FnZSIsDQogICAgICAgICAgIm5hbWUiOiAiU3lzdGVtIE1lc3NhZ2UiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiY29udGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiQ29udGV4dCIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInJlc3BvbnNlIiwNCiAgICAgICAgICAibmFtZSI6ICJSZXNwb25zZSIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0b2tlbnNfdXNlZCIsDQogICAgICAgICAgIm5hbWUiOiAiVG9rZW5zIFVzZWQiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJtb2RlbF91c2VkIiwNCiAgICAgICAgICAibmFtZSI6ICJNb2RlbCBVc2VkIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZ1bGxfcmVzcG9uc2UiLA0KICAgICAgICAgICJuYW1lIjogIkZ1bGwgUmVzcG9uc2UiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZW5kcG9pbnQiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIk9sbGFtYSBFbmRwb2ludCIsDQogICAgICAgICAgInZhbHVlIjogImh0dHA6Ly8xMjcuMC4wLjE6MTE0MzQvdjEiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJodHRwOi8vMTI3LjAuMC4xOjExNDM0L3YxIg0KICAgICAgICB9LA0KICAgICAgICAibW9kZWwiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIk1vZGVsIE5hbWUiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJIYW1tZXJBSS9tbi1tYWctbWVsbC1yMTpsYXRlc3QiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJsbGFtYTIsIGNvZGVsbGFtYSwgZXRjLiINCiAgICAgICAgfSwNCiAgICAgICAgInRlbXBlcmF0dXJlIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIlRlbXBlcmF0dXJlIiwNCiAgICAgICAgICAidmFsdWUiOiAwLjcsDQogICAgICAgICAgIm1pbiI6IDAsDQogICAgICAgICAgIm1heCI6IDIsDQogICAgICAgICAgInN0ZXAiOiAwLjENCiAgICAgICAgfSwNCiAgICAgICAgIm1heF90b2tlbnMiOiB7DQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICAgICAibGFiZWwiOiAiTWF4IFRva2VucyIsDQogICAgICAgICAgInZhbHVlIjogMjA0OCwNCiAgICAgICAgICAibWluIjogMSwNCiAgICAgICAgICAibWF4IjogODE5MiwNCiAgICAgICAgICAic3RlcCI6IDENCiAgICAgICAgfSwNCiAgICAgICAgInN5c3RlbV9wcm9tcHQiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dGFyZWEiLA0KICAgICAgICAgICJsYWJlbCI6ICJTeXN0ZW0gUHJvbXB0IiwNCiAgICAgICAgICAidmFsdWUiOiAiWW91IGFyZSBhIGhlbHBmdWwgQUkgYXNzaXN0YW50LiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIkRlZmluZSB0aGUgQUkncyByb2xlIGFuZCBiZWhhdmlvciINCiAgICAgICAgfSwNCiAgICAgICAgImluY2x1ZGVfY29udGV4dCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbmNsdWRlIENvbnRleHQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ0cnVlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAibGxtX2NoYXRfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgImxvZ2ljYWxfZ2F0ZSI6IHsNCiAgICAgICJpZCI6ICJsb2dpY2FsX2dhdGUiLA0KICAgICAgIm5hbWUiOiAiTG9naWNhbCBHYXRlIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPbmx5IGNvbnRpbnVlIGV4ZWN1dGlvbiBpZiBpbnB1dCBpcyB0cnVlIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1maWx0ZXIiLA0KICAgICAgImNvbG9yIjogImluZm8iLA0KICAgICAgImNhdGVnb3J5IjogImxvZ2ljIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiY29uZGl0aW9uIiwNCiAgICAgICAgICAibmFtZSI6ICJDb25kaXRpb24iLA0KICAgICAgICAgICJ0eXBlIjogImJvb2xlYW4iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImludmVydCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbnZlcnQgTG9naWMiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJmYWxzZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiZGVzY3JpcHRpb24iOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIkRlc2NyaXB0aW9uIiwNCiAgICAgICAgICAidmFsdWUiOiAiIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiT3B0aW9uYWwgZGVzY3JpcHRpb24gb2Ygd2hhdCB0aGlzIGdhdGUgZG9lcyINCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJsb2dpY2FsX2dhdGVfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgInJlcGVhdGVyIjogew0KICAgICAgImlkIjogInJlcGVhdGVyIiwNCiAgICAgICJuYW1lIjogIlJlcGVhdGVyIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJSZXBlYXQgY29ubmVjdGVkIHdvcmtmbG93IGF0IGludGVydmFscyIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtcmVkbyIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAidHJpZ2dlciIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImNvdW50IiwNCiAgICAgICAgICAibmFtZSI6ICJDb3VudCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImludGVydmFsIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkludGVydmFsIChtcykiLA0KICAgICAgICAgICJ2YWx1ZSI6IDEwMDAsDQogICAgICAgICAgIm1pbiI6IDEwMCwNCiAgICAgICAgICAibWF4IjogMzAwMDAwLA0KICAgICAgICAgICJzdGVwIjogMTAwDQogICAgICAgIH0sDQogICAgICAgICJjb3VudCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJDb3VudCAoMCA9IGluZmluaXRlKSIsDQogICAgICAgICAgInZhbHVlIjogMCwNCiAgICAgICAgICAibWluIjogMCwNCiAgICAgICAgICAic3RlcCI6IDENCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJyZXBlYXRlcl9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAidGV4dCI6IHsNCiAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIk91dHB1dCBzdGF0aWMgdGV4dCBjb250ZW50IiwNCiAgICAgICJpY29uIjogImZhcyBmYS1mb250IiwNCiAgICAgICJjb2xvciI6ICJzZWNvbmRhcnkiLA0KICAgICAgImNhdGVnb3J5IjogImRhdGEiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidXBwZXJjYXNlIiwNCiAgICAgICAgICAibmFtZSI6ICJVcHBlcmNhc2UiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAibG93ZXJjYXNlIiwNCiAgICAgICAgICAibmFtZSI6ICJMb3dlcmNhc2UiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAid29yZF9jb3VudCIsDQogICAgICAgICAgIm5hbWUiOiAiV29yZCBDb3VudCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImxlbmd0aCIsDQogICAgICAgICAgIm5hbWUiOiAiTGVuZ3RoIiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAidGV4dF9jb250ZW50Ijogew0KICAgICAgICAgICJ0eXBlIjogInRleHRhcmVhIiwNCiAgICAgICAgICAibGFiZWwiOiAiVGV4dCBDb250ZW50IiwNCiAgICAgICAgICAidmFsdWUiOiAiSGVsbG8sIFdvcmxkISINCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJ0ZXh0X2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJ0aW1lciI6IHsNCiAgICAgICJpZCI6ICJ0aW1lciIsDQogICAgICAibmFtZSI6ICJUaW1lciIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRGVsYXkgZXhlY3V0aW9uIGZvciBzcGVjaWZpZWQgbWlsbGlzZWNvbmRzIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1jbG9jayIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAidHJpZ2dlciIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0aW1lc3RhbXAiLA0KICAgICAgICAgICJuYW1lIjogIlRpbWVzdGFtcCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImVsYXBzZWQiLA0KICAgICAgICAgICJuYW1lIjogIkVsYXBzZWQiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJpbnRlcnZhbCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbnRlcnZhbCAobXMpIiwNCiAgICAgICAgICAidmFsdWUiOiAxMDAwLA0KICAgICAgICAgICJtaW4iOiAxMDAsDQogICAgICAgICAgIm1heCI6IDYwMDAwLA0KICAgICAgICAgICJzdGVwIjogMTAwDQogICAgICAgIH0sDQogICAgICAgICJjb3VudCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJDb3VudCIsDQogICAgICAgICAgInZhbHVlIjogMSwNCiAgICAgICAgICAibWluIjogMSwNCiAgICAgICAgICAibWF4IjogMTAwLA0KICAgICAgICAgICJzdGVwIjogMQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInRpbWVyX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJ2ZnNfbG9hZCI6IHsNCiAgICAgICJpZCI6ICJ2ZnNfbG9hZCIsDQogICAgICAibmFtZSI6ICJWRlMgTG9hZCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiTG9hZCBkYXRhIGZyb20gdGhlIFZpcnR1YWwgRmlsZSBTeXN0ZW0iLA0KICAgICAgImljb24iOiAiZmFzIGZhLWZvbGRlci1vcGVuIiwNCiAgICAgICJjb2xvciI6ICJwcmltYXJ5IiwNCiAgICAgICJjYXRlZ29yeSI6ICJzdG9yYWdlIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZmlsZV9wYXRoIiwNCiAgICAgICAgICAibmFtZSI6ICJGaWxlIFBhdGgiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZmlsZV9wYXRoIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJGaWxlIFBhdGgiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIvbXlfZGF0YS5qc29uIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiL2Fic29sdXRlL3BhdGgvaW4vdmZzIg0KICAgICAgICB9LA0KICAgICAgICAiZm9ybWF0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkZvcm1hdCIsDQogICAgICAgICAgInZhbHVlIjogImpzb24iLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgImpzb24iLA0KICAgICAgICAgICAgInRleHQiLA0KICAgICAgICAgICAgImJpbmFyeSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJhdXRvX3JlbG9hZCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJBdXRvIFJlbG9hZCBvbiBDaGFuZ2UiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJmYWxzZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInZmc19sb2FkX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJ2ZnNfc2F2ZSI6IHsNCiAgICAgICJpZCI6ICJ2ZnNfc2F2ZSIsDQogICAgICAibmFtZSI6ICJWRlMgU2F2ZSIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiU2F2ZSBkYXRhIHRvIHRoZSBWaXJ0dWFsIEZpbGUgU3lzdGVtIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1zYXZlIiwNCiAgICAgICJjb2xvciI6ICJwcmltYXJ5IiwNCiAgICAgICJjYXRlZ29yeSI6ICJzdG9yYWdlIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInN1Y2Nlc3MiLA0KICAgICAgICAgICJuYW1lIjogIlN1Y2Nlc3MiLA0KICAgICAgICAgICJ0eXBlIjogImJvb2xlYW4iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZmlsZV9wYXRoIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJGaWxlIFBhdGgiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIvbXlfZGF0YS5qc29uIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiL2Fic29sdXRlL3BhdGgvaW4vdmZzIg0KICAgICAgICB9LA0KICAgICAgICAiZm9ybWF0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkZvcm1hdCIsDQogICAgICAgICAgInZhbHVlIjogImpzb24iLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgImpzb24iLA0KICAgICAgICAgICAgInRleHQiLA0KICAgICAgICAgICAgImJpbmFyeSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJvdmVyd3JpdGUiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiT3ZlcndyaXRlIiwNCiAgICAgICAgICAidmFsdWUiOiAidHJ1ZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiYXBwZW5kIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkFwcGVuZCBNb2RlIiwNCiAgICAgICAgICAidmFsdWUiOiAiZmFsc2UiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRydWUiLA0KICAgICAgICAgICAgImZhbHNlIg0KICAgICAgICAgIF0NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJ2ZnNfc2F2ZV9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfQ0KICB9DQp9",
      "size": 21438
    }
  ]
}