{
  "app_metadata": {
    "id": "flow_editor",
    "name": "Flow Editor",
    "description": "Visual node-based workflow editor for creating and executing data processing pipelines",
    "icon": "fas fa-project-diagram",
    "keywords": [
      "flow",
      "workflow",
      "nodes",
      "pipeline",
      "visual",
      "editor"
    ],
    "author": "Sypnex OS",
    "version": "1.0.4",
    "type": "user_app",
    "scripts": [
      "js/utils.js",
      "js/node-registry.js",
      "js/canvas.js",
      "js/node-config.js",
      "js/node-renderer.js",
      "js/data-executors.js",
      "js/http-executors.js",
      "js/media-executors.js",
      "js/flow-executors.js",
      "js/ai-executors.js",
      "js/execution-engine.js",
      "js/workflow.js",
      "js/canvas-manager.js",
      "js/tag-manager.js",
      "js/file-manager.js",
      "js/ui-manager.js",
      "js/main.js"
    ],
    "styles": [
      "css/layout.css",
      "css/nodes.css",
      "css/components.css",
      "css/node-types.css",
      "css/responsive.css"
    ],
    "additional_files": [
      {
        "vfs_path": "/nodes/nodes-pack.json",
        "source_file": "node-definitions/nodes-pack.json"
      }
    ],
    "settings": [
      {
        "key": "DEFAULT_HTTP_TIMEOUT",
        "name": "HTTP Timeout (ms)",
        "type": "number",
        "value": 30000,
        "description": "Default timeout for HTTP requests in milliseconds"
      },
      {
        "key": "AUTO_SAVE_INTERVAL",
        "name": "Auto Save Interval (s)",
        "type": "number",
        "value": 30,
        "description": "Auto save workflows every N seconds (0 = disabled)"
      },
      {
        "key": "MAX_NODES",
        "name": "Maximum Nodes",
        "type": "number",
        "value": 50,
        "description": "Maximum number of nodes allowed in a workflow"
      }
    ]
  },
  "files": {
    "flow_editor.app": "ew0KICAiaWQiOiAiZmxvd19lZGl0b3IiLA0KICAibmFtZSI6ICJGbG93IEVkaXRvciIsDQogICJkZXNjcmlwdGlvbiI6ICJWaXN1YWwgbm9kZS1iYXNlZCB3b3JrZmxvdyBlZGl0b3IgZm9yIGNyZWF0aW5nIGFuZCBleGVjdXRpbmcgZGF0YSBwcm9jZXNzaW5nIHBpcGVsaW5lcyIsDQogICJpY29uIjogImZhcyBmYS1wcm9qZWN0LWRpYWdyYW0iLA0KICAia2V5d29yZHMiOiBbImZsb3ciLCAid29ya2Zsb3ciLCAibm9kZXMiLCAicGlwZWxpbmUiLCAidmlzdWFsIiwgImVkaXRvciJdLA0KICAiYXV0aG9yIjogIlN5cG5leCBPUyIsDQogICJ2ZXJzaW9uIjogIjEuMC40IiwNCiAgInR5cGUiOiAidXNlcl9hcHAiLA0KICAic2NyaXB0cyI6IFsNCiAgICAianMvdXRpbHMuanMiLA0KICAgICJqcy9ub2RlLXJlZ2lzdHJ5LmpzIiwNCiAgICAianMvY2FudmFzLmpzIiwNCiAgICAianMvbm9kZS1jb25maWcuanMiLA0KICAgICJqcy9ub2RlLXJlbmRlcmVyLmpzIiwNCiAgICAianMvZGF0YS1leGVjdXRvcnMuanMiLA0KICAgICJqcy9odHRwLWV4ZWN1dG9ycy5qcyIsDQogICAgImpzL21lZGlhLWV4ZWN1dG9ycy5qcyIsDQogICAgImpzL2Zsb3ctZXhlY3V0b3JzLmpzIiwNCiAgICAianMvYWktZXhlY3V0b3JzLmpzIiwNCiAgICAianMvZXhlY3V0aW9uLWVuZ2luZS5qcyIsDQogICAgImpzL3dvcmtmbG93LmpzIiwNCiAgICAianMvY2FudmFzLW1hbmFnZXIuanMiLA0KICAgICJqcy90YWctbWFuYWdlci5qcyIsDQogICAgImpzL2ZpbGUtbWFuYWdlci5qcyIsDQogICAgImpzL3VpLW1hbmFnZXIuanMiLA0KICAgICJqcy9tYWluLmpzIg0KICBdLA0KICAic3R5bGVzIjogWw0KICAgICJjc3MvbGF5b3V0LmNzcyIsDQogICAgImNzcy9ub2Rlcy5jc3MiLA0KICAgICJjc3MvY29tcG9uZW50cy5jc3MiLA0KICAgICJjc3Mvbm9kZS10eXBlcy5jc3MiLA0KICAgICJjc3MvcmVzcG9uc2l2ZS5jc3MiDQogIF0sDQogICJhZGRpdGlvbmFsX2ZpbGVzIjogWw0KICAgIHsNCiAgICAgICJ2ZnNfcGF0aCI6ICIvbm9kZXMvbm9kZXMtcGFjay5qc29uIiwNCiAgICAgICJzb3VyY2VfZmlsZSI6ICJub2RlLWRlZmluaXRpb25zL25vZGVzLXBhY2suanNvbiINCiAgICB9DQogIF0sDQogICJzZXR0aW5ncyI6IFsNCiAgICB7DQogICAgICAia2V5IjogIkRFRkFVTFRfSFRUUF9USU1FT1VUIiwNCiAgICAgICJuYW1lIjogIkhUVFAgVGltZW91dCAobXMpIiwNCiAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAidmFsdWUiOiAzMDAwMCwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEZWZhdWx0IHRpbWVvdXQgZm9yIEhUVFAgcmVxdWVzdHMgaW4gbWlsbGlzZWNvbmRzIg0KICAgIH0sDQogICAgew0KICAgICAgImtleSI6ICJBVVRPX1NBVkVfSU5URVJWQUwiLA0KICAgICAgIm5hbWUiOiAiQXV0byBTYXZlIEludGVydmFsIChzKSIsDQogICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgInZhbHVlIjogMzAsDQogICAgICAiZGVzY3JpcHRpb24iOiAiQXV0byBzYXZlIHdvcmtmbG93cyBldmVyeSBOIHNlY29uZHMgKDAgPSBkaXNhYmxlZCkiDQogICAgfSwNCiAgICB7DQogICAgICAia2V5IjogIk1BWF9OT0RFUyIsDQogICAgICAibmFtZSI6ICJNYXhpbXVtIE5vZGVzIiwNCiAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAidmFsdWUiOiA1MCwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJNYXhpbXVtIG51bWJlciBvZiBub2RlcyBhbGxvd2VkIGluIGEgd29ya2Zsb3ciDQogICAgfQ0KICBdDQp9",
    "flow_editor.html": "PGRpdiBjbGFzcz0iYXBwLWNvbnRhaW5lciI+DQogICAgPGRpdiBjbGFzcz0iYXBwLWhlYWRlciI+DQogICAgICAgIDxoMj48aSBjbGFzcz0iZmFzIGZhLXByb2plY3QtZGlhZ3JhbSI+PC9pPiBGbG93IEVkaXRvcjwvaDI+DQogICAgICAgIDxwPkNyZWF0ZSBhbmQgZXhlY3V0ZSBub2RlLWJhc2VkIHdvcmtmbG93cyAtIE5PVCBQUk9EVUNUSU9OIFJFQURZPC9wPg0KICAgIDwvZGl2Pg0KDQogICAgPGRpdiBjbGFzcz0iYXBwLWNvbnRlbnQiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LWVkaXRvciI+DQogICAgICAgICAgICA8IS0tIExlZnQgVG9vbGJveCAtLT4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctdG9vbGJveCIgaWQ9ImZsb3ctdG9vbGJveCI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbGJveC1oZWFkZXIiPg0KICAgICAgICAgICAgICAgICAgICA8aDQ+PGkgY2xhc3M9ImZhcyBmYS10b29scyI+PC9pPiBOb2RlczwvaDQ+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InRvZ2dsZS10b29sYm94IiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJDb2xsYXBzZSBUb29sYm94Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1sZWZ0Ij48L2k+DQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2xib3gtY29udGVudCIgaWQ9InRvb2xib3gtY29udGVudCI+DQogICAgICAgICAgICAgICAgICAgIDwhLS0gTm9kZXMgd2lsbCBiZSBsb2FkZWQgZHluYW1pY2FsbHkgZnJvbSBWRlMgLS0+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxvYWRpbmctbm9kZXMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbXV0ZWQiPkxvYWRpbmcgbm9kZXMuLi48L3A+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgIDwhLS0gTWFpbiB3b3Jrc3BhY2UgLS0+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LXdvcmtzcGFjZSI+DQogICAgICAgICAgICAgICAgPCEtLSBUb29sYmFyIC0tPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctdG9vbGJhciI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2xiYXItbGVmdCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJydW4td29ya2Zsb3ciIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGxheSI+PC9pPiBSdW4gV29ya2Zsb3cNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3RvcC13b3JrZmxvdyIgY2xhc3M9ImJ0biBidG4tZGFuZ2VyIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc3RvcCI+PC9pPiBTdG9wDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImN1cnJlbnQtZmlsZS1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iY3VycmVudC1maWxlbmFtZSIgY2xhc3M9ImN1cnJlbnQtZmlsZW5hbWUiPnVudGl0bGVkLmZsb3c8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sYmFyLXJpZ2h0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImFkZC10YWciIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc3VjY2VzcyIgdGl0bGU9IkFkZCBBcmVhIFRhZyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10YWciPjwvaT4gVGFnDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InJlc2V0LXBhbiIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJSZXNldCBWaWV3IChQYW4gJiBab29tKSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jcm9zc2hhaXJzIj48L2k+IFJlc2V0IFZpZXcNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iem9vbS1jb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iem9vbS1vdXQiIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0aXRsZT0iWm9vbSBPdXQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNlYXJjaC1taW51cyI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJ6b29tLWxldmVsIiBjbGFzcz0iem9vbS1sZXZlbCI+MTAwJTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJ6b29tLWluIiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgdGl0bGU9Ilpvb20gSW4iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNlYXJjaC1wbHVzIj48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iem9vbS1maXQiIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0aXRsZT0iWm9vbSB0byBGaXQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4cGFuZC1hcnJvd3MtYWx0Ij48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InNhdmUtZmxvdyIgY2xhc3M9ImJ0biBidG4tcHJpbWFyeSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYXZlIj48L2k+IFNhdmUNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic2F2ZS1mbG93LWFzIiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXByaW1hcnkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2F2ZSI+PC9pPiBTYXZlIEFzDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImxvYWQtZmxvdyIgY2xhc3M9ImJ0biBidG4tc2Vjb25kYXJ5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWZvbGRlci1vcGVuIj48L2k+IExvYWQNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZGVsZXRlLXNlbGVjdGVkIiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLWRhbmdlciI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPiBEZWxldGUNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY2xlYXItY2FudmFzIiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10cmFzaC1hbHQiPjwvaT4gQ2xlYXIgQWxsDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgICAgICA8IS0tIE1haW4gY2FudmFzIGFyZWEgLS0+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy1jYW52YXMtY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iZmxvdy1jYW52YXMiIGNsYXNzPSJmbG93LWNhbnZhcyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIE5vZGVzIHdpbGwgYmUgYWRkZWQgaGVyZSBkeW5hbWljYWxseSAtLT4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgICAgPCEtLSBDb25maWd1cmF0aW9uIHBhbmVsIC0tPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy1jb25maWctcGFuZWwiIGlkPSJmbG93LWNvbmZpZy1wYW5lbCI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLWhlYWRlciI+DQogICAgICAgICAgICAgICAgICAgIDxoND48aSBjbGFzcz0iZmFzIGZhLWNvZyI+PC9pPiBDb25maWd1cmF0aW9uPC9oND4NCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0idG9nZ2xlLWNvbmZpZyIgY2xhc3M9ImJ0biBidG4tc20gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0aXRsZT0iQ29sbGFwc2UgQ29uZmlndXJhdGlvbiBQYW5lbCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tcmlnaHQiPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLWNvbnRlbnQiIGlkPSJjb25maWctY29udGVudCI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9Im5vZGUtY29uZmlnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LW11dGVkIj5TZWxlY3QgYSBub2RlIHRvIGNvbmZpZ3VyZSBpdDwvcD4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InRhZy1wYW5lbCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aDU+PGkgY2xhc3M9ImZhcyBmYS10YWdzIj48L2k+IEFyZWEgVGFnczwvaDU+DQogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1tdXRlZCI+Tm8gdGFncyB5ZXQ8L3A+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIDwhLS0gT3V0cHV0IHBhbmVsIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LW91dHB1dC1wYW5lbCBjb2xsYXBzZWQiIGlkPSJmbG93LW91dHB1dC1wYW5lbCI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJvdXRwdXQtaGVhZGVyIj4NCiAgICAgICAgICAgICAgICA8aDQ+PGkgY2xhc3M9ImZhcyBmYS10ZXJtaW5hbCI+PC9pPiBFeGVjdXRpb24gT3V0cHV0PC9oND4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvdXRwdXQtY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJ0b2dnbGUtb3V0cHV0IiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJTaG93L0hpZGUgT3V0cHV0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIj48L2k+DQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJjbGVhci1vdXRwdXQiIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRyYXNoIj48L2k+IENsZWFyDQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJvdXRwdXQtY29udGVudCIgaWQ9Im91dHB1dC1jb250ZW50IiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImV4ZWN1dGlvbi1vdXRwdXQiIGNsYXNzPSJleGVjdXRpb24tb3V0cHV0Ij4NCiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbXV0ZWQiPldvcmtmbG93IG91dHB1dCB3aWxsIGFwcGVhciBoZXJlPC9wPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KPC9kaXY+DQo8c3R5bGU+LyogPT09PT0gU3R5bGU6IGNzcy9sYXlvdXQuY3NzID09PT09ICovDQovKiBGbG93IEVkaXRvciBMYXlvdXQgJiBTdHJ1Y3R1cmUgKi8NCg0KLyogRmxvdyBFZGl0b3IgTGF5b3V0ICovDQouZmxvdy1lZGl0b3Igew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgaGVpZ2h0OiA3MHZoOw0KICAgIGdhcDogMDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA4cHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KDQovKiBMZWZ0IFRvb2xib3ggKi8NCi5mbG93LXRvb2xib3ggew0KICAgIHdpZHRoOiAyNTBweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBmbGV4LXNocmluazogMDsNCn0NCg0KLnRvb2xib3gtaGVhZGVyIHsNCiAgICBwYWRkaW5nOiAxNXB4Ow0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi50b29sYm94LWhlYWRlciBoNCB7DQogICAgbWFyZ2luOiAwOw0KICAgIGZvbnQtc2l6ZTogMTZweDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA4cHg7DQp9DQoNCiN0b2dnbGUtdG9vbGJveCB7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQp9DQoNCiN0b2dnbGUtdG9vbGJveDpob3ZlciB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tYm9yZGVyLWNvbG9yKTsNCn0NCg0KLyogQ29sbGFwc2VkIHN0YXRlICovDQouZmxvdy10b29sYm94LmNvbGxhcHNlZCB7DQogICAgd2lkdGg6IDUwcHg7DQp9DQoNCi5mbG93LXRvb2xib3guY29sbGFwc2VkIC50b29sYm94LWNvbnRlbnQgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5mbG93LXRvb2xib3guY29sbGFwc2VkIC50b29sYm94LWhlYWRlciBoNCB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLnRvb2xib3gtY29udGVudCB7DQogICAgZmxleDogMTsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KICAgIHBhZGRpbmc6IDEwcHg7DQp9DQoNCi8qIE1haW4gV29ya3NwYWNlICovDQouZmxvdy13b3Jrc3BhY2Ugew0KICAgIGZsZXg6IDE7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIG1pbi13aWR0aDogMDsNCn0NCg0KLyogVG9vbGJhciAqLw0KLmZsb3ctdG9vbGJhciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBwYWRkaW5nOiAxMnB4IDIwcHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgZmxleC1zaHJpbms6IDA7DQp9DQoNCi50b29sYmFyLWxlZnQgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZ2FwOiAxMHB4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi5jdXJyZW50LWZpbGUtaW5mbyB7DQogICAgbWFyZ2luLWxlZnQ6IDE1cHg7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KfQ0KDQouY3VycmVudC1maWxlbmFtZSB7DQogICAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi50b29sYmFyLXJpZ2h0IHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGdhcDogOHB4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi8qIFpvb20gQ29udHJvbHMgKi8NCi56b29tLWNvbnRyb2xzIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA0cHg7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDZweDsNCn0NCg0KLnpvb20tbGV2ZWwgew0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogNTAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBtaW4td2lkdGg6IDQwcHg7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHVzZXItc2VsZWN0OiBub25lOw0KfQ0KDQouem9vbS1jb250cm9scyBidXR0b24gew0KICAgIHBhZGRpbmc6IDRweCA2cHg7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KLnpvb20tY29udHJvbHMgYnV0dG9uOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ib3JkZXItY29sb3IpOw0KfQ0KDQouem9vbS1jb250cm9scyBidXR0b246YWN0aXZlIHsNCiAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOTUpOw0KfQ0KDQovKiBDYW52YXMgQ29udGFpbmVyICovDQouZmxvdy1jYW52YXMtY29udGFpbmVyIHsNCiAgICBmbGV4OiAxOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KDQouZmxvdy1jYW52YXMgew0KICAgIHdpZHRoOiAxMDAwMHB4Ow0KICAgIGhlaWdodDogMTAwMDBweDsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgYmFja2dyb3VuZDogDQogICAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMjBweCAyMHB4LCB2YXIoLS1ib3JkZXItY29sb3IpIDFweCwgdHJhbnNwYXJlbnQgMXB4KSwNCiAgICAgICAgcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCA0MHB4IDQwcHgsIHZhcigtLWJvcmRlci1jb2xvcikgMXB4LCB0cmFuc3BhcmVudCAxcHgpOw0KICAgIGJhY2tncm91bmQtc2l6ZTogNDBweCA0MHB4Ow0KICAgIGN1cnNvcjogZ3JhYjsNCiAgICB0cmFuc2Zvcm0tb3JpZ2luOiAwIDA7DQogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsNCn0NCg0KLmZsb3ctY2FudmFzOmFjdGl2ZSB7DQogICAgY3Vyc29yOiBncmFiYmluZzsNCn0NCg0KLmZsb3ctY2FudmFzLnBhbm5pbmcgew0KICAgIGN1cnNvcjogZ3JhYmJpbmc7DQp9DQoNCi8qIENvbmZpZ3VyYXRpb24gUGFuZWwgKi8NCi5mbG93LWNvbmZpZy1wYW5lbCB7DQogICAgd2lkdGg6IDMwMHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgZmxleC1zaHJpbms6IDA7DQp9DQoNCi5jb25maWctaGVhZGVyIHsNCiAgICBwYWRkaW5nOiAxNXB4Ow0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi5jb25maWctaGVhZGVyIGg0IHsNCiAgICBtYXJnaW46IDA7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDhweDsNCn0NCg0KI3RvZ2dsZS1jb25maWcgew0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQojdG9nZ2xlLWNvbmZpZzpob3ZlciB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tYm9yZGVyLWNvbG9yKTsNCn0NCg0KLyogQ29sbGFwc2VkIHN0YXRlICovDQouZmxvdy1jb25maWctcGFuZWwuY29sbGFwc2VkIHsNCiAgICB3aWR0aDogNTBweDsNCn0NCg0KLmZsb3ctY29uZmlnLXBhbmVsLmNvbGxhcHNlZCAuY29uZmlnLWNvbnRlbnQgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5mbG93LWNvbmZpZy1wYW5lbC5jb2xsYXBzZWQgLmNvbmZpZy1oZWFkZXIgaDQgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5jb25maWctY29udGVudCB7DQogICAgZmxleDogMTsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KICAgIHBhZGRpbmc6IDE1cHg7DQp9DQoNCi8qIE91dHB1dCBQYW5lbCAqLw0KLmZsb3ctb3V0cHV0LXBhbmVsIHsNCiAgICBtYXJnaW4tdG9wOiAxMHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIG92ZXJmbG93OiBoaWRkZW47DQp9DQoNCi5vdXRwdXQtaGVhZGVyIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHBhZGRpbmc6IDEycHggMTVweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCn0NCg0KLm91dHB1dC1oZWFkZXIgaDQgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LXNpemU6IDE2cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KfQ0KDQoub3V0cHV0LWNvbnRlbnQgew0KICAgIHBhZGRpbmc6IDE1cHg7DQogICAgbWF4LWhlaWdodDogMjAwcHg7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCn0NCg0KLmZsb3ctb3V0cHV0LXBhbmVsLmNvbGxhcHNlZCAub3V0cHV0LWNvbnRlbnQgew0KICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsNCn0NCg0KLmZsb3ctb3V0cHV0LXBhbmVsIC5vdXRwdXQtaGVhZGVyIHsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi5mbG93LW91dHB1dC1wYW5lbCAub3V0cHV0LWNvbnRyb2xzIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGdhcDogOHB4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCg0KLyogPT09PT0gU3R5bGU6IGNzcy9ub2Rlcy5jc3MgPT09PT0gKi8NCi8qIEZsb3cgRWRpdG9yIE5vZGVzICYgQ29ubmVjdGlvbnMgKi8NCg0KLyogTm9kZSBTdHlsZXMgKi8NCi5mbG93LW5vZGUgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBtaW4td2lkdGg6IDE1MHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIHBhZGRpbmc6IDEwcHg7DQogICAgY3Vyc29yOiBncmFiOw0KICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMSk7DQogICAgdHJhbnNpdGlvbjogYm94LXNoYWRvdyAwLjJzIGVhc2UsIHRyYW5zZm9ybSAwLjFzIGVhc2U7DQogICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsNCn0NCg0KLmZsb3ctbm9kZTphY3RpdmUgew0KICAgIGN1cnNvcjogZ3JhYmJpbmc7DQogICAgdHJhbnNpdGlvbjogbm9uZTsNCn0NCg0KLmZsb3ctbm9kZTpob3ZlciB7DQogICAgYm94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuMTUpOw0KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsNCn0NCg0KLmZsb3ctbm9kZS5zZWxlY3RlZCB7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBib3gtc2hhZG93OiAwIDAgMCAycHggcmdiYSh2YXIoLS1wcmltYXJ5LWNvbG9yLXJnYiksIDAuMik7DQp9DQoNCi5mbG93LW5vZGUtaGVhZGVyIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA4cHg7DQogICAgbWFyZ2luLWJvdHRvbTogOHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoNCi5ub2RlLWRlbGV0ZS1idG4gew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICByaWdodDogLTVweDsNCiAgICB0b3A6IC01cHg7DQogICAgd2lkdGg6IDIwcHg7DQogICAgaGVpZ2h0OiAyMHB4Ow0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGZvbnQtc2l6ZTogMTBweDsNCiAgICBvcGFjaXR5OiAwOw0KICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4ycyBlYXNlOw0KICAgIHotaW5kZXg6IDEwOw0KfQ0KDQouZmxvdy1ub2RlOmhvdmVyIC5ub2RlLWRlbGV0ZS1idG4gew0KICAgIG9wYWNpdHk6IDE7DQp9DQoNCi5ub2RlLWRlbGV0ZS1idG46aG92ZXIgew0KICAgIGJhY2tncm91bmQ6ICNkMzJmMmY7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOw0KfQ0KDQouZmxvdy1ub2RlLXR5cGUgew0KICAgIHBhZGRpbmc6IDJweCA2cHg7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgIGJhY2tncm91bmQ6ICM2Yzc1N2Q7DQogICAgY29sb3I6IHdoaXRlOw0KfQ0KDQouZmxvdy1ub2RlLWNvbnRlbnQgew0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQp9DQoNCi5mbG93LW5vZGUtcG9ydHMgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQp9DQoNCi5mbG93LW5vZGUtcG9ydCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMnB4Ow0KICAgIGhlaWdodDogMTJweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDJweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgcG9pbnRlci1ldmVudHM6IGFsbDsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnQ6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnQuaW5wdXQgew0KICAgIGxlZnQ6IC02cHg7DQogICAgdG9wOiA1MCU7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnQub3V0cHV0IHsNCiAgICByaWdodDogLTZweDsNCiAgICB0b3A6IDUwJTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7DQp9DQoNCi8qIENvbm5lY3Rpb24gTGluZXMgKi8NCi5mbG93LWNvbm5lY3Rpb24gew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCiAgICB6LWluZGV4OiAxOw0KfQ0KDQouZmxvdy1jb25uZWN0aW9uLWxpbmUgew0KICAgIHN0cm9rZTogdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBzdHJva2Utd2lkdGg6IDg7DQogICAgZmlsbDogbm9uZTsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KICAgIG9wYWNpdHk6IDAuNjsgLyogU2xpZ2h0bHkgdHJhbnNwYXJlbnQgYnkgZGVmYXVsdCAqLw0KfQ0KDQouZmxvdy1jb25uZWN0aW9uLWxpbmU6aG92ZXIgew0KICAgIHN0cm9rZTogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgb3BhY2l0eTogMTsNCiAgICBzdHJva2Utd2lkdGg6IDEwOw0KfQ0KDQouZmxvdy1jb25uZWN0aW9uLWxpbmUuY29ubmVjdGVkIHsNCiAgICBzdHJva2U6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIG9wYWNpdHk6IDAuODsNCn0NCg0KLyogUnVubmluZyBTdGF0ZSAqLw0KLmZsb3ctbm9kZS5ydW5uaW5nIHsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KICAgIGFuaW1hdGlvbjogcHVsc2UgMnMgaW5maW5pdGU7DQp9DQoNCkBrZXlmcmFtZXMgcHVsc2Ugew0KICAgIDAlIHsgYm94LXNoYWRvdzogMCAwIDAgMCByZ2JhKHZhcigtLXN1Y2Nlc3MtY29sb3ItcmdiKSwgMC40KTsgfQ0KICAgIDcwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDEwcHggcmdiYSh2YXIoLS1zdWNjZXNzLWNvbG9yLXJnYiksIDApOyB9DQogICAgMTAwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDAgcmdiYSh2YXIoLS1zdWNjZXNzLWNvbG9yLXJnYiksIDApOyB9DQp9DQoNCg0KLyogPT09PT0gU3R5bGU6IGNzcy9jb21wb25lbnRzLmNzcyA9PT09PSAqLw0KLyogRmxvdyBFZGl0b3IgVUkgQ29tcG9uZW50cyAqLw0KDQovKiBOb2RlIENhdGVnb3J5IFRvb2xib3ggKi8NCi5ub2RlLWNhdGVnb3J5IHsNCiAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KfQ0KDQoubm9kZS1jYXRlZ29yeSBoNSB7DQogICAgbWFyZ2luOiAwIDAgMTBweCAwOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOw0KICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsNCiAgICBwYWRkaW5nOiAwIDVweDsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG4gew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDEwcHg7DQogICAgcGFkZGluZzogMTJweCAxNXB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgICBjdXJzb3I6IGdyYWI7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCiAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi50b29sYm94LW5vZGUtYnRuOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xKTsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG46YWN0aXZlIHsNCiAgICBjdXJzb3I6IGdyYWJiaW5nOw0KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG4gaSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KICAgIHdpZHRoOiAyMHB4Ow0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG4gc3BhbiB7DQogICAgZmxleDogMTsNCiAgICBmb250LXdlaWdodDogNTAwOw0KfQ0KDQovKiBCdXR0b25zICovDQouZmxvdy10b29sYmFyIC5idG4gew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDZweDsNCiAgICBwYWRkaW5nOiA4cHggMTJweDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYm9yZGVyLXJhZGl1czogNnB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuOmhvdmVyIHsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xKTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLW91dGxpbmUtZGFuZ2VyIHsNCiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLW91dGxpbmUtZGFuZ2VyOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KfQ0KDQouZmxvdy10b29sYmFyIC5idG4tb3V0bGluZS1zZWNvbmRhcnkgew0KICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQouZmxvdy10b29sYmFyIC5idG4tb3V0bGluZS1zZWNvbmRhcnk6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQovKiBDb25maWd1cmF0aW9uIFN0eWxlcyAqLw0KLmNvbmZpZy1ncm91cCB7DQogICAgbWFyZ2luLWJvdHRvbTogMTVweDsNCn0NCg0KLmNvbmZpZy1ncm91cCBsYWJlbCB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luLWJvdHRvbTogNXB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCn0NCg0KLmNvbmZpZy1ncm91cCBpbnB1dCB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4ycyBlYXNlOw0KfQ0KDQouY29uZmlnLWdyb3VwIHNlbGVjdCB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZ2xhc3MtYm9yZGVyKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLWdsYXNzLWJnKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi5jb25maWctZ3JvdXAgaW5wdXQ6Zm9jdXMgew0KICAgIG91dGxpbmU6IG5vbmU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBib3gtc2hhZG93OiAwIDAgMCAycHggcmdiYSh2YXIoLS1wcmltYXJ5LWNvbG9yLXJnYiksIDAuMSk7DQp9DQoNCi5jb25maWctZ3JvdXAgc2VsZWN0OmZvY3VzIHsNCiAgICBvdXRsaW5lOiBub25lOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDIxMiwgMjU1LCAwLjA1KTsNCn0NCg0KLmNvbmZpZy1ncm91cCBzZWxlY3Qgb3B0aW9uIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWJnKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQp9DQoNCi5jb25maWctZ3JvdXAgc2VsZWN0IG9wdGlvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZ2xhc3MtYmcpOw0KfQ0KDQouY29uZmlnLWdyb3VwIHRleHRhcmVhIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiA4cHggMTJweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHJlc2l6ZTogdmVydGljYWw7DQogICAgbWluLWhlaWdodDogODBweDsNCiAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOw0KfQ0KDQovKiBUYWcgUGFuZWwgKi8NCiN0YWctcGFuZWwgew0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgcGFkZGluZy10b3A6IDIwcHg7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCiN0YWctcGFuZWwgaDUgew0KICAgIG1hcmdpbjogMCAwIDE1cHggMDsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KfQ0KDQoudGFnLWl0ZW0gew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDEwcHg7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgbWFyZ2luLWJvdHRvbTogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNnB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQoudGFnLWl0ZW06aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOw0KfQ0KDQoudGFnLWNvbG9yIHsNCiAgICB3aWR0aDogMTJweDsNCiAgICBoZWlnaHQ6IDEycHg7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGZsZXgtc2hyaW5rOiAwOw0KfQ0KDQoudGFnLWluZm8gew0KICAgIGZsZXg6IDE7DQogICAgbWluLXdpZHRoOiAwOw0KfQ0KDQoudGFnLW5hbWUgew0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgZm9udC1zaXplOiAxM3B4Ow0KICAgIG1hcmdpbi1ib3R0b206IDJweDsNCn0NCg0KLnRhZy1kZXNjcmlwdGlvbiB7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIG9wYWNpdHk6IDAuNzsNCn0NCg0KLnRhZy1kZWxldGUgew0KICAgIGJhY2tncm91bmQ6IG5vbmU7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGNvbG9yOiBpbmhlcml0Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBwYWRkaW5nOiA0cHg7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG9wYWNpdHk6IDAuNjsNCiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMnMgZWFzZTsNCn0NCg0KLnRhZy1kZWxldGU6aG92ZXIgew0KICAgIG9wYWNpdHk6IDE7DQogICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjEpOw0KfQ0KDQovKiBPdXRwdXQgU3R5bGVzICovDQouZXhlY3V0aW9uLW91dHB1dCB7DQogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsNCiAgICBmb250LXNpemU6IDEzcHg7DQogICAgbGluZS1oZWlnaHQ6IDEuNDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi5leGVjdXRpb24tb3V0cHV0IC5sb2ctZW50cnkgew0KICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICBwYWRkaW5nOiA0cHggMDsNCn0NCg0KLmV4ZWN1dGlvbi1vdXRwdXQgLmxvZy1lbnRyeS5pbmZvIHsNCiAgICBjb2xvcjogdmFyKC0taW5mby1jb2xvcik7DQp9DQoNCi5leGVjdXRpb24tb3V0cHV0IC5sb2ctZW50cnkuc3VjY2VzcyB7DQogICAgY29sb3I6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KfQ0KDQouZXhlY3V0aW9uLW91dHB1dCAubG9nLWVudHJ5LmVycm9yIHsNCiAgICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KfQ0KDQouZXhlY3V0aW9uLW91dHB1dCAubG9nLWVudHJ5Lndhcm5pbmcgew0KICAgIGNvbG9yOiB2YXIoLS13YXJuaW5nLWNvbG9yKTsNCn0NCg0KLyogSW5wdXQvT3V0cHV0IE1hcHBpbmdzIENvbmZpZ3VyYXRpb24gU3R5bGVzICovDQouaW5wdXQtbWFwcGluZ3MtY29uZmlnLA0KLm91dHB1dC1tYXBwaW5ncy1jb25maWcgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBtYXJnaW4tdG9wOiA0cHg7DQp9DQoNCi5pbnB1dC1tYXBwaW5nLWNvbmZpZywNCi5vdXRwdXQtbWFwcGluZy1jb25maWcgew0KICAgIG1hcmdpbi1ib3R0b206IDhweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjAyKTsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCn0NCg0KLmlucHV0LW1hcHBpbmctY29uZmlnOmxhc3QtY2hpbGQsDQoub3V0cHV0LW1hcHBpbmctY29uZmlnOmxhc3QtY2hpbGQgew0KICAgIG1hcmdpbi1ib3R0b206IDA7DQp9DQoNCi5pbnB1dC1tYXBwaW5nLWNvbmZpZyBsYWJlbCwNCi5vdXRwdXQtbWFwcGluZy1jb25maWcgbGFiZWwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBtYXJnaW4tYm90dG9tOiA0cHg7DQp9DQoNCi5pbnB1dC1tYXBwaW5nLXNlbGVjdCwNCi5vdXRwdXQtbWFwcGluZy1zZWxlY3Qgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCn0NCg0KLmlucHV0LW1hcHBpbmctc2VsZWN0OmZvY3VzLA0KLm91dHB1dC1tYXBwaW5nLXNlbGVjdDpmb2N1cyB7DQogICAgb3V0bGluZTogbm9uZTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIGJveC1zaGFkb3c6IDAgMCAwIDJweCByZ2JhKDAsIDEyMywgMjU1LCAwLjEpOw0KfQ0KDQovKiBMZWdhY3kgc3R5bGVzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5ICovDQouaW5wdXQtbWFwcGluZ3Mgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBtYXJnaW4tdG9wOiA0cHg7DQp9DQoNCi5pbnB1dC1tYXBwaW5nIHsNCiAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDRweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBsaW5lLWhlaWdodDogMS4yOw0KfQ0KDQouaW5wdXQtbWFwcGluZzpsYXN0LWNoaWxkIHsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQouaW5wdXQtbWFwcGluZyAuc291cmNlLW5vZGUgew0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQp9DQoNCi5pbnB1dC1tYXBwaW5nIC5zb3VyY2UtcG9ydCB7DQogICAgb3BhY2l0eTogMC44Ow0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCn0NCg0KDQovKiA9PT09PSBTdHlsZTogY3NzL25vZGUtdHlwZXMuY3NzID09PT09ICovDQovKiBGbG93IEVkaXRvciBOb2RlIFR5cGUgU3BlY2lmaWMgU3R5bGVzICovDQoNCi8qIERpc3BsYXkgTm9kZSBDb250ZW50ICovDQouZGlzcGxheS1jb250ZW50IHsNCiAgICBwYWRkaW5nOiA4cHg7DQp9DQoNCi5kaXNwbGF5LXRleHQgew0KICAgIG1pbi1oZWlnaHQ6IDQwcHg7DQogICAgbWF4LWhlaWdodDogMjAwcHg7DQogICAgd2lkdGg6IDIyMHB4Ow0KICAgIG92ZXJmbG93LXk6IGF1dG87DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjA1KTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDhweDsNCiAgICByZXNpemU6IG5vbmU7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KLmRpc3BsYXktdGV4dCBwcmUgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOw0KICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsNCiAgICB3b3JkLWJyZWFrOiBicmVhay13b3JkOw0KICAgIHVzZXItc2VsZWN0OiB0ZXh0Ow0KfQ0KDQouZGlzcGxheS1mb3JtYXQgew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KfQ0KDQovKiBBdWRpbyBQbGF5ZXIgU3R5bGVzICovDQouYXVkaW8tY29udHJvbHMgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDEwcHg7DQogICAgbWFyZ2luLXRvcDogMTBweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjA1KTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQp9DQoNCi5hdWRpby1wbGF5LWJ0biwNCi5hdWRpby1zdG9wLWJ0biB7DQogICAgd2lkdGg6IDMycHg7DQogICAgaGVpZ2h0OiAzMnB4Ow0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KLmF1ZGlvLXBsYXktYnRuIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQp9DQoNCi5hdWRpby1zdG9wLWJ0biB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCn0NCg0KLmF1ZGlvLXBsYXktYnRuOmhvdmVyLA0KLmF1ZGlvLXN0b3AtYnRuOmhvdmVyIHsNCiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4yKTsNCn0NCg0KLmF1ZGlvLXN0YXR1cyB7DQogICAgZmxleDogMTsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLyogSlNPTiBFeHRyYWN0IERpc3BsYXkgKi8NCi5qc29uLWV4dHJhY3QtZGlzcGxheSB7DQogICAgbWFyZ2luLXRvcDogMTBweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjA1KTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQp9DQoNCi5leHRyYWN0LWxhYmVsIHsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIG1hcmdpbi1ib3R0b206IDRweDsNCiAgICBmb250LXdlaWdodDogNTAwOw0KfQ0KDQouZXh0cmFjdC12YWx1ZSB7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsNCiAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDNweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KfQ0KDQouZXh0cmFjdC12YWx1ZS5zdWNjZXNzIHsNCiAgICBjb2xvcjogdmFyKC0tc3VjY2Vzcy1jb2xvcik7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCn0NCg0KLmV4dHJhY3QtdmFsdWUuZXJyb3Igew0KICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQp9DQoNCi8qIFJlcGVhdGVyIE5vZGUgU3R5bGVzICovDQoucmVwZWF0ZXItY29udGVudCB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA4cHg7DQogICAgcGFkZGluZzogOHB4Ow0KfQ0KDQoucmVwZWF0ZXItc3RhdHVzIHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgbWluLXdpZHRoOiA4MHB4Ow0KfQ0KDQoucmVwZWF0ZXItc3RhdHVzLnN0b3BwZWQgew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4xKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQp9DQoNCi5yZXBlYXRlci1zdGF0dXMucnVubmluZyB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VjY2Vzcy1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KICAgIGFuaW1hdGlvbjogcHVsc2UgMnMgaW5maW5pdGU7DQp9DQoNCi5yZXBlYXRlci1jb250cm9scyB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBnYXA6IDhweDsNCn0NCg0KLnJlcGVhdGVyLXN0YXJ0LWJ0biwNCi5yZXBlYXRlci1zdG9wLWJ0biB7DQogICAgd2lkdGg6IDI4cHg7DQogICAgaGVpZ2h0OiAyOHB4Ow0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KLnJlcGVhdGVyLXN0YXJ0LWJ0biB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VjY2Vzcy1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KfQ0KDQoucmVwZWF0ZXItc3RvcC1idG4gew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQp9DQoNCi5yZXBlYXRlci1zdGFydC1idG46aG92ZXIsDQoucmVwZWF0ZXItc3RvcC1idG46aG92ZXIgew0KICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsNCiAgICBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjIpOw0KfQ0KDQovKiBJbWFnZSBOb2RlIFN0eWxlcyAqLw0KLmltYWdlLWNvbnRhaW5lciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA4cHg7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIG1pbi1oZWlnaHQ6IDEyMHB4Ow0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KfQ0KDQouaW1hZ2UtdGh1bWJuYWlsIHsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBvYmplY3QtZml0OiBjb250YWluOw0KICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzIGVhc2U7DQp9DQoNCi5pbWFnZS10aHVtYm5haWw6aG92ZXIgew0KICAgIHRyYW5zZm9ybTogc2NhbGUoMS4wNSk7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4yKTsNCn0NCg0KLmltYWdlLWluZm8gew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wNSk7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgd2lkdGg6IDEwMCU7DQp9DQoNCi5pbWFnZS1lcnJvciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA0cHg7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi5pbWFnZS1lcnJvciBpIHsNCiAgICBmb250LXNpemU6IDE2cHg7DQp9DQoNCi8qIEltYWdlIE1vZGFsIFN0eWxlcyAqLw0KLmltYWdlLW1vZGFsIHsNCiAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgdG9wOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC44KTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgei1pbmRleDogMTAwMDsNCiAgICBwYWRkaW5nOiAyMHB4Ow0KfQ0KDQouaW1hZ2UtbW9kYWwtY29udGVudCB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIG1heC13aWR0aDogOTAlOw0KICAgIG1heC1oZWlnaHQ6IDkwJTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIGJveC1zaGFkb3c6IDAgNHB4IDIwcHggcmdiYSgwLDAsMCwwLjMpOw0KfQ0KDQouaW1hZ2UtbW9kYWwtaGVhZGVyIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHBhZGRpbmc6IDE1cHggMjBweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCn0NCg0KLmltYWdlLW1vZGFsLWhlYWRlciBzcGFuIHsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCn0NCg0KLmltYWdlLW1vZGFsLWNsb3NlIHsNCiAgICBiYWNrZ3JvdW5kOiBub25lOw0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBmb250LXNpemU6IDI0cHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBwYWRkaW5nOiAwOw0KICAgIHdpZHRoOiAzMHB4Ow0KICAgIGhlaWdodDogMzBweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQp9DQoNCi5pbWFnZS1tb2RhbC1jbG9zZTpob3ZlciB7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjEpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCn0NCg0KLmltYWdlLW1vZGFsLWJvZHkgew0KICAgIHBhZGRpbmc6IDIwcHg7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiAxNXB4Ow0KICAgIG1heC1oZWlnaHQ6IGNhbGMoOTB2aCAtIDEwMHB4KTsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KfQ0KDQouaW1hZ2UtbW9kYWwtaW1hZ2Ugew0KICAgIG1heC13aWR0aDogMTAwJTsNCiAgICBtYXgtaGVpZ2h0OiA3MHZoOw0KICAgIG9iamVjdC1maXQ6IGNvbnRhaW47DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMSk7DQp9DQoNCi5pbWFnZS1tb2RhbC1pbmZvIHsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgcGFkZGluZzogMTBweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLyogUmFuZG9tIFF1b3RlIE5vZGUgU3R5bGVzICovDQoucXVvdGUtY29udGVudCB7DQogICAgcGFkZGluZzogMTBweDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi5xdW90ZS10ZXh0IHsNCiAgICBtYXJnaW4tYm90dG9tOiA4cHg7DQogICAgbWluLWhlaWdodDogNDBweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQp9DQoNCi5xdW90ZS1kaXNwbGF5IHsNCiAgICBtYXJnaW46IDA7DQogICAgZm9udC1zdHlsZTogaXRhbGljOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBmb250LXNpemU6IDEzcHg7DQogICAgbGluZS1oZWlnaHQ6IDEuNDsNCiAgICBtYXgtd2lkdGg6IDEwMCU7DQogICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KfQ0KDQoucXVvdGUtaW5mbyB7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBwYWRkaW5nLXRvcDogOHB4Ow0KfQ0KDQovKiBMTE0gQ2hhdCBOb2RlIFN0eWxlcyAqLw0KLmxsbS1yZXNwb25zZSB7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMjMsIDE2MiwgMTg0LCAwLjEpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBtYXJnaW46IDRweCAwOw0KfQ0KDQoucmVzcG9uc2UtcHJldmlldyB7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGxpbmUtaGVpZ2h0OiAxLjM7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICBtYXJnaW4tYm90dG9tOiA0cHg7DQp9DQoNCi51c2FnZS1pbmZvIHsNCiAgICBmb250LXNpemU6IDEwcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDAsMCwwLDAuMSk7DQogICAgcGFkZGluZy10b3A6IDRweDsNCn0NCg0KLmxsbS1lcnJvciB7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMjIwLCA1MywgNjksIDAuMSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG1hcmdpbjogNHB4IDA7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogNnB4Ow0KfQ0KDQoubGxtLWVycm9yIGkgew0KICAgIGZvbnQtc2l6ZTogMTRweDsNCn0NCg0KLyogVGV4dCBOb2RlIFN0eWxlcyAqLw0KLnRleHQtY29udGVudCB7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMTA4LCAxMTcsIDEyNSwgMC4xKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgbWFyZ2luOiA0cHggMDsNCn0NCg0KLnRleHQtcHJldmlldyB7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGxpbmUtaGVpZ2h0OiAxLjM7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICBtYXJnaW4tYm90dG9tOiA0cHg7DQp9DQoNCi50ZXh0LWluZm8gew0KICAgIGZvbnQtc2l6ZTogMTBweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHJnYmEoMCwwLDAsMC4xKTsNCiAgICBwYWRkaW5nLXRvcDogNHB4Ow0KfQ0KDQovKiBOb2RlIFN0YXR1cyBEaXNwbGF5ICovDQoubm9kZS1zdGF0dXMgew0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBtYXJnaW46IDRweCAwOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLnN0YXR1cy10ZXh0IHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgbWFyZ2luLWJvdHRvbTogNHB4Ow0KfQ0KDQouc3RhdHVzLWluZm8gew0KICAgIGZvbnQtc2l6ZTogMTBweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQp9DQoNCi8qIENvbnRlbnQgRGlzcGxheSBpbiBDb25maWcgUGFuZWwgKi8NCi5jb250ZW50LWRpc3BsYXkgew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wNSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHBhZGRpbmc6IDEycHg7DQogICAgbWFyZ2luLXRvcDogOHB4Ow0KfQ0KDQouY29udGVudC10ZXh0IHsNCiAgICBtYXJnaW46IDA7DQogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgbGluZS1oZWlnaHQ6IDEuNDsNCiAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7DQogICAgd29yZC1icmVhazogYnJlYWstd29yZDsNCiAgICBtYXgtaGVpZ2h0OiAzMDBweDsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICB1c2VyLXNlbGVjdDogdGV4dDsNCn0NCg0KLmNvbnRlbnQtaW5mbyB7DQogICAgbWFyZ2luLXRvcDogOHB4Ow0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQovKiBUZXJtaW5hbCBOb2RlIFN0eWxlcyAqLw0KLnRlcm1pbmFsLWVycm9yIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgyMjAsIDUzLCA2OSwgMC4xKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIG1hcmdpbi10b3A6IDhweDsNCn0NCg0KLnRlcm1pbmFsLWVycm9yIGkgew0KICAgIG1hcmdpbi1yaWdodDogOHB4Ow0KICAgIGNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQp9DQoNCg0KLyogPT09PT0gU3R5bGU6IGNzcy9yZXNwb25zaXZlLmNzcyA9PT09PSAqLw0KLyogRmxvdyBFZGl0b3IgUmVzcG9uc2l2ZSBEZXNpZ24gJiBFZmZlY3RzICovDQoNCi8qIFJlc3BvbnNpdmUgRGVzaWduICovDQpAbWVkaWEgKG1heC13aWR0aDogMTIwMHB4KSB7DQogICAgLmZsb3ctZWRpdG9yIHsNCiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgaGVpZ2h0OiBhdXRvOw0KICAgIH0NCiAgICANCiAgICAuZmxvdy10b29sYm94IHsNCiAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgIGhlaWdodDogYXV0bzsNCiAgICAgICAgYm9yZGVyLXJpZ2h0OiBub25lOw0KICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICB9DQogICAgDQogICAgLnRvb2xib3gtY29udGVudCB7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIGZsZXgtd3JhcDogd3JhcDsNCiAgICAgICAgZ2FwOiAxMHB4Ow0KICAgICAgICBwYWRkaW5nOiAxNXB4Ow0KICAgIH0NCiAgICANCiAgICAubm9kZS1jYXRlZ29yeSB7DQogICAgICAgIG1hcmdpbi1ib3R0b206IDA7DQogICAgICAgIGZsZXg6IDE7DQogICAgICAgIG1pbi13aWR0aDogMjAwcHg7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LWNvbmZpZy1wYW5lbCB7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICBib3JkZXItbGVmdDogbm9uZTsNCiAgICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgfQ0KfQ0KDQpAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsNCiAgICAuZmxvdy10b29sYmFyIHsNCiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgZ2FwOiAxMHB4Ow0KICAgIH0NCiAgICANCiAgICAudG9vbGJhci1sZWZ0LA0KICAgIC50b29sYmFyLXJpZ2h0IHsNCiAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIH0NCiAgICANCiAgICAuZmxvdy10b29sYmFyIC5idG4gew0KICAgICAgICBmb250LXNpemU6IDEycHg7DQogICAgICAgIHBhZGRpbmc6IDZweCAxMHB4Ow0KICAgIH0NCn0NCjwvc3R5bGU+DQo8c2NyaXB0Pi8vID09PT09IFNjcmlwdDoganMvdXRpbHMuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL25vZGUtcmVnaXN0cnkuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL2NhbnZhcy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvbm9kZS1jb25maWcuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL25vZGUtcmVuZGVyZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL2RhdGEtZXhlY3V0b3JzLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9odHRwLWV4ZWN1dG9ycy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvbWVkaWEtZXhlY3V0b3JzLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9mbG93LWV4ZWN1dG9ycy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvYWktZXhlY3V0b3JzLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9leGVjdXRpb24tZW5naW5lLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy93b3JrZmxvdy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvY2FudmFzLW1hbmFnZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL3RhZy1tYW5hZ2VyLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9maWxlLW1hbmFnZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL3VpLW1hbmFnZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL21haW4uanMgPT09PT0NCg0KDQovLyB1dGlscy5qcyAtIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBGbG93IEVkaXRvcg0KDQovLyBTY2FsZSBjb21wZW5zYXRpb24gdXRpbGl0aWVzDQpsZXQgYXBwU2NhbGUgPSAxLjA7DQoNCi8vIERldGVjdCB0aGUgY3VycmVudCBhcHAgc2NhbGUgZnJvbSBDU1MgdHJhbnNmb3JtDQpmdW5jdGlvbiBkZXRlY3RBcHBTY2FsZSgpIHsNCiAgICB0cnkgew0KICAgICAgICAvLyBGaW5kIHRoZSBhcHAgd2luZG93IGNvbnRhaW5lcg0KICAgICAgICBjb25zdCBhcHBXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXBwLXdpbmRvdycpOw0KICAgICAgICBpZiAoIWFwcFdpbmRvdykgew0KICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ05vIGFwcCB3aW5kb3cgZm91bmQsIGFzc3VtaW5nIDEwMCUgc2NhbGUnKTsNCiAgICAgICAgICAgIHJldHVybiAxLjA7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDaGVjayBmb3Igc2NhbGUgY2xhc3Nlcw0KICAgICAgICBjb25zdCBzY2FsZUNsYXNzZXMgPSBbJ3NjYWxlLTc1JywgJ3NjYWxlLTgwJywgJ3NjYWxlLTg1JywgJ3NjYWxlLTkwJywgJ3NjYWxlLTk1JywNCiAgICAgICAgICAgICdzY2FsZS0xMDAnLCAnc2NhbGUtMTA1JywgJ3NjYWxlLTExMCcsICdzY2FsZS0xMTUnLCAnc2NhbGUtMTIwJywNCiAgICAgICAgICAgICdzY2FsZS0xMjUnLCAnc2NhbGUtMTMwJywgJ3NjYWxlLTEzNScsICdzY2FsZS0xNDAnLCAnc2NhbGUtMTQ1JywgJ3NjYWxlLTE1MCddOw0KDQogICAgICAgIGZvciAoY29uc3Qgc2NhbGVDbGFzcyBvZiBzY2FsZUNsYXNzZXMpIHsNCiAgICAgICAgICAgIGlmIChhcHBXaW5kb3cuY2xhc3NMaXN0LmNvbnRhaW5zKHNjYWxlQ2xhc3MpKSB7DQogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVWYWx1ZSA9IHBhcnNlSW50KHNjYWxlQ2xhc3MucmVwbGFjZSgnc2NhbGUtJywgJycpKTsNCiAgICAgICAgICAgICAgICBhcHBTY2FsZSA9IHNjYWxlVmFsdWUgLyAxMDA7DQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYERldGVjdGVkIGFwcCBzY2FsZTogJHtzY2FsZVZhbHVlfSUgKCR7YXBwU2NhbGV9KWApOw0KICAgICAgICAgICAgICAgIHJldHVybiBhcHBTY2FsZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEZhbGxiYWNrOiBjaGVjayBjb21wdXRlZCB0cmFuc2Zvcm0NCiAgICAgICAgY29uc3QgY29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGFwcFdpbmRvdyk7DQogICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IGNvbXB1dGVkU3R5bGUudHJhbnNmb3JtOw0KICAgICAgICBpZiAodHJhbnNmb3JtICYmIHRyYW5zZm9ybSAhPT0gJ25vbmUnKSB7DQogICAgICAgICAgICAvLyBQYXJzZSB0cmFuc2Zvcm0gbWF0cml4IHRvIGV4dHJhY3Qgc2NhbGUNCiAgICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IHRyYW5zZm9ybS5tYXRjaCgvbWF0cml4XCgoW14pXSspXCkvKTsNCiAgICAgICAgICAgIGlmIChtYXRyaXgpIHsNCiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBtYXRyaXhbMV0uc3BsaXQoJywnKS5tYXAodiA9PiBwYXJzZUZsb2F0KHYudHJpbSgpKSk7DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlcy5sZW5ndGggPj0gNCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBNYXRyaXggZm9ybWF0OiBtYXRyaXgoYSwgYiwgYywgZCwgdHgsIHR5KSB3aGVyZSBhIGFuZCBkIGFyZSBzY2FsZSBmYWN0b3JzDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlWCA9IHZhbHVlc1swXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVZID0gdmFsdWVzWzNdOw0KICAgICAgICAgICAgICAgICAgICBhcHBTY2FsZSA9IChzY2FsZVggKyBzY2FsZVkpIC8gMjsgLy8gQXZlcmFnZSBvZiBYIGFuZCBZIHNjYWxlDQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBEZXRlY3RlZCBhcHAgc2NhbGUgZnJvbSB0cmFuc2Zvcm06ICR7YXBwU2NhbGV9YCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhcHBTY2FsZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBjb25zb2xlLmxvZygnTm8gc2NhbGUgZGV0ZWN0ZWQsIHVzaW5nIDEwMCUnKTsNCiAgICAgICAgcmV0dXJuIDEuMDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZXRlY3RpbmcgYXBwIHNjYWxlOicsIGVycm9yKTsNCiAgICAgICAgcmV0dXJuIDEuMDsNCiAgICB9DQp9DQoNCi8vIEdldCB0aGUgdG90YWwgZWZmZWN0aXZlIHNjYWxlIChhcHAgc2NhbGUgw5cgem9vbSBzY2FsZSkNCmZ1bmN0aW9uIGdldEVmZmVjdGl2ZVNjYWxlKCkgew0KICAgIGNvbnN0IGFwcFNjYWxlID0gZGV0ZWN0QXBwU2NhbGUoKTsNCiAgICBjb25zdCB6b29tU2NhbGUgPSAodHlwZW9mIGZsb3dFZGl0b3IgIT09ICd1bmRlZmluZWQnICYmIGZsb3dFZGl0b3Iuem9vbUxldmVsKSA/IGZsb3dFZGl0b3Iuem9vbUxldmVsIDogMS4wOw0KICAgIHJldHVybiBhcHBTY2FsZSAqIHpvb21TY2FsZTsNCn0NCg0KLy8gQ29udmVydCBzY3JlZW4gY29vcmRpbmF0ZXMgdG8gYXBwIGNvb3JkaW5hdGVzIChhY2NvdW50aW5nIGZvciBib3RoIGFwcCBzY2FsZSBhbmQgem9vbSkNCmZ1bmN0aW9uIHNjcmVlblRvQXBwQ29vcmRzKHNjcmVlblgsIHNjcmVlblkpIHsNCiAgICBjb25zdCBzY2FsZSA9IGdldEVmZmVjdGl2ZVNjYWxlKCk7DQogICAgcmV0dXJuIHsNCiAgICAgICAgeDogc2NyZWVuWCAvIHNjYWxlLA0KICAgICAgICB5OiBzY3JlZW5ZIC8gc2NhbGUNCiAgICB9Ow0KfQ0KDQovLyBDb252ZXJ0IGFwcCBjb29yZGluYXRlcyB0byBzY3JlZW4gY29vcmRpbmF0ZXMgKGFjY291bnRpbmcgZm9yIGJvdGggYXBwIHNjYWxlIGFuZCB6b29tKQ0KZnVuY3Rpb24gYXBwVG9TY3JlZW5Db29yZHMoYXBwWCwgYXBwWSkgew0KICAgIGNvbnN0IHNjYWxlID0gZ2V0RWZmZWN0aXZlU2NhbGUoKTsNCiAgICByZXR1cm4gew0KICAgICAgICB4OiBhcHBYICogc2NhbGUsDQogICAgICAgIHk6IGFwcFkgKiBzY2FsZQ0KICAgIH07DQp9DQoNCi8vIEdldCBzY2FsZWQgZWxlbWVudCByZWN0IChjb21wZW5zYXRlcyBmb3IgYXBwIHNjYWxpbmcgYW5kIHpvb20pDQpmdW5jdGlvbiBnZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QoZWxlbWVudCkgew0KICAgIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIGNvbnN0IGFwcFNjYWxlID0gZGV0ZWN0QXBwU2NhbGUoKTsNCiAgICAvLyBOb3RlOiBEb24ndCBpbmNsdWRlIHpvb20gc2NhbGUgaGVyZSBhcyBnZXRCb3VuZGluZ0NsaWVudFJlY3QgYWxyZWFkeSBhY2NvdW50cyBmb3IgQ1NTIHRyYW5zZm9ybXMNCg0KICAgIHJldHVybiB7DQogICAgICAgIGxlZnQ6IHJlY3QubGVmdCAvIGFwcFNjYWxlLA0KICAgICAgICB0b3A6IHJlY3QudG9wIC8gYXBwU2NhbGUsDQogICAgICAgIHJpZ2h0OiByZWN0LnJpZ2h0IC8gYXBwU2NhbGUsDQogICAgICAgIGJvdHRvbTogcmVjdC5ib3R0b20gLyBhcHBTY2FsZSwNCiAgICAgICAgd2lkdGg6IHJlY3Qud2lkdGggLyBhcHBTY2FsZSwNCiAgICAgICAgaGVpZ2h0OiByZWN0LmhlaWdodCAvIGFwcFNjYWxlLA0KICAgICAgICB4OiByZWN0LnggLyBhcHBTY2FsZSwNCiAgICAgICAgeTogcmVjdC55IC8gYXBwU2NhbGUNCiAgICB9Ow0KfQ0KDQovLyBHZXQgc2NhbGVkIG1vdXNlIGNvb3JkaW5hdGVzIGZyb20gZXZlbnQgKGNvbXBlbnNhdGVzIGZvciBhcHAgc2NhbGluZyBvbmx5KQ0KZnVuY3Rpb24gZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgew0KICAgIGNvbnN0IGFwcFNjYWxlID0gZGV0ZWN0QXBwU2NhbGUoKTsNCiAgICByZXR1cm4gew0KICAgICAgICB4OiBlLmNsaWVudFggLyBhcHBTY2FsZSwNCiAgICAgICAgeTogZS5jbGllbnRZIC8gYXBwU2NhbGUNCiAgICB9Ow0KfQ0KDQovLyBJbml0aWFsaXplIHNjYWxlIGRldGVjdGlvbg0KZnVuY3Rpb24gaW5pdFNjYWxlRGV0ZWN0aW9uKCkgew0KICAgIC8vIERldGVjdCBzY2FsZSBvbiBpbml0aWFsaXphdGlvbg0KICAgIGRldGVjdEFwcFNjYWxlKCk7DQoNCiAgICAvLyBMaXN0ZW4gZm9yIHNjYWxlIGNoYW5nZXMgKGlmIHRoZSBhcHAgc2NhbGUgY2hhbmdlcyBkeW5hbWljYWxseSkNCiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHsNCiAgICAgICAgbXV0YXRpb25zLmZvckVhY2goKG11dGF0aW9uKSA9PiB7DQogICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2F0dHJpYnV0ZXMnICYmIG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUgPT09ICdjbGFzcycpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBvbGRTY2FsZSA9IGFwcFNjYWxlOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5ld1NjYWxlID0gZGV0ZWN0QXBwU2NhbGUoKTsNCiAgICAgICAgICAgICAgICBpZiAob2xkU2NhbGUgIT09IG5ld1NjYWxlKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBBcHAgc2NhbGUgY2hhbmdlZCBmcm9tICR7b2xkU2NhbGV9IHRvICR7bmV3U2NhbGV9YCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgYW55IG5lY2Vzc2FyeSB1cGRhdGVzDQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVkcmF3QWxsQ29ubmVjdGlvbnMgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0pOw0KDQogICAgLy8gT2JzZXJ2ZSB0aGUgYXBwIHdpbmRvdyBmb3IgY2xhc3MgY2hhbmdlcw0KICAgIGNvbnN0IGFwcFdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hcHAtd2luZG93Jyk7DQogICAgaWYgKGFwcFdpbmRvdykgew0KICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGFwcFdpbmRvdywgew0KICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwNCiAgICAgICAgICAgIGF0dHJpYnV0ZUZpbHRlcjogWydjbGFzcyddDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIHJldHVybiBvYnNlcnZlcjsNCn0NCg0KLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBlc2NhcGUgSFRNTA0KZnVuY3Rpb24gZXNjYXBlSHRtbCh0ZXh0KSB7DQogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgZGl2LnRleHRDb250ZW50ID0gdGV4dDsNCiAgICByZXR1cm4gZGl2LmlubmVySFRNTDsNCn0NCg0KLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBmb3JtYXQgZmlsZSBzaXplDQpmdW5jdGlvbiBmb3JtYXRGaWxlU2l6ZShieXRlcykgew0KICAgIGlmIChieXRlcyA9PT0gMCkgcmV0dXJuICcwIEJ5dGVzJzsNCiAgICBjb25zdCBrID0gMTAyNDsNCiAgICBjb25zdCBzaXplcyA9IFsnQnl0ZXMnLCAnS0InLCAnTUInLCAnR0InXTsNCiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhrKSk7DQogICAgcmV0dXJuIHBhcnNlRmxvYXQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMikpICsgJyAnICsgc2l6ZXNbaV07DQp9DQoNCi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gZGVib3VuY2UgZnVuY3Rpb24gY2FsbHMNCmZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMsIHdhaXQpIHsNCiAgICBsZXQgdGltZW91dDsNCiAgICByZXR1cm4gZnVuY3Rpb24gZXhlY3V0ZWRGdW5jdGlvbiguLi5hcmdzKSB7DQogICAgICAgIGNvbnN0IGxhdGVyID0gKCkgPT4gew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOw0KICAgICAgICAgICAgZnVuYyguLi5hcmdzKTsNCiAgICAgICAgfTsNCiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOw0KICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7DQogICAgfTsNCn0NCg0KDQovLyBIZWxwZXIgbWV0aG9kIGZvciB0ZW1wbGF0ZSBwcm9jZXNzaW5nDQpmdW5jdGlvbiBwcm9jZXNzVGVtcGxhdGVzKHRlbXBsYXRlLCBkYXRhKSB7DQogICAgLy8gU2ltcGxlIHRlbXBsYXRlIHByb2Nlc3NpbmcgLSBjYW4gYmUgZW5oYW5jZWQNCiAgICBsZXQgcmVzdWx0ID0gdGVtcGxhdGU7DQogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0Jykgew0KICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhkYXRhKSkgew0KICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UobmV3IFJlZ0V4cChge3ske2tleX19fWAsICdnJyksIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQovLyBIZWxwZXIgbWV0aG9kIGZvciBleHRyYWN0aW5nIG5lc3RlZCBKU09OIHZhbHVlcw0KZnVuY3Rpb24gZXh0cmFjdE5lc3RlZFZhbHVlKG9iaiwgcGF0aCkgew0KICAgIGNvbnN0IGtleXMgPSBwYXRoLnNwbGl0KCcuJyk7DQogICAgbGV0IGN1cnJlbnQgPSBvYmo7DQoNCiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7DQogICAgICAgIGlmIChjdXJyZW50ID09PSBudWxsIHx8IGN1cnJlbnQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBIYW5kbGUgYXJyYXkgYWNjZXNzIGxpa2UgIml0ZW1zWzBdLm5hbWUiDQogICAgICAgIGNvbnN0IGFycmF5TWF0Y2ggPSBrZXkubWF0Y2goL14oLispXFsoXGQrKVxdJC8pOw0KICAgICAgICBpZiAoYXJyYXlNYXRjaCkgew0KICAgICAgICAgICAgY29uc3QgYXJyYXlLZXkgPSBhcnJheU1hdGNoWzFdOw0KICAgICAgICAgICAgY29uc3QgYXJyYXlJbmRleCA9IHBhcnNlSW50KGFycmF5TWF0Y2hbMl0pOw0KDQogICAgICAgICAgICBpZiAoY3VycmVudFthcnJheUtleV0gJiYgQXJyYXkuaXNBcnJheShjdXJyZW50W2FycmF5S2V5XSkpIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudFthcnJheUtleV1bYXJyYXlJbmRleF07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnRba2V5XTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiBjdXJyZW50Ow0KfQ0KDQovLyBIZWxwZXIgbWV0aG9kIHRvIGRldGVjdCBpbWFnZSB0eXBlIGZyb20gYmFzZTY0IGRhdGENCmZ1bmN0aW9uIGRldGVjdEltYWdlVHlwZUZyb21CYXNlNjQoYmFzZTY0RGF0YSkgew0KICAgIC8vIENoZWNrIHRoZSBmaXJzdCBmZXcgYnl0ZXMgdG8gZGV0ZXJtaW5lIGltYWdlIHR5cGUNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBiaW5hcnlTdHJpbmcgPSBhdG9iKGJhc2U2NERhdGEpOw0KICAgICAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJpbmFyeVN0cmluZy5sZW5ndGgpOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpbmFyeVN0cmluZy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENoZWNrIGZpbGUgc2lnbmF0dXJlcw0KICAgICAgICBpZiAoYnl0ZXNbMF0gPT09IDB4RkYgJiYgYnl0ZXNbMV0gPT09IDB4RDggJiYgYnl0ZXNbMl0gPT09IDB4RkYpIHsNCiAgICAgICAgICAgIHJldHVybiAnaW1hZ2UvanBlZyc7DQogICAgICAgIH0gZWxzZSBpZiAoYnl0ZXNbMF0gPT09IDB4ODkgJiYgYnl0ZXNbMV0gPT09IDB4NTAgJiYgYnl0ZXNbMl0gPT09IDB4NEUgJiYgYnl0ZXNbM10gPT09IDB4NDcpIHsNCiAgICAgICAgICAgIHJldHVybiAnaW1hZ2UvcG5nJzsNCiAgICAgICAgfSBlbHNlIGlmIChieXRlc1swXSA9PT0gMHg0NyAmJiBieXRlc1sxXSA9PT0gMHg0OSAmJiBieXRlc1syXSA9PT0gMHg0Nikgew0KICAgICAgICAgICAgcmV0dXJuICdpbWFnZS9naWYnOw0KICAgICAgICB9IGVsc2UgaWYgKGJ5dGVzWzBdID09PSAweDUyICYmIGJ5dGVzWzFdID09PSAweDQ5ICYmIGJ5dGVzWzJdID09PSAweDQ2ICYmIGJ5dGVzWzNdID09PSAweDQ2KSB7DQogICAgICAgICAgICByZXR1cm4gJ2ltYWdlL3dlYnAnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gRGVmYXVsdCB0byBQTkcgaWYgd2UgY2FuJ3QgZGV0ZXJtaW5lDQogICAgICAgICAgICByZXR1cm4gJ2ltYWdlL3BuZyc7DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIC8vIERlZmF1bHQgdG8gUE5HIGlmIHRoZXJlJ3MgYW4gZXJyb3INCiAgICAgICAgcmV0dXJuICdpbWFnZS9wbmcnOw0KICAgIH0NCn0NCg0KLy8gQ29udmVydCB2aWV3cG9ydCBjb29yZGluYXRlcyB0byBjYW52YXMgY29vcmRpbmF0ZXMgKGFjY291bnRpbmcgZm9yIHBhbiBhbmQgem9vbSkNCmZ1bmN0aW9uIHZpZXdwb3J0VG9DYW52YXNDb29yZHModmlld3BvcnRYLCB2aWV3cG9ydFkpIHsNCiAgICBpZiAodHlwZW9mIGZsb3dFZGl0b3IgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHJldHVybiB7IHg6IHZpZXdwb3J0WCwgeTogdmlld3BvcnRZIH07DQogICAgfQ0KICAgIA0KICAgIHJldHVybiB7DQogICAgICAgIHg6ICh2aWV3cG9ydFggLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsLA0KICAgICAgICB5OiAodmlld3BvcnRZIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbA0KICAgIH07DQp9DQoNCi8vIENvbnZlcnQgY2FudmFzIGNvb3JkaW5hdGVzIHRvIHZpZXdwb3J0IGNvb3JkaW5hdGVzIChhY2NvdW50aW5nIGZvciBwYW4gYW5kIHpvb20pDQpmdW5jdGlvbiBjYW52YXNUb1ZpZXdwb3J0Q29vcmRzKGNhbnZhc1gsIGNhbnZhc1kpIHsNCiAgICBpZiAodHlwZW9mIGZsb3dFZGl0b3IgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHJldHVybiB7IHg6IGNhbnZhc1gsIHk6IGNhbnZhc1kgfTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIHsNCiAgICAgICAgeDogKGNhbnZhc1ggKiBmbG93RWRpdG9yLnpvb21MZXZlbCkgKyBmbG93RWRpdG9yLnBhbk9mZnNldC54LA0KICAgICAgICB5OiAoY2FudmFzWSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsKSArIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkNCiAgICB9Ow0KfQ0KDQovLyBHZXQgdGhlIGNlbnRlciBvZiB0aGUgY3VycmVudCB2aWV3cG9ydCBpbiBjYW52YXMgY29vcmRpbmF0ZXMNCmZ1bmN0aW9uIGdldFZpZXdwb3J0Q2VudGVySW5DYW52YXMoKSB7DQogICAgaWYgKHR5cGVvZiBmbG93RWRpdG9yID09PSAndW5kZWZpbmVkJyB8fCAhZmxvd0VkaXRvci5jYW52YXMpIHsNCiAgICAgICAgcmV0dXJuIHsgeDogMCwgeTogMCB9Ow0KICAgIH0NCiAgICANCiAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgIGlmICghY29udGFpbmVyKSB7DQogICAgICAgIHJldHVybiB7IHg6IDAsIHk6IDAgfTsNCiAgICB9DQogICAgDQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclggPSBjb250YWluZXJSZWN0LndpZHRoIC8gMjsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclkgPSBjb250YWluZXJSZWN0LmhlaWdodCAvIDI7DQogICAgDQogICAgcmV0dXJuIHZpZXdwb3J0VG9DYW52YXNDb29yZHModmlld3BvcnRDZW50ZXJYLCB2aWV3cG9ydENlbnRlclkpOw0KfQ0KDQovLyBDZW50ZXIgdGhlIHZpZXdwb3J0IG9uIHNwZWNpZmljIGNhbnZhcyBjb29yZGluYXRlcw0KZnVuY3Rpb24gY2VudGVyVmlld3BvcnRPbkNhbnZhcyhjYW52YXNYLCBjYW52YXNZKSB7DQogICAgaWYgKHR5cGVvZiBmbG93RWRpdG9yID09PSAndW5kZWZpbmVkJyB8fCAhZmxvd0VkaXRvci5jYW52YXMpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgIGlmICghY29udGFpbmVyKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclggPSBjb250YWluZXJSZWN0LndpZHRoIC8gMjsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclkgPSBjb250YWluZXJSZWN0LmhlaWdodCAvIDI7DQogICAgDQogICAgLy8gQ2FsY3VsYXRlIHBhbiBvZmZzZXQgdG8gY2VudGVyIHRoZSBzcGVjaWZpZWQgY2FudmFzIGNvb3JkaW5hdGVzIGluIHRoZSB2aWV3cG9ydA0KICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSB2aWV3cG9ydENlbnRlclggLSAoY2FudmFzWCAqIGZsb3dFZGl0b3Iuem9vbUxldmVsKTsNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gdmlld3BvcnRDZW50ZXJZIC0gKGNhbnZhc1kgKiBmbG93RWRpdG9yLnpvb21MZXZlbCk7DQogICAgDQogICAgLy8gVXBkYXRlIHRoZSB0cmFuc2Zvcm0NCiAgICBpZiAod2luZG93LmNhbnZhc01hbmFnZXIgJiYgd2luZG93LmNhbnZhc01hbmFnZXIudXBkYXRlQ2FudmFzVHJhbnNmb3JtKSB7DQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgIH0NCn0NCg0KLy8gRXhwb3J0IHV0aWxpdGllcyBmb3IgdXNlIGluIG90aGVyIG1vZHVsZXMNCndpbmRvdy5mbG93RWRpdG9yVXRpbHMgPSB7DQogICAgZGV0ZWN0QXBwU2NhbGUsDQogICAgZ2V0RWZmZWN0aXZlU2NhbGUsDQogICAgc2NyZWVuVG9BcHBDb29yZHMsDQogICAgYXBwVG9TY3JlZW5Db29yZHMsDQogICAgZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0LA0KICAgIGdldFNjYWxlZE1vdXNlQ29vcmRzLA0KICAgIGluaXRTY2FsZURldGVjdGlvbiwNCiAgICBlc2NhcGVIdG1sLA0KICAgIGZvcm1hdEZpbGVTaXplLA0KICAgIGRlYm91bmNlLA0KICAgIHByb2Nlc3NUZW1wbGF0ZXMsDQogICAgZXh0cmFjdE5lc3RlZFZhbHVlLA0KICAgIGRldGVjdEltYWdlVHlwZUZyb21CYXNlNjQsDQogICAgdmlld3BvcnRUb0NhbnZhc0Nvb3JkcywNCiAgICBjYW52YXNUb1ZpZXdwb3J0Q29vcmRzLA0KICAgIGdldFZpZXdwb3J0Q2VudGVySW5DYW52YXMsDQogICAgY2VudGVyVmlld3BvcnRPbkNhbnZhcw0KfTsNCg0KLy8gUmVwbGFjZSB0ZW1wbGF0ZSBwbGFjZWhvbGRlcnMgaW4gSlNPTiBib2R5DQpmdW5jdGlvbiByZXBsYWNlVGVtcGxhdGVQbGFjZWhvbGRlcnMoYm9keSwgdGVtcGxhdGVEYXRhKSB7DQogICAgY29uc29sZS5sb2coJ3JlcGxhY2VUZW1wbGF0ZVBsYWNlaG9sZGVycyBjYWxsZWQgd2l0aDonLCB7IGJvZHksIHRlbXBsYXRlRGF0YSwgYm9keVR5cGU6IHR5cGVvZiBib2R5LCB0ZW1wbGF0ZURhdGFUeXBlOiB0eXBlb2YgdGVtcGxhdGVEYXRhIH0pOw0KDQogICAgaWYgKCFib2R5KSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdCb2R5IGlzIGVtcHR5LCByZXR1cm5pbmcgYXMtaXMnKTsNCiAgICAgICAgcmV0dXJuIGJvZHk7DQogICAgfQ0KDQogICAgLy8gSGFuZGxlIGJvdGggc3RyaW5nIGFuZCBvYmplY3QgaW5wdXRzDQogICAgbGV0IGJvZHlTdHJpbmc7DQogICAgbGV0IGlzSnNvblN0cmluZyA9IGZhbHNlOw0KDQogICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykgew0KICAgICAgICBib2R5U3RyaW5nID0gYm9keTsNCiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbHJlYWR5IGEgSlNPTiBzdHJpbmcNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIEpTT04ucGFyc2UoYm9keSk7DQogICAgICAgICAgICBpc0pzb25TdHJpbmcgPSB0cnVlOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAvLyBOb3QgYSBKU09OIHN0cmluZywgdHJlYXQgYXMgcmVndWxhciBzdHJpbmcNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnKSB7DQogICAgICAgIGJvZHlTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShib2R5KTsNCiAgICAgICAgaXNKc29uU3RyaW5nID0gdHJ1ZTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25zb2xlLmxvZygnQm9keSBpcyBuZWl0aGVyIHN0cmluZyBub3Igb2JqZWN0LCByZXR1cm5pbmcgYXMtaXMnKTsNCiAgICAgICAgcmV0dXJuIGJvZHk7DQogICAgfQ0KDQogICAgY29uc29sZS5sb2coJ0JvZHkgc3RyaW5nIGJlZm9yZSByZXBsYWNlbWVudDonLCBib2R5U3RyaW5nLCAnaXNKc29uU3RyaW5nOicsIGlzSnNvblN0cmluZyk7DQoNCiAgICAvLyBSZXBsYWNlIHBsYWNlaG9sZGVycyB3aXRoIHRlbXBsYXRlIGRhdGENCiAgICBpZiAodGVtcGxhdGVEYXRhICE9PSB1bmRlZmluZWQgJiYgdGVtcGxhdGVEYXRhICE9PSBudWxsKSB7DQogICAgICAgIGNvbnN0IGJlZm9yZVJlcGxhY2UgPSBib2R5U3RyaW5nOw0KDQogICAgICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyB0ZW1wbGF0ZSByZXBsYWNlbWVudCB3aXRoIHRlbXBsYXRlRGF0YTonLCB0ZW1wbGF0ZURhdGEpOw0KDQogICAgICAgIC8vIFNpbXBsZSBKU09OIGZpZWxkIHJlcGxhY2VtZW50IC0ganVzdCB7e2ZpZWxkfX0gb3Ige3tuZXN0ZWQuZmllbGR9fQ0KICAgICAgICBpZiAodHlwZW9mIHRlbXBsYXRlRGF0YSA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9jZXNzaW5nIHNpbXBsZSBmaWVsZCByZXBsYWNlbWVudHMgZm9yIG9iamVjdCB0ZW1wbGF0ZURhdGEnKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUZW1wbGF0ZSBkYXRhIGtleXM6JywgT2JqZWN0LmtleXModGVtcGxhdGVEYXRhKSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnTG9va2luZyBmb3IgcGF0dGVybnMgbGlrZSB7e2ZpZWxkfX0gaW4gYm9keSBzdHJpbmc6JywgYm9keVN0cmluZyk7DQoNCiAgICAgICAgICAgIC8vIFVzZSBhIHNpbXBsZXIsIG1vcmUgZXhwbGljaXQgcmVnZXgNCiAgICAgICAgICAgIGNvbnN0IHBsYWNlaG9sZGVyUmVnZXggPSAvXHtceyhbXn1dKylcfVx9L2c7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVXNpbmcgcmVnZXg6JywgcGxhY2Vob2xkZXJSZWdleCk7DQoNCiAgICAgICAgICAgIC8vIFRlc3QgaWYgdGhlIHJlZ2V4IGZpbmRzIGFueXRoaW5nDQogICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gYm9keVN0cmluZy5tYXRjaChwbGFjZWhvbGRlclJlZ2V4KTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZWdleCBtYXRjaGVzIGZvdW5kOicsIG1hdGNoZXMpOw0KDQogICAgICAgICAgICBib2R5U3RyaW5nID0gYm9keVN0cmluZy5yZXBsYWNlKHBsYWNlaG9sZGVyUmVnZXgsIChtYXRjaCwgZmllbGRQYXRoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIHBhdHRlcm4ge3snICsgZmllbGRQYXRoICsgJ319LCBleHRyYWN0aW5nIHZhbHVlLi4uJyk7DQogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBnZXROZXN0ZWRWYWx1ZSh0ZW1wbGF0ZURhdGEsIGZpZWxkUGF0aCk7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0V4dHJhY3RlZCB2YWx1ZSBmb3InLCBmaWVsZFBhdGgsICc6JywgdmFsdWUpOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWYWx1ZSB0eXBlOicsIHR5cGVvZiB2YWx1ZSk7DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcGxhY2VtZW50Ow0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWx3YXlzIGVzY2FwZSB0aGUgc3RyaW5nIHByb3Blcmx5IGZvciBKU09OIGNvbnRleHQNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50ID0gdmFsdWUucmVwbGFjZSgvXFwvZywgJ1xcXFwnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8iL2csICdcXCInKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cbi9nLCAnXFxuJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXHIvZywgJ1xccicpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1x0L2csICdcXHQnKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBub24tc3RyaW5ncywgY29udmVydCB0byBKU09OIHN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnQgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlcGxhY2luZycsIG1hdGNoLCAnd2l0aDonLCByZXBsYWNlbWVudCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXBsYWNlbWVudDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmllbGQgbm90IGZvdW5kLCBrZWVwaW5nIG9yaWdpbmFsOicsIG1hdGNoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0ZW1wbGF0ZURhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAvLyBGb3Igc3RyaW5ncywganVzdCByZXBsYWNlIHt7VkFMVUV9fSBhcyBhIGZhbGxiYWNrDQogICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvY2Vzc2luZyBzdHJpbmcgdGVtcGxhdGVEYXRhLCByZXBsYWNpbmcge3tWQUxVRX19Jyk7DQogICAgICAgICAgICBib2R5U3RyaW5nID0gYm9keVN0cmluZy5yZXBsYWNlKC97e1ZBTFVFfX0vZywgSlNPTi5zdHJpbmdpZnkodGVtcGxhdGVEYXRhKSk7DQogICAgICAgIH0NCg0KICAgICAgICBjb25zb2xlLmxvZygnVGVtcGxhdGUgcmVwbGFjZW1lbnQgcmVzdWx0OicsIHsNCiAgICAgICAgICAgIGJlZm9yZTogYmVmb3JlUmVwbGFjZSwNCiAgICAgICAgICAgIGFmdGVyOiBib2R5U3RyaW5nLA0KICAgICAgICAgICAgcmVwbGFjZWQ6IGJlZm9yZVJlcGxhY2UgIT09IGJvZHlTdHJpbmcsDQogICAgICAgICAgICB0ZW1wbGF0ZURhdGE6IHRlbXBsYXRlRGF0YQ0KICAgICAgICB9KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25zb2xlLmxvZygnTm8gdGVtcGxhdGUgZGF0YSBwcm92aWRlZCwgc2tpcHBpbmcgcmVwbGFjZW1lbnQnKTsNCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShib2R5U3RyaW5nKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSB0ZW1wbGF0ZS1yZXBsYWNlZCBib2R5OicsIGVycm9yKTsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0JvZHkgc3RyaW5nIHdhczonLCBib2R5U3RyaW5nKTsNCiAgICAgICAgICAgIHJldHVybiBib2R5Ow0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGJvZHlTdHJpbmc7DQogICAgfQ0KfQ0KDQovLyBHZXQgbmVzdGVkIHZhbHVlIGZyb20gb2JqZWN0IHVzaW5nIGRvdCBub3RhdGlvbg0KZnVuY3Rpb24gZ2V0TmVzdGVkVmFsdWUob2JqLCBwYXRoKSB7DQogICAgY29uc29sZS5sb2coJ2dldE5lc3RlZFZhbHVlIGNhbGxlZCB3aXRoOicsIHsgb2JqLCBwYXRoIH0pOw0KICAgIGNvbnN0IHJlc3VsdCA9IHBhdGguc3BsaXQoJy4nKS5yZWR1Y2UoKGN1cnJlbnQsIGtleSkgPT4gew0KICAgICAgICBjb25zb2xlLmxvZygnQ2hlY2tpbmcga2V5OicsIGtleSwgJ2luOicsIGN1cnJlbnQpOw0KICAgICAgICBjb25zdCB2YWx1ZSA9IGN1cnJlbnQgJiYgY3VycmVudFtrZXldICE9PSB1bmRlZmluZWQgPyBjdXJyZW50W2tleV0gOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnNvbGUubG9nKCdWYWx1ZSBmb3Iga2V5Jywga2V5LCAnOicsIHZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgIH0sIG9iaik7DQogICAgY29uc29sZS5sb2coJ2dldE5lc3RlZFZhbHVlIHJlc3VsdCBmb3IgcGF0aCcsIHBhdGgsICc6JywgcmVzdWx0KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQoNCi8vIFVwZGF0ZSBKU09OIGV4dHJhY3Qgbm9kZSBkaXNwbGF5DQpmdW5jdGlvbiB1cGRhdGVKc29uRXh0cmFjdERpc3BsYXkobm9kZUlkLCBsYWJlbCwgdmFsdWUsIHN0YXR1cyA9ICdub3JtYWwnKSB7DQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub2RlSWQpOw0KICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICBjb25zdCBjb250ZW50RWxlbWVudCA9IG5vZGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mbG93LW5vZGUtY29udGVudCcpOw0KICAgICAgICBpZiAoY29udGVudEVsZW1lbnQpIHsNCiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0NsYXNzID0gc3RhdHVzID09PSAnZXJyb3InID8gJ3RleHQtZGFuZ2VyJyA6IHN0YXR1cyA9PT0gJ3N1Y2Nlc3MnID8gJ3RleHQtc3VjY2VzcycgOiAndGV4dC1tdXRlZCc7DQoNCiAgICAgICAgICAgIC8vIFNob3cganVzdCBhIHN0YXR1cyBvbiB0aGUgbm9kZSwgZnVsbCBjb250ZW50IHdpbGwgYmUgaW4gY29uZmlnIHBhbmVsDQogICAgICAgICAgICBjb25zdCB0cnVuY2F0ZWRWYWx1ZSA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUubGVuZ3RoID4gNTAgPw0KICAgICAgICAgICAgICAgIHZhbHVlLnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJyA6IHZhbHVlOw0KDQogICAgICAgICAgICBjb250ZW50RWxlbWVudC5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibm9kZS1zdGF0dXMiPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0dXMtdGV4dCI+VmFsdWUgZXh0cmFjdGVkPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN0YXR1cy1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD4ke2xhYmVsfTogJHtlc2NhcGVIdG1sKFN0cmluZyh0cnVuY2F0ZWRWYWx1ZSkpfTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gQWRkIGV4ZWN1dGlvbiBsb2cgZW50cnkNCmZ1bmN0aW9uIGFkZEV4ZWN1dGlvbkxvZyhtZXNzYWdlLCB0eXBlID0gJ2luZm8nKSB7DQogICAgY29uc3Qgb3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4ZWN1dGlvbi1vdXRwdXQnKTsNCiAgICBpZiAob3V0cHV0KSB7DQogICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCk7DQogICAgICAgIG91dHB1dC5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9ImxvZy1lbnRyeSAke3R5cGV9Ij5bJHt0aW1lc3RhbXB9XSAke21lc3NhZ2V9PC9kaXY+YDsNCiAgICAgICAgb3V0cHV0LnNjcm9sbFRvcCA9IG91dHB1dC5zY3JvbGxIZWlnaHQ7DQogICAgfQ0KfQ0KDQovLyBDbGVhciBleGVjdXRpb24gb3V0cHV0DQpmdW5jdGlvbiBjbGVhck91dHB1dCgpIHsNCiAgICBjb25zdCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhlY3V0aW9uLW91dHB1dCcpOw0KICAgIGlmIChvdXRwdXQpIHsNCiAgICAgICAgb3V0cHV0LmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJsb2ctZW50cnkgaW5mbyI+T3V0cHV0IGNsZWFyZWQ8L2Rpdj4nOw0KICAgIH0NCn0NCg0KDQovLyBJbnRlcmFjdGl2ZSBoZWxwZXIgZnVuY3Rpb25zIGZvciBzcGVjaWFsIG5vZGUgdHlwZXMNCg0KLy8gQXVkaW8gY29udHJvbCBmdW5jdGlvbnMNCmZ1bmN0aW9uIHBsYXlBdWRpbyhub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUgfHwgIW5vZGUubGFzdEF1ZGlvVXJsKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGF1ZGlvIGRhdGEgYXZhaWxhYmxlIGZvciBub2RlOicsIG5vZGVJZCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBDcmVhdGUgb3IgcmV1c2UgYXVkaW8gZWxlbWVudA0KICAgIGlmICghbm9kZS5hdWRpb0VsZW1lbnQpIHsNCiAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQgPSBuZXcgQXVkaW8obm9kZS5sYXN0QXVkaW9VcmwpOw0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC52b2x1bWUgPSBwYXJzZUZsb2F0KG5vZGUuY29uZmlnLnZvbHVtZS52YWx1ZSk7DQogICAgfQ0KDQogICAgbm9kZS5hdWRpb0VsZW1lbnQucGxheSgpLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHBsYXkgYXVkaW86JywgZXJyb3IpOw0KICAgIH0pOw0KDQogICAgY29uc29sZS5sb2coJ1BsYXlpbmcgYXVkaW8gZm9yIG5vZGU6Jywgbm9kZUlkKTsNCn0NCg0KZnVuY3Rpb24gc3RvcEF1ZGlvKG5vZGVJZCkgew0KICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChub2RlSWQpOw0KICAgIGlmICghbm9kZSB8fCAhbm9kZS5hdWRpb0VsZW1lbnQpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignTm8gYXVkaW8gZWxlbWVudCBmb3VuZCBmb3Igbm9kZTonLCBub2RlSWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbm9kZS5hdWRpb0VsZW1lbnQucGF1c2UoKTsNCiAgICBub2RlLmF1ZGlvRWxlbWVudC5jdXJyZW50VGltZSA9IDA7DQoNCiAgICBjb25zb2xlLmxvZygnU3RvcHBlZCBhdWRpbyBmb3Igbm9kZTonLCBub2RlSWQpOw0KfQ0KDQovLyBJbWFnZSBkaXNwbGF5IGZ1bmN0aW9ucw0KZnVuY3Rpb24gc2hvd0Z1bGxJbWFnZShub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUgfHwgIW5vZGUubGFzdEltYWdlVXJsKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGltYWdlIGRhdGEgYXZhaWxhYmxlIGZvciBub2RlOicsIG5vZGVJZCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBDcmVhdGUgYSBtb2RhbCB0byBzaG93IHRoZSBmdWxsIGltYWdlDQogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBtb2RhbC5jbGFzc05hbWUgPSAnaW1hZ2UtbW9kYWwnOw0KICAgIG1vZGFsLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICAgICAgdG9wOiAwOw0KICAgICAgICBsZWZ0OiAwOw0KICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuOCk7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICB6LWluZGV4OiAxMDAwMDsNCiAgICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGA7DQoNCiAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsNCiAgICBpbWcuc3JjID0gbm9kZS5sYXN0SW1hZ2VVcmw7DQogICAgaW1nLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICAgIG1heC13aWR0aDogOTAlOw0KICAgICAgICBtYXgtaGVpZ2h0OiA5MCU7DQogICAgICAgIG9iamVjdC1maXQ6IGNvbnRhaW47DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDAsIDAsIDAsIDAuNSk7DQogICAgYDsNCg0KICAgIG1vZGFsLmFwcGVuZENoaWxkKGltZyk7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtb2RhbCk7DQoNCiAgICAvLyBDbG9zZSBtb2RhbCBvbiBjbGljaw0KICAgIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG1vZGFsKTsNCiAgICB9KTsNCg0KICAgIGNvbnNvbGUubG9nKCdTaG93aW5nIGZ1bGwgaW1hZ2UgZm9yIG5vZGU6Jywgbm9kZUlkKTsNCn0NCg0KLy8gUmVwZWF0ZXIgY29udHJvbCBmdW5jdGlvbnMNCmZ1bmN0aW9uIHN0YXJ0UmVwZWF0ZXIobm9kZUlkKSB7DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKCFub2RlIHx8IG5vZGUudHlwZSAhPT0gJ3JlcGVhdGVyJykgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIHJlcGVhdGVyIG5vZGU6Jywgbm9kZUlkKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIEV4ZWN1dGUgdGhlIHJlcGVhdGVyIG5vZGUgdG8gc3RhcnQgaXQNCiAgICBleGVjdXRpb25FbmdpbmUuZXhlY3V0ZU5vZGUobm9kZSwge30sIG5ldyBTZXQoKSkudGhlbigoKSA9PiB7DQogICAgICAgIGNvbnNvbGUubG9nKCdSZXBlYXRlciBzdGFydGVkOicsIG5vZGVJZCk7DQogICAgICAgIC8vIFJlZnJlc2ggdGhlIGNvbmZpZyBwYW5lbCB0byB1cGRhdGUgdGhlIFVJDQogICAgICAgIHNob3dOb2RlQ29uZmlnKG5vZGVJZCk7DQogICAgfSkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3RhcnQgcmVwZWF0ZXI6JywgZXJyb3IpOw0KICAgIH0pOw0KfQ0KDQpmdW5jdGlvbiBzdG9wUmVwZWF0ZXIobm9kZUlkKSB7DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKCFub2RlIHx8IG5vZGUudHlwZSAhPT0gJ3JlcGVhdGVyJykgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIHJlcGVhdGVyIG5vZGU6Jywgbm9kZUlkKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIFN0b3AgdGhlIHJlcGVhdGVyIHVzaW5nIHRoZSBleGVjdXRpb24gZW5naW5lIG1ldGhvZA0KICAgIGV4ZWN1dGlvbkVuZ2luZS5zdG9wUmVwZWF0ZXIobm9kZSk7DQogICAgY29uc29sZS5sb2coJ1JlcGVhdGVyIHN0b3BwZWQ6Jywgbm9kZUlkKTsNCg0KICAgIC8vIFJlZnJlc2ggdGhlIGNvbmZpZyBwYW5lbCB0byB1cGRhdGUgdGhlIFVJDQogICAgc2hvd05vZGVDb25maWcobm9kZUlkKTsNCn0NCg0KDQoNCi8vIFVwZGF0ZSBpbnB1dCBtYXBwaW5nIHdoZW4gdXNlciBzZWxlY3RzIGEgZGlmZmVyZW50IG91dHB1dCBwb3J0DQpmdW5jdGlvbiB1cGRhdGVJbnB1dE1hcHBpbmcobm9kZUlkLCBpbnB1dFBvcnQsIHNlbGVjdGVkT3V0cHV0UG9ydCkgew0KICAgIGNvbnNvbGUubG9nKGBVcGRhdGluZyBpbnB1dCBtYXBwaW5nOiAke25vZGVJZH0uJHtpbnB1dFBvcnR9IOKGkCAke3NlbGVjdGVkT3V0cHV0UG9ydH1gKTsNCiAgICAvLyBGaW5kIHRoZSBjb25uZWN0aW9uIHRoYXQgZ29lcyB0byB0aGlzIGlucHV0IHBvcnQgKGlnbm9yZSBmcm9tLnBvcnROYW1lKQ0KICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLmZpbmQoY29ubiA9Pg0KICAgICAgICBjb25uLnRvLm5vZGVJZCA9PT0gbm9kZUlkICYmIGNvbm4udG8ucG9ydE5hbWUgPT09IGlucHV0UG9ydA0KICAgICk7DQogICAgaWYgKGNvbm5lY3Rpb24pIHsNCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBvbGQgY29ubmVjdGlvbg0KICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmRlbGV0ZShjb25uZWN0aW9uLmlkKTsNCiAgICAgICAgaWYgKGNvbm5lY3Rpb24uc3ZnKSBjb25uZWN0aW9uLnN2Zy5yZW1vdmUoKTsNCiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGNvbm5lY3Rpb24gd2l0aCB0aGUgdXBkYXRlZCBwb3J0IG5hbWUgYW5kIG5ldyBJRA0KICAgICAgICBjb25zdCBuZXdDb25uZWN0aW9uSWQgPSBgY29ubl8ke2Nvbm5lY3Rpb24uZnJvbS5ub2RlSWR9XyR7c2VsZWN0ZWRPdXRwdXRQb3J0fV8ke2Nvbm5lY3Rpb24udG8ubm9kZUlkfV8ke2Nvbm5lY3Rpb24udG8ucG9ydE5hbWV9YDsNCiAgICAgICAgY29uc3QgbmV3Q29ubmVjdGlvbiA9IHsNCiAgICAgICAgICAgIGlkOiBuZXdDb25uZWN0aW9uSWQsDQogICAgICAgICAgICBmcm9tOiB7IG5vZGVJZDogY29ubmVjdGlvbi5mcm9tLm5vZGVJZCwgcG9ydE5hbWU6IHNlbGVjdGVkT3V0cHV0UG9ydCB9LA0KICAgICAgICAgICAgdG86IHsgbm9kZUlkOiBjb25uZWN0aW9uLnRvLm5vZGVJZCwgcG9ydE5hbWU6IGNvbm5lY3Rpb24udG8ucG9ydE5hbWUgfQ0KICAgICAgICB9Ow0KICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnNldChuZXdDb25uZWN0aW9uSWQsIG5ld0Nvbm5lY3Rpb24pOw0KICAgICAgICBkcmF3Q29ubmVjdGlvbihuZXdDb25uZWN0aW9uKTsNCiAgICAgICAgLy8gUmVmcmVzaCB0aGUgbm9kZSBjb25maWcgcGFuZWwgdG8gc2hvdyB1cGRhdGVkIHN0YXRlDQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9PT0gbm9kZUlkKSB7DQogICAgICAgICAgICBzaG93Tm9kZUNvbmZpZyhub2RlSWQpOw0KICAgICAgICB9DQogICAgICAgIC8vIEF1dG8tc2F2ZSB0aGUgd29ya2Zsb3cgdG8gcGVyc2lzdCB0aGUgbWFwcGluZyBjaGFuZ2UNCiAgICAgICAgaWYgKHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvdykgew0KICAgICAgICAgICAgd2luZG93LmZpbGVNYW5hZ2VyLnNhdmVGbG93KCk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFVwZGF0ZSBvdXRwdXQgbWFwcGluZyB3aGVuIHVzZXIgc2VsZWN0cyBhIGRpZmZlcmVudCBvdXRwdXQgcG9ydA0KZnVuY3Rpb24gdXBkYXRlT3V0cHV0TWFwcGluZyhub2RlSWQsIG91dHB1dFBvcnQsIHRhcmdldE5vZGVJZCwgc2VsZWN0ZWRPdXRwdXRQb3J0KSB7DQogICAgY29uc29sZS5sb2coYFVwZGF0aW5nIG91dHB1dCBtYXBwaW5nOiAke25vZGVJZH0uJHtvdXRwdXRQb3J0fSDihpIgJHt0YXJnZXROb2RlSWR9IChuZXcgb3V0cHV0OiAke3NlbGVjdGVkT3V0cHV0UG9ydH0pYCk7DQogICAgLy8gUmVtb3ZlIGFsbCBjb25uZWN0aW9ucyBmcm9tIHRoaXMgbm9kZSB0byB0aGUgdGFyZ2V0IG5vZGUgKHJlZ2FyZGxlc3Mgb2YgcG9ydCkNCiAgICBjb25zdCBjb25uZWN0aW9uc1RvUmVtb3ZlID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5maWx0ZXIoY29ubiA9Pg0KICAgICAgICBjb25uLmZyb20ubm9kZUlkID09PSBub2RlSWQgJiYgY29ubi50by5ub2RlSWQgPT09IHRhcmdldE5vZGVJZA0KICAgICk7DQogICAgY29ubmVjdGlvbnNUb1JlbW92ZS5mb3JFYWNoKGNvbm4gPT4gew0KICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmRlbGV0ZShjb25uLmlkKTsNCiAgICAgICAgaWYgKGNvbm4uc3ZnKSBjb25uLnN2Zy5yZW1vdmUoKTsNCiAgICB9KTsNCiAgICAvLyBBZGQgdGhlIG5ldyBjb25uZWN0aW9uDQogICAgY29uc3QgbmV3Q29ubmVjdGlvbklkID0gYGNvbm5fJHtub2RlSWR9XyR7c2VsZWN0ZWRPdXRwdXRQb3J0fV8ke3RhcmdldE5vZGVJZH1gOw0KICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb24gPSB7DQogICAgICAgIGlkOiBuZXdDb25uZWN0aW9uSWQsDQogICAgICAgIGZyb206IHsgbm9kZUlkOiBub2RlSWQsIHBvcnROYW1lOiBzZWxlY3RlZE91dHB1dFBvcnQgfSwNCiAgICAgICAgdG86IHsgbm9kZUlkOiB0YXJnZXROb2RlSWQsIHBvcnROYW1lOiBjb25uZWN0aW9uc1RvUmVtb3ZlWzBdPy50by5wb3J0TmFtZSB8fCAnZGF0YScgfQ0KICAgIH07DQogICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5zZXQobmV3Q29ubmVjdGlvbklkLCBuZXdDb25uZWN0aW9uKTsNCiAgICBkcmF3Q29ubmVjdGlvbihuZXdDb25uZWN0aW9uKTsNCiAgICAvLyBSZWZyZXNoIHRoZSB0YXJnZXQgbm9kZSBpZiBzZWxlY3RlZA0KICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9PT0gdGFyZ2V0Tm9kZUlkKSB7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgc2hvd05vZGVDb25maWcodGFyZ2V0Tm9kZUlkKTsNCiAgICAgICAgfSwgMTApOw0KICAgIH0NCiAgICAvLyBBdXRvLXNhdmUNCiAgICBpZiAod2luZG93LmZpbGVNYW5hZ2VyLnNhdmVGbG93KSB3aW5kb3cuZmlsZU1hbmFnZXIuc2F2ZUZsb3coKTsNCn0NCg0KDQovLyBub2RlLXJlZ2lzdHJ5LmpzIC0gRHluYW1pYyBub2RlIHJlZ2lzdHJ5IGZvciBGbG93IEVkaXRvcg0KDQpjbGFzcyBOb2RlUmVnaXN0cnkgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBjb25zb2xlLmxvZygnTm9kZVJlZ2lzdHJ5IGNvbnN0cnVjdG9yIGNhbGxlZCcpOw0KICAgICAgICB0aGlzLm5vZGVUeXBlcyA9IG5ldyBNYXAoKTsNCiAgICAgICAgdGhpcy5leGVjdXRvcnMgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMubG9hZGVkID0gZmFsc2U7DQogICAgICAgIGNvbnNvbGUubG9nKCdOb2RlUmVnaXN0cnkgaW5pdGlhbGl6ZWQnKTsNCiAgICB9DQogICAgDQogICAgYXN5bmMgbG9hZE5vZGVzRnJvbVZGUygpIHsNCiAgICAgICAgaWYgKHRoaXMubG9hZGVkKSByZXR1cm47DQogICAgICAgIA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0xvYWRpbmcgbm9kZXMgZnJvbSBWRlMgcGFja2VkIGZpbGUuLi4nKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gTG9hZCB0aGUgcGFja2VkIG5vZGVzIGZpbGUgZGlyZWN0bHkNCiAgICAgICAgICAgIGNvbnN0IHBhY2tGaWxlUGF0aCA9ICcvbm9kZXMvbm9kZXMtcGFjay5qc29uJzsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBMb2FkaW5nIHBhY2tlZCBub2RlcyBmcm9tOiAke3BhY2tGaWxlUGF0aH1gKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHN5cG5leEFQSS5yZWFkVmlydHVhbEZpbGVUZXh0KHBhY2tGaWxlUGF0aCk7DQogICAgICAgICAgICBjb25zdCBwYWNrRGF0YSA9IEpTT04ucGFyc2UoY29udGVudCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgcGFja2VkIG5vZGVzICh2ZXJzaW9uICR7cGFja0RhdGEudmVyc2lvbn0pLCB0b3RhbCBub2RlczogJHtwYWNrRGF0YS50b3RhbF9ub2Rlc31gKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gUmVnaXN0ZXIgYWxsIG5vZGVzIGZyb20gdGhlIHBhY2sNCiAgICAgICAgICAgIGZvciAoY29uc3QgW25vZGVJZCwgbm9kZURlZl0gb2YgT2JqZWN0LmVudHJpZXMocGFja0RhdGEubm9kZXMpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5yZWdpc3Rlck5vZGUobm9kZURlZik7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFJlZ2lzdGVyZWQgbm9kZTogJHtub2RlSWR9YCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgJHt0aGlzLm5vZGVUeXBlcy5zaXplfSBub2RlIHR5cGVzOmAsIEFycmF5LmZyb20odGhpcy5ub2RlVHlwZXMua2V5cygpKSk7DQogICAgICAgICAgICANCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIG5vZGVzIGZyb20gVkZTIHBhY2tlZCBmaWxlOicsIGVycm9yKTsNCiAgICAgICAgICAgIHRocm93IGVycm9yOyAvLyBSZS10aHJvdyB0byBpbmRpY2F0ZSBmYWlsdXJlDQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgYXN5bmMgbG9hZE5vZGVGaWxlKGZpbGVQYXRoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTG9hZGluZyBub2RlIGZyb206ICR7ZmlsZVBhdGh9YCk7DQogICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgc3lwbmV4QVBJLnJlYWRWaXJ0dWFsRmlsZVRleHQoZmlsZVBhdGgpOw0KICAgICAgICAgICAgY29uc3Qgbm9kZURlZiA9IEpTT04ucGFyc2UoY29udGVudCk7DQogICAgICAgICAgICB0aGlzLnJlZ2lzdGVyTm9kZShub2RlRGVmKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgbm9kZTogJHtub2RlRGVmLmlkfWApOw0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgbm9kZSBmcm9tICR7ZmlsZVBhdGh9OmAsIGVycm9yKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICByZWdpc3Rlck5vZGUobm9kZURlZikgew0KICAgICAgICB0aGlzLm5vZGVUeXBlcy5zZXQobm9kZURlZi5pZCwgbm9kZURlZik7DQogICAgfQ0KICAgIA0KICAgIHJlZ2lzdGVyRXhlY3V0b3IobmFtZSwgZXhlY3V0b3IpIHsNCiAgICAgICAgdGhpcy5leGVjdXRvcnMuc2V0KG5hbWUsIGV4ZWN1dG9yKTsNCiAgICB9DQogICAgDQogICAgZ2V0Tm9kZVR5cGUoaWQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubm9kZVR5cGVzLmdldChpZCk7DQogICAgfQ0KICAgIA0KICAgIGdldEV4ZWN1dG9yKG5hbWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0b3JzLmdldChuYW1lKTsNCiAgICB9DQogICAgDQogICAgZ2V0QWxsTm9kZVR5cGVzKCkgew0KICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLm5vZGVUeXBlcy52YWx1ZXMoKSk7DQogICAgfQ0KICAgIA0KICAgIGdldE5vZGVUeXBlc0J5Q2F0ZWdvcnkoY2F0ZWdvcnkpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsTm9kZVR5cGVzKCkuZmlsdGVyKG5vZGUgPT4gbm9kZS5jYXRlZ29yeSA9PT0gY2F0ZWdvcnkpOw0KICAgIH0NCn0NCg0KLy8gR2xvYmFsIG5vZGUgcmVnaXN0cnkgaW5zdGFuY2UNCmNvbnNvbGUubG9nKCdDcmVhdGluZyBnbG9iYWwgbm9kZVJlZ2lzdHJ5IGluc3RhbmNlLi4uJyk7DQpjb25zdCBub2RlUmVnaXN0cnkgPSBuZXcgTm9kZVJlZ2lzdHJ5KCk7DQpjb25zb2xlLmxvZygnR2xvYmFsIG5vZGVSZWdpc3RyeSBjcmVhdGVkOicsIG5vZGVSZWdpc3RyeSk7IA0KDQovLyBjYW52YXMuanMgLSBDYW52YXMgZXZlbnQgaGFuZGxlcnMgYW5kIGRyYXdpbmcgbG9naWMgZm9yIEZsb3cgRWRpdG9yDQoNCi8vIFN0YXJ0IGRyYWdnaW5nIGEgbm9kZQ0KZnVuY3Rpb24gc3RhcnREcmFnZ2luZ05vZGUobm9kZUlkLCBlKSB7DQogICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgDQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKCFub2RlKSByZXR1cm47DQogICAgDQogICAgZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUgPSBub2RlSWQ7DQogICAgDQogICAgLy8gQ2FsY3VsYXRlIG9mZnNldCBmcm9tIG1vdXNlIHRvIG5vZGUgY29ybmVyIHVzaW5nIHNjYWxlZCBjb29yZGluYXRlcw0KICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICBjb25zdCByZWN0ID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChub2RlRWxlbWVudCkgOiANCiAgICAgICAgbm9kZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgY29uc3QgbW91c2VDb29yZHMgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOiANCiAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgIA0KICAgIGZsb3dFZGl0b3IuZHJhZ09mZnNldCA9IHsNCiAgICAgICAgeDogbW91c2VDb29yZHMueCAtIHJlY3QubGVmdCwNCiAgICAgICAgeTogbW91c2VDb29yZHMueSAtIHJlY3QudG9wDQogICAgfTsNCiAgICANCiAgICBub2RlRWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZ3JhYmJpbmcnOw0KICAgIG5vZGVFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gQnJpbmcgdG8gZnJvbnQgd2hpbGUgZHJhZ2dpbmcNCiAgICANCiAgICAvLyBDYWNoZSBjYW52YXMgcmVjdCBmb3IgcGVyZm9ybWFuY2UgKHNjYWxlZCkNCiAgICBmbG93RWRpdG9yLmNhbnZhc1JlY3QgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGZsb3dFZGl0b3IuY2FudmFzKSA6IA0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCn0NCg0KLy8gU2VsZWN0IGEgbm9kZQ0KZnVuY3Rpb24gc2VsZWN0Tm9kZShub2RlSWQpIHsNCiAgICAvLyBSZW1vdmUgcHJldmlvdXMgc2VsZWN0aW9uDQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZsb3ctbm9kZS5zZWxlY3RlZCcpLmZvckVhY2gobm9kZSA9PiB7DQogICAgICAgIG5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTsNCiAgICB9KTsNCiAgICANCiAgICAvLyBTZWxlY3QgbmV3IG5vZGUNCiAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGVJZCk7DQogICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7DQogICAgICAgIGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID0gbm9kZUlkOw0KICAgICAgICBzaG93Tm9kZUNvbmZpZyhub2RlSWQpOw0KICAgIH0NCn0NCg0KDQovLyBTdGFydCBhIGNvbm5lY3Rpb24gZnJvbSBhIHBvcnQNCmZ1bmN0aW9uIHN0YXJ0Q29ubmVjdGlvbihub2RlSWQsIHBvcnROYW1lLCBpc091dHB1dCkgew0KICAgIGlmIChpc091dHB1dCkgew0KICAgICAgICAvLyBTdGFydGluZyBmcm9tIG91dHB1dCBwb3J0DQogICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20gPSB7DQogICAgICAgICAgICBub2RlSWQ6IG5vZGVJZCwNCiAgICAgICAgICAgIHBvcnROYW1lOiBwb3J0TmFtZSwNCiAgICAgICAgICAgIGlzT3V0cHV0OiB0cnVlDQogICAgICAgIH07DQogICAgICAgIGNvbnNvbGUubG9nKCdTdGFydGVkIGNvbm5lY3Rpb24gZnJvbSBvdXRwdXQ6Jywgbm9kZUlkLCBwb3J0TmFtZSk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gU3RhcnRpbmcgZnJvbSBpbnB1dCBwb3J0IC0gY2hlY2sgaWYgd2UgaGF2ZSBhIHBlbmRpbmcgY29ubmVjdGlvbg0KICAgICAgICBpZiAoZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbSAmJiBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tLmlzT3V0cHV0KSB7DQogICAgICAgICAgICAvLyBDb21wbGV0ZSB0aGUgY29ubmVjdGlvbg0KICAgICAgICAgICAgY29uc3QgZnJvbU5vZGVJZCA9IGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20ubm9kZUlkOw0KICAgICAgICAgICAgY29uc3QgZnJvbVBvcnQgPSBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tLnBvcnROYW1lOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjcmVhdGVDb25uZWN0aW9uKGZyb21Ob2RlSWQsIGZyb21Qb3J0LCBub2RlSWQsIHBvcnROYW1lKTsNCiAgICAgICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20gPSBudWxsOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0NvbXBsZXRlZCBjb25uZWN0aW9uOicsIGZyb21Ob2RlSWQsIGZyb21Qb3J0LCAnLT4nLCBub2RlSWQsIHBvcnROYW1lKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gVXBkYXRlIGNvbm5lY3Rpb25zIGZvciBhIHNwZWNpZmljIG5vZGUNCmZ1bmN0aW9uIHVwZGF0ZUNvbm5lY3Rpb25zRm9yTm9kZShub2RlSWQpIHsNCiAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb24gb2YgZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkgew0KICAgICAgICBpZiAoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCA9PT0gbm9kZUlkIHx8IGNvbm5lY3Rpb24udG8ubm9kZUlkID09PSBub2RlSWQpIHsNCiAgICAgICAgICAgIHVwZGF0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFVwZGF0ZSBhIHNpbmdsZSBjb25uZWN0aW9uDQpmdW5jdGlvbiB1cGRhdGVDb25uZWN0aW9uKGNvbm5lY3Rpb24pIHsNCiAgICBjb25zdCBmcm9tTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQpOw0KICAgIGNvbnN0IHRvTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbm5lY3Rpb24udG8ubm9kZUlkKTsNCiAgICANCiAgICBpZiAoIWZyb21Ob2RlIHx8ICF0b05vZGUgfHwgIWNvbm5lY3Rpb24uc3ZnKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdNaXNzaW5nIGVsZW1lbnRzIGZvciBjb25uZWN0aW9uOicsIGNvbm5lY3Rpb24uaWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIEdldCBub2RlIGRhdGEgcG9zaXRpb25zDQogICAgY29uc3QgZnJvbU5vZGVEYXRhID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCk7DQogICAgY29uc3QgdG9Ob2RlRGF0YSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KGNvbm5lY3Rpb24udG8ubm9kZUlkKTsNCiAgICANCiAgICBpZiAoIWZyb21Ob2RlRGF0YSB8fCAhdG9Ob2RlRGF0YSkgew0KICAgICAgICBjb25zb2xlLmxvZygnTWlzc2luZyBub2RlIGRhdGEgZm9yIGNvbm5lY3Rpb246JywgY29ubmVjdGlvbi5pZCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gR2V0IGFjdHVhbCBub2RlIGRpbWVuc2lvbnMgZnJvbSBjb21wdXRlZCBzdHlsZXMNCiAgICBjb25zdCBmcm9tU3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZnJvbU5vZGUpOw0KICAgIGNvbnN0IHRvU3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodG9Ob2RlKTsNCiAgICANCiAgICBjb25zdCBmcm9tV2lkdGggPSBwYXJzZUZsb2F0KGZyb21TdHlsZXMud2lkdGgpIHx8IDIwMDsNCiAgICBjb25zdCBmcm9tSGVpZ2h0ID0gcGFyc2VGbG9hdChmcm9tU3R5bGVzLmhlaWdodCkgfHwgODA7DQogICAgY29uc3QgdG9XaWR0aCA9IHBhcnNlRmxvYXQodG9TdHlsZXMud2lkdGgpIHx8IDIwMDsNCiAgICBjb25zdCB0b0hlaWdodCA9IHBhcnNlRmxvYXQodG9TdHlsZXMuaGVpZ2h0KSB8fCA4MDsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgY29ubmVjdGlvbiBwb3NpdGlvbnMgZGlyZWN0bHkgZnJvbSBub2RlIGRhdGEgKG5vIGV4dHJhIHRyYW5zZm9ybXMpDQogICAgLy8gRnJvbSBvdXRwdXQgcG9ydCAocmlnaHQgc2lkZSBvZiBmcm9tIG5vZGUsIG1pZGRsZSB2ZXJ0aWNhbGx5KQ0KICAgIGNvbnN0IGZyb21YID0gZnJvbU5vZGVEYXRhLnggKyBmcm9tV2lkdGg7DQogICAgY29uc3QgZnJvbVkgPSBmcm9tTm9kZURhdGEueSArIGZyb21IZWlnaHQgLyAyOw0KICAgIA0KICAgIC8vIFRvIGlucHV0IHBvcnQgKGxlZnQgc2lkZSBvZiB0byBub2RlLCBtaWRkbGUgdmVydGljYWxseSkgIA0KICAgIGNvbnN0IHRvWCA9IHRvTm9kZURhdGEueDsNCiAgICBjb25zdCB0b1kgPSB0b05vZGVEYXRhLnkgKyB0b0hlaWdodCAvIDI7DQogICAgDQogICAgY29uc29sZS5sb2coJ0Nvbm5lY3Rpb24gY29vcmRzOicsIGNvbm5lY3Rpb24uaWQsICdmcm9tOicsIGZyb21YLCBmcm9tWSwgJ3RvOicsIHRvWCwgdG9ZKTsNCiAgICANCiAgICAvLyBVcGRhdGUgdGhlIHBhdGgNCiAgICBjb25zdCBwYXRoID0gY29ubmVjdGlvbi5zdmcucXVlcnlTZWxlY3RvcigncGF0aCcpOw0KICAgIGlmIChwYXRoKSB7DQogICAgICAgIGNvbnN0IGNvbnRyb2xQb2ludDFYID0gZnJvbVggKyAodG9YIC0gZnJvbVgpICogMC41Ow0KICAgICAgICBjb25zdCBjb250cm9sUG9pbnQyWCA9IGZyb21YICsgKHRvWCAtIGZyb21YKSAqIDAuNTsNCiAgICAgICAgY29uc3QgcGF0aEQgPSBgTSAke2Zyb21YfSAke2Zyb21ZfSBDICR7Y29udHJvbFBvaW50MVh9ICR7ZnJvbVl9ICR7Y29udHJvbFBvaW50Mlh9ICR7dG9ZfSAke3RvWH0gJHt0b1l9YDsNCiAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCBwYXRoRCk7DQogICAgICAgIGNvbnNvbGUubG9nKCdTZXQgcGF0aDonLCBwYXRoRCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgY29uc29sZS5sb2coJ05vIHBhdGggZWxlbWVudCBmb3VuZCBmb3IgY29ubmVjdGlvbjonLCBjb25uZWN0aW9uLmlkKTsNCiAgICB9DQp9DQoNCi8vIFJlZHJhdyBhbGwgY29ubmVjdGlvbnMgKGZvciB3aW5kb3cgcmVzaXplLCBldGMuKQ0KZnVuY3Rpb24gcmVkcmF3QWxsQ29ubmVjdGlvbnMoKSB7DQogICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpIHsNCiAgICAgICAgdXBkYXRlQ29ubmVjdGlvbihjb25uZWN0aW9uKTsNCiAgICB9DQp9DQoNCi8vIERlbGV0ZSBhIG5vZGUgYW5kIGFsbCBpdHMgY29ubmVjdGlvbnMNCmZ1bmN0aW9uIGRlbGV0ZU5vZGUobm9kZUlkKSB7DQogICAgaWYgKGNvbmZpcm0oYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBub2RlP2ApKSB7DQogICAgICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChub2RlSWQpOw0KICAgICAgICANCiAgICAgICAgLy8gQ2xlYW4gdXAgYXVkaW8gZWxlbWVudHMgaWYgdGhpcyBpcyBhbiBhdWRpbyBub2RlDQogICAgICAgIGlmIChub2RlICYmIG5vZGUudHlwZSA9PT0gJ2F1ZGlvJyAmJiBub2RlLmF1ZGlvRWxlbWVudCkgew0KICAgICAgICAgICAgLy8gUGF1c2UgYW5kIHN0b3AgdGhlIGF1ZGlvDQogICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5wYXVzZSgpOw0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuY3VycmVudFRpbWUgPSAwOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBSZW1vdmUgZXZlbnQgbGlzdGVuZXJzIHByb3Blcmx5DQogICAgICAgICAgICBpZiAobm9kZS5hdWRpb0V2ZW50TGlzdGVuZXJzKSB7DQogICAgICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBub2RlLmF1ZGlvRXZlbnRMaXN0ZW5lcnMuZW5kZWQpOw0KICAgICAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgbm9kZS5hdWRpb0V2ZW50TGlzdGVuZXJzLmVycm9yKTsNCiAgICAgICAgICAgICAgICBub2RlLmF1ZGlvRXZlbnRMaXN0ZW5lcnMgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBTdG9yZSB0aGUgc3JjIGJlZm9yZSBjbGVhcmluZyBpdCBmb3IgY2xlYW51cA0KICAgICAgICAgICAgY29uc3QgYXVkaW9TcmMgPSBub2RlLmF1ZGlvRWxlbWVudC5zcmM7DQogICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5zcmMgPSAnJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gUmV2b2tlIGJsb2IgVVJMIGlmIGl0IGV4aXN0cw0KICAgICAgICAgICAgaWYgKGF1ZGlvU3JjICYmIGF1ZGlvU3JjLnN0YXJ0c1dpdGgoJ2Jsb2I6JykpIHsNCiAgICAgICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGF1ZGlvU3JjKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIGF1ZGlvIGVsZW1lbnQgcmVmZXJlbmNlDQogICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudCA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFJlbW92ZSBhbGwgY29ubmVjdGlvbnMgaW52b2x2aW5nIHRoaXMgbm9kZQ0KICAgICAgICBjb25zdCBjb25uZWN0aW9uc1RvRGVsZXRlID0gW107DQogICAgICAgIGZvciAoY29uc3QgW2Nvbm5lY3Rpb25JZCwgY29ubmVjdGlvbl0gb2YgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5lbnRyaWVzKCkpIHsNCiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uLmZyb20ubm9kZUlkID09PSBub2RlSWQgfHwgY29ubmVjdGlvbi50by5ub2RlSWQgPT09IG5vZGVJZCkgew0KICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25zVG9EZWxldGUucHVzaChjb25uZWN0aW9uSWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBEZWxldGUgY29ubmVjdGlvbnMNCiAgICAgICAgZm9yIChjb25zdCBjb25uZWN0aW9uSWQgb2YgY29ubmVjdGlvbnNUb0RlbGV0ZSkgew0KICAgICAgICAgICAgZGVsZXRlQ29ubmVjdGlvbihjb25uZWN0aW9uSWQpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBSZW1vdmUgbm9kZSBmcm9tIGRhdGEgc3RydWN0dXJlDQogICAgICAgIGZsb3dFZGl0b3Iubm9kZXMuZGVsZXRlKG5vZGVJZCk7DQogICAgICAgIA0KICAgICAgICAvLyBSZW1vdmUgbm9kZSBlbGVtZW50IGZyb20gRE9NDQogICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICBub2RlRWxlbWVudC5yZW1vdmUoKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRGVzZWxlY3QgaWYgdGhpcyB3YXMgdGhlIHNlbGVjdGVkIG5vZGUNCiAgICAgICAgaWYgKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID09PSBub2RlSWQpIHsNCiAgICAgICAgICAgIGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID0gbnVsbDsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2RlLWNvbmZpZycpLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1tdXRlZCI+U2VsZWN0IGEgbm9kZSB0byBjb25maWd1cmUgaXQ8L3A+JzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uc29sZS5sb2coYERlbGV0ZWQgbm9kZTogJHtub2RlSWR9YCk7DQogICAgfQ0KfQ0KDQovLyBEZWxldGUgYSBjb25uZWN0aW9uDQpmdW5jdGlvbiBkZWxldGVDb25uZWN0aW9uKGNvbm5lY3Rpb25JZCkgew0KICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmdldChjb25uZWN0aW9uSWQpOw0KICAgIGlmIChjb25uZWN0aW9uICYmIGNvbm5lY3Rpb24uc3ZnKSB7DQogICAgICAgIGNvbm5lY3Rpb24uc3ZnLnJlbW92ZSgpOw0KICAgIH0NCiAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmRlbGV0ZShjb25uZWN0aW9uSWQpOw0KICAgIGNvbnNvbGUubG9nKGBEZWxldGVkIGNvbm5lY3Rpb246ICR7Y29ubmVjdGlvbklkfWApOw0KfQ0KDQovLyBEZWxldGUgc2VsZWN0ZWQgbm9kZQ0KZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWROb2RlKCkgew0KICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSkgew0KICAgICAgICBkZWxldGVOb2RlKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlKTsNCiAgICB9DQp9DQoNCi8vIEhhbmRsZSBrZXlib2FyZCBzaG9ydGN1dHMNCmZ1bmN0aW9uIGhhbmRsZUtleURvd24oZSkgew0KICAgIGlmIChlLmtleSA9PT0gJ0RlbGV0ZScgfHwgKGUua2V5ID09PSAnQmFja3NwYWNlJyAmJiBlLmN0cmxLZXkpKSB7DQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSkgew0KICAgICAgICAgICAgZGVsZXRlU2VsZWN0ZWROb2RlKCk7DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGUua2V5ID09PSAnRXNjYXBlJykgew0KICAgICAgICAvLyBEZXNlbGVjdCBub2RlDQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSkgew0KICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSk7DQogICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQpIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7DQogICAgICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG51bGw7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9kZS1jb25maWcnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPic7DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJ3MnICYmICFlLnNoaWZ0S2V5KSB7DQogICAgICAgIC8vIEN0cmwvQ21kICsgUzogU2F2ZQ0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvdygpOw0KICAgIH0gZWxzZSBpZiAoKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpICYmIGUuc2hpZnRLZXkgJiYgZS5rZXkgPT09ICdTJykgew0KICAgICAgICAvLyBDdHJsL0NtZCArIFNoaWZ0ICsgUzogU2F2ZSBBcw0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvd0FzKCk7DQogICAgfSBlbHNlIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgZS5rZXkgPT09ICdvJykgew0KICAgICAgICAvLyBDdHJsL0NtZCArIE86IExvYWQNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIubG9hZEZsb3coKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJz0nKSB7DQogICAgICAgIC8vIEN0cmwvQ21kICsgPTogWm9vbSBJbg0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21JbigpOw0KICAgIH0gZWxzZSBpZiAoKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpICYmIGUua2V5ID09PSAnLScpIHsNCiAgICAgICAgLy8gQ3RybC9DbWQgKyAtOiBab29tIE91dA0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21PdXQoKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJzAnKSB7DQogICAgICAgIC8vIEN0cmwvQ21kICsgMDogUmVzZXQgem9vbSBhbmQgcGFuDQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgd2luZG93LmNhbnZhc01hbmFnZXIucmVzZXRDYW52YXNQYW4oKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiAoZS5zaGlmdEtleSkgJiYgZS5rZXkgPT09ICdGJykgew0KICAgICAgICAvLyBDdHJsL0NtZCArIFNoaWZ0ICsgRjogWm9vbSB0byBmaXQNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci56b29tVG9GaXQoKTsNCiAgICB9DQp9DQoNCi8vIEhhbmRsZSBwb3J0IG1vdXNlIGV2ZW50cyBmb3IgY29ubmVjdGlvbnMNCmZ1bmN0aW9uIGhhbmRsZVBvcnRNb3VzZURvd24oZSwgbm9kZUlkLCBwb3J0TmFtZSwgaXNPdXRwdXQpIHsNCiAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICANCiAgICBpZiAoaXNPdXRwdXQpIHsNCiAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbSA9IHsgbm9kZUlkLCBwb3J0TmFtZSB9Ow0KICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdjb25uZWN0aW5nJyk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20pIHsNCiAgICAgICAgICAgIGNyZWF0ZUNvbm5lY3Rpb24oZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbS5ub2RlSWQsIGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20ucG9ydE5hbWUsIG5vZGVJZCwgcG9ydE5hbWUpOw0KICAgICAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbSA9IG51bGw7DQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmxvdy1ub2RlLXBvcnQnKS5mb3JFYWNoKHBvcnQgPT4gcG9ydC5jbGFzc0xpc3QucmVtb3ZlKCdjb25uZWN0aW5nJykpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyBDcmVhdGUgYSBjb25uZWN0aW9uIGJldHdlZW4gbm9kZXMNCmZ1bmN0aW9uIGNyZWF0ZUNvbm5lY3Rpb24oZnJvbU5vZGVJZCwgZnJvbVBvcnQsIHRvTm9kZUlkLCB0b1BvcnQpIHsNCiAgICAvLyBDaGVjayBpZiBjb25uZWN0aW9uIGFscmVhZHkgZXhpc3RzDQogICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpIHsNCiAgICAgICAgaWYgKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgPT09IGZyb21Ob2RlSWQgJiYgDQogICAgICAgICAgICBjb25uZWN0aW9uLmZyb20ucG9ydE5hbWUgPT09IGZyb21Qb3J0ICYmDQogICAgICAgICAgICBjb25uZWN0aW9uLnRvLm5vZGVJZCA9PT0gdG9Ob2RlSWQgJiYgDQogICAgICAgICAgICBjb25uZWN0aW9uLnRvLnBvcnROYW1lID09PSB0b1BvcnQpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0aW9uIGFscmVhZHkgZXhpc3RzJyk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgY29uc3QgY29ubmVjdGlvbklkID0gYGNvbm5fJHtmcm9tTm9kZUlkfV8ke2Zyb21Qb3J0fV8ke3RvTm9kZUlkfV8ke3RvUG9ydH1gOw0KICAgIGNvbnN0IGNvbm5lY3Rpb24gPSB7DQogICAgICAgIGlkOiBjb25uZWN0aW9uSWQsDQogICAgICAgIGZyb206IHsgbm9kZUlkOiBmcm9tTm9kZUlkLCBwb3J0TmFtZTogZnJvbVBvcnQgfSwNCiAgICAgICAgdG86IHsgbm9kZUlkOiB0b05vZGVJZCwgcG9ydE5hbWU6IHRvUG9ydCB9DQogICAgfTsNCiAgICANCiAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnNldChjb25uZWN0aW9uSWQsIGNvbm5lY3Rpb24pOw0KICAgIGRyYXdDb25uZWN0aW9uKGNvbm5lY3Rpb24pOw0KICAgIA0KICAgIGNvbnNvbGUubG9nKGBDcmVhdGVkIGNvbm5lY3Rpb246ICR7Y29ubmVjdGlvbklkfWApOw0KfQ0KDQovLyBEcmF3IGEgY29ubmVjdGlvbiBvbiB0aGUgY2FudmFzDQpmdW5jdGlvbiBkcmF3Q29ubmVjdGlvbihjb25uZWN0aW9uKSB7DQogICAgY29uc3QgZnJvbU5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25uZWN0aW9uLmZyb20ubm9kZUlkKTsNCiAgICBjb25zdCB0b05vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25uZWN0aW9uLnRvLm5vZGVJZCk7DQogICAgDQogICAgaWYgKCFmcm9tTm9kZSB8fCAhdG9Ob2RlKSByZXR1cm47DQogICAgDQogICAgLy8gQ3JlYXRlIFNWRyBlbGVtZW50IGZvciB0aGUgY29ubmVjdGlvbg0KICAgIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnc3ZnJyk7DQogICAgc3ZnLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsNCiAgICBzdmcuc3R5bGUudG9wID0gJzAnOw0KICAgIHN2Zy5zdHlsZS5sZWZ0ID0gJzAnOw0KICAgIHN2Zy5zdHlsZS53aWR0aCA9ICcxMDAlJzsNCiAgICBzdmcuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOw0KICAgIHN2Zy5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnOyAvLyBEb24ndCBjYXB0dXJlIGV2ZW50cyBieSBkZWZhdWx0DQogICAgc3ZnLnN0eWxlLnpJbmRleCA9ICcxJzsNCiAgICBzdmcuZGF0YXNldC5jb25uZWN0aW9uSWQgPSBjb25uZWN0aW9uLmlkOw0KICAgIA0KICAgIGNvbnN0IHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BhdGgnKTsNCiAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyM0Q0FGNTAnKTsNCiAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzInKTsNCiAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZmlsbCcsICdub25lJyk7DQogICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ21hcmtlci1lbmQnLCAndXJsKCNhcnJvd2hlYWQpJyk7DQogICAgcGF0aC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7DQogICAgcGF0aC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2F1dG8nOyAvLyBPbmx5IHRoZSBwYXRoIGNhcHR1cmVzIGV2ZW50cw0KICAgIA0KICAgIC8vIEFkZCBob3ZlciBlZmZlY3RzDQogICAgcGF0aC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4gew0KICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzQnKTsNCiAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICcjZmY2YjZiJyk7DQogICAgICAgIC8vIFNob3cgZGVsZXRlIHRvb2x0aXANCiAgICAgICAgc2hvd0Nvbm5lY3Rpb25Ub29sdGlwKGNvbm5lY3Rpb24uaWQsICdDbGljayB0byBkZWxldGUgY29ubmVjdGlvbicpOw0KICAgIH0pOw0KICAgIA0KICAgIHBhdGguYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHsNCiAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcyJyk7DQogICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnIzRDQUY1MCcpOw0KICAgICAgICBoaWRlQ29ubmVjdGlvblRvb2x0aXAoKTsNCiAgICB9KTsNCiAgICANCiAgICAvLyBBZGQgY2xpY2sgdG8gZGVsZXRlDQogICAgcGF0aC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgIGlmIChjb25maXJtKCdEZWxldGUgdGhpcyBjb25uZWN0aW9uPycpKSB7DQogICAgICAgICAgICBkZWxldGVDb25uZWN0aW9uKGNvbm5lY3Rpb24uaWQpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgc3ZnLmFwcGVuZENoaWxkKHBhdGgpOw0KICAgIGZsb3dFZGl0b3IuY2FudmFzLmFwcGVuZENoaWxkKHN2Zyk7DQogICAgDQogICAgLy8gU3RvcmUgU1ZHIHJlZmVyZW5jZQ0KICAgIGNvbm5lY3Rpb24uc3ZnID0gc3ZnOw0KICAgIA0KICAgIC8vIFVwZGF0ZSBjb25uZWN0aW9uIHBvc2l0aW9uDQogICAgdXBkYXRlQ29ubmVjdGlvbihjb25uZWN0aW9uKTsNCn0NCg0KLy8gU2hvdyBjb25uZWN0aW9uIHRvb2x0aXANCmZ1bmN0aW9uIHNob3dDb25uZWN0aW9uVG9vbHRpcChjb25uZWN0aW9uSWQsIG1lc3NhZ2UpIHsNCiAgICAvLyBDaGVjayBpZiBhcHAgaXMgc3RpbGwgYWN0aXZlDQogICAgaWYgKCFmbG93RWRpdG9yLmlzQWN0aXZlKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHRvb2x0aXANCiAgICBoaWRlQ29ubmVjdGlvblRvb2x0aXAoKTsNCiAgICANCiAgICBjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgdG9vbHRpcC5jbGFzc05hbWUgPSAnY29ubmVjdGlvbi10b29sdGlwJzsNCiAgICB0b29sdGlwLnRleHRDb250ZW50ID0gbWVzc2FnZTsNCiAgICB0b29sdGlwLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjgpOw0KICAgICAgICBjb2xvcjogd2hpdGU7DQogICAgICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCiAgICAgICAgei1pbmRleDogMTAwMDA7DQogICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgYDsNCiAgICANCiAgICB0b29sdGlwLmlkID0gJ2Nvbm5lY3Rpb24tdG9vbHRpcCc7DQogICAgDQogICAgLy8gVHJ5IHRvIGFwcGVuZCB0byBhcHAgY29udGFpbmVyIGZpcnN0LCBmYWxsYmFjayB0byBib2R5DQogICAgY29uc3QgYXBwQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFwcC1jb250YWluZXInKTsNCiAgICBjb25zdCBjb250YWluZXIgPSBhcHBDb250YWluZXIgfHwgZG9jdW1lbnQuYm9keTsNCiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodG9vbHRpcCk7DQogICAgDQogICAgLy8gUG9zaXRpb24gdG9vbHRpcCBuZWFyIG1vdXNlICh3aWxsIGJlIHVwZGF0ZWQgb24gbW91c2Vtb3ZlKQ0KICAgIGNvbnN0IHRvb2x0aXBNb3VzZU1vdmVIYW5kbGVyID0gKGUpID0+IHVwZGF0ZVRvb2x0aXBQb3NpdGlvbihlKTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0b29sdGlwTW91c2VNb3ZlSGFuZGxlcik7DQogICAgDQogICAgLy8gU3RvcmUgdGhlIGhhbmRsZXIgcmVmZXJlbmNlIGZvciBjbGVhbnVwDQogICAgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlciA9IHRvb2x0aXBNb3VzZU1vdmVIYW5kbGVyOw0KICAgIA0KICAgIC8vIFNob3cgdGhlIHRvb2x0aXAgYWZ0ZXIgYSBzbWFsbCBkZWxheSB0byBwcmV2ZW50IGZsaWNrZXJpbmcNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgaWYgKHRvb2x0aXAucGFyZW50Tm9kZSAmJiBmbG93RWRpdG9yLmlzQWN0aXZlKSB7DQogICAgICAgICAgICB0b29sdGlwLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICB9DQogICAgfSwgMTApOw0KfQ0KDQovLyBVcGRhdGUgdG9vbHRpcCBwb3NpdGlvbg0KZnVuY3Rpb24gdXBkYXRlVG9vbHRpcFBvc2l0aW9uKGUpIHsNCiAgICBjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvbm5lY3Rpb24tdG9vbHRpcCcpOw0KICAgIGlmICh0b29sdGlwKSB7DQogICAgICAgIC8vIFVzZSBzY2FsZWQgY29vcmRpbmF0ZXMgZm9yIHRvb2x0aXAgcG9zaXRpb25pbmcNCiAgICAgICAgY29uc3QgbW91c2VDb29yZHMgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDogDQogICAgICAgICAgICB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07DQogICAgICAgIHRvb2x0aXAuc3R5bGUubGVmdCA9IChtb3VzZUNvb3Jkcy54ICsgMTApICsgJ3B4JzsNCiAgICAgICAgdG9vbHRpcC5zdHlsZS50b3AgPSAobW91c2VDb29yZHMueSAtIDEwKSArICdweCc7DQogICAgfQ0KfQ0KDQovLyBIaWRlIGNvbm5lY3Rpb24gdG9vbHRpcA0KZnVuY3Rpb24gaGlkZUNvbm5lY3Rpb25Ub29sdGlwKCkgew0KICAgIGNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29ubmVjdGlvbi10b29sdGlwJyk7DQogICAgaWYgKHRvb2x0aXApIHsNCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBzcGVjaWZpYyBldmVudCBsaXN0ZW5lciB3ZSBhZGRlZA0KICAgICAgICBpZiAod2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcikgew0KICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcik7DQogICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclRvb2x0aXBIYW5kbGVyID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gSGlkZSBhbmQgcmVtb3ZlIHRoZSB0b29sdGlwDQogICAgICAgIHRvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgaWYgKHRvb2x0aXAucGFyZW50Tm9kZSkgew0KICAgICAgICAgICAgdG9vbHRpcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRvb2x0aXApOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyBDbGVhciB0aGUgY2FudmFzDQpmdW5jdGlvbiBjbGVhckNhbnZhcygpIHsNCiAgICBpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoZSBjYW52YXM/IFRoaXMgd2lsbCBkZWxldGUgYWxsIG5vZGVzIGFuZCBjb25uZWN0aW9ucy4nKSkgew0KICAgICAgICAvLyBIaWRlIGFueSBhY3RpdmUgdG9vbHRpcHMNCiAgICAgICAgaGlkZUNvbm5lY3Rpb25Ub29sdGlwKCk7DQogICAgICAgIA0KICAgICAgICAvLyBDbGVhciBhbGwgY29ubmVjdGlvbnMNCiAgICAgICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpIHsNCiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uLnN2Zykgew0KICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc3ZnLnJlbW92ZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuY2xlYXIoKTsNCiAgICAgICAgDQogICAgICAgIC8vIENsZWFyIGFsbCBub2Rlcw0KICAgICAgICBmb3IgKGNvbnN0IG5vZGVJZCBvZiBmbG93RWRpdG9yLm5vZGVzLmtleXMoKSkgew0KICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub2RlSWQpOw0KICAgICAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQucmVtb3ZlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZmxvd0VkaXRvci5ub2Rlcy5jbGVhcigpOw0KICAgICAgICANCiAgICAgICAgLy8gQ2xlYXIgYWxsIHRhZ3MNCiAgICAgICAgZm9yIChjb25zdCB0YWdJZCBvZiBmbG93RWRpdG9yLnRhZ3Mua2V5cygpKSB7DQogICAgICAgICAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFnSWQpOw0KICAgICAgICAgICAgaWYgKHRhZ0VsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICB0YWdFbGVtZW50LnJlbW92ZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZsb3dFZGl0b3IudGFncy5jbGVhcigpOw0KICAgICAgICANCiAgICAgICAgLy8gUmVzZXQgY291bnRlcnMNCiAgICAgICAgZmxvd0VkaXRvci5ub2RlQ291bnRlciA9IDA7DQogICAgICAgIGZsb3dFZGl0b3IudGFnQ291bnRlciA9IDA7DQogICAgICAgIGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID0gbnVsbDsNCiAgICAgICAgDQogICAgICAgIC8vIENsZWFyIGN1cnJlbnQgZmlsZSBwYXRoDQogICAgICAgIGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoID0gbnVsbDsNCiAgICAgICAgDQogICAgICAgIC8vIFJlc2V0IHBhbiBvZmZzZXQgdG8gY2VudGVyIG9mIGxhcmdlIGNhbnZhcw0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldCA9IHsgeDogLTUwMDAsIHk6IC01MDAwIH07DQogICAgICAgIA0KICAgICAgICAvLyBSZXNldCB6b29tIGxldmVsDQogICAgICAgIGZsb3dFZGl0b3Iuem9vbUxldmVsID0gMS4wOw0KICAgICAgICANCiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0gPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBVcGRhdGUgZmlsZW5hbWUgZGlzcGxheQ0KICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5maWxlTWFuYWdlci51cGRhdGVGaWxlbmFtZURpc3BsYXkgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgIHdpbmRvdy5maWxlTWFuYWdlci51cGRhdGVGaWxlbmFtZURpc3BsYXkoKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gQ2xlYXIgY29uZmlnIHBhbmVsDQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2RlLWNvbmZpZycpLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1tdXRlZCI+U2VsZWN0IGEgbm9kZSB0byBjb25maWd1cmUgaXQ8L3A+JzsNCiAgICAgICAgDQogICAgICAgIGNvbnNvbGUubG9nKCdDYW52YXMgY2xlYXJlZCcpOw0KICAgIH0NCn0gDQoNCg0KLy8gU2hvdyBub2RlIGNvbmZpZ3VyYXRpb24NCmZ1bmN0aW9uIHNob3dOb2RlQ29uZmlnKG5vZGVJZCkgew0KICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChub2RlSWQpOw0KICAgIGlmICghbm9kZSkgcmV0dXJuOw0KICAgIA0KICAgIGNvbnN0IG5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUobm9kZS50eXBlKTsNCiAgICBpZiAoIW5vZGVEZWYpIHJldHVybjsNCiAgICANCiAgICAvLyBTaG93IGNvbmZpZyBwYW5lbCB3aXRoIG5vZGUgY29uZmlndXJhdGlvbg0KICAgIGNvbnN0IGNvbmZpZ1BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vZGUtY29uZmlnJyk7DQogICAgaWYgKGNvbmZpZ1BhbmVsKSB7DQogICAgICAgIGxldCBjb25maWdIdG1sID0gYDxoND4ke25vZGVEZWYubmFtZX0gQ29uZmlndXJhdGlvbjwvaDQ+YDsNCiAgICAgICAgDQogICAgICAgIC8vIEFkZCBzcGVjaWFsIGNvbnRlbnQgZGlzcGxheSBmb3IgZGlmZmVyZW50IG5vZGUgdHlwZXMNCiAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ2Rpc3BsYXknICYmIG5vZGUubGFzdENvbnRlbnQpIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5MYXN0IENvbnRlbnQ8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LWRpc3BsYXkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHByZSBjbGFzcz0iY29udGVudC10ZXh0Ij4ke2VzY2FwZUh0bWwobm9kZS5sYXN0Q29udGVudCl9PC9wcmU+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LWluZm8iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5Gb3JtYXQ6ICR7bm9kZS5sYXN0Rm9ybWF0fSDigKIgTGVuZ3RoOiAke25vZGUubGFzdENvbnRlbnQubGVuZ3RofSBjaGFyczwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ2ltYWdlJyAmJiBub2RlLmxhc3RJbWFnZURhdGEpIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5JbWFnZSBQcmV2aWV3PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW1hZ2UtZGlzcGxheSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz0iJHtub2RlLmxhc3RJbWFnZVVybH0iIGFsdD0iSW1hZ2UgcHJldmlldyIgc3R5bGU9Im1heC13aWR0aDogMjAwcHg7IG1heC1oZWlnaHQ6IDE1MHB4OyBib3JkZXI6IDFweCBzb2xpZCAjY2NjOyBib3JkZXItcmFkaXVzOiA0cHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImltYWdlLWluZm8iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5TaXplOiAke25vZGUubGFzdEltYWdlSW5mbz8ud2lkdGggfHwgJz8nfXgke25vZGUubGFzdEltYWdlSW5mbz8uaGVpZ2h0IHx8ICc/J30g4oCiIEZvcm1hdDogJHtub2RlLmxhc3RJbWFnZUluZm8/LmZvcm1hdCB8fCAnPyd9PC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tcHJpbWFyeSBtdC0yIHZpZXctZnVsbC1pbWFnZS1idG4iIGRhdGEtbm9kZS1pZD0iJHtub2RlSWR9Ij5WaWV3IEZ1bGwgSW1hZ2U8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ2F1ZGlvJyAmJiBub2RlLmxhc3RBdWRpb0RhdGEpIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5BdWRpbyBDb250cm9sczwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImF1ZGlvLWRpc3BsYXkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYXVkaW8taW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsPkF1ZGlvIGxvYWRlZCBzdWNjZXNzZnVsbHk8L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhdWRpby1jb250cm9scyBtdC0yIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1zdWNjZXNzIHBsYXktYXVkaW8tYnRuIiBkYXRhLW5vZGUtaWQ9IiR7bm9kZUlkfSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGxheSI+PC9pPiBQbGF5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tZGFuZ2VyIHN0b3AtYXVkaW8tYnRuIiBkYXRhLW5vZGUtaWQ9IiR7bm9kZUlkfSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc3RvcCI+PC9pPiBTdG9wDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ3Zmc19sb2FkJykgew0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlZGUyBMb2FkIFN0YXR1czwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZmcy1sb2FkLWluZm8iPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsPkxhc3QgbG9hZGVkOiAke25vZGUubGFzdExvYWRlZEZpbGUgfHwgJ05vbmUnfTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdsbG1fY2hhdCcgJiYgbm9kZS5sYXN0UmVzcG9uc2UpIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5MYXN0IFJlc3BvbnNlPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1kaXNwbGF5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwcmUgY2xhc3M9ImNvbnRlbnQtdGV4dCI+JHtlc2NhcGVIdG1sKG5vZGUubGFzdFJlc3BvbnNlKX08L3ByZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRlbnQtaW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsPlRva2VuczogJHtub2RlLmxhc3RVc2FnZT8udG90YWxfdG9rZW5zIHx8IDB9IOKAoiBNb2RlbDogJHtub2RlLmxhc3RNb2RlbCB8fCAnVW5rbm93bid9PC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAncmVwZWF0ZXInKSB7DQogICAgICAgICAgICBjb25zdCBpc1J1bm5pbmcgPSBub2RlLnJlcGVhdGVyU3RhdGUgJiYgbm9kZS5yZXBlYXRlclN0YXRlLmlzUnVubmluZzsNCiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gbm9kZS5yZXBlYXRlclN0YXRlID8gbm9kZS5yZXBlYXRlclN0YXRlLmNvdW50IDogMDsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5SZXBlYXRlciBDb250cm9sczwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlcGVhdGVyLWRpc3BsYXkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVwZWF0ZXItaW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsPlN0YXR1czogJHtpc1J1bm5pbmcgPyAnUnVubmluZycgOiAnU3RvcHBlZCd9IOKAoiBDb3VudDogJHtjb3VudH08L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZXBlYXRlci1jb250cm9scyBtdC0yIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1zdWNjZXNzIHN0YXJ0LXJlcGVhdGVyLWJ0biIgZGF0YS1ub2RlLWlkPSIke25vZGVJZH0iICR7aXNSdW5uaW5nID8gJ2Rpc2FibGVkJyA6ICcnfT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1wbGF5Ij48L2k+IFN0YXJ0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tZGFuZ2VyIHN0b3AtcmVwZWF0ZXItYnRuIiBkYXRhLW5vZGUtaWQ9IiR7bm9kZUlkfSIgJHshaXNSdW5uaW5nID8gJ2Rpc2FibGVkJyA6ICcnfT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zdG9wIj48L2k+IFN0b3ANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFNob3cgaW5wdXQgbWFwcGluZ3MgY29uZmlndXJhdGlvbiAod2hhdCB0aGlzIG5vZGUgcmVjZWl2ZXMgZnJvbSBvdGhlciBub2RlcykNCiAgICAgICAgY29uc3QgaW5wdXRDb25uZWN0aW9ucyA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkNCiAgICAgICAgICAgIC5maWx0ZXIoY29ubiA9PiBjb25uLnRvLm5vZGVJZCA9PT0gbm9kZUlkKTsNCiAgICAgICAgDQogICAgICAgIGlmIChpbnB1dENvbm5lY3Rpb25zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5SZWNlaXZpbmcgRnJvbTwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LW1hcHBpbmdzLWNvbmZpZyI+DQogICAgICAgICAgICBgOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgKGNvbnN0IGNvbm4gb2YgaW5wdXRDb25uZWN0aW9ucykgew0KICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZU5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChjb25uLmZyb20ubm9kZUlkKTsNCiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VOb2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKHNvdXJjZU5vZGU/LnR5cGUgfHwgJ3Vua25vd24nKTsNCiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VOb2RlTmFtZSA9IHNvdXJjZU5vZGVEZWY/Lm5hbWUgfHwgc291cmNlTm9kZT8udHlwZSB8fCAndW5rbm93bic7DQogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPdXRwdXQgPSBzb3VyY2VOb2RlRGVmPy5vdXRwdXRzPy5maW5kKG91dHB1dCA9PiBvdXRwdXQuaWQgPT09IGNvbm4uZnJvbS5wb3J0TmFtZSk7DQogICAgICAgICAgICAgICAgY29uc3Qgb3V0cHV0TmFtZSA9IHNlbGVjdGVkT3V0cHV0ID8gc2VsZWN0ZWRPdXRwdXQubmFtZSA6IGNvbm4uZnJvbS5wb3J0TmFtZTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBTaW1wbGU6IFNob3cgd2hhdCBJJ20gcmVjZWl2aW5nIGFuZCBsZXQgbWUgY2hvb3NlIG15IGlucHV0IHBvcnQNCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5wdXQtbWFwcGluZy1jb25maWciPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29ubmVjdGlvbi1oZWFkZXIiPkZyb20gJHtzb3VyY2VOb2RlTmFtZX0gKCR7b3V0cHV0TmFtZX0pPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25uZWN0aW9uLWNvbnRyb2xzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250cm9sLXJvdyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5UbyBteSBpbnB1dDo8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJpbnB1dF90YXJnZXRfJHtub2RlSWR9fCR7Y29ubi50by5wb3J0TmFtZX0iIGNsYXNzPSJpbnB1dC10YXJnZXQtc2VsZWN0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+U2VsZWN0Li4uPC9vcHRpb24+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke25vZGVEZWYuaW5wdXRzLm1hcChpbnB1dCA9PiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPG9wdGlvbiB2YWx1ZT0iJHtpbnB1dC5pZH0iICR7Y29ubi50by5wb3J0TmFtZSA9PT0gaW5wdXQuaWQgPyAnc2VsZWN0ZWQnIDogJyd9PiR7aW5wdXQubmFtZX08L29wdGlvbj5gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmpvaW4oJycpfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBTaG93IG91dHB1dCBtYXBwaW5ncyBjb25maWd1cmF0aW9uICh3aGF0IG90aGVyIG5vZGVzIHJlY2VpdmUgZnJvbSB0aGlzIG5vZGUpDQogICAgICAgIGNvbnN0IG91dHB1dENvbm5lY3Rpb25zID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKQ0KICAgICAgICAgICAgLmZpbHRlcihjb25uID0+IGNvbm4uZnJvbS5ub2RlSWQgPT09IG5vZGVJZCk7DQogICAgICAgIA0KICAgICAgICBpZiAob3V0cHV0Q29ubmVjdGlvbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlNlbmRpbmcgVG88L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvdXRwdXQtbWFwcGluZ3MtY29uZmlnIj4NCiAgICAgICAgICAgIGA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciAoY29uc3QgY29ubiBvZiBvdXRwdXRDb25uZWN0aW9ucykgew0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChjb25uLnRvLm5vZGVJZCk7DQogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Tm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZSh0YXJnZXROb2RlPy50eXBlIHx8ICd1bmtub3duJyk7DQogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Tm9kZU5hbWUgPSB0YXJnZXROb2RlRGVmPy5uYW1lIHx8IHRhcmdldE5vZGU/LnR5cGUgfHwgJ3Vua25vd24nOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIEdldCBhdmFpbGFibGUgb3V0cHV0cyBmcm9tIFRISVMgbm9kZSAoc291cmNlIG5vZGUpDQogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlTm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZShub2RlLnR5cGUpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGF2YWlsYWJsZU91dHB1dHMgPSBzb3VyY2VOb2RlRGVmPy5vdXRwdXRzIHx8IFtdOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvdXRwdXQtbWFwcGluZy1jb25maWciPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29ubmVjdGlvbi1oZWFkZXIiPlRvICR7dGFyZ2V0Tm9kZU5hbWV9PC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25uZWN0aW9uLWNvbnRyb2xzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250cm9sLXJvdyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5TZW5kIG91dHB1dDo8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJvdXRwdXRfbWFwcGluZ18ke25vZGVJZH18JHtjb25uLmZyb20ucG9ydE5hbWV9fCR7Y29ubi50by5ub2RlSWR9IiBjbGFzcz0ib3V0cHV0LW1hcHBpbmctc2VsZWN0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+U2VsZWN0Li4uPC9vcHRpb24+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2F2YWlsYWJsZU91dHB1dHMubWFwKG91dHB1dCA9PiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPG9wdGlvbiB2YWx1ZT0iJHtvdXRwdXQuaWR9IiAke2Nvbm4uZnJvbS5wb3J0TmFtZSA9PT0gb3V0cHV0LmlkID8gJ3NlbGVjdGVkJyA6ICcnfT4ke291dHB1dC5uYW1lfTwvb3B0aW9uPmANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuam9pbignJyl9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIGA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEdlbmVyYXRlIGNvbmZpZ3VyYXRpb24gZmllbGRzDQogICAgICAgIGZvciAoY29uc3QgW2tleSwgY29uZmlnXSBvZiBPYmplY3QuZW50cmllcyhub2RlRGVmLmNvbmZpZykpIHsNCiAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbmZpZ18ke25vZGVJZH1fJHtrZXl9Ij4ke2NvbmZpZy5sYWJlbH08L2xhYmVsPg0KICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGNvbmZpZy50eXBlID09PSAnc2VsZWN0Jykgew0KICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxzZWxlY3QgaWQ9ImNvbmZpZ18ke25vZGVJZH1fJHtrZXl9Ij5gOw0KICAgICAgICAgICAgICAgIGNvbmZpZy5vcHRpb25zLmZvckVhY2gob3B0aW9uID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBub2RlLmNvbmZpZ1trZXldLnZhbHVlID09PSBvcHRpb24gPyAnc2VsZWN0ZWQnIDogJyc7DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxvcHRpb24gdmFsdWU9IiR7b3B0aW9ufSIgJHtzZWxlY3RlZH0+JHtvcHRpb259PC9vcHRpb24+YDsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGA8L3NlbGVjdD5gOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb25maWcudHlwZSA9PT0gJ3RleHRhcmVhJykgew0KICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDx0ZXh0YXJlYSBpZD0iY29uZmlnXyR7bm9kZUlkfV8ke2tleX0iPiR7bm9kZS5jb25maWdba2V5XS52YWx1ZX08L3RleHRhcmVhPmA7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy50eXBlID09PSAnbnVtYmVyJykgew0KICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IGNvbmZpZy5taW4gPyBgIG1pbj0iJHtjb25maWcubWlufSJgIDogJyc7DQogICAgICAgICAgICAgICAgY29uc3QgbWF4ID0gY29uZmlnLm1heCA/IGAgbWF4PSIke2NvbmZpZy5tYXh9ImAgOiAnJzsNCiAgICAgICAgICAgICAgICBjb25zdCBzdGVwID0gY29uZmlnLnN0ZXAgPyBgIHN0ZXA9IiR7Y29uZmlnLnN0ZXB9ImAgOiAnJzsNCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iY29uZmlnXyR7bm9kZUlkfV8ke2tleX0iIHZhbHVlPSIke25vZGUuY29uZmlnW2tleV0udmFsdWV9IiR7bWlufSR7bWF4fSR7c3RlcH0+YDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPGlucHV0IHR5cGU9IiR7Y29uZmlnLnR5cGV9IiBpZD0iY29uZmlnXyR7bm9kZUlkfV8ke2tleX0iIHZhbHVlPSIke25vZGUuY29uZmlnW2tleV0udmFsdWV9Ij5gOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25maWdIdG1sICs9IGA8L2Rpdj5gOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25maWdQYW5lbC5pbm5lckhUTUwgPSBjb25maWdIdG1sOw0KICAgICAgICANCiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycyBmb3IgbWFwcGluZyBzZWxlY3RzDQogICAgICAgIC8vIE5vIGlucHV0IG1hcHBpbmcgc2VsZWN0cyBhbnltb3JlIC0gbm9kZXMgY2FuJ3QgY29udHJvbCB3aGF0IHRoZXkgcmVjZWl2ZQ0KICAgICAgICANCiAgICAgICAgY29uc3QgaW5wdXRUYXJnZXRTZWxlY3RzID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXRhcmdldC1zZWxlY3QnKTsNCiAgICAgICAgaW5wdXRUYXJnZXRTZWxlY3RzLmZvckVhY2goc2VsZWN0ID0+IHsNCiAgICAgICAgICAgIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IFtub2RlSWQsIGN1cnJlbnRJbnB1dFBvcnRdID0gZS50YXJnZXQuaWQucmVwbGFjZSgnaW5wdXRfdGFyZ2V0XycsICcnKS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkSW5wdXRQb3J0ID0gZS50YXJnZXQudmFsdWU7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0NoYW5naW5nIGlucHV0IHRhcmdldDonLCBub2RlSWQsIGN1cnJlbnRJbnB1dFBvcnQsICfihpInLCBzZWxlY3RlZElucHV0UG9ydCk7DQogICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgY29ubmVjdGlvbg0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLmZpbmQoY29ubiA9Pg0KICAgICAgICAgICAgICAgICAgICBjb25uLnRvLm5vZGVJZCA9PT0gbm9kZUlkICYmIGNvbm4udG8ucG9ydE5hbWUgPT09IGN1cnJlbnRJbnB1dFBvcnQNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uICYmIHNlbGVjdGVkSW5wdXRQb3J0KSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBhbGwgY29ubmVjdGlvbnMgZnJvbSB0aGUgc2FtZSBmcm9tTm9kZSB0byB0aGlzIG5vZGUgKHJlZ2FyZGxlc3Mgb2YgcG9ydCkNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbnNUb1JlbW92ZSA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkuZmlsdGVyKGNvbm4gPT4NCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4uZnJvbS5ub2RlSWQgPT09IGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgJiYgY29ubi50by5ub2RlSWQgPT09IG5vZGVJZA0KICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uc1RvUmVtb3ZlLmZvckVhY2goY29ubiA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmRlbGV0ZShjb25uLmlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25uLnN2ZykgY29ubi5zdmcucmVtb3ZlKCk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIG5ldyBjb25uZWN0aW9uDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb25JZCA9IGBjb25uXyR7Y29ubmVjdGlvbi5mcm9tLm5vZGVJZH1fJHtjb25uZWN0aW9uLmZyb20ucG9ydE5hbWV9XyR7bm9kZUlkfV8ke3NlbGVjdGVkSW5wdXRQb3J0fWA7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb24gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZDogbmV3Q29ubmVjdGlvbklkLA0KICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogeyBub2RlSWQ6IGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQsIHBvcnROYW1lOiBjb25uZWN0aW9uLmZyb20ucG9ydE5hbWUgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB7IG5vZGVJZDogbm9kZUlkLCBwb3J0TmFtZTogc2VsZWN0ZWRJbnB1dFBvcnQgfQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnNldChuZXdDb25uZWN0aW9uSWQsIG5ld0Nvbm5lY3Rpb24pOw0KICAgICAgICAgICAgICAgICAgICBkcmF3Q29ubmVjdGlvbihuZXdDb25uZWN0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXV0by1zYXZlDQogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2F2ZUZsb3cpIHdpbmRvdy5zYXZlRmxvdygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGNvbnN0IG91dHB1dE1hcHBpbmdTZWxlY3RzID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLm91dHB1dC1tYXBwaW5nLXNlbGVjdCcpOw0KICAgICAgICBvdXRwdXRNYXBwaW5nU2VsZWN0cy5mb3JFYWNoKHNlbGVjdCA9PiB7DQogICAgICAgICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGUudGFyZ2V0LmlkLnJlcGxhY2UoJ291dHB1dF9tYXBwaW5nXycsICcnKS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZCA9IHBhcnRzWzBdOw0KICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dFBvcnQgPSBwYXJ0c1sxXTsNCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlSWQgPSBwYXJ0c1syXTsNCiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE91dHB1dFBvcnQgPSBlLnRhcmdldC52YWx1ZTsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT3V0cHV0IG1hcHBpbmcgY2hhbmdlOicsIG5vZGVJZCwgb3V0cHV0UG9ydCwgJ+KGkicsIHNlbGVjdGVkT3V0cHV0UG9ydCwgJ3RvJywgdGFyZ2V0Tm9kZUlkKTsNCiAgICAgICAgICAgICAgICB1cGRhdGVPdXRwdXRNYXBwaW5nKG5vZGVJZCwgb3V0cHV0UG9ydCwgdGFyZ2V0Tm9kZUlkLCBzZWxlY3RlZE91dHB1dFBvcnQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycyBmb3Igc3BlY2lhbCBidXR0b25zDQogICAgICAgIGNvbnN0IHZpZXdGdWxsSW1hZ2VCdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcudmlldy1mdWxsLWltYWdlLWJ0bicpOw0KICAgICAgICBpZiAodmlld0Z1bGxJbWFnZUJ0bikgew0KICAgICAgICAgICAgdmlld0Z1bGxJbWFnZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtaWQnKTsNCiAgICAgICAgICAgICAgICBzaG93RnVsbEltYWdlKG5vZGVJZCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uc3QgcGxheUF1ZGlvQnRuID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvcignLnBsYXktYXVkaW8tYnRuJyk7DQogICAgICAgIGlmIChwbGF5QXVkaW9CdG4pIHsNCiAgICAgICAgICAgIHBsYXlBdWRpb0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtaWQnKTsNCiAgICAgICAgICAgICAgICBwbGF5QXVkaW8obm9kZUlkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCBzdG9wQXVkaW9CdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcuc3RvcC1hdWRpby1idG4nKTsNCiAgICAgICAgaWYgKHN0b3BBdWRpb0J0bikgew0KICAgICAgICAgICAgc3RvcEF1ZGlvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9kZS1pZCcpOw0KICAgICAgICAgICAgICAgIHN0b3BBdWRpbyhub2RlSWQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGNvbnN0IHN0YXJ0UmVwZWF0ZXJCdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcuc3RhcnQtcmVwZWF0ZXItYnRuJyk7DQogICAgICAgIGlmIChzdGFydFJlcGVhdGVyQnRuKSB7DQogICAgICAgICAgICBzdGFydFJlcGVhdGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9kZS1pZCcpOw0KICAgICAgICAgICAgICAgIHN0YXJ0UmVwZWF0ZXIobm9kZUlkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCBzdG9wUmVwZWF0ZXJCdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcuc3RvcC1yZXBlYXRlci1idG4nKTsNCiAgICAgICAgaWYgKHN0b3BSZXBlYXRlckJ0bikgew0KICAgICAgICAgICAgc3RvcFJlcGVhdGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9kZS1pZCcpOw0KICAgICAgICAgICAgICAgIHN0b3BSZXBlYXRlcihub2RlSWQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEFkZCBjaGFuZ2UgbGlzdGVuZXJzDQogICAgICAgIGZvciAoY29uc3QgW2tleSwgY29uZmlnXSBvZiBPYmplY3QuZW50cmllcyhub2RlRGVmLmNvbmZpZykpIHsNCiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgY29uZmlnXyR7bm9kZUlkfV8ke2tleX1gKTsNCiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7DQogICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBub2RlLmNvbmZpZ1trZXldLnZhbHVlID0gZS50YXJnZXQudmFsdWU7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdVcGRhdGVkIGNvbmZpZzonLCBub2RlSWQsIGtleSwgZS50YXJnZXQudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgZGlzcGxheSBub2RlIGZvcm1hdCBjaGFuZ2VzDQogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdkaXNwbGF5JyAmJiBrZXkgPT09ICdmb3JtYXQnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRpc3BsYXktZm9ybWF0LSR7bm9kZUlkfWApOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdEVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRFbGVtZW50LnRleHRDb250ZW50ID0gZS50YXJnZXQudmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gbm9kZS1yZW5kZXJlci5qcyAtIER5bmFtaWMgbm9kZSByZW5kZXJpbmcgZm9yIEZsb3cgRWRpdG9yDQoNCmNsYXNzIE5vZGVSZW5kZXJlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMudGVtcGxhdGVzID0gbmV3IE1hcCgpOw0KICAgICAgICB0aGlzLnNldHVwU3RhbmRhcmRUZW1wbGF0ZSgpOw0KICAgIH0NCiAgICANCiAgICBzZXR1cFN0YW5kYXJkVGVtcGxhdGUoKSB7DQogICAgICAgIHRoaXMudGVtcGxhdGVzLnNldCgnc3RhbmRhcmQnLCB7DQogICAgICAgICAgICByZW5kZXI6IChub2RlLCBub2RlRGVmKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgaW5wdXRzID0gbm9kZURlZi5pbnB1dHMgfHwgW107DQogICAgICAgICAgICAgICAgY29uc3Qgb3V0cHV0cyA9IG5vZGVEZWYub3V0cHV0cyB8fCBbXTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gYA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LW5vZGUtaGVhZGVyIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSIke25vZGVEZWYuaWNvbn0iPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPiR7bm9kZURlZi5uYW1lfTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmbG93LW5vZGUtdHlwZSAke25vZGUudHlwZX0iPiR7bm9kZS50eXBlLnRvVXBwZXJDYXNlKCl9PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibm9kZS1kZWxldGUtYnRuIiB0aXRsZT0iRGVsZXRlIG5vZGUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy1ub2RlLWNvbnRlbnQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibm9kZS1kZWZhdWx0LWNvbnRlbnQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbCBjbGFzcz0idGV4dC1tdXRlZCI+JHtub2RlRGVmLmRlc2NyaXB0aW9ufTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctbm9kZS1wb3J0cyI+DQogICAgICAgICAgICAgICAgICAgICAgICAke2lucHV0cy5tYXAoaW5wdXQgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgY2xhc3M9ImZsb3ctbm9kZS1wb3J0IGlucHV0IiBkYXRhLXBvcnQ9IiR7aW5wdXQuaWR9Ij48L2Rpdj5gDQogICAgICAgICAgICAgICAgICAgICAgICApLmpvaW4oJycpfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJHtvdXRwdXRzLm1hcChvdXRwdXQgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgY2xhc3M9ImZsb3ctbm9kZS1wb3J0IG91dHB1dCIgZGF0YS1wb3J0PSIke291dHB1dC5pZH0iPjwvZGl2PmANCiAgICAgICAgICAgICAgICAgICAgICAgICkuam9pbignJyl9DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIGA7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICANCiAgICByZWdpc3RlclRlbXBsYXRlKG5hbWUsIHRlbXBsYXRlKSB7DQogICAgICAgIHRoaXMudGVtcGxhdGVzLnNldChuYW1lLCB0ZW1wbGF0ZSk7DQogICAgfQ0KICAgIA0KICAgIHJlbmRlck5vZGUobm9kZSkgew0KICAgICAgICBjb25zdCBub2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKG5vZGUudHlwZSk7DQogICAgICAgIGlmICghbm9kZURlZikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTm8gbm9kZSBkZWZpbml0aW9uIGZvdW5kIGZvciB0eXBlOiAke25vZGUudHlwZX1gKTsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uc3QgdGVtcGxhdGVOYW1lID0gbm9kZURlZi50ZW1wbGF0ZSB8fCAnc3RhbmRhcmQnOw0KICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGVzLmdldCh0ZW1wbGF0ZU5hbWUpOw0KICAgICAgICANCiAgICAgICAgaWYgKCF0ZW1wbGF0ZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTm8gdGVtcGxhdGUgZm91bmQ6ICR7dGVtcGxhdGVOYW1lfWApOw0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdGVtcGxhdGUucmVuZGVyKG5vZGUsIG5vZGVEZWYpOw0KICAgIH0NCiAgICANCiAgICBjcmVhdGVOb2RlRWxlbWVudChub2RlKSB7DQogICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTmFtZSA9IGBmbG93LW5vZGUgJHtub2RlLnR5cGV9LW5vZGVgOw0KICAgICAgICBub2RlRWxlbWVudC5pZCA9IG5vZGUuaWQ7DQogICAgICAgIG5vZGVFbGVtZW50LnN0eWxlLmxlZnQgPSBub2RlLnggKyAncHgnOw0KICAgICAgICBub2RlRWxlbWVudC5zdHlsZS50b3AgPSBub2RlLnkgKyAncHgnOw0KICAgICAgICANCiAgICAgICAgLy8gUmVuZGVyIHRoZSBub2RlIGNvbnRlbnQNCiAgICAgICAgbm9kZUVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5yZW5kZXJOb2RlKG5vZGUpOw0KICAgICAgICANCiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycyBhbmQgZ2V0IHRoZSB1cGRhdGVkIGVsZW1lbnQNCiAgICAgICAgY29uc3QgZmluYWxFbGVtZW50ID0gdGhpcy5hZGROb2RlRXZlbnRMaXN0ZW5lcnMobm9kZUVsZW1lbnQsIG5vZGUpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGZpbmFsRWxlbWVudDsNCiAgICB9DQogICAgDQogICAgYWRkTm9kZUV2ZW50TGlzdGVuZXJzKG5vZGVFbGVtZW50LCBub2RlKSB7DQogICAgICAgIC8vIERlbGV0ZSBidXR0b24NCiAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gbm9kZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLm5vZGUtZGVsZXRlLWJ0bicpOw0KICAgICAgICBpZiAoZGVsZXRlQnRuKSB7DQogICAgICAgICAgICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgZGVsZXRlTm9kZShub2RlLmlkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBOb2RlIHNlbGVjdGlvbg0KICAgICAgICBub2RlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLm5vZGUtZGVsZXRlLWJ0bicpKSByZXR1cm47DQogICAgICAgICAgICBzZWxlY3ROb2RlKG5vZGUuaWQpOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIC8vIE5vZGUgZHJhZ2dpbmcNCiAgICAgICAgbm9kZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsNCiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcubm9kZS1kZWxldGUtYnRuJykpIHJldHVybjsNCiAgICAgICAgICAgIHN0YXJ0RHJhZ2dpbmdOb2RlKG5vZGUuaWQsIGUpOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIC8vIFBvcnQgY29ubmVjdGlvbnMNCiAgICAgICAgY29uc3QgcG9ydHMgPSBub2RlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmxvdy1ub2RlLXBvcnQnKTsNCiAgICAgICAgcG9ydHMuZm9yRWFjaChwb3J0ID0+IHsNCiAgICAgICAgICAgIHBvcnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgICAgIHN0YXJ0Q29ubmVjdGlvbihub2RlLmlkLCBwb3J0LmRhdGFzZXQucG9ydCwgcG9ydC5jbGFzc0xpc3QuY29udGFpbnMoJ291dHB1dCcpKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBub2RlRWxlbWVudDsNCiAgICB9DQp9DQoNCi8vIEdsb2JhbCBub2RlIHJlbmRlcmVyIGluc3RhbmNlDQpjb25zb2xlLmxvZygnQ3JlYXRpbmcgZ2xvYmFsIG5vZGVSZW5kZXJlciBpbnN0YW5jZS4uLicpOw0KY29uc3Qgbm9kZVJlbmRlcmVyID0gbmV3IE5vZGVSZW5kZXJlcigpOw0KY29uc29sZS5sb2coJ0dsb2JhbCBub2RlUmVuZGVyZXIgY3JlYXRlZDonLCBub2RlUmVuZGVyZXIpOyANCg0KLy8gVGV4dCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlVGV4dE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgdGV4dENvbnRlbnQgPSBub2RlLmNvbmZpZy50ZXh0X2NvbnRlbnQudmFsdWU7DQoNCiAgICByZXR1cm4geyB0ZXh0OiB0ZXh0Q29udGVudCB9Ow0KfQ0KDQoNCi8vIEpTT04gRXh0cmFjdCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlSnNvbkV4dHJhY3ROb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGZpZWxkUGF0aCA9IG5vZGUuY29uZmlnLmZpZWxkX3BhdGgudmFsdWU7DQogICAgY29uc3QgZGVmYXVsdFZhbHVlID0gbm9kZS5jb25maWcuZGVmYXVsdF92YWx1ZT8udmFsdWUgfHwgJyc7DQoNCiAgICAvLyBBY2NlcHQgYW55IGlucHV0IGRhdGEsIG5vdCBqdXN0IGpzb25fZGF0YQ0KICAgIGxldCBqc29uRGF0YSA9IG51bGw7DQoNCiAgICAvLyBUcnkgdG8gZmluZCBKU09OIGRhdGEgZnJvbSBhbnkgaW5wdXQNCiAgICBpZiAoaW5wdXREYXRhLmpzb25fZGF0YSkgew0KICAgICAgICBqc29uRGF0YSA9IGlucHV0RGF0YS5qc29uX2RhdGE7DQogICAgfSBlbHNlIGlmIChpbnB1dERhdGEuZGF0YSkgew0KICAgICAgICBqc29uRGF0YSA9IGlucHV0RGF0YS5kYXRhOw0KICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLnRleHQpIHsNCiAgICAgICAganNvbkRhdGEgPSBpbnB1dERhdGEudGV4dDsNCiAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5yZXNwb25zZSkgew0KICAgICAgICBqc29uRGF0YSA9IGlucHV0RGF0YS5yZXNwb25zZTsNCiAgICB9IGVsc2Ugew0KICAgICAgICAvLyBVc2UgdGhlIGZpcnN0IGF2YWlsYWJsZSBpbnB1dA0KICAgICAgICBjb25zdCBmaXJzdElucHV0ID0gT2JqZWN0LnZhbHVlcyhpbnB1dERhdGEpWzBdOw0KICAgICAgICBqc29uRGF0YSA9IGZpcnN0SW5wdXQ7DQogICAgfQ0KDQogICAgY29uc29sZS5sb2coJ0pTT04gRXh0cmFjdCBpbnB1dCBkYXRhOicsIGlucHV0RGF0YSk7DQogICAgY29uc29sZS5sb2coJ0pTT04gRXh0cmFjdCBzZWxlY3RlZCBqc29uRGF0YTonLCBqc29uRGF0YSk7DQogICAgY29uc29sZS5sb2coJ0pTT04gRXh0cmFjdCBqc29uRGF0YSB0eXBlOicsIHR5cGVvZiBqc29uRGF0YSk7DQoNCiAgICBsZXQgZXh0cmFjdGVkVmFsdWUgPSBudWxsOw0KDQogICAgdHJ5IHsNCiAgICAgICAgLy8gUGFyc2UgSlNPTiBpZiBpdCdzIGEgc3RyaW5nDQogICAgICAgIGlmICh0eXBlb2YganNvbkRhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICBqc29uRGF0YSA9IEpTT04ucGFyc2UoanNvbkRhdGEpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRXh0cmFjdCB2YWx1ZSB1c2luZyBkb3Qgbm90YXRpb24NCiAgICAgICAgZXh0cmFjdGVkVmFsdWUgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmV4dHJhY3ROZXN0ZWRWYWx1ZShqc29uRGF0YSwgZmllbGRQYXRoKTsNCg0KICAgICAgICAvLyBVc2UgZGVmYXVsdCB2YWx1ZSBpZiBleHRyYWN0aW9uIGZhaWxlZA0KICAgICAgICBpZiAoZXh0cmFjdGVkVmFsdWUgPT09IG51bGwgfHwgZXh0cmFjdGVkVmFsdWUgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgZXh0cmFjdGVkVmFsdWUgPSBkZWZhdWx0VmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBGb3JtYXQgdGhlIG91dHB1dCBhcyBzdHJpbmcgZm9yIGNvbnNpc3RlbmN5DQogICAgICAgIGxldCBmb3JtYXR0ZWRWYWx1ZSA9IFN0cmluZyhleHRyYWN0ZWRWYWx1ZSk7DQoNCiAgICAgICAgLy8gU3RvcmUgZm9yIGRpc3BsYXkgaW4gY29uZmlnIHBhbmVsDQogICAgICAgIG5vZGUubGFzdEV4dHJhY3RlZFZhbHVlID0gZm9ybWF0dGVkVmFsdWU7DQogICAgICAgIG5vZGUubGFzdEZpZWxkUGF0aCA9IGZpZWxkUGF0aDsNCg0KICAgICAgICAvLyBEZWJ1ZyBsb2dnaW5nDQogICAgICAgIGNvbnNvbGUubG9nKCdKU09OIEV4dHJhY3QgZGVidWc6Jyk7DQogICAgICAgIGNvbnNvbGUubG9nKCcgIEZpZWxkIHBhdGg6JywgZmllbGRQYXRoKTsNCiAgICAgICAgY29uc29sZS5sb2coJyAgUmF3IGV4dHJhY3RlZCB2YWx1ZTonLCBleHRyYWN0ZWRWYWx1ZSwgJ1R5cGU6JywgdHlwZW9mIGV4dHJhY3RlZFZhbHVlKTsNCiAgICAgICAgY29uc29sZS5sb2coJyAgRGVmYXVsdCB2YWx1ZTonLCBkZWZhdWx0VmFsdWUpOw0KICAgICAgICBjb25zb2xlLmxvZygnICBGb3JtYXR0ZWQgdmFsdWU6JywgZm9ybWF0dGVkVmFsdWUsICdUeXBlOicsIHR5cGVvZiBmb3JtYXR0ZWRWYWx1ZSk7DQogICAgICAgIGNvbnNvbGUubG9nKCcgIFJldHVybmluZzonLCB7DQogICAgICAgICAgICBvcmlnaW5hbF9kYXRhOiBqc29uRGF0YSwNCiAgICAgICAgICAgIGV4dHJhY3RlZF92YWx1ZTogZm9ybWF0dGVkVmFsdWUsDQogICAgICAgICAgICBwcm9jZXNzZWRfZGF0YTogZm9ybWF0dGVkVmFsdWUNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGRhdGE6IGZvcm1hdHRlZFZhbHVlLA0KICAgICAgICAgICAgdGV4dDogZm9ybWF0dGVkVmFsdWUsDQogICAgICAgICAgICBqc29uOiBleHRyYWN0ZWRWYWx1ZSwNCiAgICAgICAgICAgIGV4dHJhY3RlZF92YWx1ZTogZm9ybWF0dGVkVmFsdWUsDQogICAgICAgICAgICBmaWVsZF9wYXRoOiBmaWVsZFBhdGgsDQogICAgICAgICAgICBvcmlnaW5hbDoganNvbkRhdGENCiAgICAgICAgfTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdKU09OIEV4dHJhY3QgZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZGF0YTogZGVmYXVsdFZhbHVlLA0KICAgICAgICAgICAgdGV4dDogZGVmYXVsdFZhbHVlLA0KICAgICAgICAgICAganNvbjogbnVsbCwNCiAgICAgICAgICAgIGV4dHJhY3RlZF92YWx1ZTogZGVmYXVsdFZhbHVlLA0KICAgICAgICAgICAgZmllbGRfcGF0aDogZmllbGRQYXRoLA0KICAgICAgICAgICAgb3JpZ2luYWw6IGpzb25EYXRhLA0KICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UNCiAgICAgICAgfTsNCiAgICB9DQp9DQoNCg0KLy8gUmFuZG9tIExpbmUgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVJhbmRvbVF1b3RlTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBza2lwRW1wdHkgPSBub2RlLmNvbmZpZy5za2lwX2VtcHR5LnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3QgdHJpbVdoaXRlc3BhY2UgPSBub2RlLmNvbmZpZy50cmltX3doaXRlc3BhY2UudmFsdWUgPT09ICd0cnVlJzsNCiAgICBjb25zdCBtYXhMZW5ndGggPSBwYXJzZUludChub2RlLmNvbmZpZy5tYXhfbGVuZ3RoLnZhbHVlKTsNCg0KICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSBpbnB1dERhdGE6JywgaW5wdXREYXRhKTsNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgaW5wdXREYXRhLnRleHQ6JywgaW5wdXREYXRhLnRleHQpOw0KICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSBpbnB1dERhdGEudGV4dCB0eXBlOicsIHR5cGVvZiBpbnB1dERhdGEudGV4dCk7DQoNCiAgICBsZXQgdGV4dCA9IGlucHV0RGF0YS50ZXh0Ow0KICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KHRleHQpOw0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSBwcm9jZXNzZWQgdGV4dDonLCB0ZXh0KTsNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgdGV4dCBsZW5ndGg6JywgdGV4dC5sZW5ndGgpOw0KDQogICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpOw0KICAgIGNvbnNvbGUubG9nKCdSYW5kb20gTGluZSBzcGxpdCBsaW5lczonLCBsaW5lcy5sZW5ndGgsICdsaW5lcycpOw0KDQogICAgbGV0IHZhbGlkTGluZXMgPSBsaW5lczsNCg0KICAgIGlmIChza2lwRW1wdHkpIHsNCiAgICAgICAgdmFsaWRMaW5lcyA9IGxpbmVzLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpLmxlbmd0aCA+IDApOw0KICAgICAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgYWZ0ZXIgc2tpcEVtcHR5OicsIHZhbGlkTGluZXMubGVuZ3RoLCAnbGluZXMnKTsNCiAgICB9DQoNCiAgICBpZiAodHJpbVdoaXRlc3BhY2UpIHsNCiAgICAgICAgdmFsaWRMaW5lcyA9IHZhbGlkTGluZXMubWFwKGxpbmUgPT4gbGluZS50cmltKCkpOw0KICAgICAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgYWZ0ZXIgdHJpbVdoaXRlc3BhY2U6JywgdmFsaWRMaW5lcy5sZW5ndGgsICdsaW5lcycpOw0KICAgIH0NCg0KICAgIGlmICh2YWxpZExpbmVzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmU6IE5vIHZhbGlkIGxpbmVzIGZvdW5kJyk7DQogICAgICAgIHJldHVybiB7IHJhbmRvbV9saW5lOiBudWxsLCBsaW5lX251bWJlcjogMCwgdG90YWxfbGluZXM6IDAgfTsNCiAgICB9DQoNCiAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbGlkTGluZXMubGVuZ3RoKTsNCiAgICBsZXQgcmFuZG9tTGluZSA9IHZhbGlkTGluZXNbcmFuZG9tSW5kZXhdOw0KDQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIE1hdGgucmFuZG9tKCk6JywgTWF0aC5yYW5kb20oKSk7DQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIHZhbGlkTGluZXMubGVuZ3RoOicsIHZhbGlkTGluZXMubGVuZ3RoKTsNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgY2FsY3VsYXRlZCBpbmRleDonLCByYW5kb21JbmRleCwgJ291dCBvZicsIHZhbGlkTGluZXMubGVuZ3RoKTsNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgc2VsZWN0ZWQgbGluZTonLCByYW5kb21MaW5lKTsNCiAgICBjb25zb2xlLmxvZygnUmFuZG9tIExpbmUgYWxsIHZhbGlkIGxpbmVzOicsIHZhbGlkTGluZXMpOw0KDQogICAgaWYgKG1heExlbmd0aCA+IDAgJiYgcmFuZG9tTGluZS5sZW5ndGggPiBtYXhMZW5ndGgpIHsNCiAgICAgICAgcmFuZG9tTGluZSA9IHJhbmRvbUxpbmUuc3Vic3RyaW5nKDAsIG1heExlbmd0aCkgKyAnLi4uJzsNCiAgICAgICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIHRydW5jYXRlZCB0bzonLCByYW5kb21MaW5lKTsNCiAgICB9DQoNCiAgICBjb25zdCByZXN1bHQgPSB7DQogICAgICAgIHJhbmRvbV9saW5lOiByYW5kb21MaW5lLA0KICAgICAgICBsaW5lX251bWJlcjogcmFuZG9tSW5kZXggKyAxLA0KICAgICAgICB0b3RhbF9saW5lczogdmFsaWRMaW5lcy5sZW5ndGgNCiAgICB9Ow0KDQogICAgY29uc29sZS5sb2coJ1JhbmRvbSBMaW5lIHJldHVybmluZzonLCByZXN1bHQpOw0KICAgIHJldHVybiByZXN1bHQ7DQp9DQoNCg0KLy8gRXhwb3J0IHRvIGdsb2JhbCBzY29wZQ0Kd2luZG93LmRhdGFFeGVjdXRvcnMgPSB7DQogICAgZXhlY3V0ZVRleHROb2RlLA0KICAgIGV4ZWN1dGVKc29uRXh0cmFjdE5vZGUsDQogICAgZXhlY3V0ZVJhbmRvbVF1b3RlTm9kZQ0KfTsNCg0KDQovLyBIVFRQIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVIdHRwTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCB1cmwgPSBub2RlLmNvbmZpZy51cmwudmFsdWU7DQogICAgY29uc3QgbWV0aG9kID0gbm9kZS5jb25maWcubWV0aG9kLnZhbHVlOw0KICAgIGNvbnN0IGhlYWRlcnMgPSBKU09OLnBhcnNlKG5vZGUuY29uZmlnLmhlYWRlcnMudmFsdWUgfHwgJ3t9Jyk7DQogICAgY29uc3QgYm9keSA9IG5vZGUuY29uZmlnLmJvZHkudmFsdWU7DQogICAgY29uc3QgdXNlVGVtcGxhdGUgPSAobm9kZS5jb25maWcudXNlX3RlbXBsYXRlPy52YWx1ZSB8fCAnZmFsc2UnKSA9PT0gJ3RydWUnOw0KDQogICAgbGV0IHByb2Nlc3NlZEJvZHkgPSBib2R5Ow0KDQogICAgLy8gUGFyc2UgYm9keSBhcyBKU09OIGlmIGl0J3MgYSBzdHJpbmcgYW5kIGxvb2tzIGxpa2UgSlNPTg0KICAgIGlmICh0eXBlb2YgcHJvY2Vzc2VkQm9keSA9PT0gJ3N0cmluZycgJiYgcHJvY2Vzc2VkQm9keS50cmltKCkuc3RhcnRzV2l0aCgneycpKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBwcm9jZXNzZWRCb2R5ID0gSlNPTi5wYXJzZShwcm9jZXNzZWRCb2R5KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gcGFyc2UgYm9keSBhcyBKU09OLCB1c2luZyBhcyBzdHJpbmc6JywgZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAodXNlVGVtcGxhdGUgJiYgaW5wdXREYXRhLnRlbXBsYXRlX2RhdGEpIHsNCiAgICAgICAgcHJvY2Vzc2VkQm9keSA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMucHJvY2Vzc1RlbXBsYXRlcyhwcm9jZXNzZWRCb2R5LCBpbnB1dERhdGEudGVtcGxhdGVfZGF0YSk7DQogICAgfQ0KDQogICAgLy8gVXNlIE9TIHByb3h5IHRvIGJ5cGFzcyBDT1JTDQogICAgY29uc3QgcHJveHlSZXF1ZXN0ID0gew0KICAgICAgICB1cmw6IHVybCwNCiAgICAgICAgbWV0aG9kOiBtZXRob2QsDQogICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsDQogICAgICAgIGJvZHk6IHByb2Nlc3NlZEJvZHksDQogICAgICAgIHRpbWVvdXQ6IDMwDQogICAgfTsNCg0KICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IFNlbmRpbmcgcHJveHkgcmVxdWVzdDonLCBwcm94eVJlcXVlc3QpOw0KICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IEJvZHkgdHlwZTonLCB0eXBlb2YgcHJvY2Vzc2VkQm9keSk7DQogICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogQm9keSBjb250ZW50OicsIHByb2Nlc3NlZEJvZHkpOw0KICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IEpTT04gc3RyaW5naWZpZWQgYm9keTonLCBKU09OLnN0cmluZ2lmeShwcm94eVJlcXVlc3QpKTsNCg0KICAgIGNvbnN0IHByb3h5UmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2FwaS9wcm94eS9odHRwJywgew0KICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywNCiAgICAgICAgfSwNCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocHJveHlSZXF1ZXN0KQ0KICAgIH0pOw0KDQogICAgaWYgKCFwcm94eVJlc3BvbnNlLm9rKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihgUHJveHkgcmVxdWVzdCBmYWlsZWQ6ICR7cHJveHlSZXNwb25zZS5zdGF0dXN9YCk7DQogICAgfQ0KDQogICAgY29uc3QgcHJveHlEYXRhID0gYXdhaXQgcHJveHlSZXNwb25zZS5qc29uKCk7DQoNCiAgICBpZiAocHJveHlEYXRhLmVycm9yKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCByZXF1ZXN0IGZhaWxlZDogJHtwcm94eURhdGEuZXJyb3J9YCk7DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgaWYgcmVzcG9uc2UgaXMgYmluYXJ5IChhdWRpbywgaW1hZ2UsIGV0Yy4pDQogICAgaWYgKHByb3h5RGF0YS5pc19iaW5hcnkpIHsNCiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogUHJvY2Vzc2luZyBiaW5hcnkgcmVzcG9uc2UnKTsNCiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogQ29udGVudCB0eXBlOicsIHByb3h5RGF0YS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSB8fCBwcm94eURhdGEuaGVhZGVyc1snQ29udGVudC1UeXBlJ10pOw0KICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBDb250ZW50IGxlbmd0aDonLCBwcm94eURhdGEuY29udGVudC5sZW5ndGgpOw0KDQogICAgICAgIC8vIENvbnZlcnQgYmFzZTY0IGNvbnRlbnQgdG8gYmxvYiBmb3IgYmluYXJ5IGRhdGENCiAgICAgICAgY29uc3QgYmluYXJ5RGF0YSA9IGF0b2IocHJveHlEYXRhLmNvbnRlbnQpOw0KICAgICAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJpbmFyeURhdGEubGVuZ3RoKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnlEYXRhLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBieXRlc1tpXSA9IGJpbmFyeURhdGEuY2hhckNvZGVBdChpKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBjb250ZW50VHlwZSA9IHByb3h5RGF0YS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSB8fCBwcm94eURhdGEuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gfHwgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7DQogICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYnl0ZXNdLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0pOw0KICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBDcmVhdGVkIEJsb2I6JywgYmxvYik7DQogICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IEJsb2Igc2l6ZTonLCBibG9iLnNpemUpOw0KICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBCbG9iIHR5cGU6JywgYmxvYi50eXBlKTsNCg0KICAgICAgICAvLyBSZXR1cm4gYmxvYiBkaXJlY3RseSBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3aXRoIGltYWdlL2F1ZGlvIG5vZGVzDQogICAgICAgIC8vIFRoZSB3b3JrZmxvdyBleGVjdXRpb24gd2lsbCBoYW5kbGUgbWFwcGluZyB0byB0aGUgY29ycmVjdCBwb3J0cw0KICAgICAgICByZXR1cm4gYmxvYjsNCiAgICB9DQoNCiAgICAvLyBGb3IgdGV4dCByZXNwb25zZXMsIHRyeSB0byBwYXJzZSBhcyBKU09OIGFuZCByZXR1cm4gc3RydWN0dXJlZCBvdXRwdXQNCiAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBQcm9jZXNzaW5nIHRleHQgcmVzcG9uc2UnKTsNCiAgICBjb25zb2xlLmxvZygnSFRUUCBub2RlOiBTdGF0dXMgY29kZTonLCBwcm94eURhdGEuc3RhdHVzIHx8IDIwMCk7DQogICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogQ29udGVudCBwcmV2aWV3OicsIHByb3h5RGF0YS5jb250ZW50LnN1YnN0cmluZygwLCAyMDApKTsNCg0KICAgIGxldCBwYXJzZWRKc29uID0gbnVsbDsNCiAgICB0cnkgew0KICAgICAgICAvLyBUcnkgdG8gcGFyc2UgYXMgSlNPTg0KICAgICAgICBwYXJzZWRKc29uID0gSlNPTi5wYXJzZShwcm94eURhdGEuY29udGVudCk7DQogICAgICAgIGNvbnNvbGUubG9nKCdIVFRQIG5vZGU6IFN1Y2Nlc3NmdWxseSBwYXJzZWQgSlNPTiByZXNwb25zZScpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5sb2coJ0hUVFAgbm9kZTogUmVzcG9uc2UgaXMgbm90IHZhbGlkIEpTT04sIHBhcnNlZF9qc29uIHdpbGwgYmUgbnVsbCcpOw0KICAgIH0NCg0KICAgIC8vIFJldHVybiBzdHJ1Y3R1cmVkIG91dHB1dCBmb3IgdGV4dCByZXNwb25zZXMgbWF0Y2hpbmcgbmV3IG5vZGUgYXJjaGl0ZWN0dXJlDQogICAgcmV0dXJuIHsNCiAgICAgICAgb3JpZ2luYWxfZGF0YTogcHJveHlEYXRhLmNvbnRlbnQsDQogICAgICAgIHByb2Nlc3NlZF9kYXRhOiBwYXJzZWRKc29uIHx8IHByb3h5RGF0YS5jb250ZW50LA0KICAgICAgICByZXNwb25zZTogcHJveHlEYXRhLmNvbnRlbnQsDQogICAgICAgIHN0YXR1c19jb2RlOiBwcm94eURhdGEuc3RhdHVzIHx8IDIwMCwNCiAgICAgICAgaGVhZGVyczogcHJveHlEYXRhLmhlYWRlcnMgfHwge30sDQogICAgICAgIHBhcnNlZF9qc29uOiBwYXJzZWRKc29uLA0KICAgICAgICAvLyBBbHNvIHByb3ZpZGUgdGhlIHJhdyByZXNwb25zZSBhcyAnZGF0YScgZm9yIGNvbXBhdGliaWxpdHkNCiAgICAgICAgZGF0YTogcHJveHlEYXRhLmNvbnRlbnQsDQogICAgICAgIC8vIEFkZCB0aGUgbWlzc2luZyBvdXRwdXQgcG9ydHMgZnJvbSBub2RlIGRlZmluaXRpb24NCiAgICAgICAgdGV4dDogcHJveHlEYXRhLmNvbnRlbnQsDQogICAgICAgIGpzb246IHBhcnNlZEpzb24sDQogICAgICAgIHVybDogdXJsDQogICAgfTsNCn0NCg0KLy8gVkZTIExvYWQgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVZmc0xvYWROb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGZpbGVQYXRoID0gbm9kZS5jb25maWcuZmlsZV9wYXRoLnZhbHVlOw0KICAgIGNvbnN0IGZvcm1hdCA9IG5vZGUuY29uZmlnLmZvcm1hdC52YWx1ZTsNCg0KICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCBleGVjdXRpbmc6JywgZmlsZVBhdGgsICdmb3JtYXQ6JywgZm9ybWF0KTsNCg0KICAgIHRyeSB7DQogICAgICAgIGxldCBkYXRhID0gbnVsbDsNCg0KICAgICAgICBpZiAoZm9ybWF0ID09PSAnanNvbicpIHsNCiAgICAgICAgICAgIGRhdGEgPSBhd2FpdCBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlSlNPTihmaWxlUGF0aCk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgSlNPTiBkYXRhOicsIGRhdGEpOw0KICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gJ3RleHQnKSB7DQogICAgICAgICAgICBkYXRhID0gYXdhaXQgc3lwbmV4QVBJLnJlYWRWaXJ0dWFsRmlsZVRleHQoZmlsZVBhdGgpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIHRleHQgZGF0YSBsZW5ndGg6JywgZGF0YSA/IGRhdGEubGVuZ3RoIDogMCk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgdGV4dCBkYXRhIHByZXZpZXc6JywgZGF0YSA/IGRhdGEuc3Vic3RyaW5nKDAsIDEwMCkgKyAnLi4uJyA6ICdudWxsJyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBGb3IgYmluYXJ5IGZpbGVzLCB1c2UgdGhlIGRpcmVjdCBVUkwgbWV0aG9kDQogICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgYmluYXJ5IGZpbGUsIHVzaW5nIGRpcmVjdCBVUkwgbWV0aG9kJyk7DQogICAgICAgICAgICBjb25zdCBmaWxlVXJsID0gc3lwbmV4QVBJLmdldFZpcnR1YWxGaWxlVXJsKGZpbGVQYXRoKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCBiaW5hcnkgZmlsZSBVUkw6JywgZmlsZVVybCk7DQoNCiAgICAgICAgICAgIC8vIENoZWNrIGZpbGUgZXh0ZW5zaW9uIHRvIGRldGVybWluZSBpZiBpdCdzIGF1ZGlvDQogICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlUGF0aC5zcGxpdCgnLicpLnBvcCgpPy50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgY29uc3QgaXNBdWRpb0ZpbGUgPSBbJ21wMycsICd3YXYnLCAnb2dnJywgJ200YScsICdhYWMnLCAnZmxhYyddLmluY2x1ZGVzKGV4dGVuc2lvbik7DQogICAgICAgICAgICBjb25zdCBpc0ltYWdlRmlsZSA9IFsncG5nJywgJ2pwZycsICdqcGVnJywgJ2dpZicsICd3ZWJwJywgJ3N2ZyddLmluY2x1ZGVzKGV4dGVuc2lvbik7DQoNCiAgICAgICAgICAgIGlmIChpc0F1ZGlvRmlsZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCBkZXRlY3RlZCBhdWRpbyBmaWxlOicsIGV4dGVuc2lvbik7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGlzSW1hZ2VGaWxlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIGRldGVjdGVkIGltYWdlIGZpbGU6JywgZXh0ZW5zaW9uKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIGRldGVjdGVkIGJpbmFyeSBmaWxlOicsIGV4dGVuc2lvbik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEZldGNoIHRoZSBiaW5hcnkgZGF0YSBhcyBhIEJsb2INCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZVVybCk7DQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggYmluYXJ5IGZpbGU6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGRhdGEgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgYmluYXJ5IGRhdGEgYXMgQmxvYjonLCBkYXRhKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWRlMgTG9hZCBiaW5hcnkgZGF0YSB0eXBlOicsIGRhdGEudHlwZSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnVkZTIExvYWQgYmluYXJ5IGRhdGEgc2l6ZTonLCBkYXRhLnNpemUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU3RvcmUgdGhlIGxvYWRlZCBkYXRhIGZvciBkaXNwbGF5IGluIGNvbmZpZyBwYW5lbA0KICAgICAgICBub2RlLmxhc3RMb2FkZWRGaWxlID0gZmlsZVBhdGg7DQogICAgICAgIG5vZGUubGFzdExvYWRlZERhdGEgPSBkYXRhOw0KDQogICAgICAgIC8vIFJldHVybiBzdHJ1Y3R1cmVkIG91dHB1dCB3aXRoIGFwcHJvcHJpYXRlIHBvcnQgbmFtZXMNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gew0KICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgIGZpbGVfcGF0aDogZmlsZVBhdGgsICAvLyBSZXR1cm4gdGhlIGFjdHVhbCBmaWxlIHBhdGggc3RyaW5nDQogICAgICAgICAgICBqc29uX2RhdGE6IGZvcm1hdCA9PT0gJ2pzb24nID8gZGF0YSA6IG51bGwNCiAgICAgICAgfTsNCiAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBMb2FkIHJldHVybmluZzonLCByZXN1bHQpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1ZGUyBMb2FkIGVycm9yOicsIGVycm9yKTsNCiAgICAgICAgcmV0dXJuIHsgZGF0YTogbnVsbCwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTsNCiAgICB9DQp9DQoNCg0KLy8gVkZTIFNhdmUgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVZmc1NhdmVOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGZpbGVQYXRoID0gbm9kZS5jb25maWcuZmlsZV9wYXRoLnZhbHVlOw0KICAgIGNvbnN0IGZvcm1hdCA9IG5vZGUuY29uZmlnLmZvcm1hdC52YWx1ZTsNCiAgICBjb25zdCBvdmVyd3JpdGUgPSBub2RlLmNvbmZpZy5vdmVyd3JpdGUudmFsdWUgPT09ICd0cnVlJzsNCiAgICBjb25zdCBhcHBlbmQgPSBub2RlLmNvbmZpZy5hcHBlbmQudmFsdWUgPT09ICd0cnVlJzsNCg0KICAgIHRyeSB7DQogICAgICAgIGxldCBkYXRhID0gaW5wdXREYXRhLmRhdGE7DQogICAgICAgIGxldCBzdWNjZXNzID0gZmFsc2U7DQoNCiAgICAgICAgY29uc29sZS5sb2coJ1ZGUyBTYXZlIGlucHV0IHZhbHVlIGluc3RhbmNlb2YgQmxvYjonLCBkYXRhIGluc3RhbmNlb2YgQmxvYik7DQogICAgICAgIGNvbnNvbGUubG9nKCdWRlMgU2F2ZSBpbnB1dCBkYXRhIHR5cGU6JywgdHlwZW9mIGRhdGEpOw0KDQogICAgICAgIGlmIChmb3JtYXQgPT09ICdqc29uJykgew0KICAgICAgICAgICAgc3VjY2VzcyA9IGF3YWl0IHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlSlNPTihmaWxlUGF0aCwgZGF0YSk7DQogICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAndGV4dCcpIHsNCiAgICAgICAgICAgIGNvbnN0IHRleHREYXRhID0gdHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnID8gZGF0YSA6IEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpOw0KICAgICAgICAgICAgc3VjY2VzcyA9IGF3YWl0IHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlKGZpbGVQYXRoLCB0ZXh0RGF0YSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBGb3IgYmluYXJ5IGRhdGEgKGxpa2UgQmxvYnMpLCBjb252ZXJ0IHRvIGRhdGEgVVJMDQogICAgICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IEJsb2IgdG8gZGF0YSBVUkwNCiAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFVcmwgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHJlYWRlci5yZXN1bHQpOw0KICAgICAgICAgICAgICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDsNCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZGF0YSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IGF3YWl0IHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlKGZpbGVQYXRoLCBkYXRhVXJsKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgLy8gSWYgaXQncyBhbHJlYWR5IGEgZGF0YSBVUkwsIHNhdmUgaXQgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICBzdWNjZXNzID0gYXdhaXQgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGUoZmlsZVBhdGgsIGRhdGEpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayB0byBKU09OIHN0cmluZw0KICAgICAgICAgICAgICAgIGNvbnN0IHRleHREYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMik7DQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IGF3YWl0IHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlKGZpbGVQYXRoLCB0ZXh0RGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBzdWNjZXNzIH07DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignVkZTIFNhdmUgZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTsNCiAgICB9DQp9DQoNCi8vIEV4cG9ydCB0byBnbG9iYWwgc2NvcGUNCndpbmRvdy5odHRwRXhlY3V0b3JzID0gew0KICAgIGV4ZWN1dGVIdHRwTm9kZSwNCiAgICBleGVjdXRlVmZzTG9hZE5vZGUsDQogICAgZXhlY3V0ZVZmc1NhdmVOb2RlDQp9Ow0KDQovLyBJbWFnZSBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlSW1hZ2VOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IG1heFByZXZpZXdTaXplID0gbm9kZS5jb25maWcubWF4X3ByZXZpZXdfc2l6ZS52YWx1ZTsNCiAgICBjb25zdCBzaG93SW5mbyA9IG5vZGUuY29uZmlnLnNob3dfaW5mby52YWx1ZSA9PT0gJ3RydWUnOw0KDQogICAgbGV0IGltYWdlRGF0YSA9IGlucHV0RGF0YS5pbWFnZV9kYXRhOw0KICAgIGxldCBpbWFnZVVybCA9IG51bGw7DQogICAgbGV0IGltYWdlSW5mbyA9IG51bGw7DQoNCiAgICAvLyBIYW5kbGUgZGlmZmVyZW50IHR5cGVzIG9mIGltYWdlIGRhdGENCiAgICBpZiAoaW1hZ2VEYXRhIGluc3RhbmNlb2YgQmxvYikgew0KICAgICAgICAvLyBDcmVhdGUgb2JqZWN0IFVSTCBmb3IgQmxvYiBkYXRhDQogICAgICAgIGltYWdlVXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChpbWFnZURhdGEpOw0KICAgICAgICBpbWFnZUluZm8gPSB7DQogICAgICAgICAgICB0eXBlOiBpbWFnZURhdGEudHlwZSB8fCAnaW1hZ2UnLA0KICAgICAgICAgICAgc2l6ZTogaW1hZ2VEYXRhLnNpemUNCiAgICAgICAgfTsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbWFnZURhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYmFzZTY0IGRhdGENCiAgICAgICAgaWYgKGltYWdlRGF0YS5zdGFydHNXaXRoKCdkYXRhOmltYWdlLycpIHx8IGltYWdlRGF0YS5zdGFydHNXaXRoKCdkYXRhOmFwcGxpY2F0aW9uLycpKSB7DQogICAgICAgICAgICAvLyBBbHJlYWR5IGEgZGF0YSBVUkwNCiAgICAgICAgICAgIGltYWdlVXJsID0gaW1hZ2VEYXRhOw0KICAgICAgICB9IGVsc2UgaWYgKGltYWdlRGF0YS5tYXRjaCgvXltBLVphLXowLTkrL10qPXswLDJ9JC8pKSB7DQogICAgICAgICAgICAvLyBMb29rcyBsaWtlIGJhc2U2NCBkYXRhLCBjb252ZXJ0IHRvIGRhdGEgVVJMDQogICAgICAgICAgICAvLyBUcnkgdG8gZGV0ZWN0IGltYWdlIHR5cGUgZnJvbSB0aGUgZGF0YQ0KICAgICAgICAgICAgY29uc3QgaW1hZ2VUeXBlID0gd2luZG93LmZsb3dFZGl0b3JVdGlscy5kZXRlY3RJbWFnZVR5cGVGcm9tQmFzZTY0KGltYWdlRGF0YSk7DQogICAgICAgICAgICBpbWFnZVVybCA9IGBkYXRhOiR7aW1hZ2VUeXBlfTtiYXNlNjQsJHtpbWFnZURhdGF9YDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIEFzc3VtZSBpdCdzIGEgcmVndWxhciBVUkwNCiAgICAgICAgICAgIGltYWdlVXJsID0gaW1hZ2VEYXRhOw0KICAgICAgICB9DQogICAgfSBlbHNlIGlmIChpbWFnZURhdGEgJiYgdHlwZW9mIGltYWdlRGF0YSA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgLy8gSGFuZGxlIG9iamVjdCB3aXRoIGltYWdlIGRhdGENCiAgICAgICAgaWYgKGltYWdlRGF0YS51cmwpIHsNCiAgICAgICAgICAgIGltYWdlVXJsID0gaW1hZ2VEYXRhLnVybDsNCiAgICAgICAgfSBlbHNlIGlmIChpbWFnZURhdGEuZGF0YSkgew0KICAgICAgICAgICAgaW1hZ2VVcmwgPSBpbWFnZURhdGEuZGF0YTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpbWFnZURhdGEuaW5mbykgew0KICAgICAgICAgICAgaW1hZ2VJbmZvID0gaW1hZ2VEYXRhLmluZm87DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBOb3RlOiBSZW1vdmVkIGltYWdlIGRpbWVuc2lvbiBkZXRlY3Rpb24gYXMgaXQncyBub3QgbmVlZGVkDQoNCiAgICAvLyBTdG9yZSBpbWFnZSBkYXRhIGZvciBkaXNwbGF5IGluIGNvbmZpZyBwYW5lbA0KICAgIG5vZGUubGFzdEltYWdlRGF0YSA9IGltYWdlRGF0YTsNCiAgICBub2RlLmxhc3RJbWFnZVVybCA9IGltYWdlVXJsOw0KICAgIG5vZGUubGFzdEltYWdlSW5mbyA9IGltYWdlSW5mbzsNCg0KICAgIHJldHVybiB7DQogICAgICAgIGltYWdlX2RhdGE6IGltYWdlRGF0YSwNCiAgICAgICAgaW1hZ2VfdXJsOiBpbWFnZVVybCwNCiAgICAgICAgaW1hZ2VfaW5mbzogaW1hZ2VJbmZvLA0KICAgICAgICBkYXRhOiBpbWFnZURhdGENCiAgICB9Ow0KfQ0KDQovLyBBdWRpbyBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlQXVkaW9Ob2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGF1dG9QbGF5ID0gbm9kZS5jb25maWcuYXV0b1BsYXkudmFsdWUgPT09ICd0cnVlJzsNCiAgICBjb25zdCB2b2x1bWUgPSBwYXJzZUZsb2F0KG5vZGUuY29uZmlnLnZvbHVtZS52YWx1ZSk7DQoNCiAgICBsZXQgYXVkaW9EYXRhID0gaW5wdXREYXRhLmF1ZGlvX2RhdGE7DQoNCiAgICBjb25zb2xlLmxvZygnQXVkaW8gbm9kZSBleGVjdXRpb24gLSBpbnB1dERhdGE6JywgaW5wdXREYXRhKTsNCiAgICBjb25zb2xlLmxvZygnQXVkaW8gbm9kZSBleGVjdXRpb24gLSBhdWRpb0RhdGE6JywgYXVkaW9EYXRhKTsNCiAgICBjb25zb2xlLmxvZygnQXVkaW8gZGF0YSB0eXBlOicsIHR5cGVvZiBhdWRpb0RhdGEpOw0KICAgIGNvbnNvbGUubG9nKCdBdWRpbyBkYXRhIGluc3RhbmNlb2YgQmxvYjonLCBhdWRpb0RhdGEgaW5zdGFuY2VvZiBCbG9iKTsNCg0KICAgIGlmICghYXVkaW9EYXRhKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gYXVkaW8gZGF0YSBwcm92aWRlZCcpOw0KICAgIH0NCg0KICAgIC8vIFN0b3JlIGF1ZGlvIGRhdGEgZm9yIG1hbnVhbCBwbGF5IGJ1dHRvbiBzeXN0ZW0gKGxpa2Ugb2xkIHN5c3RlbSkNCiAgICBub2RlLmF1ZGlvRGF0YSA9IGF1ZGlvRGF0YTsNCiAgICBub2RlLnZvbHVtZSA9IHZvbHVtZTsNCg0KICAgIC8vIENyZWF0ZSBhdWRpbyBlbGVtZW50IGlmIGl0IGRvZXNuJ3QgZXhpc3QgKGxpa2Ugb2xkIHN5c3RlbSkNCiAgICBpZiAoIW5vZGUuYXVkaW9FbGVtZW50KSB7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50ID0gbmV3IEF1ZGlvKCk7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LmNvbnRyb2xzID0gdHJ1ZTsNCiAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuc3R5bGUud2lkdGggPSAnMTAwJSc7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JzsNCiAgICB9DQoNCiAgICAvLyBTZXQgYXVkaW8gc291cmNlIChsaWtlIG9sZCBzeXN0ZW0pDQogICAgaWYgKGF1ZGlvRGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTChhdWRpb0RhdGEpOw0KICAgICAgICBjb25zb2xlLmxvZygnU2V0IGF1ZGlvIHNvdXJjZSBmcm9tIEJsb2InKTsNCiAgICAgICAgY29uc29sZS5sb2coJ0F1ZGlvIGVsZW1lbnQgc3JjOicsIG5vZGUuYXVkaW9FbGVtZW50LnNyYyk7DQogICAgfSBlbHNlIGlmICh0eXBlb2YgYXVkaW9EYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICBpZiAoYXVkaW9EYXRhLnN0YXJ0c1dpdGgoJ2RhdGE6YXVkaW8vJykgfHwgYXVkaW9EYXRhLnN0YXJ0c1dpdGgoJ2RhdGE6YXBwbGljYXRpb24vJykpIHsNCiAgICAgICAgICAgIC8vIEFscmVhZHkgYSBkYXRhIFVSTA0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuc3JjID0gYXVkaW9EYXRhOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1NldCBhdWRpbyBzb3VyY2UgZnJvbSBkYXRhIFVSTCcpOw0KICAgICAgICB9IGVsc2UgaWYgKGF1ZGlvRGF0YS5tYXRjaCgvXltBLVphLXowLTkrL10qPXswLDJ9JC8pKSB7DQogICAgICAgICAgICAvLyBMb29rcyBsaWtlIGJhc2U2NCBkYXRhLCBjb252ZXJ0IHRvIGRhdGEgVVJMDQogICAgICAgICAgICBjb25zdCBhdWRpb1R5cGUgPSAnYXVkaW8vbXBlZyc7IC8vIERlZmF1bHQgdG8gTVAzLCBjb3VsZCBiZSBlbmhhbmNlZCB0byBkZXRlY3QgdHlwZQ0KICAgICAgICAgICAgY29uc3QgZGF0YVVybCA9IGBkYXRhOiR7YXVkaW9UeXBlfTtiYXNlNjQsJHthdWRpb0RhdGF9YDsNCiAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnNyYyA9IGRhdGFVcmw7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnU2V0IGF1ZGlvIHNvdXJjZSBmcm9tIGJhc2U2NCBkYXRhJyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBc3N1bWUgaXQncyBhIHJlZ3VsYXIgVVJMDQogICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5zcmMgPSBhdWRpb0RhdGE7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnU2V0IGF1ZGlvIHNvdXJjZSBmcm9tIFVSTCcpOw0KICAgICAgICB9DQogICAgICAgIGNvbnNvbGUubG9nKCdBdWRpbyBlbGVtZW50IHNyYzonLCBub2RlLmF1ZGlvRWxlbWVudC5zcmMpOw0KICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZGF0YSByZWNlaXZlZDonLCBhdWRpb0RhdGEpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdTZXQgYXVkaW8gc291cmNlIGZyb20gdW5rbm93biBkYXRhIHR5cGU6JywgdHlwZW9mIGF1ZGlvRGF0YSk7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnNyYyA9IGF1ZGlvRGF0YTsNCiAgICB9DQoNCiAgICAvLyBTZXQgdm9sdW1lDQogICAgbm9kZS5hdWRpb0VsZW1lbnQudm9sdW1lID0gdm9sdW1lOw0KDQogICAgLy8gU3RvcmUgZm9yIGNvbmZpZyBwYW5lbCBjb21wYXRpYmlsaXR5DQogICAgbm9kZS5sYXN0QXVkaW9EYXRhID0gYXVkaW9EYXRhOw0KICAgIG5vZGUubGFzdEF1ZGlvVXJsID0gbm9kZS5hdWRpb0VsZW1lbnQuc3JjOw0KDQogICAgLy8gQXV0by1wbGF5IGlmIGNvbmZpZ3VyZWQNCiAgICBpZiAoYXV0b1BsYXkpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGF3YWl0IG5vZGUuYXVkaW9FbGVtZW50LnBsYXkoKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBdXRvLXBsYXkgc3RhcnRlZCcpOw0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQXV0by1wbGF5IGZhaWxlZDonLCBlcnJvcik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBDb252ZXJ0IGF1ZGlvIGRhdGEgdG8gcHJvcGVyIGRhdGEgVVJMIGZvciBWRlMgU2F2ZQ0KICAgIGxldCBkYXRhVXJsRm9yU2F2ZSA9IG51bGw7DQoNCiAgICBpZiAoYXVkaW9EYXRhIGluc3RhbmNlb2YgQmxvYikgew0KICAgICAgICAvLyBDb252ZXJ0IEJsb2IgdG8gZGF0YSBVUkwNCiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgZGF0YVVybEZvclNhdmUgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4gcmVzb2x2ZShyZWFkZXIucmVzdWx0KTsNCiAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0Ow0KICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoYXVkaW9EYXRhKTsNCiAgICAgICAgfSk7DQogICAgICAgIGNvbnNvbGUubG9nKCdDb252ZXJ0ZWQgQmxvYiB0byBkYXRhIFVSTCBmb3Igc2F2ZTonLCBkYXRhVXJsRm9yU2F2ZS5zdWJzdHJpbmcoMCwgNTApICsgJy4uLicpOw0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGF1ZGlvRGF0YSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgaWYgKGF1ZGlvRGF0YS5zdGFydHNXaXRoKCdkYXRhOmF1ZGlvLycpIHx8IGF1ZGlvRGF0YS5zdGFydHNXaXRoKCdkYXRhOmFwcGxpY2F0aW9uLycpKSB7DQogICAgICAgICAgICAvLyBBbHJlYWR5IGEgZGF0YSBVUkwNCiAgICAgICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYXVkaW9EYXRhOw0KICAgICAgICB9IGVsc2UgaWYgKGF1ZGlvRGF0YS5tYXRjaCgvXltBLVphLXowLTkrL10qPXswLDJ9JC8pKSB7DQogICAgICAgICAgICAvLyBCYXNlNjQgZGF0YSwgY29udmVydCB0byBkYXRhIFVSTA0KICAgICAgICAgICAgY29uc3QgYXVkaW9UeXBlID0gJ2F1ZGlvL21wZWcnOyAvLyBEZWZhdWx0IHRvIE1QMywgY291bGQgYmUgZW5oYW5jZWQgdG8gZGV0ZWN0IHR5cGUNCiAgICAgICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYGRhdGE6JHthdWRpb1R5cGV9O2Jhc2U2NCwke2F1ZGlvRGF0YX1gOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gUmVndWxhciBVUkwsIGtlZXAgYXMgaXMNCiAgICAgICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYXVkaW9EYXRhOw0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gRmFsbGJhY2sNCiAgICAgICAgZGF0YVVybEZvclNhdmUgPSBhdWRpb0RhdGE7DQogICAgfQ0KDQogICAgcmV0dXJuIHsNCiAgICAgICAgYXVkaW9fZGF0YTogYXVkaW9EYXRhLA0KICAgICAgICBhdWRpb191cmw6IG5vZGUuYXVkaW9FbGVtZW50LnNyYywNCiAgICAgICAgZGF0YTogZGF0YVVybEZvclNhdmUgIC8vIFJldHVybiB0aGUgYWN0dWFsIGF1ZGlvIGRhdGEgYXMgZGF0YSBVUkwNCiAgICB9Ow0KfQ0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cubWVkaWFFeGVjdXRvcnMgPSB7DQogICAgZXhlY3V0ZUltYWdlTm9kZSwNCiAgICBleGVjdXRlQXVkaW9Ob2RlDQp9Ow0KDQoNCi8vIFRpbWVyIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVUaW1lck5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgaW50ZXJ2YWwgPSBub2RlLmNvbmZpZy5pbnRlcnZhbC52YWx1ZTsNCiAgICBjb25zdCBjb3VudCA9IG5vZGUuY29uZmlnLmNvdW50LnZhbHVlOw0KDQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTsNCiAgICAgICAgICAgIHJlc29sdmUoew0KICAgICAgICAgICAgICAgIHRyaWdnZXI6IHRpbWVzdGFtcCwNCiAgICAgICAgICAgICAgICBvcmlnaW5hbF9kYXRhOiB0aW1lc3RhbXAsDQogICAgICAgICAgICAgICAgcHJvY2Vzc2VkX2RhdGE6IHRpbWVzdGFtcCwNCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcCwNCiAgICAgICAgICAgICAgICBlbGFwc2VkOiBpbnRlcnZhbA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sIGludGVydmFsKTsNCiAgICB9KTsNCn0NCg0KLy8gRGlzcGxheSBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlRGlzcGxheU5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgZm9ybWF0ID0gbm9kZS5jb25maWcuZm9ybWF0LnZhbHVlOw0KICAgIGNvbnN0IG1heExlbmd0aCA9IG5vZGUuY29uZmlnLm1heExlbmd0aC52YWx1ZTsNCiAgICBjb25zdCBpbnB1dFBvcnQgPSBub2RlLmNvbmZpZy5pbnB1dF9wb3J0Py52YWx1ZSB8fCAnYXV0byc7DQoNCiAgICAvLyBUcnkgdG8gZmluZCBjb250ZW50IGJhc2VkIG9uIGNvbmZpZ3VyZWQgaW5wdXQgcG9ydCBvciBhdXRvLWRldGVjdA0KICAgIGxldCBjb250ZW50ID0gbnVsbDsNCg0KICAgIGlmIChpbnB1dFBvcnQgIT09ICdhdXRvJykgew0KICAgICAgICAvLyBVc2UgdGhlIHNwZWNpZmllZCBpbnB1dCBwb3J0DQogICAgICAgIGNvbnRlbnQgPSBpbnB1dERhdGFbaW5wdXRQb3J0XTsNCiAgICAgICAgY29uc29sZS5sb2coYERpc3BsYXkgbm9kZSB1c2luZyBzcGVjaWZpZWQgaW5wdXQgcG9ydCAnJHtpbnB1dFBvcnR9JzpgLCBjb250ZW50KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICAvLyBBdXRvLWRldGVjdDogUHJpb3JpdHkgb3JkZXI6IHRleHQsIGpzb24sIGRhdGEsIGJpbmFyeQ0KICAgICAgICBpZiAoaW5wdXREYXRhLnRleHQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgY29udGVudCA9IGlucHV0RGF0YS50ZXh0Ow0KICAgICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5qc29uICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGNvbnRlbnQgPSBpbnB1dERhdGEuanNvbjsNCiAgICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEuZGF0YSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjb250ZW50ID0gaW5wdXREYXRhLmRhdGE7DQogICAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmJpbmFyeSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjb250ZW50ID0gaW5wdXREYXRhLmJpbmFyeTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIFVzZSB0aGUgZmlyc3QgYXZhaWxhYmxlIGlucHV0DQogICAgICAgICAgICBjb25zdCBmaXJzdElucHV0ID0gT2JqZWN0LnZhbHVlcyhpbnB1dERhdGEpWzBdOw0KICAgICAgICAgICAgY29udGVudCA9IGZpcnN0SW5wdXQ7DQogICAgICAgIH0NCiAgICAgICAgY29uc29sZS5sb2coJ0Rpc3BsYXkgbm9kZSBhdXRvLWRldGVjdGVkIGlucHV0IHBvcnQnKTsNCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZygnRGlzcGxheSBub2RlIGlucHV0IGRhdGE6JywgaW5wdXREYXRhKTsNCiAgICBjb25zb2xlLmxvZygnRGlzcGxheSBub2RlIHNlbGVjdGVkIGNvbnRlbnQ6JywgY29udGVudCk7DQogICAgY29uc29sZS5sb2coJ0Rpc3BsYXkgbm9kZSBjb250ZW50IHR5cGU6JywgdHlwZW9mIGNvbnRlbnQpOw0KDQogICAgLy8gT25seSBjb252ZXJ0IHRvIEpTT04gc3RyaW5nIGlmIGZvcm1hdCBpcyAnanNvbicgb3IgaWYgaXQncyBhbiBvYmplY3QgYW5kIGZvcm1hdCBpcyBub3Qgc3BlY2lmaWVkDQogICAgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnb2JqZWN0JyAmJiBmb3JtYXQgPT09ICdqc29uJykgew0KICAgICAgICBjb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoY29udGVudCwgbnVsbCwgMik7DQogICAgfSBlbHNlIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ29iamVjdCcgJiYgZm9ybWF0ID09PSAndGV4dCcpIHsNCiAgICAgICAgLy8gRm9yIHRleHQgZm9ybWF0LCBleHRyYWN0IHRoZSBhY3R1YWwgdmFsdWUgZnJvbSBjb21tb24gZmllbGRzDQogICAgICAgIGlmIChjb250ZW50ID09PSBudWxsKSB7DQogICAgICAgICAgICBjb250ZW50ID0gJ251bGwnOw0KICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudCkpIHsNCiAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LmpvaW4oJywgJyk7DQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICAvLyBMb29rIGZvciB0aGUgYWN0dWFsIHZhbHVlIGluIGNvbW1vbiBmaWVsZHMNCiAgICAgICAgICAgIGlmIChjb250ZW50LmV4dHJhY3RlZF92YWx1ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgY29udGVudCA9IFN0cmluZyhjb250ZW50LmV4dHJhY3RlZF92YWx1ZSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlbnQudmFsdWUgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoY29udGVudC52YWx1ZSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlbnQudGV4dCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgY29udGVudCA9IFN0cmluZyhjb250ZW50LnRleHQpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZW50LmRhdGEgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoY29udGVudC5kYXRhKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gSWYgbm8gY29tbW9uIGZpZWxkcyBmb3VuZCwganVzdCBzaG93IHRoZSBmaXJzdCB2YWx1ZQ0KICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0VmFsdWUgPSBPYmplY3QudmFsdWVzKGNvbnRlbnQpWzBdOw0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoZmlyc3RWYWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoY29udGVudCAmJiBjb250ZW50Lmxlbmd0aCA+IG1heExlbmd0aCkgew0KICAgICAgICBjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgbWF4TGVuZ3RoKSArICcuLi4nOw0KICAgIH0NCg0KICAgIC8vIFVwZGF0ZSBkaXNwbGF5IG5vZGUgY29udGVudA0KICAgIHVwZGF0ZURpc3BsYXlOb2RlQ29udGVudChub2RlLmlkLCBjb250ZW50LCBmb3JtYXQpOw0KDQogICAgcmV0dXJuIHsNCiAgICAgICAgb3JpZ2luYWxfZGF0YTogY29udGVudCwNCiAgICAgICAgZGlzcGxheWVkOiBjb250ZW50LA0KICAgICAgICBwcm9jZXNzZWRfZGF0YTogY29udGVudA0KICAgIH07DQp9DQoNCg0KLy8gUmVwZWF0ZXIgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVJlcGVhdGVyTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBpbnRlcnZhbCA9IHBhcnNlSW50KG5vZGUuY29uZmlnLmludGVydmFsLnZhbHVlKTsNCiAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KG5vZGUuY29uZmlnLmNvdW50LnZhbHVlKTsNCg0KICAgIC8vIEluaXRpYWxpemUgcmVwZWF0ZXIgc3RhdGUgaWYgbm90IGV4aXN0cw0KICAgIGlmICghbm9kZS5yZXBlYXRlclN0YXRlKSB7DQogICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZSA9IHsNCiAgICAgICAgICAgIGNvdW50OiAwLA0KICAgICAgICAgICAgaW50ZXJ2YWw6IG51bGwsDQogICAgICAgICAgICBpc1J1bm5pbmc6IGZhbHNlDQogICAgICAgIH07DQogICAgfQ0KDQogICAgLy8gSWYgdGhpcyBpcyBhIG1hbnVhbCB0cmlnZ2VyIChub3QgZnJvbSBpbnRlcnZhbCksIHN0YXJ0IHRoZSByZXBlYXRlcg0KICAgIGlmICghbm9kZS5yZXBlYXRlclN0YXRlLmlzUnVubmluZykgew0KICAgICAgICBub2RlLnJlcGVhdGVyU3RhdGUuaXNSdW5uaW5nID0gdHJ1ZTsNCiAgICAgICAgbm9kZS5yZXBlYXRlclN0YXRlLmNvdW50ID0gMDsNCg0KICAgICAgICAvLyBTdGFydCB0aGUgaW50ZXJ2YWwNCiAgICAgICAgbm9kZS5yZXBlYXRlclN0YXRlLmludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgbm9kZS5yZXBlYXRlclN0YXRlLmNvdW50Kys7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnUmVwZWF0ZXIgdHJpZ2dlcmVkOicsIG5vZGUuaWQsICdjb3VudDonLCBub2RlLnJlcGVhdGVyU3RhdGUuY291bnQpOw0KDQogICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBjb25uZWN0ZWQgd29ya2Zsb3cNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdGVkTm9kZXMgPSBmaW5kQ29ubmVjdGVkTm9kZXMobm9kZS5pZCk7DQogICAgICAgICAgICAgICAgY29uc3QgZXhlY3V0ZWQgPSBuZXcgU2V0KCk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbm5lY3RlZE5vZGUgb2YgY29ubmVjdGVkTm9kZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZXhlY3V0ZU5vZGUoY29ubmVjdGVkTm9kZS5ub2RlLCB7IHRyaWdnZXI6IERhdGUubm93KCkgfSwgZXhlY3V0ZWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZXhlY3V0aW5nIHJlcGVhdGVyIHdvcmtmbG93OicsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gU3RvcCBpZiBjb3VudCBsaW1pdCByZWFjaGVkDQogICAgICAgICAgICBpZiAoY291bnQgPiAwICYmIG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCA+PSBjb3VudCkgew0KICAgICAgICAgICAgICAgIGVuZ2luZS5zdG9wUmVwZWF0ZXIobm9kZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sIGludGVydmFsKTsNCiAgICB9DQoNCiAgICByZXR1cm4geyB0cmlnZ2VyOiBEYXRlLm5vdygpLCBjb3VudDogbm9kZS5yZXBlYXRlclN0YXRlLmNvdW50LCBpc1J1bm5pbmc6IG5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmcgfTsNCn0NCg0KLy8gQ29uZGl0aW9uIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVDb25kaXRpb25Ob2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IG9wZXJhdG9yID0gbm9kZS5jb25maWcub3BlcmF0b3IudmFsdWU7DQogICAgY29uc3QgY29tcGFyZVZhbHVlID0gbm9kZS5jb25maWcuY29tcGFyZV92YWx1ZS52YWx1ZTsNCiAgICBjb25zdCBjYXNlU2Vuc2l0aXZlID0gbm9kZS5jb25maWcuY2FzZV9zZW5zaXRpdmUudmFsdWUgPT09ICd0cnVlJzsNCg0KICAgIGxldCBpbnB1dFZhbHVlID0gaW5wdXREYXRhLnZhbHVlOw0KICAgIGxldCByZXN1bHQgPSBmYWxzZTsNCg0KICAgIC8vIENvbnZlcnQgaW5wdXQgdG8gc3RyaW5nIGZvciBjb21wYXJpc29uIGlmIG5lZWRlZA0KICAgIGxldCBpbnB1dFN0ciA9IFN0cmluZyhpbnB1dFZhbHVlKTsNCiAgICBsZXQgY29tcGFyZVN0ciA9IFN0cmluZyhjb21wYXJlVmFsdWUpOw0KDQogICAgLy8gRGVidWcgbG9nZ2luZyBmb3Igc3RyaW5nIGNvbXBhcmlzb25zDQogICAgY29uc29sZS5sb2coJ0NvbmRpdGlvbiBub2RlIGRlYnVnOicpOw0KICAgIGNvbnNvbGUubG9nKCcgIElucHV0IHZhbHVlOicsIGlucHV0VmFsdWUsICdUeXBlOicsIHR5cGVvZiBpbnB1dFZhbHVlKTsNCiAgICBjb25zb2xlLmxvZygnICBDb21wYXJlIHZhbHVlOicsIGNvbXBhcmVWYWx1ZSwgJ1R5cGU6JywgdHlwZW9mIGNvbXBhcmVWYWx1ZSk7DQogICAgY29uc29sZS5sb2coJyAgSW5wdXQgc3RyaW5nOicsIGlucHV0U3RyLCAnTGVuZ3RoOicsIGlucHV0U3RyLmxlbmd0aCk7DQogICAgY29uc29sZS5sb2coJyAgQ29tcGFyZSBzdHJpbmc6JywgY29tcGFyZVN0ciwgJ0xlbmd0aDonLCBjb21wYXJlU3RyLmxlbmd0aCk7DQogICAgY29uc29sZS5sb2coJyAgQ2FzZSBzZW5zaXRpdmU6JywgY2FzZVNlbnNpdGl2ZSk7DQoNCiAgICAvLyBIYW5kbGUgY2FzZSBzZW5zaXRpdml0eQ0KICAgIGlmICghY2FzZVNlbnNpdGl2ZSkgew0KICAgICAgICBpbnB1dFN0ciA9IGlucHV0U3RyLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIGNvbXBhcmVTdHIgPSBjb21wYXJlU3RyLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIGNvbnNvbGUubG9nKCcgIEFmdGVyIGNhc2UgY29udmVyc2lvbiAtIElucHV0OicsIGlucHV0U3RyLCAnQ29tcGFyZTonLCBjb21wYXJlU3RyKTsNCiAgICB9DQoNCiAgICAvLyBQZXJmb3JtIGNvbXBhcmlzb24gYmFzZWQgb24gb3BlcmF0b3INCiAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7DQogICAgICAgIGNhc2UgJ2VxdWFscyc6DQogICAgICAgICAgICByZXN1bHQgPSBpbnB1dFN0ciA9PT0gY29tcGFyZVN0cjsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdub3RfZXF1YWxzJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyICE9PSBjb21wYXJlU3RyOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2dyZWF0ZXJfdGhhbic6DQogICAgICAgICAgICByZXN1bHQgPSBOdW1iZXIoaW5wdXRWYWx1ZSkgPiBOdW1iZXIoY29tcGFyZVZhbHVlKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdsZXNzX3RoYW4nOg0KICAgICAgICAgICAgcmVzdWx0ID0gTnVtYmVyKGlucHV0VmFsdWUpIDwgTnVtYmVyKGNvbXBhcmVWYWx1ZSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnZ3JlYXRlcl90aGFuX29yX2VxdWFsJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IE51bWJlcihpbnB1dFZhbHVlKSA+PSBOdW1iZXIoY29tcGFyZVZhbHVlKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdsZXNzX3RoYW5fb3JfZXF1YWwnOg0KICAgICAgICAgICAgcmVzdWx0ID0gTnVtYmVyKGlucHV0VmFsdWUpIDw9IE51bWJlcihjb21wYXJlVmFsdWUpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2NvbnRhaW5zJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLmluY2x1ZGVzKGNvbXBhcmVTdHIpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ25vdF9jb250YWlucyc6DQogICAgICAgICAgICByZXN1bHQgPSAhaW5wdXRTdHIuaW5jbHVkZXMoY29tcGFyZVN0cik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnc3RhcnRzX3dpdGgnOg0KICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXRTdHIuc3RhcnRzV2l0aChjb21wYXJlU3RyKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdlbmRzX3dpdGgnOg0KICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXRTdHIuZW5kc1dpdGgoY29tcGFyZVN0cik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnaXNfZW1wdHknOg0KICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXRTdHIudHJpbSgpID09PSAnJzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdpc19ub3RfZW1wdHknOg0KICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXRTdHIudHJpbSgpICE9PSAnJzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7DQogICAgfQ0KDQogICAgLy8gU3RvcmUgZm9yIGRpc3BsYXkgaW4gY29uZmlnIHBhbmVsDQogICAgbm9kZS5sYXN0SW5wdXRWYWx1ZSA9IGlucHV0VmFsdWU7DQogICAgbm9kZS5sYXN0Q29tcGFyZVZhbHVlID0gY29tcGFyZVZhbHVlOw0KICAgIG5vZGUubGFzdFJlc3VsdCA9IHJlc3VsdDsNCiAgICBub2RlLmxhc3RPcGVyYXRvciA9IG9wZXJhdG9yOw0KDQogICAgcmV0dXJuIHsgcmVzdWx0OiByZXN1bHQgfTsNCn0NCg0KLy8gTG9naWNhbCBHYXRlIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVMb2dpY2FsR2F0ZU5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgaW52ZXJ0ID0gbm9kZS5jb25maWcuaW52ZXJ0LnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3QgZGVzY3JpcHRpb24gPSBub2RlLmNvbmZpZy5kZXNjcmlwdGlvbi52YWx1ZTsNCg0KICAgIGxldCBjb25kaXRpb24gPSBpbnB1dERhdGEuY29uZGl0aW9uOw0KDQogICAgLy8gQ29udmVydCB0byBib29sZWFuIGlmIG5lZWRlZA0KICAgIGlmICh0eXBlb2YgY29uZGl0aW9uID09PSAnc3RyaW5nJykgew0KICAgICAgICBjb25kaXRpb24gPSBjb25kaXRpb24udG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnOw0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gJ251bWJlcicpIHsNCiAgICAgICAgY29uZGl0aW9uID0gY29uZGl0aW9uICE9PSAwOw0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgLy8gSWYgaXQncyBhbiBvYmplY3Qgd2l0aCBhIHJlc3VsdCBmaWVsZCAoZnJvbSBjb25kaXRpb24gbm9kZSkNCiAgICAgICAgY29uZGl0aW9uID0gY29uZGl0aW9uLnJlc3VsdCA9PT0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBBcHBseSBpbnZlcnNpb24gaWYgY29uZmlndXJlZA0KICAgIGlmIChpbnZlcnQpIHsNCiAgICAgICAgY29uZGl0aW9uID0gIWNvbmRpdGlvbjsNCiAgICB9DQoNCiAgICAvLyBTdG9yZSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICBub2RlLmxhc3RDb25kaXRpb24gPSBjb25kaXRpb247DQogICAgbm9kZS5sYXN0SW52ZXJ0ZWQgPSBpbnZlcnQ7DQogICAgbm9kZS5sYXN0RGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjsNCg0KICAgIC8vIE9ubHkgcmV0dXJuIHRyaWdnZXIgaWYgY29uZGl0aW9uIGlzIHRydWUNCiAgICBpZiAoY29uZGl0aW9uKSB7DQogICAgICAgIHJldHVybiB7IHRyaWdnZXI6IERhdGUubm93KCkgfTsNCiAgICB9IGVsc2Ugew0KICAgICAgICAvLyBSZXR1cm4gc3BlY2lhbCBvYmplY3QgdG8gaW5kaWNhdGUgZXhlY3V0aW9uIHNob3VsZCBzdG9wDQogICAgICAgIHJldHVybiB7IF9fc3RvcF9leGVjdXRpb246IHRydWUgfTsNCiAgICB9DQp9DQoNCi8vIEV4cG9ydCB0byBnbG9iYWwgc2NvcGUNCndpbmRvdy5mbG93RXhlY3V0b3JzID0gew0KICAgIGV4ZWN1dGVUaW1lck5vZGUsDQogICAgZXhlY3V0ZURpc3BsYXlOb2RlLA0KICAgIGV4ZWN1dGVSZXBlYXRlck5vZGUsDQogICAgZXhlY3V0ZUNvbmRpdGlvbk5vZGUsDQogICAgZXhlY3V0ZUxvZ2ljYWxHYXRlTm9kZQ0KfTsNCg0KDQovLyBMTE0gQ2hhdCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlTGxtQ2hhdE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgZW5kcG9pbnQgPSBub2RlLmNvbmZpZy5lbmRwb2ludC52YWx1ZTsNCiAgICBjb25zdCBtb2RlbCA9IG5vZGUuY29uZmlnLm1vZGVsLnZhbHVlOw0KICAgIGNvbnN0IHRlbXBlcmF0dXJlID0gcGFyc2VGbG9hdChub2RlLmNvbmZpZy50ZW1wZXJhdHVyZS52YWx1ZSk7DQogICAgY29uc3QgbWF4VG9rZW5zID0gcGFyc2VJbnQobm9kZS5jb25maWcubWF4X3Rva2Vucy52YWx1ZSk7DQogICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gbm9kZS5jb25maWcuc3lzdGVtX3Byb21wdC52YWx1ZTsNCiAgICBjb25zdCBpbmNsdWRlQ29udGV4dCA9IG5vZGUuY29uZmlnLmluY2x1ZGVfY29udGV4dC52YWx1ZSA9PT0gJ3RydWUnOw0KDQogICAgLy8gQWNjZXB0IHByb21wdCBmcm9tIGVpdGhlciAncHJvbXB0JyBvciAndGV4dCcgaW5wdXQNCiAgICBsZXQgcHJvbXB0ID0gaW5wdXREYXRhLnByb21wdDsNCiAgICBpZiAoIXByb21wdCAmJiBpbnB1dERhdGEudGV4dCkgew0KICAgICAgICBwcm9tcHQgPSBpbnB1dERhdGEudGV4dDsNCiAgICB9DQogICAgaWYgKCFwcm9tcHQgJiYgaW5wdXREYXRhLmNvbnRleHQpIHsNCiAgICAgICAgLy8gSWYgY29udGV4dCBpcyBhIHN0cmluZywgdXNlIGl0IGFzIHByb21wdA0KICAgICAgICBpZiAodHlwZW9mIGlucHV0RGF0YS5jb250ZXh0ID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgcHJvbXB0ID0gaW5wdXREYXRhLmNvbnRleHQ7DQogICAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmNvbnRleHQgJiYgdHlwZW9mIGlucHV0RGF0YS5jb250ZXh0ID09PSAnb2JqZWN0JyAmJiBpbnB1dERhdGEuY29udGV4dC50ZXh0KSB7DQogICAgICAgICAgICAvLyBJZiBjb250ZXh0IGlzIGFuIG9iamVjdCB3aXRoIHRleHQgZmllbGQsIHVzZSB0aGF0DQogICAgICAgICAgICBwcm9tcHQgPSBpbnB1dERhdGEuY29udGV4dC50ZXh0Ow0KICAgICAgICB9DQogICAgfQ0KICAgIGlmICghcHJvbXB0KSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignTExNIENoYXQgcmVxdWlyZXMgYSBwcm9tcHQgaW5wdXQuIENvbm5lY3QgYSBUZXh0IG5vZGUgdG8gcHJvdmlkZSB0aGUgcHJvbXB0LicpOw0KICAgIH0NCg0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gW107DQoNCiAgICAgICAgaWYgKHN5c3RlbVByb21wdCkgew0KICAgICAgICAgICAgbWVzc2FnZXMucHVzaCh7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoaW5jbHVkZUNvbnRleHQgJiYgaW5wdXREYXRhLmNvbnRleHQpIHsNCiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2goeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IGBDb250ZXh0OiAke0pTT04uc3RyaW5naWZ5KGlucHV0RGF0YS5jb250ZXh0KX1cblxuUHJvbXB0OiAke3Byb21wdH1gIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbWVzc2FnZXMucHVzaCh7IHJvbGU6ICd1c2VyJywgY29udGVudDogcHJvbXB0IH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtlbmRwb2ludH0vY2hhdC9jb21wbGV0aW9uc2AsIHsNCiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLA0KICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsLA0KICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcywNCiAgICAgICAgICAgICAgICB0ZW1wZXJhdHVyZTogdGVtcGVyYXR1cmUsDQogICAgICAgICAgICAgICAgbWF4X3Rva2VuczogbWF4VG9rZW5zDQogICAgICAgICAgICB9KQ0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOw0KDQogICAgICAgIGlmIChkYXRhLmVycm9yKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvci5tZXNzYWdlIHx8ICdMTE0gQVBJIGVycm9yJyk7DQogICAgICAgIH0NCg0KICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBkYXRhLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgJyc7DQoNCiAgICAgICAgLy8gU3RvcmUgZm9yIGRpc3BsYXkgaW4gY29uZmlnIHBhbmVsDQogICAgICAgIG5vZGUubGFzdFJlc3BvbnNlID0gcmVzcG9uc2VUZXh0Ow0KICAgICAgICBub2RlLmxhc3RVc2FnZSA9IGRhdGEudXNhZ2U7DQogICAgICAgIG5vZGUubGFzdE1vZGVsID0gbW9kZWw7DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZVRleHQsDQogICAgICAgICAgICB0b2tlbnNfdXNlZDogZGF0YS51c2FnZT8udG90YWxfdG9rZW5zIHx8IDAsDQogICAgICAgICAgICBtb2RlbF91c2VkOiBtb2RlbCwNCiAgICAgICAgICAgIGZ1bGxfcmVzcG9uc2U6IGRhdGENCiAgICAgICAgfTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdMTE0gQ2hhdCBlcnJvcjonLCBlcnJvcik7DQogICAgICAgIHJldHVybiB7IHJlc3BvbnNlOiBudWxsLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9Ow0KICAgIH0NCn0NCg0KDQovLyBUZXJtaW5hbCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlVGVybWluYWxOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGNvbW1hbmQgPSBub2RlLmNvbmZpZy5jb21tYW5kLnZhbHVlOw0KICAgIGNvbnN0IHVzZUlucHV0Q29tbWFuZCA9IG5vZGUuY29uZmlnLnVzZV9pbnB1dF9jb21tYW5kLnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3Qgd29ya2luZ0RpcmVjdG9yeSA9IG5vZGUuY29uZmlnLndvcmtpbmdfZGlyZWN0b3J5LnZhbHVlOw0KICAgIGNvbnN0IHRpbWVvdXQgPSBwYXJzZUludChub2RlLmNvbmZpZy50aW1lb3V0LnZhbHVlKTsNCg0KICAgIGxldCBmaW5hbENvbW1hbmQgPSBjb21tYW5kOw0KICAgIGlmICh1c2VJbnB1dENvbW1hbmQgJiYgaW5wdXREYXRhLmNvbW1hbmQpIHsNCiAgICAgICAgZmluYWxDb21tYW5kID0gaW5wdXREYXRhLmNvbW1hbmQ7DQogICAgfQ0KDQogICAgdHJ5IHsNCiAgICAgICAgLy8gVGhpcyB3b3VsZCBuZWVkIHRvIGJlIGltcGxlbWVudGVkIHdpdGggYWN0dWFsIHRlcm1pbmFsIGV4ZWN1dGlvbg0KICAgICAgICAvLyBGb3Igbm93LCB3ZSdsbCByZXR1cm4gYSBwbGFjZWhvbGRlcg0KICAgICAgICBjb25zb2xlLmxvZygnVGVybWluYWwgY29tbWFuZCB3b3VsZCBleGVjdXRlOicsIGZpbmFsQ29tbWFuZCk7DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIG91dHB1dDogYENvbW1hbmQgZXhlY3V0ZWQ6ICR7ZmluYWxDb21tYW5kfWAsDQogICAgICAgICAgICBzdWNjZXNzOiB0cnVlLA0KICAgICAgICAgICAgZXJyb3I6IG51bGwsDQogICAgICAgICAgICBleGl0X2NvZGU6IDANCiAgICAgICAgfTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdUZXJtaW5hbCBleGVjdXRpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgb3V0cHV0OiBudWxsLA0KICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsDQogICAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSwNCiAgICAgICAgICAgIGV4aXRfY29kZTogMQ0KICAgICAgICB9Ow0KICAgIH0NCn0NCg0KLy8gRXhwb3J0IHRvIGdsb2JhbCBzY29wZQ0Kd2luZG93LmFpRXhlY3V0b3JzID0gew0KICAgIGV4ZWN1dGVMbG1DaGF0Tm9kZSwNCiAgICBleGVjdXRlVGVybWluYWxOb2RlDQp9Ow0KDQovLyBleGVjdXRpb24tZW5naW5lLmpzIC0gRHluYW1pYyBleGVjdXRpb24gZW5naW5lIGZvciBGbG93IEVkaXRvcg0KDQpjbGFzcyBFeGVjdXRpb25FbmdpbmUgew0KICAgIGNvbnN0cnVjdG9yKHJlZ2lzdHJ5KSB7DQogICAgICAgIHRoaXMucmVnaXN0cnkgPSByZWdpc3RyeTsNCiAgICAgICAgdGhpcy5zZXR1cEV4ZWN1dG9ycygpOw0KICAgIH0NCg0KICAgIHNldHVwRXhlY3V0b3JzKCkgew0KICAgICAgICAvLyBSZWdpc3RlciBleGVjdXRvcnMgZnJvbSBleHRlcm5hbCBmaWxlcyB3aXRoIGVuZ2luZSBpbnN0YW5jZSBwYXNzZWQgYXMgZmlyc3QgcGFyYW1ldGVyDQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignaHR0cF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5odHRwRXhlY3V0b3JzLmV4ZWN1dGVIdHRwTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcigndmZzX3NhdmVfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuaHR0cEV4ZWN1dG9ycy5leGVjdXRlVmZzU2F2ZU5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3Zmc19sb2FkX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93Lmh0dHBFeGVjdXRvcnMuZXhlY3V0ZVZmc0xvYWROb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgICAgIA0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3RpbWVyX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFeGVjdXRvcnMuZXhlY3V0ZVRpbWVyTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignZGlzcGxheV9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5mbG93RXhlY3V0b3JzLmV4ZWN1dGVEaXNwbGF5Tm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcigncmVwZWF0ZXJfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZmxvd0V4ZWN1dG9ycy5leGVjdXRlUmVwZWF0ZXJOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdjb25kaXRpb25fZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZmxvd0V4ZWN1dG9ycy5leGVjdXRlQ29uZGl0aW9uTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignbG9naWNhbF9nYXRlX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFeGVjdXRvcnMuZXhlY3V0ZUxvZ2ljYWxHYXRlTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgICAgICANCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdhdWRpb19leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5tZWRpYUV4ZWN1dG9ycy5leGVjdXRlQXVkaW9Ob2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdpbWFnZV9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5tZWRpYUV4ZWN1dG9ycy5leGVjdXRlSW1hZ2VOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgICAgIA0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ2pzb25fZXh0cmFjdF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5kYXRhRXhlY3V0b3JzLmV4ZWN1dGVKc29uRXh0cmFjdE5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3JhbmRvbV9saW5lX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmRhdGFFeGVjdXRvcnMuZXhlY3V0ZVJhbmRvbVF1b3RlTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcigndGV4dF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5kYXRhRXhlY3V0b3JzLmV4ZWN1dGVUZXh0Tm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgICAgICANCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdsbG1fY2hhdF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5haUV4ZWN1dG9ycy5leGVjdXRlTGxtQ2hhdE5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3Rlcm1pbmFsX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmFpRXhlY3V0b3JzLmV4ZWN1dGVUZXJtaW5hbE5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgIH0NCg0KICAgIGFzeW5jIGV4ZWN1dGVOb2RlKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICAgICAgY29uc3Qgbm9kZURlZiA9IHRoaXMucmVnaXN0cnkuZ2V0Tm9kZVR5cGUobm9kZS50eXBlKTsNCiAgICAgICAgaWYgKCFub2RlRGVmKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIG5vZGUgZGVmaW5pdGlvbiBmb3VuZCBmb3IgdHlwZTogJHtub2RlLnR5cGV9YCk7DQogICAgICAgIH0NCg0KICAgICAgICBjb25zdCBleGVjdXRvck5hbWUgPSBub2RlRGVmLmV4ZWN1dG9yOw0KICAgICAgICBjb25zdCBleGVjdXRvciA9IHRoaXMucmVnaXN0cnkuZ2V0RXhlY3V0b3IoZXhlY3V0b3JOYW1lKTsNCg0KICAgICAgICBpZiAoIWV4ZWN1dG9yKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGV4ZWN1dG9yIGZvdW5kIGZvcjogJHtleGVjdXRvck5hbWV9YCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gYXdhaXQgZXhlY3V0b3Iobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCk7DQogICAgfQ0KDQoNCg0KICAgIC8vIFN0b3AgcmVwZWF0ZXIgbWV0aG9kDQogICAgc3RvcFJlcGVhdGVyKG5vZGUpIHsNCiAgICAgICAgaWYgKG5vZGUucmVwZWF0ZXJTdGF0ZSAmJiBub2RlLnJlcGVhdGVyU3RhdGUuaW50ZXJ2YWwpIHsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobm9kZS5yZXBlYXRlclN0YXRlLmludGVydmFsKTsNCiAgICAgICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5pbnRlcnZhbCA9IG51bGw7DQogICAgICAgICAgICBub2RlLnJlcGVhdGVyU3RhdGUuaXNSdW5uaW5nID0gZmFsc2U7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnUmVwZWF0ZXIgc3RvcHBlZDonLCBub2RlLmlkKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KDQoNCg0KfQ0KDQovLyBHbG9iYWwgZXhlY3V0aW9uIGVuZ2luZSBpbnN0YW5jZQ0KY29uc29sZS5sb2coJ0NyZWF0aW5nIGdsb2JhbCBleGVjdXRpb25FbmdpbmUgaW5zdGFuY2UuLi4nKTsNCmNvbnN0IGV4ZWN1dGlvbkVuZ2luZSA9IG5ldyBFeGVjdXRpb25FbmdpbmUobm9kZVJlZ2lzdHJ5KTsNCmNvbnNvbGUubG9nKCdHbG9iYWwgZXhlY3V0aW9uRW5naW5lIGNyZWF0ZWQ6JywgZXhlY3V0aW9uRW5naW5lKTsgDQoNCi8vIHdvcmtmbG93LmpzIC0gV29ya2Zsb3cgZXhlY3V0aW9uIGxvZ2ljIGZvciBGbG93IEVkaXRvcg0KDQovLyBSdW4gdGhlIHdvcmtmbG93DQphc3luYyBmdW5jdGlvbiBydW5Xb3JrZmxvdygpIHsNCiAgICBpZiAoZmxvd0VkaXRvci5pc1J1bm5pbmcpIHsNCiAgICAgICAgY29uc29sZS5sb2coJ1dvcmtmbG93IGFscmVhZHkgcnVubmluZycpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGZsb3dFZGl0b3IuaXNSdW5uaW5nID0gdHJ1ZTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcC13b3JrZmxvdycpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWZsZXgnOw0KICAgIA0KICAgIC8vIENsZWFyIG91dHB1dA0KICAgIGNvbnN0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGVjdXRpb24tb3V0cHV0Jyk7DQogICAgb3V0cHV0LmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJsb2ctZW50cnkgaW5mbyI+U3RhcnRpbmcgd29ya2Zsb3cgZXhlY3V0aW9uLi4uPC9kaXY+JzsNCiAgICANCiAgICB0cnkgew0KICAgICAgICAvLyBGaW5kIHN0YXJ0IG5vZGVzIChub2RlcyB3aXRoIG5vIGlucHV0cyB0aGF0IGFyZSBwYXJ0IG9mIGEgY29ubmVjdGVkIHdvcmtmbG93KQ0KICAgICAgICBjb25zdCBzdGFydE5vZGVzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKS5maWx0ZXIobm9kZSA9PiB7DQogICAgICAgICAgICBjb25zdCBub2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKG5vZGUudHlwZSk7DQogICAgICAgICAgICBpZiAoIW5vZGVEZWYpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYE5vIG5vZGUgZGVmaW5pdGlvbiBmb3VuZCBmb3IgdHlwZTogJHtub2RlLnR5cGV9YCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zb2xlLmxvZyhgQ2hlY2tpbmcgbm9kZSAke25vZGUudHlwZX0gKCR7bm9kZS5pZH0pOiBpbnB1dHM9JHtub2RlRGVmLmlucHV0cy5sZW5ndGh9LCBvdXRwdXRzPSR7bm9kZURlZi5vdXRwdXRzLmxlbmd0aH1gKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gVGltZXIgYW5kIFJlcGVhdGVyIG5vZGVzIGFyZSBzdGFydCBub2RlcyAoY2FuIHRyaWdnZXIgdGhlbXNlbHZlcykNCiAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICd0aW1lcicgfHwgbm9kZS50eXBlID09PSAncmVwZWF0ZXInKSB7DQogICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ3JlcGVhdGVyJykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1J1bm5pbmcgPSBub2RlLnJlcGVhdGVyU3RhdGUgJiYgbm9kZS5yZXBlYXRlclN0YXRlLmlzUnVubmluZzsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFJlcGVhdGVyICR7bm9kZS5pZH06IGlzUnVubmluZz0ke2lzUnVubmluZ30sIHJlcGVhdGVyU3RhdGU9YCwgbm9kZS5yZXBlYXRlclN0YXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gVGltZXIvUmVwZWF0ZXIgaXMgYSBzdGFydCBub2RlIGlmIGl0IGhhcyBjb25uZWN0ZWQgb3V0cHV0cw0KICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Nvbm5lY3RlZE91dHB1dHMgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLnNvbWUoY29ubiA9PiANCiAgICAgICAgICAgICAgICAgICAgY29ubi5mcm9tLm5vZGVJZCA9PT0gbm9kZS5pZA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCR7bm9kZS50eXBlfSAke25vZGUuaWR9OiBoYXNDb25uZWN0ZWRPdXRwdXRzPSR7aGFzQ29ubmVjdGVkT3V0cHV0c31gKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzQ29ubmVjdGVkT3V0cHV0czsgLy8gVGltZXIvUmVwZWF0ZXIgaXMgYSBzdGFydCBub2RlIGlmIGNvbm5lY3RlZA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBJZiBub2RlIGhhcyBubyBpbnB1dHMsIGNoZWNrIGlmIGl0J3MgcGFydCBvZiBhIGNvbm5lY3RlZCB3b3JrZmxvdw0KICAgICAgICAgICAgaWYgKG5vZGVEZWYuaW5wdXRzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgbm9kZSBoYXMgYW55IG91dHB1dHMgdGhhdCBhcmUgY29ubmVjdGVkIHRvIG90aGVyIG5vZGVzDQogICAgICAgICAgICAgICAgY29uc3QgaGFzQ29ubmVjdGVkT3V0cHV0cyA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkuc29tZShjb25uID0+IA0KICAgICAgICAgICAgICAgICAgICBjb25uLmZyb20ubm9kZUlkID09PSBub2RlLmlkDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUudHlwZX0gKCR7bm9kZS5pZH0pOiBubyBpbnB1dHMsIGhhc0Nvbm5lY3RlZE91dHB1dHM9JHtoYXNDb25uZWN0ZWRPdXRwdXRzfWApOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE9ubHkgaW5jbHVkZSBpZiBpdCdzIGNvbm5lY3RlZCB0byB0aGUgd29ya2Zsb3cNCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzQ29ubmVjdGVkT3V0cHV0czsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3Igbm9kZXMgd2l0aCBvcHRpb25hbCBpbnB1dHMNCiAgICAgICAgICAgIGNvbnN0IG9wdGlvbmFsSW5wdXRzID0gbm9kZURlZi5pbnB1dHMuZmlsdGVyKGlucHV0ID0+IGlucHV0Lm9wdGlvbmFsKTsNCiAgICAgICAgICAgIGlmIChvcHRpb25hbElucHV0cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBub2RlIGhhcyBjb25uZWN0ZWQgb3V0cHV0cw0KICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Nvbm5lY3RlZE91dHB1dHMgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLnNvbWUoY29ubiA9PiANCiAgICAgICAgICAgICAgICAgICAgY29ubi5mcm9tLm5vZGVJZCA9PT0gbm9kZS5pZA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLnR5cGV9ICgke25vZGUuaWR9KTogaGFzIG9wdGlvbmFsIGlucHV0cywgaGFzQ29ubmVjdGVkT3V0cHV0cz0ke2hhc0Nvbm5lY3RlZE91dHB1dHN9YCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc0Nvbm5lY3RlZE91dHB1dHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIE5vZGVzIHdpdGggcmVxdWlyZWQgaW5wdXRzIGFyZSBub3Qgc3RhcnQgbm9kZXMgLSB0aGV5IHNob3VsZCBiZSB0cmlnZ2VyZWQgYnkgb3RoZXIgbm9kZXMNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb2RlICR7bm9kZS50eXBlfSAoJHtub2RlLmlkfSk6IGhhcyByZXF1aXJlZCBpbnB1dHMsIG5vdCBhIHN0YXJ0IG5vZGVgKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBpZiAoc3RhcnROb2Rlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gc3RhcnQgbm9kZXMgZm91bmQuIEFkZCBub2RlcyB3aXRoIG5vIGlucHV0cyAoVGltZXIpIG9yIG5vZGVzIHdpdGggb3B0aW9uYWwgaW5wdXRzIHRoYXQgYXJlblwndCBjb25uZWN0ZWQgKEhUVFAgUmVxdWVzdCknKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRXhlY3V0ZSB3b3JrZmxvdw0KICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgZXhlY3V0ZVdvcmtmbG93KHN0YXJ0Tm9kZXMpOw0KICAgICAgICANCiAgICAgICAgLy8gRGlzcGxheSByZXN1bHRzDQogICAgICAgIG91dHB1dC5pbm5lckhUTUwgKz0gJzxkaXYgY2xhc3M9ImxvZy1lbnRyeSBzdWNjZXNzIj5Xb3JrZmxvdyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5ITwvZGl2Pic7DQogICAgICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHJlc3VsdHMpIHsNCiAgICAgICAgICAgIG91dHB1dC5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9ImxvZy1lbnRyeSBpbmZvIj4ke3Jlc3VsdC5ub2RlSWR9OiAke3Jlc3VsdC5vdXRwdXR9PC9kaXY+YDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gU2VuZCBjb21wbGV0aW9uIHZpYSBXZWJTb2NrZXQNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2VuZE1lc3NhZ2UpIHsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zZW5kTWVzc2FnZSgnd29ya2Zsb3dfY29tcGxldGVkJywgew0KICAgICAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsDQogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpDQogICAgICAgICAgICB9LCAnZmxvdy1lZGl0b3InKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdXb3JrZmxvdyBleGVjdXRpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJsb2ctZW50cnkgZXJyb3IiPkVycm9yOiAke2Vycm9yLm1lc3NhZ2V9PC9kaXY+YDsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgICBmbG93RWRpdG9yLmlzUnVubmluZyA9IGZhbHNlOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtZmxleCc7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICB9DQp9DQoNCi8vIEV4ZWN1dGUgd29ya2Zsb3cNCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVXb3JrZmxvdyhzdGFydE5vZGVzKSB7DQogICAgY29uc3QgcmVzdWx0cyA9IFtdOw0KICAgIGNvbnN0IGV4ZWN1dGVkID0gbmV3IFNldCgpOw0KICAgIA0KICAgIGZvciAoY29uc3Qgc3RhcnROb2RlIG9mIHN0YXJ0Tm9kZXMpIHsNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZU5vZGUoc3RhcnROb2RlLCB7fSwgZXhlY3V0ZWQpOw0KICAgICAgICBpZiAocmVzdWx0KSByZXN1bHRzLnB1c2gocmVzdWx0KTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIHJlc3VsdHM7DQp9DQoNCi8vIEV4ZWN1dGUgYSBzaW5nbGUgbm9kZSAoZHluYW1pYyB2ZXJzaW9uKQ0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZU5vZGUobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGlmIChleGVjdXRlZC5oYXMobm9kZS5pZCkpIHsNCiAgICAgICAgY29uc29sZS5sb2coYE5vZGUgJHtub2RlLmlkfSBhbHJlYWR5IGV4ZWN1dGVkLCBza2lwcGluZyB0byBwcmV2ZW50IGN5Y2xlc2ApOw0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgZXhlY3V0ZWQuYWRkKG5vZGUuaWQpOw0KICAgIA0KICAgIC8vIE1hcmsgbm9kZSBhcyBydW5uaW5nDQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub2RlLmlkKTsNCiAgICBpZiAobm9kZUVsZW1lbnQpIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3J1bm5pbmcnKTsNCiAgICANCiAgICB0cnkgew0KICAgICAgICAvLyBVc2UgdGhlIGR5bmFtaWMgZXhlY3V0aW9uIGVuZ2luZQ0KICAgICAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCBleGVjdXRpb25FbmdpbmUuZXhlY3V0ZU5vZGUobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCk7DQogICAgICAgIA0KICAgICAgICAvLyBDaGVjayBpZiBvdXRwdXQgaW5kaWNhdGVzIGV4ZWN1dGlvbiBzaG91bGQgc3RvcCAobG9naWNhbCBnYXRlIHNwZWNpZmljKQ0KICAgICAgICBpZiAob3V0cHV0ICYmIHR5cGVvZiBvdXRwdXQgPT09ICdvYmplY3QnICYmIG91dHB1dC5fX3N0b3BfZXhlY3V0aW9uID09PSB0cnVlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IHJldHVybmVkIHN0b3AgZXhlY3V0aW9uIHNpZ25hbCwgc3RvcHBpbmcgd29ya2Zsb3dgKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gTWFyayBub2RlIGFzIGNvbXBsZXRlZA0KICAgICAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgncnVubmluZycpOw0KICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlZCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4geyBub2RlSWQ6IG5vZGUuaWQsIG91dHB1dDogbnVsbCB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBGaW5kIGNvbm5lY3RlZCBub2RlcyBhbmQgZXhlY3V0ZSB0aGVtDQogICAgICAgIGNvbnN0IGNvbm5lY3RlZE5vZGVzID0gZmluZENvbm5lY3RlZE5vZGVzKG5vZGUuaWQpOw0KICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IGhhcyAke2Nvbm5lY3RlZE5vZGVzLmxlbmd0aH0gY29ubmVjdGVkIG5vZGVzYCk7DQogICAgICAgIA0KICAgICAgICBmb3IgKGNvbnN0IGNvbm5lY3RlZE5vZGUgb2YgY29ubmVjdGVkTm9kZXMpIHsNCiAgICAgICAgICAgIC8vIENoZWNrIGZvciBjeWNsZXMgYmVmb3JlIGV4ZWN1dGluZw0KICAgICAgICAgICAgaWYgKGV4ZWN1dGVkLmhhcyhjb25uZWN0ZWROb2RlLm5vZGUuaWQpKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFNraXBwaW5nIGNvbm5lY3RlZCBub2RlICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfSB0byBwcmV2ZW50IGN5Y2xlYCk7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGA9PT0gUHJvY2Vzc2luZyBjb25uZWN0aW9uICR7bm9kZS5pZH0gLT4gJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9ID09PWApOw0KICAgICAgICAgICAgY29uc29sZS5sb2coYENvbm5lY3Rpb24gZGV0YWlsczogJHtjb25uZWN0ZWROb2RlLm91dHB1dFBvcnR9IC0+ICR7Y29ubmVjdGVkTm9kZS5pbnB1dFBvcnR9YCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEhhbmRsZSBvdXRwdXQgbWFwcGluZyB0byBpbnB1dCBwb3J0cyAtIERJUkVDVCBNQVBQSU5HDQogICAgICAgICAgICBsZXQgaW5wdXRWYWx1ZSA9IG91dHB1dDsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb2RlICR7bm9kZS5pZH0gb3V0cHV0OmAsIG91dHB1dCk7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IG91dHB1dCB0eXBlOmAsIHR5cGVvZiBvdXRwdXQpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coYFNvdXJjZSBvdXRwdXQgcG9ydDpgLCBjb25uZWN0ZWROb2RlLm91dHB1dFBvcnQpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coYFRhcmdldCBpbnB1dCBwb3J0OmAsIGNvbm5lY3RlZE5vZGUuaW5wdXRQb3J0KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKG91dHB1dCBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgICAgICAgICAvLyBCbG9iIG91dHB1dCAtIHBhc3MgZGlyZWN0bHkgdG8gdGhlIGlucHV0IHBvcnQNCiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gb3V0cHV0Ow0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb2RlICR7bm9kZS5pZH0gLT4gJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9OiBQYXNzaW5nIEJsb2IgZGlyZWN0bHkgPWAsIGlucHV0VmFsdWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb3V0cHV0ID09PSAnb2JqZWN0JyAmJiBvdXRwdXQgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAvLyBPYmplY3Qgb3V0cHV0IC0gZXh0cmFjdCB0aGUgRVhBQ1Qgb3V0cHV0IHBvcnQgZmllbGQNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IG91dHB1dCBvYmplY3Qga2V5czpgLCBPYmplY3Qua2V5cyhvdXRwdXQpKTsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IG91dHB1dCBvYmplY3QgdmFsdWVzOmAsIE9iamVjdC52YWx1ZXMob3V0cHV0KSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKGNvbm5lY3RlZE5vZGUub3V0cHV0UG9ydCBpbiBvdXRwdXQpIHsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IG91dHB1dFtjb25uZWN0ZWROb2RlLm91dHB1dFBvcnRdOw0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kZSAke25vZGUuaWR9IC0+ICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTogRElSRUNUIE1BUFBJTkcgJHtjb25uZWN0ZWROb2RlLm91dHB1dFBvcnR9IC0+ICR7Y29ubmVjdGVkTm9kZS5pbnB1dFBvcnR9ID1gLCBpbnB1dFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYElucHV0IHZhbHVlIHR5cGU6YCwgdHlwZW9mIGlucHV0VmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgSW5wdXQgdmFsdWUgaXMgbnVsbDpgLCBpbnB1dFZhbHVlID09PSBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYElucHV0IHZhbHVlIGlzIHVuZGVmaW5lZDpgLCBpbnB1dFZhbHVlID09PSB1bmRlZmluZWQpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYE5vZGUgJHtub2RlLmlkfSAtPiAke2Nvbm5lY3RlZE5vZGUubm9kZS5pZH06IEVSUk9SIC0gT3V0cHV0IHBvcnQgJyR7Y29ubmVjdGVkTm9kZS5vdXRwdXRQb3J0fScgbm90IGZvdW5kIGluIG91dHB1dCFgKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQXZhaWxhYmxlIGZpZWxkczpgLCBPYmplY3Qua2V5cyhvdXRwdXQpKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCB0aGlzIGNvbm5lY3Rpb24gaW5zdGVhZCBvZiBwYXNzaW5nIG51bGwNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFNraXBwaW5nIGNvbm5lY3Rpb24gJHtub2RlLmlkfSAtPiAke2Nvbm5lY3RlZE5vZGUubm9kZS5pZH0gZHVlIHRvIG1pc3Npbmcgb3V0cHV0IHBvcnRgKTsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBTaW1wbGUgdmFsdWUgb3V0cHV0IC0gcGFzcyBkaXJlY3RseQ0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb2RlICR7bm9kZS5pZH0gLT4gJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9OiBQYXNzaW5nIHNpbXBsZSB2YWx1ZSA9YCwgaW5wdXRWYWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGaW5hbCBpbnB1dCB2YWx1ZSBmb3IgJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9OmAsIGlucHV0VmFsdWUpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coYElucHV0IHZhbHVlIHR5cGU6YCwgdHlwZW9mIGlucHV0VmFsdWUpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coYElucHV0IHZhbHVlIGluc3RhbmNlb2YgQmxvYjpgLCBpbnB1dFZhbHVlIGluc3RhbmNlb2YgQmxvYik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgYXdhaXQgZXhlY3V0ZU5vZGUoY29ubmVjdGVkTm9kZS5ub2RlLCB7IFtjb25uZWN0ZWROb2RlLmlucHV0UG9ydF06IGlucHV0VmFsdWUgfSwgZXhlY3V0ZWQpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBleGVjdXRpbmcgY29ubmVjdGVkIG5vZGUgJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9OmAsIGVycm9yKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGVjdXRpb24tb3V0cHV0Jyk7DQogICAgICAgICAgICAgICAgb3V0cHV0UGFuZWwuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJsb2ctZW50cnkgZXJyb3IiPkVycm9yIGluIGNvbm5lY3RlZCBub2RlICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTogJHtlcnJvci5tZXNzYWdlfTwvZGl2PmA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIE1hcmsgbm9kZSBhcyBjb21wbGV0ZWQNCiAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJyk7DQogICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHsgbm9kZUlkOiBub2RlLmlkLCBvdXRwdXQ6IG91dHB1dCB9Ow0KICAgICAgICANCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBleGVjdXRpbmcgbm9kZSAke25vZGUuaWR9OmAsIGVycm9yKTsNCiAgICAgICAgDQogICAgICAgIC8vIE1hcmsgbm9kZSBhcyBlcnJvcg0KICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Vycm9yJyk7DQogICAgfQ0KICAgIA0KICAgICAgICB0aHJvdyBlcnJvcjsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgICAvLyBSZW1vdmUgcnVubmluZyBzdGF0ZQ0KICAgICAgICBpZiAobm9kZUVsZW1lbnQpIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICB9DQogICAgfQ0KICAgIA0KLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHVwZGF0ZSBkaXNwbGF5IG5vZGUgY29udGVudCAodXNlZCBieSBleGVjdXRpb24gZW5naW5lKQ0KZnVuY3Rpb24gdXBkYXRlRGlzcGxheU5vZGVDb250ZW50KG5vZGVJZCwgY29udGVudCwgZm9ybWF0KSB7DQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub2RlSWQpOw0KICAgIGlmICghbm9kZUVsZW1lbnQpIHJldHVybjsNCiAgICANCiAgICBjb25zdCBkaXNwbGF5VGV4dCA9IG5vZGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kaXNwbGF5LXRleHQnKTsNCiAgICBjb25zdCBmb3JtYXRFbGVtZW50ID0gbm9kZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmRpc3BsYXktZm9ybWF0IHNwYW4nKTsNCiAgICANCiAgICBpZiAoZGlzcGxheVRleHQpIHsNCiAgICAgICAgbGV0IGZvcm1hdHRlZENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICANCiAgICBzd2l0Y2ggKGZvcm1hdCkgew0KICAgICAgICBjYXNlICdqc29uJzoNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2UoY29udGVudCkgOiBjb250ZW50Ow0KICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkocGFyc2VkLCBudWxsLCAyKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCA9IGNvbnRlbnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnaHRtbCc6DQogICAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCA9IGNvbnRlbnQ7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAndGV4dCc6DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCA9IGNvbnRlbnQ7DQogICAgICAgICAgICBicmVhazsNCiAgICB9DQogICAgDQogICAgICAgIGRpc3BsYXlUZXh0LmlubmVySFRNTCA9IGA8cHJlIGNsYXNzPSJjb250ZW50LXRleHQiPiR7ZXNjYXBlSHRtbChmb3JtYXR0ZWRDb250ZW50KX08L3ByZT5gOw0KICAgIH0NCiAgICANCiAgICBpZiAoZm9ybWF0RWxlbWVudCkgew0KICAgICAgICBmb3JtYXRFbGVtZW50LnRleHRDb250ZW50ID0gZm9ybWF0Ow0KICAgIH0NCiAgICANCiAgICAvLyBTdG9yZSBmb3IgY29uZmlnIHBhbmVsIGRpc3BsYXkNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAobm9kZSkgew0KICAgICAgICBub2RlLmxhc3RDb250ZW50ID0gY29udGVudDsNCiAgICAgICAgbm9kZS5sYXN0Rm9ybWF0ID0gZm9ybWF0Ow0KICAgIH0NCn0NCg0KLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGVzY2FwZSBIVE1MDQpmdW5jdGlvbiBlc2NhcGVIdG1sKHRleHQpIHsNCiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBkaXYudGV4dENvbnRlbnQgPSB0ZXh0Ow0KICAgIHJldHVybiBkaXYuaW5uZXJIVE1MOw0KfQ0KDQovLyBIZWxwZXIgZnVuY3Rpb24gdG8gcmVwbGFjZSB0ZW1wbGF0ZSBwbGFjZWhvbGRlcnMNCmZ1bmN0aW9uIHJlcGxhY2VUZW1wbGF0ZVBsYWNlaG9sZGVycyh0ZW1wbGF0ZSwgZGF0YSkgew0KICAgIGlmICh0eXBlb2YgdGVtcGxhdGUgIT09ICdvYmplY3QnIHx8IHRlbXBsYXRlID09PSBudWxsKSB7DQogICAgICAgIHJldHVybiB0ZW1wbGF0ZTsNCiAgICB9DQogICAgDQogICAgaWYgKEFycmF5LmlzQXJyYXkodGVtcGxhdGUpKSB7DQogICAgICAgIHJldHVybiB0ZW1wbGF0ZS5tYXAoaXRlbSA9PiByZXBsYWNlVGVtcGxhdGVQbGFjZWhvbGRlcnMoaXRlbSwgZGF0YSkpOw0KICAgIH0NCiAgICANCiAgICBjb25zdCByZXN1bHQgPSB7fTsNCiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh0ZW1wbGF0ZSkpIHsNCiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIGxldCByZXBsYWNlZFZhbHVlID0gdmFsdWU7DQogICAgDQogICAgICAgICAgICAvLyBSZXBsYWNlIHt7VkFMVUV9fSB3aXRoIHRoZSBmdWxsIGRhdGEgb2JqZWN0DQogICAgICAgICAgICBpZiAodmFsdWUuaW5jbHVkZXMoJ3t7VkFMVUV9fScpKSB7DQogICAgICAgICAgICAgICAgcmVwbGFjZWRWYWx1ZSA9IHZhbHVlLnJlcGxhY2UoJ3t7VkFMVUV9fScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTsNCn0NCg0KICAgICAgICAgICAgLy8gUmVwbGFjZSB7e0pTT046ZmllbGR9fSB3aXRoIHNwZWNpZmljIGZpZWxkDQogICAgICAgICAgICBjb25zdCBqc29uTWF0Y2hlcyA9IHZhbHVlLm1hdGNoKC9ce1x7SlNPTjooW159XSspXH1cfS9nKTsNCiAgICAgICAgICAgIGlmIChqc29uTWF0Y2hlcykgew0KICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbWF0Y2ggb2YganNvbk1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSBtYXRjaC5tYXRjaCgvXHtce0pTT046KFtefV0rKVx9XH0vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRWYWx1ZSA9IGdldE5lc3RlZFZhbHVlKGRhdGEsIGZpZWxkKTsNCiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZWRWYWx1ZSA9IHJlcGxhY2VkVmFsdWUucmVwbGFjZShtYXRjaCwgSlNPTi5zdHJpbmdpZnkoZmllbGRWYWx1ZSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICB9DQogICAgDQogICAgICAgICAgICAvLyBSZXBsYWNlIHt7ZmllbGR9fSB3aXRoIHNwZWNpZmljIGZpZWxkIHZhbHVlDQogICAgICAgICAgICBjb25zdCBmaWVsZE1hdGNoZXMgPSB2YWx1ZS5tYXRjaCgvXHtceyhbXn1dKylcfVx9L2cpOw0KICAgICAgICAgICAgaWYgKGZpZWxkTWF0Y2hlcykgew0KICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbWF0Y2ggb2YgZmllbGRNYXRjaGVzKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gbWF0Y2gubWF0Y2goL1x7XHsoW159XSspXH1cfS8pWzFdOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQgIT09ICdWQUxVRScgJiYgIWZpZWxkLnN0YXJ0c1dpdGgoJ0pTT046JykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSBnZXROZXN0ZWRWYWx1ZShkYXRhLCBmaWVsZCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlZFZhbHVlID0gcmVwbGFjZWRWYWx1ZS5yZXBsYWNlKG1hdGNoLCBmaWVsZFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmVzdWx0W2tleV0gPSByZXBsYWNlZFZhbHVlOw0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHsNCiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gcmVwbGFjZVRlbXBsYXRlUGxhY2Vob2xkZXJzKHZhbHVlLCBkYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBuZXN0ZWQgb2JqZWN0IHZhbHVlcw0KZnVuY3Rpb24gZ2V0TmVzdGVkVmFsdWUob2JqLCBwYXRoKSB7DQogICAgY29uc3Qga2V5cyA9IHBhdGguc3BsaXQoJy4nKTsNCiAgICBsZXQgY3VycmVudCA9IG9iajsNCiAgICANCiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7DQogICAgICAgIGlmIChjdXJyZW50ID09PSBudWxsIHx8IGN1cnJlbnQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEhhbmRsZSBhcnJheSBhY2Nlc3MgbGlrZSAiaXRlbXNbMF0ubmFtZSINCiAgICAgICAgY29uc3QgYXJyYXlNYXRjaCA9IGtleS5tYXRjaCgvXiguKylcWyhcZCspXF0kLyk7DQogICAgICAgIGlmIChhcnJheU1hdGNoKSB7DQogICAgICAgICAgICBjb25zdCBhcnJheUtleSA9IGFycmF5TWF0Y2hbMV07DQogICAgICAgICAgICBjb25zdCBhcnJheUluZGV4ID0gcGFyc2VJbnQoYXJyYXlNYXRjaFsyXSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChjdXJyZW50W2FycmF5S2V5XSAmJiBBcnJheS5pc0FycmF5KGN1cnJlbnRbYXJyYXlLZXldKSkgew0KICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W2FycmF5S2V5XVthcnJheUluZGV4XTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W2tleV07DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIGN1cnJlbnQ7DQp9DQoNCi8vIFN0b3Agd29ya2Zsb3cgZXhlY3V0aW9uDQpmdW5jdGlvbiBzdG9wV29ya2Zsb3coKSB7DQogICAgICAgIGZsb3dFZGl0b3IuaXNSdW5uaW5nID0gZmFsc2U7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdydW4td29ya2Zsb3cnKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1mbGV4JzsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3Atd29ya2Zsb3cnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICANCiAgICAvLyBDbGVhciBydW5uaW5nIHN0YXRlcyBmcm9tIGFsbCBub2Rlcw0KICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmxvdy1ub2RlLnJ1bm5pbmcnKS5mb3JFYWNoKG5vZGUgPT4gew0KICAgICAgICAgICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJyk7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICBjb25zdCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhlY3V0aW9uLW91dHB1dCcpOw0KICAgIG91dHB1dC5pbm5lckhUTUwgKz0gJzxkaXYgY2xhc3M9ImxvZy1lbnRyeSB3YXJuaW5nIj5Xb3JrZmxvdyBleGVjdXRpb24gc3RvcHBlZCBieSB1c2VyPC9kaXY+JzsNCiAgICANCiAgICBjb25zb2xlLmxvZygnV29ya2Zsb3cgZXhlY3V0aW9uIHN0b3BwZWQnKTsNCn0NCg0KLy8gRmluZCBub2RlcyBjb25uZWN0ZWQgdG8gYSBzcGVjaWZpYyBub2RlDQpmdW5jdGlvbiBmaW5kQ29ubmVjdGVkTm9kZXMobm9kZUlkKSB7DQogICAgY29uc3QgY29ubmVjdGVkTm9kZXMgPSBbXTsNCiAgICANCiAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb24gb2YgZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkgew0KICAgICAgICBpZiAoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCA9PT0gbm9kZUlkKSB7DQogICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubmVjdGlvbi50by5ub2RlSWQpOw0KICAgICAgICAgICAgaWYgKHRhcmdldE5vZGUpIHsNCiAgICAgICAgICAgICAgICBjb25uZWN0ZWROb2Rlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgbm9kZTogdGFyZ2V0Tm9kZSwNCiAgICAgICAgICAgICAgICAgICAgaW5wdXRQb3J0OiBjb25uZWN0aW9uLnRvLnBvcnROYW1lLA0KICAgICAgICAgICAgICAgICAgICBvdXRwdXRQb3J0OiBjb25uZWN0aW9uLmZyb20ucG9ydE5hbWUNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICByZXR1cm4gY29ubmVjdGVkTm9kZXM7DQp9IA0KDQovLyBVcGRhdGUgY2FudmFzIHRyYW5zZm9ybSBmb3IgcGFubmluZyBhbmQgem9vbWluZw0KZnVuY3Rpb24gdXBkYXRlQ2FudmFzVHJhbnNmb3JtKCkgew0KICAgIGlmIChmbG93RWRpdG9yLmNhbnZhcykgew0KICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7Zmxvd0VkaXRvci5wYW5PZmZzZXQueH1weCwgJHtmbG93RWRpdG9yLnBhbk9mZnNldC55fXB4KSBzY2FsZSgke2Zsb3dFZGl0b3Iuem9vbUxldmVsfSlgOw0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07DQogICAgICAgIA0KICAgICAgICAvLyBVcGRhdGUgem9vbSBsZXZlbCBkaXNwbGF5DQogICAgICAgIGNvbnN0IHpvb21EaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb20tbGV2ZWwnKTsNCiAgICAgICAgaWYgKHpvb21EaXNwbGF5KSB7DQogICAgICAgICAgICB6b29tRGlzcGxheS50ZXh0Q29udGVudCA9IE1hdGgucm91bmQoZmxvd0VkaXRvci56b29tTGV2ZWwgKiAxMDApICsgJyUnOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyBTdGFydCBjYW52YXMgcGFubmluZw0KZnVuY3Rpb24gc3RhcnRDYW52YXNQYW4oZSkgew0KICAgIC8vIE9ubHkgc3RhcnQgcGFubmluZyBpZiBjbGlja2luZyBkaXJlY3RseSBvbiBjYW52YXMgKG5vdCBvbiBub2RlcyBvciBvdGhlciBlbGVtZW50cykNCiAgICAvLyBhbmQgbm90IGFscmVhZHkgZHJhZ2dpbmcgYSBub2RlDQogICAgaWYgKGUudGFyZ2V0ID09PSBmbG93RWRpdG9yLmNhbnZhcyAmJiAhZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUpIHsNCiAgICAgICAgZmxvd0VkaXRvci5pc1Bhbm5pbmcgPSB0cnVlOw0KICAgICAgICBjb25zdCBtb3VzZUNvb3JkcyA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPw0KICAgICAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRNb3VzZUNvb3JkcyhlKSA6DQogICAgICAgICAgICB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07DQogICAgICAgIGZsb3dFZGl0b3IucGFuU3RhcnQgPSB7IHg6IG1vdXNlQ29vcmRzLngsIHk6IG1vdXNlQ29vcmRzLnkgfTsNCiAgICAgICAgZmxvd0VkaXRvci5sYXN0UGFuT2Zmc2V0ID0geyAuLi5mbG93RWRpdG9yLnBhbk9mZnNldCB9Ow0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSAnZ3JhYmJpbmcnOw0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5jbGFzc0xpc3QuYWRkKCdwYW5uaW5nJyk7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICB9DQp9DQoNCi8vIFVwZGF0ZSBjYW52YXMgcGFubmluZw0KZnVuY3Rpb24gdXBkYXRlQ2FudmFzUGFuKGUpIHsNCiAgICBpZiAoZmxvd0VkaXRvci5pc1Bhbm5pbmcpIHsNCiAgICAgICAgY29uc3QgbW91c2VDb29yZHMgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8NCiAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOg0KICAgICAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgICAgICBjb25zdCBkZWx0YVggPSBtb3VzZUNvb3Jkcy54IC0gZmxvd0VkaXRvci5wYW5TdGFydC54Ow0KICAgICAgICBjb25zdCBkZWx0YVkgPSBtb3VzZUNvb3Jkcy55IC0gZmxvd0VkaXRvci5wYW5TdGFydC55Ow0KDQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSBmbG93RWRpdG9yLmxhc3RQYW5PZmZzZXQueCArIGRlbHRhWDsNCiAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IGZsb3dFZGl0b3IubGFzdFBhbk9mZnNldC55ICsgZGVsdGFZOw0KDQogICAgICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgfQ0KfQ0KDQovLyBTdG9wIGNhbnZhcyBwYW5uaW5nDQpmdW5jdGlvbiBzdG9wQ2FudmFzUGFuKCkgew0KICAgIGlmIChmbG93RWRpdG9yLmlzUGFubmluZykgew0KICAgICAgICBmbG93RWRpdG9yLmlzUGFubmluZyA9IGZhbHNlOw0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSAnZ3JhYic7DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLmNsYXNzTGlzdC5yZW1vdmUoJ3Bhbm5pbmcnKTsNCiAgICB9DQp9DQoNCi8vIFJlc2V0IGNhbnZhcyBwYW4gdG8gY2VudGVyDQpmdW5jdGlvbiByZXNldENhbnZhc1BhbigpIHsNCiAgICAvLyBBZGQgc21vb3RoIHRyYW5zaXRpb24gZm9yIHJlc2V0DQogICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC4zcyBlYXNlLW91dCc7DQoNCiAgICAvLyBDYWxjdWxhdGUgY2VudGVyIG9mIGFsbCBub2RlcyBpZiBhbnkgZXhpc3QNCiAgICBpZiAoZmxvd0VkaXRvci5ub2Rlcy5zaXplID4gMCkgew0KICAgICAgICBjb25zdCBub2RlcyA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5ub2Rlcy52YWx1ZXMoKSk7DQogICAgICAgIGNvbnN0IG1pblggPSBNYXRoLm1pbiguLi5ub2Rlcy5tYXAobiA9PiBuLngpKTsNCiAgICAgICAgY29uc3QgbWF4WCA9IE1hdGgubWF4KC4uLm5vZGVzLm1hcChuID0+IG4ueCkpOw0KICAgICAgICBjb25zdCBtaW5ZID0gTWF0aC5taW4oLi4ubm9kZXMubWFwKG4gPT4gbi55KSk7DQogICAgICAgIGNvbnN0IG1heFkgPSBNYXRoLm1heCguLi5ub2Rlcy5tYXAobiA9PiBuLnkpKTsNCg0KICAgICAgICBjb25zdCBjZW50ZXJYID0gKG1pblggKyBtYXhYKSAvIDI7DQogICAgICAgIGNvbnN0IGNlbnRlclkgPSAobWluWSArIG1heFkpIC8gMjsNCg0KICAgICAgICAvLyBHZXQgY2FudmFzIGNvbnRhaW5lciBkaW1lbnNpb25zIChzY2FsZWQpDQogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8NCiAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOg0KICAgICAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KDQogICAgICAgIC8vIENhbGN1bGF0ZSBwYW4gb2Zmc2V0IHRvIGNlbnRlciB0aGUgbm9kZXMgaW4gdGhlIHZpZXdwb3J0DQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSAtY2VudGVyWCArIGNvbnRhaW5lclJlY3Qud2lkdGggLyAyOw0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gLWNlbnRlclkgKyBjb250YWluZXJSZWN0LmhlaWdodCAvIDI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gSWYgbm8gbm9kZXMsIHJlc2V0IHRvIGNlbnRlciBvZiB0aGUgbGFyZ2UgY2FudmFzDQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0ID0geyB4OiAtNTAwMCwgeTogLTUwMDAgfTsNCiAgICB9DQoNCiAgICAvLyBSZXNldCB6b29tIHRvIDEwMCUNCiAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IDEuMDsNCg0KICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KDQogICAgLy8gUmVtb3ZlIHRyYW5zaXRpb24gYWZ0ZXIgYW5pbWF0aW9uIGNvbXBsZXRlcw0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS50cmFuc2l0aW9uID0gJyc7DQogICAgfSwgMzAwKTsNCn0NCg0KLy8gWm9vbSBmdW5jdGlvbnMNCmZ1bmN0aW9uIHpvb21JbigpIHsNCiAgICBjb25zdCBuZXdab29tID0gTWF0aC5taW4oZmxvd0VkaXRvci56b29tTGV2ZWwgKyBmbG93RWRpdG9yLnpvb21TdGVwLCBmbG93RWRpdG9yLm1heFpvb20pOw0KICAgIHNldFpvb21MZXZlbChuZXdab29tKTsNCn0NCg0KZnVuY3Rpb24gem9vbU91dCgpIHsNCiAgICBjb25zdCBuZXdab29tID0gTWF0aC5tYXgoZmxvd0VkaXRvci56b29tTGV2ZWwgLSBmbG93RWRpdG9yLnpvb21TdGVwLCBmbG93RWRpdG9yLm1pblpvb20pOw0KICAgIHNldFpvb21MZXZlbChuZXdab29tKTsNCn0NCg0KZnVuY3Rpb24gc2V0Wm9vbUxldmVsKHpvb21MZXZlbCkgew0KICAgIC8vIEdldCB0aGUgY2VudGVyIG9mIHRoZSBjYW52YXMgY29udGFpbmVyIGZvciB6b29tIG9yaWdpbg0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPw0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChjb250YWluZXIpIDoNCiAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIA0KICAgIGNvbnN0IGNlbnRlclggPSBjb250YWluZXJSZWN0LndpZHRoIC8gMjsNCiAgICBjb25zdCBjZW50ZXJZID0gY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyOw0KICAgIA0KICAgIC8vIENhbGN1bGF0ZSB0aGUgcG9pbnQgaW4gY2FudmFzIGNvb3JkaW5hdGVzIHRoYXQgc2hvdWxkIHJlbWFpbiBmaXhlZA0KICAgIGNvbnN0IGNhbnZhc1ggPSAoY2VudGVyWCAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LngpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgY29uc3QgY2FudmFzWSA9IChjZW50ZXJZIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICANCiAgICAvLyBVcGRhdGUgem9vbSBsZXZlbA0KICAgIGZsb3dFZGl0b3Iuem9vbUxldmVsID0gTWF0aC5tYXgoZmxvd0VkaXRvci5taW5ab29tLCBNYXRoLm1pbihmbG93RWRpdG9yLm1heFpvb20sIHpvb21MZXZlbCkpOw0KICAgIA0KICAgIC8vIEFkanVzdCBwYW4gb2Zmc2V0IHRvIGtlZXAgdGhlIGNlbnRlciBwb2ludCBmaXhlZA0KICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSBjZW50ZXJYIC0gY2FudmFzWCAqIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkgPSBjZW50ZXJZIC0gY2FudmFzWSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIA0KICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgIA0KICAgIC8vIFJlZHJhdyBjb25uZWN0aW9ucyBhZnRlciB6b29tDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgfSwgMTYpOw0KfQ0KDQpmdW5jdGlvbiB6b29tVG9GaXQoKSB7DQogICAgaWYgKGZsb3dFZGl0b3Iubm9kZXMuc2l6ZSA9PT0gMCkgew0KICAgICAgICAvLyBJZiBubyBub2RlcywgcmVzZXQgdG8gMTAwJSB6b29tIGFuZCBjZW50ZXINCiAgICAgICAgZmxvd0VkaXRvci56b29tTGV2ZWwgPSAxLjA7DQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0ID0geyB4OiAtNTAwMCwgeTogLTUwMDAgfTsNCiAgICAgICAgdXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gRmluZCBib3VuZHMgb2YgYWxsIG5vZGVzDQogICAgY29uc3Qgbm9kZXMgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3Iubm9kZXMudmFsdWVzKCkpOw0KICAgIGNvbnN0IHBhZGRpbmcgPSAxMDA7IC8vIEV4dHJhIHBhZGRpbmcgYXJvdW5kIG5vZGVzDQogICAgDQogICAgbGV0IG1pblggPSBJbmZpbml0eSwgbWF4WCA9IC1JbmZpbml0eTsNCiAgICBsZXQgbWluWSA9IEluZmluaXR5LCBtYXhZID0gLUluZmluaXR5Ow0KICAgIA0KICAgIG5vZGVzLmZvckVhY2gobm9kZSA9PiB7DQogICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZS5pZCk7DQogICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgY29uc3QgcmVjdCA9IG5vZGVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICAgICAgbWluWCA9IE1hdGgubWluKG1pblgsIG5vZGUueCk7DQogICAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgbm9kZS54ICsgcmVjdC53aWR0aCk7DQogICAgICAgICAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgbm9kZS55KTsNCiAgICAgICAgICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCBub2RlLnkgKyByZWN0LmhlaWdodCk7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICAvLyBBZGQgcGFkZGluZw0KICAgIG1pblggLT0gcGFkZGluZzsNCiAgICBtYXhYICs9IHBhZGRpbmc7DQogICAgbWluWSAtPSBwYWRkaW5nOw0KICAgIG1heFkgKz0gcGFkZGluZzsNCiAgICANCiAgICBjb25zdCBjb250ZW50V2lkdGggPSBtYXhYIC0gbWluWDsNCiAgICBjb25zdCBjb250ZW50SGVpZ2h0ID0gbWF4WSAtIG1pblk7DQogICAgDQogICAgLy8gR2V0IGNvbnRhaW5lciBkaW1lbnNpb25zDQogICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICBjb25zdCBjb250YWluZXJSZWN0ID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/DQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOg0KICAgICAgICBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgDQogICAgLy8gQ2FsY3VsYXRlIHpvb20gdG8gZml0DQogICAgY29uc3Qgem9vbVggPSBjb250YWluZXJSZWN0LndpZHRoIC8gY29udGVudFdpZHRoOw0KICAgIGNvbnN0IHpvb21ZID0gY29udGFpbmVyUmVjdC5oZWlnaHQgLyBjb250ZW50SGVpZ2h0Ow0KICAgIGNvbnN0IG5ld1pvb20gPSBNYXRoLm1pbih6b29tWCwgem9vbVksIGZsb3dFZGl0b3IubWF4Wm9vbSk7DQogICAgDQogICAgLy8gU2V0IHpvb20gbGV2ZWwNCiAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IE1hdGgubWF4KGZsb3dFZGl0b3IubWluWm9vbSwgbmV3Wm9vbSk7DQogICAgDQogICAgLy8gQ2VudGVyIHRoZSBjb250ZW50DQogICAgY29uc3QgY2VudGVyWCA9IChtaW5YICsgbWF4WCkgLyAyOw0KICAgIGNvbnN0IGNlbnRlclkgPSAobWluWSArIG1heFkpIC8gMjsNCiAgICANCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gY29udGFpbmVyUmVjdC53aWR0aCAvIDIgLSBjZW50ZXJYICogZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IGNvbnRhaW5lclJlY3QuaGVpZ2h0IC8gMiAtIGNlbnRlclkgKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICANCiAgICAvLyBBZGQgc21vb3RoIHRyYW5zaXRpb24NCiAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAwLjNzIGVhc2Utb3V0JzsNCiAgICB1cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICANCiAgICAvLyBSZW1vdmUgdHJhbnNpdGlvbiBhZnRlciBhbmltYXRpb24NCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNpdGlvbiA9ICcnOw0KICAgICAgICByZWRyYXdBbGxDb25uZWN0aW9ucygpOw0KICAgIH0sIDMwMCk7DQp9DQoNCi8vIEhhbmRsZSBtb3VzZSB3aGVlbCB6b29tDQpmdW5jdGlvbiBoYW5kbGVNb3VzZVdoZWVsKGUpIHsNCiAgICBpZiAoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgew0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIA0KICAgICAgICAvLyBHZXQgbW91c2UgcG9zaXRpb24gcmVsYXRpdmUgdG8gY29udGFpbmVyDQogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8NCiAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOg0KICAgICAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICANCiAgICAgICAgY29uc3QgbW91c2VDb29yZHMgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8NCiAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOg0KICAgICAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgICAgICANCiAgICAgICAgY29uc3QgbW91c2VYID0gbW91c2VDb29yZHMueCAtIGNvbnRhaW5lclJlY3QubGVmdDsNCiAgICAgICAgY29uc3QgbW91c2VZID0gbW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wOw0KICAgICAgICANCiAgICAgICAgLy8gQ2FsY3VsYXRlIHpvb20gZGVsdGENCiAgICAgICAgY29uc3Qgem9vbURlbHRhID0gZS5kZWx0YVkgPiAwID8gLWZsb3dFZGl0b3Iuem9vbVN0ZXAgOiBmbG93RWRpdG9yLnpvb21TdGVwOw0KICAgICAgICBjb25zdCBuZXdab29tID0gTWF0aC5tYXgoZmxvd0VkaXRvci5taW5ab29tLCBNYXRoLm1pbihmbG93RWRpdG9yLm1heFpvb20sIGZsb3dFZGl0b3Iuem9vbUxldmVsICsgem9vbURlbHRhKSk7DQogICAgICAgIA0KICAgICAgICBpZiAobmV3Wm9vbSAhPT0gZmxvd0VkaXRvci56b29tTGV2ZWwpIHsNCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgcG9pbnQgaW4gY2FudmFzIGNvb3JkaW5hdGVzIHRoYXQgc2hvdWxkIHJlbWFpbiBmaXhlZCAodW5kZXIgbW91c2UpDQogICAgICAgICAgICBjb25zdCBjYW52YXNYID0gKG1vdXNlWCAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LngpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICBjb25zdCBjYW52YXNZID0gKG1vdXNlWSAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFVwZGF0ZSB6b29tIGxldmVsDQogICAgICAgICAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IG5ld1pvb207DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEFkanVzdCBwYW4gb2Zmc2V0IHRvIGtlZXAgdGhlIG1vdXNlIHBvaW50IGZpeGVkDQogICAgICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gbW91c2VYIC0gY2FudmFzWCAqIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IG1vdXNlWSAtIGNhbnZhc1kgKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFJlZHJhdyBjb25uZWN0aW9ucyBhZnRlciB6b29tDQogICAgICAgICAgICBjbGVhclRpbWVvdXQoZmxvd0VkaXRvci56b29tUmVkcmF3VGltZW91dCk7DQogICAgICAgICAgICBmbG93RWRpdG9yLnpvb21SZWRyYXdUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgcmVkcmF3QWxsQ29ubmVjdGlvbnMoKTsNCiAgICAgICAgICAgIH0sIDUwKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gSGFuZGxlIGNhbnZhcyBjbGljayBldmVudHMNCmZ1bmN0aW9uIGhhbmRsZUNhbnZhc0NsaWNrKGUpIHsNCiAgICBpZiAoZS50YXJnZXQgPT09IGZsb3dFZGl0b3IuY2FudmFzKSB7DQogICAgICAgIC8vIERlc2VsZWN0IG5vZGUNCiAgICAgICAgaWYgKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlKSB7DQogICAgICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlKTsNCiAgICAgICAgICAgIGlmIChub2RlRWxlbWVudCkgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTsNCiAgICAgICAgICAgIGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID0gbnVsbDsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2RlLWNvbmZpZycpLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1tdXRlZCI+U2VsZWN0IGEgbm9kZSB0byBjb25maWd1cmUgaXQ8L3A+JzsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gSGFuZGxlIGRvY3VtZW50IG1vdXNlIGV2ZW50cyBmb3Igc21vb3RoIGRyYWdnaW5nDQpmdW5jdGlvbiBoYW5kbGVEb2N1bWVudE1vdXNlRG93bihlKSB7DQogICAgLy8gRG9uJ3Qgc3RhcnQgZHJhZ2dpbmcgaWYgY2xpY2tpbmcgb24gVUkgZWxlbWVudHMNCiAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLmZsb3ctdG9vbGJhcicpIHx8IA0KICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcuZmxvdy1jb25maWctcGFuZWwnKSB8fCANCiAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnLmZsb3ctb3V0cHV0LXBhbmVsJykgfHwNCiAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnLm5vZGUtZGVsZXRlLWJ0bicpKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gRG9uJ3Qgc3RhcnQgZHJhZ2dpbmcgaWYgd2UncmUgcGFubmluZw0KICAgIGlmIChmbG93RWRpdG9yLmlzUGFubmluZykgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIE9ubHkgYWxsb3cgZHJhZ2dpbmcgZnJvbSB0aGUgbm9kZSBoZWFkZXINCiAgICBjb25zdCBoZWFkZXJFbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnLmZsb3ctbm9kZS1oZWFkZXInKTsNCiAgICBpZiAoIWhlYWRlckVsZW1lbnQpIHJldHVybjsNCiAgICBjb25zdCBub2RlRWxlbWVudCA9IGhlYWRlckVsZW1lbnQuY2xvc2VzdCgnLmZsb3ctbm9kZScpOw0KICAgIGlmICghbm9kZUVsZW1lbnQpIHJldHVybjsNCiAgICANCiAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICBjb25zdCBub2RlSWQgPSBub2RlRWxlbWVudC5pZDsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICANCiAgICBpZiAobm9kZSkgew0KICAgICAgICBmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSA9IG5vZGVJZDsNCiAgICAgICAgDQogICAgICAgIC8vIENhbGN1bGF0ZSBvZmZzZXQgZnJvbSBtb3VzZSB0byBub2RlIGNvcm5lciwgYWNjb3VudGluZyBmb3Igem9vbQ0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QoY29udGFpbmVyKSA6IA0KICAgICAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICANCiAgICAgICAgY29uc3QgbW91c2VDb29yZHMgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDogDQogICAgICAgICAgICB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07DQogICAgICAgIA0KICAgICAgICAvLyBDb252ZXJ0IG1vdXNlIHBvc2l0aW9uIHRvIGNhbnZhcyBjb29yZGluYXRlcw0KICAgICAgICBjb25zdCBjYW52YXNNb3VzZVggPSAobW91c2VDb29yZHMueCAtIGNvbnRhaW5lclJlY3QubGVmdCAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LngpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgIGNvbnN0IGNhbnZhc01vdXNlWSA9IChtb3VzZUNvb3Jkcy55IC0gY29udGFpbmVyUmVjdC50b3AgLSBmbG93RWRpdG9yLnBhbk9mZnNldC55KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICANCiAgICAgICAgLy8gQ2FsY3VsYXRlIG9mZnNldCBpbiBjYW52YXMgY29vcmRpbmF0ZXMNCiAgICAgICAgZmxvd0VkaXRvci5kcmFnT2Zmc2V0ID0gew0KICAgICAgICAgICAgeDogKGNhbnZhc01vdXNlWCAtIG5vZGUueCkgKiBmbG93RWRpdG9yLnpvb21MZXZlbCwNCiAgICAgICAgICAgIHk6IChjYW52YXNNb3VzZVkgLSBub2RlLnkpICogZmxvd0VkaXRvci56b29tTGV2ZWwNCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIG5vZGVFbGVtZW50LnN0eWxlLmN1cnNvciA9ICdncmFiYmluZyc7DQogICAgICAgIG5vZGVFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gQnJpbmcgdG8gZnJvbnQgd2hpbGUgZHJhZ2dpbmcNCiAgICAgICAgDQogICAgICAgIC8vIENhY2hlIGNvbnRhaW5lciByZWN0IGZvciBwZXJmb3JtYW5jZQ0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhc1JlY3QgPSBjb250YWluZXJSZWN0Ow0KICAgIH0NCn0NCg0KZnVuY3Rpb24gaGFuZGxlRG9jdW1lbnRNb3VzZU1vdmUoZSkgew0KICAgIC8vIEhhbmRsZSBjYW52YXMgcGFubmluZw0KICAgIGlmIChmbG93RWRpdG9yLmlzUGFubmluZykgew0KICAgICAgICB1cGRhdGVDYW52YXNQYW4oZSk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gR2V0IHNjYWxlZCBjb29yZGluYXRlcw0KICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDogDQogICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICANCiAgICAvLyBIYW5kbGUgdGFnIGRyYWdnaW5nDQogICAgaWYgKGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcgJiYgZmxvd0VkaXRvci50YWdEcmFnT2Zmc2V0KSB7DQogICAgICAgIGNvbnN0IHRhZyA9IGZsb3dFZGl0b3IudGFncy5nZXQoZmxvd0VkaXRvci5kcmFnZ2luZ1RhZyk7DQogICAgICAgIGlmICh0YWcpIHsNCiAgICAgICAgICAgIC8vIEdldCBjb250YWluZXIgZGltZW5zaW9ucyBmb3IgY29vcmRpbmF0ZSBjb252ZXJzaW9uDQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPyANCiAgICAgICAgICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChjb250YWluZXIpIDogDQogICAgICAgICAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDb252ZXJ0IG1vdXNlIGNvb3JkaW5hdGVzIHRvIGNhbnZhcyBjb29yZGluYXRlcywgYWNjb3VudGluZyBmb3IgcGFuIGFuZCB6b29tDQogICAgICAgICAgICBjb25zdCBjYW52YXNNb3VzZVggPSAobW91c2VDb29yZHMueCAtIGNvbnRhaW5lclJlY3QubGVmdCAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LngpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICBjb25zdCBjYW52YXNNb3VzZVkgPSAobW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyBwb3NpdGlvbiB3aXRoIG9mZnNldCAoZHJhZyBvZmZzZXQgaXMgYWxzbyBpbiBzY3JlZW4gY29vcmRpbmF0ZXMsIHNvIGNvbnZlcnQgaXQpDQogICAgICAgICAgICBjb25zdCBkcmFnT2Zmc2V0WCA9IGZsb3dFZGl0b3IudGFnRHJhZ09mZnNldC54IC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICBjb25zdCBkcmFnT2Zmc2V0WSA9IGZsb3dFZGl0b3IudGFnRHJhZ09mZnNldC55IC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHRhZy54ID0gY2FudmFzTW91c2VYIC0gZHJhZ09mZnNldFg7DQogICAgICAgICAgICB0YWcueSA9IGNhbnZhc01vdXNlWSAtIGRyYWdPZmZzZXRZOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmxvd0VkaXRvci5kcmFnZ2luZ1RhZyk7DQogICAgICAgICAgICBpZiAodGFnRWxlbWVudCkgew0KICAgICAgICAgICAgICAgIC8vIFVzZSBsZWZ0L3RvcCBmb3IgcG9zaXRpb25pbmcNCiAgICAgICAgICAgICAgICB0YWdFbGVtZW50LnN0eWxlLmxlZnQgPSB0YWcueCArICdweCc7DQogICAgICAgICAgICAgICAgdGFnRWxlbWVudC5zdHlsZS50b3AgPSB0YWcueSArICdweCc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFRocm90dGxlIHVwZGF0ZXMgZm9yIGJldHRlciBwZXJmb3JtYW5jZQ0KICAgICAgICAgICAgaWYgKCFmbG93RWRpdG9yLnRhZ1VwZGF0ZVRpbWVvdXQpIHsNCiAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnRhZ1VwZGF0ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci50YWdVcGRhdGVUaW1lb3V0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9LCAxNik7IC8vIH42MGZwcw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgaWYgKGZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlICYmIGZsb3dFZGl0b3IuZHJhZ09mZnNldCkgew0KICAgICAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUpOw0KICAgICAgICBpZiAobm9kZSkgew0KICAgICAgICAgICAgLy8gR2V0IGNvbnRhaW5lciBkaW1lbnNpb25zIGZvciBjb29yZGluYXRlIGNvbnZlcnNpb24NCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOiANCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENvbnZlcnQgbW91c2UgY29vcmRpbmF0ZXMgdG8gY2FudmFzIGNvb3JkaW5hdGVzLCBhY2NvdW50aW5nIGZvciBwYW4gYW5kIHpvb20NCiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01vdXNlWCA9IChtb3VzZUNvb3Jkcy54IC0gY29udGFpbmVyUmVjdC5sZWZ0IC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueCkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01vdXNlWSA9IChtb3VzZUNvb3Jkcy55IC0gY29udGFpbmVyUmVjdC50b3AgLSBmbG93RWRpdG9yLnBhbk9mZnNldC55KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHBvc2l0aW9uIHdpdGggb2Zmc2V0IChkcmFnIG9mZnNldCBpcyBhbHNvIGluIHNjcmVlbiBjb29yZGluYXRlcywgc28gY29udmVydCBpdCkNCiAgICAgICAgICAgIGNvbnN0IGRyYWdPZmZzZXRYID0gZmxvd0VkaXRvci5kcmFnT2Zmc2V0LnggLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIGNvbnN0IGRyYWdPZmZzZXRZID0gZmxvd0VkaXRvci5kcmFnT2Zmc2V0LnkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbm9kZS54ID0gY2FudmFzTW91c2VYIC0gZHJhZ09mZnNldFg7DQogICAgICAgICAgICBub2RlLnkgPSBjYW52YXNNb3VzZVkgLSBkcmFnT2Zmc2V0WTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSk7DQogICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS5sZWZ0ID0gbm9kZS54ICsgJ3B4JzsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS50b3AgPSBub2RlLnkgKyAncHgnOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBhbGwgY29ubmVjdGlvbnMgZm9yIHRoaXMgbm9kZSAodGhyb3R0bGVkIGZvciBwZXJmb3JtYW5jZSkNCiAgICAgICAgICAgICAgICBpZiAoIWZsb3dFZGl0b3IudXBkYXRlVGltZW91dCkgew0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNvbm5lY3Rpb25zRm9yTm9kZShub2RlLmlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IudXBkYXRlVGltZW91dCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0sIDE2KTsgLy8gfjYwZnBzDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBoYW5kbGVEb2N1bWVudE1vdXNlVXAoZSkgew0KICAgIC8vIEhhbmRsZSBjYW52YXMgcGFubmluZyBzdG9wDQogICAgaWYgKGZsb3dFZGl0b3IuaXNQYW5uaW5nKSB7DQogICAgICAgIHN0b3BDYW52YXNQYW4oKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBIYW5kbGUgdGFnIGRyYWdnaW5nIHN0b3ANCiAgICBpZiAoZmxvd0VkaXRvci5kcmFnZ2luZ1RhZykgew0KICAgICAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmxvd0VkaXRvci5kcmFnZ2luZ1RhZyk7DQogICAgICAgIGlmICh0YWdFbGVtZW50KSB7DQogICAgICAgICAgICB0YWdFbGVtZW50LnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJzsNCiAgICAgICAgICAgIHRhZ0VsZW1lbnQuc3R5bGUuekluZGV4ID0gJzEwMCc7DQogICAgICAgICAgICB0YWdFbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAnYm94LXNoYWRvdyAwLjJzIGVhc2UsIHRyYW5zZm9ybSAwLjJzIGVhc2UnOyAvLyBSZXN0b3JlIHRyYW5zaXRpb25zDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcgPSBudWxsOw0KICAgICAgICBmbG93RWRpdG9yLnRhZ0RyYWdPZmZzZXQgPSBudWxsOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGlmIChmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSkgew0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlKTsNCiAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZ3JhYic7DQogICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS56SW5kZXggPSAnJzsgLy8gUmVzZXQgei1pbmRleA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBDbGVhciBhbnkgcGVuZGluZyBjb25uZWN0aW9uIHVwZGF0ZXMNCiAgICAgICAgaWYgKGZsb3dFZGl0b3IudXBkYXRlVGltZW91dCkgew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGZsb3dFZGl0b3IudXBkYXRlVGltZW91dCk7DQogICAgICAgICAgICBmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBGaW5hbCBjb25uZWN0aW9uIHVwZGF0ZQ0KICAgICAgICB1cGRhdGVDb25uZWN0aW9uc0Zvck5vZGUoZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUpOw0KICAgICAgICANCiAgICAgICAgZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUgPSBudWxsOw0KICAgICAgICBmbG93RWRpdG9yLmRyYWdPZmZzZXQgPSBudWxsOw0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhc1JlY3QgPSBudWxsOw0KICAgIH0NCn0NCg0KDQovLyBFeGFtcGxlOiBjYW52YXMtbWFuYWdlci5qcw0Kd2luZG93LmNhbnZhc01hbmFnZXIgPSB7DQogICAgdXBkYXRlQ2FudmFzVHJhbnNmb3JtLA0KICAgIHN0YXJ0Q2FudmFzUGFuLA0KICAgIHVwZGF0ZUNhbnZhc1BhbiwNCiAgICBzdG9wQ2FudmFzUGFuLA0KICAgIHJlc2V0Q2FudmFzUGFuLA0KICAgIGhhbmRsZUNhbnZhc0NsaWNrLA0KICAgIGhhbmRsZURvY3VtZW50TW91c2VEb3duLA0KICAgIGhhbmRsZURvY3VtZW50TW91c2VNb3ZlLA0KICAgIGhhbmRsZURvY3VtZW50TW91c2VVcCwNCiAgICB6b29tSW4sDQogICAgem9vbU91dCwNCiAgICBzZXRab29tTGV2ZWwsDQogICAgem9vbVRvRml0LA0KICAgIGhhbmRsZU1vdXNlV2hlZWwNCn07DQoNCg0KLy8gQWRkIGEgbmV3IHRhZyBhdCBjdXJyZW50IHZpZXdwb3J0IGNlbnRlcg0KZnVuY3Rpb24gYWRkVGFnKCkgew0KICAgIGNvbnN0IHRhZ05hbWUgPSBwcm9tcHQoJ0VudGVyIHRhZyBuYW1lOicpOw0KICAgIGlmICghdGFnTmFtZSB8fCB0YWdOYW1lLnRyaW0oKSA9PT0gJycpIHJldHVybjsNCg0KICAgIGNvbnN0IHRhZ0lkID0gYHRhZ18keysrZmxvd0VkaXRvci50YWdDb3VudGVyfWA7DQoNCiAgICAvLyBDYWxjdWxhdGUgcG9zaXRpb24gYXQgY3VycmVudCB2aWV3cG9ydCBjZW50ZXINCiAgICAvLyBHZXQgY2VudGVyIHBvc2l0aW9uIGluIGNhbnZhcyBjb29yZGluYXRlcw0KICAgIGNvbnN0IGNlbnRlciA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPyANCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRWaWV3cG9ydENlbnRlckluQ2FudmFzKCkgOg0KICAgICAgICB7IHg6IDUwMDAsIHk6IDUwMDAgfTsgLy8gRmFsbGJhY2sgdG8gY2FudmFzIGNlbnRlcg0KDQogICAgY29uc3QgdGFnID0gew0KICAgICAgICBpZDogdGFnSWQsDQogICAgICAgIG5hbWU6IHRhZ05hbWUudHJpbSgpLA0KICAgICAgICBkZXNjcmlwdGlvbjogJycsDQogICAgICAgIHg6IGNlbnRlci54LA0KICAgICAgICB5OiBjZW50ZXIueSwNCiAgICAgICAgY29sb3I6ICcjNENBRjUwJyAvLyBHcmVlbiBjb2xvcg0KICAgIH07DQoNCiAgICBmbG93RWRpdG9yLnRhZ3Muc2V0KHRhZ0lkLCB0YWcpOw0KICAgIGNyZWF0ZVRhZ0VsZW1lbnQodGFnKTsNCiAgICB1cGRhdGVUYWdQYW5lbCgpOw0KDQogICAgY29uc29sZS5sb2coJ0FkZGVkIHRhZzonLCB0YWcpOw0KfQ0KDQovLyBDcmVhdGUgdGFnIGVsZW1lbnQgb24gY2FudmFzDQpmdW5jdGlvbiBjcmVhdGVUYWdFbGVtZW50KHRhZykgew0KICAgIGNvbnN0IHRhZ0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICB0YWdFbGVtZW50LmlkID0gdGFnLmlkOw0KICAgIHRhZ0VsZW1lbnQuY2xhc3NOYW1lID0gJ2NhbnZhcy10YWcnOw0KICAgIHRhZ0VsZW1lbnQuc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgICBsZWZ0OiAke3RhZy54fXB4Ow0KICAgICAgICB0b3A6ICR7dGFnLnl9cHg7DQogICAgICAgIGJhY2tncm91bmQ6ICR7dGFnLmNvbG9yfTsNCiAgICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4Ow0KICAgICAgICBmb250LXNpemU6IDEycHg7DQogICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgIHotaW5kZXg6IDEwMDsNCiAgICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwwLDAsMC4yKTsNCiAgICAgICAgdHJhbnNpdGlvbjogYm94LXNoYWRvdyAwLjJzIGVhc2UsIHRyYW5zZm9ybSAwLjJzIGVhc2U7DQogICAgYDsNCiAgICB0YWdFbGVtZW50LnRleHRDb250ZW50ID0gdGFnLm5hbWU7DQoNCiAgICAvLyBNYWtlIHRhZyBkcmFnZ2FibGUNCiAgICB0YWdFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiB7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgc3RhcnREcmFnZ2luZ1RhZyh0YWcuaWQsIGUpOw0KICAgIH0pOw0KDQogICAgLy8gQ2xpY2sgdG8ganVtcCB0byB0YWcNCiAgICB0YWdFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgaWYgKCFmbG93RWRpdG9yLmRyYWdnaW5nVGFnKSB7DQogICAgICAgICAgICBqdW1wVG9UYWcodGFnLmlkKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLy8gSG92ZXIgZWZmZWN0cw0KICAgIHRhZ0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHsNCiAgICAgICAgdGFnRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMS4wNSknOw0KICAgICAgICB0YWdFbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9ICcwIDRweCA4cHggcmdiYSgwLDAsMCwwLjMpJzsNCiAgICB9KTsNCg0KICAgIHRhZ0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHsNCiAgICAgICAgdGFnRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMSknOw0KICAgICAgICB0YWdFbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9ICcwIDJweCA0cHggcmdiYSgwLDAsMCwwLjIpJzsNCiAgICB9KTsNCg0KICAgIGZsb3dFZGl0b3IuY2FudmFzLmFwcGVuZENoaWxkKHRhZ0VsZW1lbnQpOw0KfQ0KDQovLyBTdGFydCBkcmFnZ2luZyBhIHRhZw0KZnVuY3Rpb24gc3RhcnREcmFnZ2luZ1RhZyh0YWdJZCwgZSkgew0KICAgIGNvbnN0IHRhZyA9IGZsb3dFZGl0b3IudGFncy5nZXQodGFnSWQpOw0KICAgIGlmICghdGFnKSByZXR1cm47DQoNCiAgICBmbG93RWRpdG9yLmRyYWdnaW5nVGFnID0gdGFnSWQ7DQoNCiAgICAvLyBDYWxjdWxhdGUgb2Zmc2V0IGZyb20gbW91c2UgdG8gdGFnIGNvcm5lciwgYWNjb3VudGluZyBmb3Igem9vbQ0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgPyANCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QoY29udGFpbmVyKSA6IA0KICAgICAgICBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgDQogICAgY29uc3QgbW91c2VDb29yZHMgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOiANCiAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgIA0KICAgIC8vIENvbnZlcnQgbW91c2UgcG9zaXRpb24gdG8gY2FudmFzIGNvb3JkaW5hdGVzDQogICAgY29uc3QgY2FudmFzTW91c2VYID0gKG1vdXNlQ29vcmRzLnggLSBjb250YWluZXJSZWN0LmxlZnQgLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIGNvbnN0IGNhbnZhc01vdXNlWSA9IChtb3VzZUNvb3Jkcy55IC0gY29udGFpbmVyUmVjdC50b3AgLSBmbG93RWRpdG9yLnBhbk9mZnNldC55KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIA0KICAgIC8vIENhbGN1bGF0ZSBvZmZzZXQgaW4gY2FudmFzIGNvb3JkaW5hdGVzDQogICAgZmxvd0VkaXRvci50YWdEcmFnT2Zmc2V0ID0gew0KICAgICAgICB4OiAoY2FudmFzTW91c2VYIC0gdGFnLngpICogZmxvd0VkaXRvci56b29tTGV2ZWwsDQogICAgICAgIHk6IChjYW52YXNNb3VzZVkgLSB0YWcueSkgKiBmbG93RWRpdG9yLnpvb21MZXZlbA0KICAgIH07DQoNCiAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFnSWQpOw0KICAgIHRhZ0VsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ2dyYWJiaW5nJzsNCiAgICB0YWdFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxMDAxJzsNCiAgICB0YWdFbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAnbm9uZSc7IC8vIERpc2FibGUgdHJhbnNpdGlvbnMgZHVyaW5nIGRyYWcNCn0NCg0KLy8gSnVtcCB0byB0YWcgbG9jYXRpb24NCmZ1bmN0aW9uIGp1bXBUb1RhZyh0YWdJZCkgew0KICAgIGNvbnN0IHRhZyA9IGZsb3dFZGl0b3IudGFncy5nZXQodGFnSWQpOw0KICAgIGlmICghdGFnKSByZXR1cm47DQoNCiAgICAvLyBBZGQgc21vb3RoIHRyYW5zaXRpb24NCiAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAwLjVzIGVhc2Utb3V0JzsNCg0KICAgIC8vIFVzZSB1dGlsaXR5IGZ1bmN0aW9uIHRvIGNlbnRlciB2aWV3cG9ydCBvbiB0YWcgY29vcmRpbmF0ZXMNCiAgICBpZiAod2luZG93LmZsb3dFZGl0b3JVdGlscyAmJiB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmNlbnRlclZpZXdwb3J0T25DYW52YXMpIHsNCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JVdGlscy5jZW50ZXJWaWV3cG9ydE9uQ2FudmFzKHRhZy54LCB0YWcueSk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gRmFsbGJhY2sgbWV0aG9kDQogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgIA0KICAgICAgICBjb25zdCB2aWV3cG9ydENlbnRlclggPSBjb250YWluZXJSZWN0LndpZHRoIC8gMjsNCiAgICAgICAgY29uc3Qgdmlld3BvcnRDZW50ZXJZID0gY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyOw0KICAgICAgICANCiAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueCA9IHZpZXdwb3J0Q2VudGVyWCAtICh0YWcueCAqIGZsb3dFZGl0b3Iuem9vbUxldmVsKTsNCiAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IHZpZXdwb3J0Q2VudGVyWSAtICh0YWcueSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsKTsNCiAgICAgICAgDQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgIH0NCg0KICAgIC8vIFJlbW92ZSB0cmFuc2l0aW9uIGFmdGVyIGFuaW1hdGlvbiBjb21wbGV0ZXMNCiAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNpdGlvbiA9ICcnOw0KICAgIH0sIDUwMCk7DQp9DQoNCi8vIFVwZGF0ZSB0YWcgcGFuZWwNCmZ1bmN0aW9uIHVwZGF0ZVRhZ1BhbmVsKCkgew0KICAgIGNvbnN0IHRhZ1BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhZy1wYW5lbCcpOw0KICAgIGlmICghdGFnUGFuZWwpIHJldHVybjsNCg0KICAgIGlmIChmbG93RWRpdG9yLnRhZ3Muc2l6ZSA9PT0gMCkgew0KICAgICAgICB0YWdQYW5lbC5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPk5vIHRhZ3MgeWV0PC9wPic7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgdGFnSHRtbCA9ICcnOw0KICAgIGZsb3dFZGl0b3IudGFncy5mb3JFYWNoKHRhZyA9PiB7DQogICAgICAgIHRhZ0h0bWwgKz0gYA0KICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFnLWl0ZW0iIGRhdGEtdGFnLWlkPSIke3RhZy5pZH0iPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhZy1jb2xvciIgc3R5bGU9ImJhY2tncm91bmQ6ICR7dGFnLmNvbG9yfSI+PC9kaXY+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFnLWluZm8iPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWctbmFtZSI+JHt0YWcubmFtZX08L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgJHt0YWcuZGVzY3JpcHRpb24gPyBgPGRpdiBjbGFzcz0idGFnLWRlc2NyaXB0aW9uIj4ke3RhZy5kZXNjcmlwdGlvbn08L2Rpdj5gIDogJyd9DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFnLWRlbGV0ZSIgZGF0YS10YWctaWQ9IiR7dGFnLmlkfSI+DQogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4NCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICBgOw0KICAgIH0pOw0KDQogICAgdGFnUGFuZWwuaW5uZXJIVE1MID0gdGFnSHRtbDsNCg0KICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMNCiAgICB0YWdQYW5lbC5xdWVyeVNlbGVjdG9yQWxsKCcudGFnLWl0ZW0nKS5mb3JFYWNoKGl0ZW0gPT4gew0KICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgIGlmICghZS50YXJnZXQuY2xvc2VzdCgnLnRhZy1kZWxldGUnKSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHRhZ0lkID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFnLWlkJyk7DQogICAgICAgICAgICAgICAganVtcFRvVGFnKHRhZ0lkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSk7DQoNCiAgICB0YWdQYW5lbC5xdWVyeVNlbGVjdG9yQWxsKCcudGFnLWRlbGV0ZScpLmZvckVhY2goYnRuID0+IHsNCiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICBjb25zdCB0YWdJZCA9IGJ0bi5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFnLWlkJyk7DQogICAgICAgICAgICBkZWxldGVUYWcodGFnSWQpOw0KICAgICAgICB9KTsNCiAgICB9KTsNCn0NCg0KLy8gRGVsZXRlIGEgdGFnDQpmdW5jdGlvbiBkZWxldGVUYWcodGFnSWQpIHsNCiAgICBpZiAoY29uZmlybSgnRGVsZXRlIHRoaXMgdGFnPycpKSB7DQogICAgICAgIGNvbnN0IHRhZ0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWdJZCk7DQogICAgICAgIGlmICh0YWdFbGVtZW50KSB7DQogICAgICAgICAgICB0YWdFbGVtZW50LnJlbW92ZSgpOw0KICAgICAgICB9DQogICAgICAgIGZsb3dFZGl0b3IudGFncy5kZWxldGUodGFnSWQpOw0KICAgICAgICB1cGRhdGVUYWdQYW5lbCgpOw0KICAgIH0NCn0NCg0KLy8gRXhhbXBsZTogdGFnLW1hbmFnZXIuanMNCndpbmRvdy50YWdNYW5hZ2VyID0gew0KICAgIGFkZFRhZywNCiAgICBjcmVhdGVUYWdFbGVtZW50LA0KICAgIHN0YXJ0RHJhZ2dpbmdUYWcsDQogICAganVtcFRvVGFnLA0KICAgIHVwZGF0ZVRhZ1BhbmVsLA0KICAgIGRlbGV0ZVRhZw0KfTsNCg0KLy8gU2F2ZSBmbG93IHRvIHZpcnR1YWwgZmlsZSBzeXN0ZW0NCmFzeW5jIGZ1bmN0aW9uIHNhdmVGbG93KCkgew0KICAgIGNvbnN0IGZsb3dEYXRhID0gew0KICAgICAgICBub2RlczogQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKS5tYXAobm9kZSA9PiAoew0KICAgICAgICAgICAgaWQ6IG5vZGUuaWQsDQogICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsDQogICAgICAgICAgICB4OiBub2RlLngsDQogICAgICAgICAgICB5OiBub2RlLnksDQogICAgICAgICAgICBjb25maWc6IG5vZGUuY29uZmlnDQogICAgICAgIH0pKSwNCiAgICAgICAgY29ubmVjdGlvbnM6IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkubWFwKGNvbm4gPT4gKHsNCiAgICAgICAgICAgIGlkOiBjb25uLmlkLA0KICAgICAgICAgICAgZnJvbTogY29ubi5mcm9tLA0KICAgICAgICAgICAgdG86IGNvbm4udG8NCiAgICAgICAgfSkpLA0KICAgICAgICB0YWdzOiBBcnJheS5mcm9tKGZsb3dFZGl0b3IudGFncy52YWx1ZXMoKSksDQogICAgICAgIG1ldGFkYXRhOiB7DQogICAgICAgICAgICBzYXZlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksDQogICAgICAgICAgICBub2RlQ291bnQ6IGZsb3dFZGl0b3Iubm9kZXMuc2l6ZSwNCiAgICAgICAgICAgIGNvbm5lY3Rpb25Db3VudDogZmxvd0VkaXRvci5jb25uZWN0aW9ucy5zaXplLA0KICAgICAgICAgICAgdGFnQ291bnQ6IGZsb3dFZGl0b3IudGFncy5zaXplDQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdHJ5IHsNCiAgICAgICAgbGV0IGZpbGVQYXRoID0gZmxvd0VkaXRvci5jdXJyZW50RmlsZVBhdGg7DQogICAgICAgIA0KICAgICAgICAvLyBJZiBubyBjdXJyZW50IGZpbGUgcGF0aCwgc2hvdyBmaWxlIGV4cGxvcmVyDQogICAgICAgIGlmICghZmlsZVBhdGgpIHsNCiAgICAgICAgICAgIGZpbGVQYXRoID0gYXdhaXQgc3lwbmV4QVBJLnNob3dGaWxlRXhwbG9yZXIoew0KICAgICAgICAgICAgICAgIG1vZGU6ICdzYXZlJywNCiAgICAgICAgICAgICAgICB0aXRsZTogJ1NhdmUgRmxvdyBGaWxlJywNCiAgICAgICAgICAgICAgICBpbml0aWFsUGF0aDogJy8nLA0KICAgICAgICAgICAgICAgIGZpbGVOYW1lOiAnZmxvd193b3JrZmxvdy5qc29uJywNCiAgICAgICAgICAgICAgICBmaWxlRXh0ZW5zaW9uOiAnLmpzb24nLA0KICAgICAgICAgICAgICAgIG9uU2VsZWN0OiAoc2VsZWN0ZWRQYXRoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHNlbGVjdGVkIGZvciBzYXZpbmc6Jywgc2VsZWN0ZWRQYXRoKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHNlbGVjdGlvbiBjYW5jZWxsZWQnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgaWYgKCFmaWxlUGF0aCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsgLy8gVXNlciBjYW5jZWxsZWQNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFNhdmUgdG8gdmlydHVhbCBmaWxlIHN5c3RlbQ0KICAgICAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlSlNPTikgew0KICAgICAgICAgICAgYXdhaXQgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGVKU09OKGZpbGVQYXRoLCBmbG93RGF0YSk7DQogICAgICAgICAgICBmbG93RWRpdG9yLmN1cnJlbnRGaWxlUGF0aCA9IGZpbGVQYXRoOw0KICAgICAgICAgICAgdXBkYXRlRmlsZW5hbWVEaXNwbGF5KCk7DQogICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbihgRmxvdyBzYXZlZCB0bzogJHtmaWxlUGF0aH1gLCAnc3VjY2VzcycpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gbG9jYWxTdG9yYWdlDQogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZmxvd19lZGl0b3Jfc2F2ZWRfZmxvdycsIEpTT04uc3RyaW5naWZ5KGZsb3dEYXRhKSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnRmxvdyBzYXZlZCB0byBsb2NhbFN0b3JhZ2U6JywgZmxvd0RhdGEpOw0KICAgICAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKCdGbG93IHNhdmVkIHRvIGxvY2FsIHN0b3JhZ2UhJywgJ3N1Y2Nlc3MnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjb25zb2xlLmxvZygnRmxvdyBzYXZlZDonLCBmbG93RGF0YSk7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgZmxvdzonLCBlcnJvcik7DQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKCdGYWlsZWQgdG8gc2F2ZSBmbG93OiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFNhdmUgZmxvdyBhcyAoYWx3YXlzIHNob3cgZmlsZSBleHBsb3JlcikNCmFzeW5jIGZ1bmN0aW9uIHNhdmVGbG93QXMoKSB7DQogICAgY29uc3QgZmxvd0RhdGEgPSB7DQogICAgICAgIG5vZGVzOiBBcnJheS5mcm9tKGZsb3dFZGl0b3Iubm9kZXMudmFsdWVzKCkpLm1hcChub2RlID0+ICh7DQogICAgICAgICAgICBpZDogbm9kZS5pZCwNCiAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSwNCiAgICAgICAgICAgIHg6IG5vZGUueCwNCiAgICAgICAgICAgIHk6IG5vZGUueSwNCiAgICAgICAgICAgIGNvbmZpZzogbm9kZS5jb25maWcNCiAgICAgICAgfSkpLA0KICAgICAgICBjb25uZWN0aW9uczogQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5tYXAoY29ubiA9PiAoew0KICAgICAgICAgICAgaWQ6IGNvbm4uaWQsDQogICAgICAgICAgICBmcm9tOiBjb25uLmZyb20sDQogICAgICAgICAgICB0bzogY29ubi50bw0KICAgICAgICB9KSksDQogICAgICAgIHRhZ3M6IEFycmF5LmZyb20oZmxvd0VkaXRvci50YWdzLnZhbHVlcygpKSwNCiAgICAgICAgbWV0YWRhdGE6IHsNCiAgICAgICAgICAgIHNhdmVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwNCiAgICAgICAgICAgIG5vZGVDb3VudDogZmxvd0VkaXRvci5ub2Rlcy5zaXplLA0KICAgICAgICAgICAgY29ubmVjdGlvbkNvdW50OiBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnNpemUsDQogICAgICAgICAgICB0YWdDb3VudDogZmxvd0VkaXRvci50YWdzLnNpemUNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB0cnkgew0KICAgICAgICAvLyBTaG93IGZpbGUgZXhwbG9yZXIgZm9yIHNhdmluZw0KICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGF3YWl0IHN5cG5leEFQSS5zaG93RmlsZUV4cGxvcmVyKHsNCiAgICAgICAgICAgIG1vZGU6ICdzYXZlJywNCiAgICAgICAgICAgIHRpdGxlOiAnU2F2ZSBGbG93IEZpbGUgQXMnLA0KICAgICAgICAgICAgaW5pdGlhbFBhdGg6ICcvJywNCiAgICAgICAgICAgIGZpbGVOYW1lOiAnZmxvd193b3JrZmxvdy5qc29uJywNCiAgICAgICAgICAgIGZpbGVFeHRlbnNpb246ICcuanNvbicsDQogICAgICAgICAgICBvblNlbGVjdDogKHNlbGVjdGVkUGF0aCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHNlbGVjdGVkIGZvciBzYXZpbmcgYXM6Jywgc2VsZWN0ZWRQYXRoKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHNlbGVjdGlvbiBjYW5jZWxsZWQnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgaWYgKCFmaWxlUGF0aCkgew0KICAgICAgICAgICAgcmV0dXJuOyAvLyBVc2VyIGNhbmNlbGxlZA0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU2F2ZSB0byB2aXJ0dWFsIGZpbGUgc3lzdGVtDQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGVKU09OKSB7DQogICAgICAgICAgICBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZUpTT04oZmlsZVBhdGgsIGZsb3dEYXRhKTsNCiAgICAgICAgICAgIGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoID0gZmlsZVBhdGg7DQogICAgICAgICAgICB1cGRhdGVGaWxlbmFtZURpc3BsYXkoKTsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKGBGbG93IHNhdmVkIGFzOiAke2ZpbGVQYXRofWAsICdzdWNjZXNzJyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBGYWxsYmFjayB0byBsb2NhbFN0b3JhZ2UNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdmbG93X2VkaXRvcl9zYXZlZF9mbG93JywgSlNPTi5zdHJpbmdpZnkoZmxvd0RhdGEpKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGbG93IHNhdmVkIHRvIGxvY2FsU3RvcmFnZTonLCBmbG93RGF0YSk7DQogICAgICAgICAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKSB7DQogICAgICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oJ0Zsb3cgc2F2ZWQgdG8gbG9jYWwgc3RvcmFnZSEnLCAnc3VjY2VzcycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNvbnNvbGUubG9nKCdGbG93IHNhdmVkIGFzOicsIGZsb3dEYXRhKTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBmbG93IGFzOicsIGVycm9yKTsNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oJ0ZhaWxlZCB0byBzYXZlIGZsb3cgYXM6ICcgKyBlcnJvci5tZXNzYWdlLCAnZXJyb3InKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gTG9hZCBmbG93IGZyb20gdmlydHVhbCBmaWxlIHN5c3RlbQ0KYXN5bmMgZnVuY3Rpb24gbG9hZEZsb3coKSB7DQogICAgdHJ5IHsNCiAgICAgICAgLy8gU2hvdyBmaWxlIGV4cGxvcmVyIGZvciBsb2FkaW5nDQogICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYXdhaXQgc3lwbmV4QVBJLnNob3dGaWxlRXhwbG9yZXIoew0KICAgICAgICAgICAgbW9kZTogJ29wZW4nLA0KICAgICAgICAgICAgdGl0bGU6ICdMb2FkIEZsb3cgRmlsZScsDQogICAgICAgICAgICBpbml0aWFsUGF0aDogJy8nLA0KICAgICAgICAgICAgb25TZWxlY3Q6IChzZWxlY3RlZFBhdGgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBzZWxlY3RlZCBmb3IgbG9hZGluZzonLCBzZWxlY3RlZFBhdGgpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG9uQ2FuY2VsOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZpbGUgc2VsZWN0aW9uIGNhbmNlbGxlZCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBpZiAoIWZpbGVQYXRoKSB7DQogICAgICAgICAgICByZXR1cm47IC8vIFVzZXIgY2FuY2VsbGVkDQogICAgICAgIH0NCg0KICAgICAgICBsZXQgZmxvd0RhdGEgPSBudWxsOw0KICAgICAgICANCiAgICAgICAgLy8gVHJ5IHZpcnR1YWwgZmlsZSBzeXN0ZW0gZmlyc3QNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlSlNPTikgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YSA9IGF3YWl0IHN5cG5leEFQSS5yZWFkVmlydHVhbEZpbGVKU09OKGZpbGVQYXRoKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKHZmc0Vycm9yKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZhaWxlZCB0byBsb2FkIGZyb20gdmlydHVhbCBmaWxlIHN5c3RlbSwgdHJ5aW5nIGxvY2FsU3RvcmFnZS4uLicpOw0KICAgICAgICAgICAgICAgIHRocm93IHZmc0Vycm9yOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBGYWxsYmFjayB0byBsb2NhbFN0b3JhZ2UgKGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5KQ0KICAgICAgICBpZiAoIWZsb3dEYXRhKSB7DQogICAgICAgICAgICBjb25zdCBsb2NhbERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZmxvd19lZGl0b3Jfc2F2ZWRfZmxvdycpOw0KICAgICAgICAgICAgaWYgKGxvY2FsRGF0YSkgew0KICAgICAgICAgICAgICAgIGZsb3dEYXRhID0gSlNPTi5wYXJzZShsb2NhbERhdGEpOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGbG93IGxvYWRlZCBmcm9tIGxvY2FsU3RvcmFnZScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAoZmxvd0RhdGEpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGbG93IGxvYWRlZDonLCBmbG93RGF0YSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENsZWFyIGN1cnJlbnQgY2FudmFzDQogICAgICAgICAgICBjbGVhckNhbnZhcygpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBSZXNldCBwYW4gb2Zmc2V0IHRvIGNlbnRlciBvZiBsYXJnZSBjYW52YXMgZm9yIG5ldyB3b3JrZmxvdw0KICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQgPSB7IHg6IC01MDAwLCB5OiAtNTAwMCB9Ow0KICAgICAgICAgICAgd2luZG93LmNhbnZhc01hbmFnZXIudXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFJlc2V0IG5vZGUgY291bnRlciB0byBhdm9pZCBJRCBjb25mbGljdHMNCiAgICAgICAgICAgIGZsb3dFZGl0b3Iubm9kZUNvdW50ZXIgPSAwOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBMb2FkIG5vZGVzDQogICAgICAgICAgICBpZiAoZmxvd0RhdGEubm9kZXMpIHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YS5ub2Rlcy5mb3JFYWNoKG5vZGVEYXRhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG5vZGUgd2l0aCBwcm9wZXIgSUQNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gbm9kZURhdGEuaWQ7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZDogbm9kZUlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbm9kZURhdGEudHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IG5vZGVEYXRhLngsDQogICAgICAgICAgICAgICAgICAgICAgICB5OiBub2RlRGF0YS55LA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBub2RlRGF0YS5jb25maWcsDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7fQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIG5vZGUgY291bnRlcg0KICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlTnVtID0gcGFyc2VJbnQobm9kZUlkLnJlcGxhY2UoJ25vZGVfJywgJycpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVOdW0gPiBmbG93RWRpdG9yLm5vZGVDb3VudGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLm5vZGVDb3VudGVyID0gbm9kZU51bTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci5ub2Rlcy5zZXQobm9kZUlkLCBub2RlKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBub2RlIGVsZW1lbnQgdXNpbmcgdGhlIHJlbmRlcmVyIGFuZCBhZGQgdG8gY2FudmFzDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gbm9kZVJlbmRlcmVyLmNyZWF0ZU5vZGVFbGVtZW50KG5vZGUpOw0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5hcHBlbmRDaGlsZChub2RlRWxlbWVudCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIExvYWQgY29ubmVjdGlvbnMgYWZ0ZXIgbm9kZXMgYXJlIGZ1bGx5IGNyZWF0ZWQgYW5kIHBvc2l0aW9uZWQNCiAgICAgICAgICAgIGlmIChmbG93RGF0YS5jb25uZWN0aW9ucykgew0KICAgICAgICAgICAgICAgIGZsb3dEYXRhLmNvbm5lY3Rpb25zLmZvckVhY2goY29ubkRhdGEgPT4gew0KICAgICAgICAgICAgICAgICAgICBjcmVhdGVDb25uZWN0aW9uKGNvbm5EYXRhLmZyb20ubm9kZUlkLCBjb25uRGF0YS5mcm9tLnBvcnROYW1lLCBjb25uRGF0YS50by5ub2RlSWQsIGNvbm5EYXRhLnRvLnBvcnROYW1lKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBJbW1lZGlhdGVseSByZWRyYXcgY29ubmVjdGlvbnMgbm93IHRoYXQgYWxsIFNWRyBlbGVtZW50cyBleGlzdA0KICAgICAgICAgICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIExvYWQgdGFncw0KICAgICAgICAgICAgaWYgKGZsb3dEYXRhLnRhZ3MpIHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YS50YWdzLmZvckVhY2godGFnRGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhZyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0YWdEYXRhLmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGFnRGF0YS5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRhZ0RhdGEuZGVzY3JpcHRpb24gfHwgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4OiB0YWdEYXRhLngsDQogICAgICAgICAgICAgICAgICAgICAgICB5OiB0YWdEYXRhLnksDQogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGFnRGF0YS5jb2xvciB8fCAnIzRDQUY1MCcNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWcgY291bnRlcg0KICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdOdW0gPSBwYXJzZUludCh0YWdEYXRhLmlkLnJlcGxhY2UoJ3RhZ18nLCAnJykpOw0KICAgICAgICAgICAgICAgICAgICBpZiAodGFnTnVtID4gZmxvd0VkaXRvci50YWdDb3VudGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnRhZ0NvdW50ZXIgPSB0YWdOdW07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IudGFncy5zZXQodGFnRGF0YS5pZCwgdGFnKTsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LnRhZ01hbmFnZXIuY3JlYXRlVGFnRWxlbWVudCh0YWcpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgY2VudGVyIG9mIGxvYWRlZCBub2RlcyBhbmQgYWRqdXN0IHBhbiB0byBjZW50ZXIgdGhlbQ0KICAgICAgICAgICAgaWYgKGZsb3dEYXRhLm5vZGVzICYmIGZsb3dEYXRhLm5vZGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBjb25zdCBtaW5YID0gTWF0aC5taW4oLi4uZmxvd0RhdGEubm9kZXMubWFwKG4gPT4gbi54KSk7DQogICAgICAgICAgICAgICAgY29uc3QgbWF4WCA9IE1hdGgubWF4KC4uLmZsb3dEYXRhLm5vZGVzLm1hcChuID0+IG4ueCkpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1pblkgPSBNYXRoLm1pbiguLi5mbG93RGF0YS5ub2Rlcy5tYXAobiA9PiBuLnkpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBtYXhZID0gTWF0aC5tYXgoLi4uZmxvd0RhdGEubm9kZXMubWFwKG4gPT4gbi55KSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgY29uc3QgY2VudGVyWCA9IChtaW5YICsgbWF4WCkgLyAyOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNlbnRlclkgPSAobWluWSArIG1heFkpIC8gMjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHZXQgY2FudmFzIGNvbnRhaW5lciBkaW1lbnNpb25zDQogICAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBwYW4gb2Zmc2V0IHRvIGNlbnRlciB0aGUgbm9kZXMgaW4gdGhlIHZpZXdwb3J0DQogICAgICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueCA9IC1jZW50ZXJYICsgY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IC1jZW50ZXJZICsgY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBGaW5hbCBjb25uZWN0aW9uIHJlZHJhdyBhZnRlciBhbGwgcG9zaXRpb25pbmcgaXMgY29tcGxldGUNCiAgICAgICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWcgcGFuZWwNCiAgICAgICAgICAgIHdpbmRvdy50YWdNYW5hZ2VyLnVwZGF0ZVRhZ1BhbmVsKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFVwZGF0ZSBjdXJyZW50IGZpbGUgcGF0aA0KICAgICAgICAgICAgZmxvd0VkaXRvci5jdXJyZW50RmlsZVBhdGggPSBmaWxlUGF0aDsNCiAgICAgICAgICAgIHVwZGF0ZUZpbGVuYW1lRGlzcGxheSgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKSB7DQogICAgICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oYEZsb3cgbG9hZGVkIGZyb206ICR7ZmlsZVBhdGh9YCwgJ3N1Y2Nlc3MnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbignTm8gdmFsaWQgZmxvdyBkYXRhIGZvdW5kIGluIHRoZSBzZWxlY3RlZCBmaWxlLicsICd3YXJuaW5nJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBmbG93OicsIGVycm9yKTsNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oJ0ZhaWxlZCB0byBsb2FkIGZsb3c6ICcgKyBlcnJvci5tZXNzYWdlLCAnZXJyb3InKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gVXBkYXRlIGZpbGVuYW1lIGRpc3BsYXkNCmZ1bmN0aW9uIHVwZGF0ZUZpbGVuYW1lRGlzcGxheSgpIHsNCiAgICBjb25zdCBmaWxlbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VycmVudC1maWxlbmFtZScpOw0KICAgIGlmIChmaWxlbmFtZUVsZW1lbnQpIHsNCiAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBmbG93RWRpdG9yLmN1cnJlbnRGaWxlUGF0aCA/IGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoLnNwbGl0KCcvJykucG9wKCkgOiAndW50aXRsZWQuZmxvdyc7DQogICAgICAgIGZpbGVuYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGZpbGVuYW1lOw0KICAgIH0NCn0NCg0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cuZmlsZU1hbmFnZXIgPSB7DQogICAgc2F2ZUZsb3csDQogICAgc2F2ZUZsb3dBcywNCiAgICBsb2FkRmxvdywNCiAgICB1cGRhdGVGaWxlbmFtZURpc3BsYXkNCn07DQoNCg0KLy8gUG9wdWxhdGUgdG9vbGJveCB3aXRoIGxvYWRlZCBub2Rlcw0KZnVuY3Rpb24gcG9wdWxhdGVUb29sYm94KCkgew0KICAgIGNvbnNvbGUubG9nKCdwb3B1bGF0ZVRvb2xib3ggY2FsbGVkJyk7DQogICAgY29uc3QgdG9vbGJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mbG93LXRvb2xib3gnKTsNCiAgICBjb25zb2xlLmxvZygnVG9vbGJveCBlbGVtZW50OicsIHRvb2xib3gpOw0KICAgIGlmICghdG9vbGJveCkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdUb29sYm94IG5vdCBmb3VuZCcpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIENsZWFyIGV4aXN0aW5nIHRvb2xib3ggY29udGVudA0KICAgIGNvbnN0IHRvb2xib3hDb250ZW50ID0gdG9vbGJveC5xdWVyeVNlbGVjdG9yKCcudG9vbGJveC1jb250ZW50Jyk7DQogICAgaWYgKHRvb2xib3hDb250ZW50KSB7DQogICAgICAgIHRvb2xib3hDb250ZW50LmlubmVySFRNTCA9ICcnOw0KICAgIH0NCiAgICANCiAgICAvLyBHcm91cCBub2RlcyBieSBjYXRlZ29yeQ0KICAgIGNvbnN0IGNhdGVnb3JpZXMgPSB7fTsNCiAgICBjb25zdCBhbGxOb2RlcyA9IG5vZGVSZWdpc3RyeS5nZXRBbGxOb2RlVHlwZXMoKTsNCiAgICANCiAgICBjb25zb2xlLmxvZygnQWxsIGxvYWRlZCBub2RlczonLCBhbGxOb2Rlcyk7DQogICAgDQogICAgYWxsTm9kZXMuZm9yRWFjaChub2RlRGVmID0+IHsNCiAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSBub2RlRGVmLmNhdGVnb3J5IHx8ICdvdGhlcic7DQogICAgICAgIGlmICghY2F0ZWdvcmllc1tjYXRlZ29yeV0pIHsNCiAgICAgICAgICAgIGNhdGVnb3JpZXNbY2F0ZWdvcnldID0gW107DQogICAgICAgIH0NCiAgICAgICAgY2F0ZWdvcmllc1tjYXRlZ29yeV0ucHVzaChub2RlRGVmKTsNCiAgICB9KTsNCiAgICANCiAgICBjb25zb2xlLmxvZygnTm9kZSBjYXRlZ29yaWVzOicsIGNhdGVnb3JpZXMpOw0KICAgIA0KICAgIC8vIENyZWF0ZSB0b29sYm94IHNlY3Rpb25zIGZvciBlYWNoIGNhdGVnb3J5DQogICAgT2JqZWN0LmVudHJpZXMoY2F0ZWdvcmllcykuZm9yRWFjaCgoW2NhdGVnb3J5LCBub2Rlc10pID0+IHsNCiAgICAgICAgY29uc3QgY2F0ZWdvcnlTZWN0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgIGNhdGVnb3J5U2VjdGlvbi5jbGFzc05hbWUgPSAnbm9kZS1jYXRlZ29yeSc7DQogICAgICAgIGNhdGVnb3J5U2VjdGlvbi5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICA8aDU+JHtjYXRlZ29yeS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGNhdGVnb3J5LnNsaWNlKDEpfTwvaDU+DQogICAgICAgICAgICAke25vZGVzLm1hcChub2RlRGVmID0+IGANCiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ0b29sYm94LW5vZGUtYnRuIiBkYXRhLW5vZGUtdHlwZT0iJHtub2RlRGVmLmlkfSIgdGl0bGU9IiR7bm9kZURlZi5kZXNjcmlwdGlvbn0iPg0KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iJHtub2RlRGVmLmljb259Ij48L2k+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuPiR7bm9kZURlZi5uYW1lfTwvc3Bhbj4NCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgIGApLmpvaW4oJycpfQ0KICAgICAgICBgOw0KICAgICAgICANCiAgICAgICAgaWYgKHRvb2xib3hDb250ZW50KSB7DQogICAgICAgICAgICB0b29sYm94Q29udGVudC5hcHBlbmRDaGlsZChjYXRlZ29yeVNlY3Rpb24pOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgLy8gUmUtYXR0YWNoIGV2ZW50IGxpc3RlbmVycw0KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b29sYm94LW5vZGUtYnRuJykuZm9yRWFjaChidG4gPT4gew0KICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgY29uc3Qgbm9kZVR5cGUgPSBidG4uZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtdHlwZScpOw0KICAgICAgICAgICAgaWYgKG5vZGVUeXBlKSB7DQogICAgICAgICAgICAgICAgYWRkTm9kZShub2RlVHlwZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0pOw0KICAgIA0KICAgIGNvbnNvbGUubG9nKCdUb29sYm94IHBvcHVsYXRlZCB3aXRoJywgYWxsTm9kZXMubGVuZ3RoLCAnbm9kZXMnKTsNCn0NCg0KLy8gU2V0IHVwIGV2ZW50IGhhbmRsZXJzDQpmdW5jdGlvbiBzZXR1cEV2ZW50SGFuZGxlcnMoKSB7DQogICAgLy8gTm90ZTogVG9vbGJveCBub2RlIGJ1dHRvbiBldmVudCBsaXN0ZW5lcnMgYXJlIHNldCB1cCBpbiBwb3B1bGF0ZVRvb2xib3goKQ0KICAgIC8vIHRvIGF2b2lkIGR1cGxpY2F0ZXMgd2hlbiB0aGUgdG9vbGJveCBpcyByZXBvcHVsYXRlZA0KICAgIA0KICAgIC8vIFdvcmtmbG93IGFjdGlvbnMNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuLXdvcmtmbG93Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcnVuV29ya2Zsb3cpOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wLXdvcmtmbG93Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3RvcFdvcmtmbG93KTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsZXRlLXNlbGVjdGVkJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZGVsZXRlU2VsZWN0ZWROb2RlKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItY2FudmFzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYXJDYW52YXMpOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtdGFnJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LnRhZ01hbmFnZXIuYWRkVGFnKTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzZXQtcGFuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmNhbnZhc01hbmFnZXIucmVzZXRDYW52YXNQYW4pOw0KICAgIA0KICAgIC8vIFpvb20gY29udHJvbHMNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbS1pbicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21Jbik7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb20tb3V0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmNhbnZhc01hbmFnZXIuem9vbU91dCk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb20tZml0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmNhbnZhc01hbmFnZXIuem9vbVRvRml0KTsNCiAgICANCiAgICAvLyBGaWxlIG9wZXJhdGlvbnMNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1mbG93Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmZpbGVNYW5hZ2VyLnNhdmVGbG93KTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1mbG93LWFzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmZpbGVNYW5hZ2VyLnNhdmVGbG93QXMpOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkLWZsb3cnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB3aW5kb3cuZmlsZU1hbmFnZXIubG9hZEZsb3cpOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhci1vdXRwdXQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhck91dHB1dCk7DQogICAgDQogICAgLy8gQ29uZmlnIHBhbmVsIHRvZ2dsZQ0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtY29uZmlnJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlQ29uZmlnUGFuZWwpOw0KICAgIA0KICAgIC8vIEluaXRpYWxpemUgY29uZmlnIHBhbmVsIHN0YXRlICh3aXRob3V0IG92ZXJyaWRpbmcgaWNvbnMpDQogICAgY29uc3QgY29uZmlnUGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvdy1jb25maWctcGFuZWwnKTsNCiAgICBpZiAoY29uZmlnUGFuZWwpIHsNCiAgICAgICAgLy8gRGVmYXVsdCBleHBhbmRlZCAobm90IGNvbGxhcHNlZCkNCiAgICAgICAgY29uZmlnUGFuZWwuY2xhc3NMaXN0LnJlbW92ZSgnY29sbGFwc2VkJyk7DQogICAgfQ0KICAgIA0KICAgIC8vIFRvb2xib3ggdG9nZ2xlDQogICAgY29uc3QgdG9vbGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmbG93LXRvb2xib3gnKTsNCiAgICBjb25zdCB0b29sYm94Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b29sYm94LWNvbnRlbnQnKTsNCiAgICBjb25zdCB0b2dnbGVUb29sYm94QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS10b29sYm94Jyk7DQogICAgaWYgKHRvb2xib3ggJiYgdG9vbGJveENvbnRlbnQgJiYgdG9nZ2xlVG9vbGJveEJ0bikgew0KICAgICAgICAvLyBEZWZhdWx0IGV4cGFuZGVkIChub3QgY29sbGFwc2VkKQ0KICAgICAgICB0b29sYm94LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbGxhcHNlZCcpOw0KICAgICAgICB0b29sYm94Q29udGVudC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoNCiAgICAgICAgdG9nZ2xlVG9vbGJveEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgdG9nZ2xlVG9vbGJveCgpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgDQogICAgLy8gT3V0cHV0IHBhbmVsIHRvZ2dsZQ0KICAgIGNvbnN0IG91dHB1dFBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zsb3ctb3V0cHV0LXBhbmVsJyk7DQogICAgY29uc3Qgb3V0cHV0Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQtY29udGVudCcpOw0KICAgIGNvbnN0IHRvZ2dsZU91dHB1dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtb3V0cHV0Jyk7DQogICAgaWYgKG91dHB1dFBhbmVsICYmIG91dHB1dENvbnRlbnQgJiYgdG9nZ2xlT3V0cHV0QnRuKSB7DQogICAgICAgIC8vIERlZmF1bHQgY29sbGFwc2VkDQogICAgICAgIG91dHB1dFBhbmVsLmNsYXNzTGlzdC5hZGQoJ2NvbGxhcHNlZCcpOw0KICAgICAgICBvdXRwdXRDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIHRvZ2dsZU91dHB1dEJ0bi5xdWVyeVNlbGVjdG9yKCdpJykuY2xhc3NOYW1lID0gJ2ZhcyBmYS1jaGV2cm9uLWRvd24nOw0KDQogICAgICAgIHRvZ2dsZU91dHB1dEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgY29uc3QgaXNDb2xsYXBzZWQgPSBvdXRwdXRQYW5lbC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbGxhcHNlZCcpOw0KICAgICAgICAgICAgaWYgKGlzQ29sbGFwc2VkKSB7DQogICAgICAgICAgICAgICAgb3V0cHV0UGFuZWwuY2xhc3NMaXN0LnJlbW92ZSgnY29sbGFwc2VkJyk7DQogICAgICAgICAgICAgICAgb3V0cHV0Q29udGVudC5zdHlsZS5kaXNwbGF5ID0gJyc7DQogICAgICAgICAgICAgICAgdG9nZ2xlT3V0cHV0QnRuLnF1ZXJ5U2VsZWN0b3IoJ2knKS5jbGFzc05hbWUgPSAnZmFzIGZhLWNoZXZyb24tdXAnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBvdXRwdXRQYW5lbC5jbGFzc0xpc3QuYWRkKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgICAgICAgICBvdXRwdXRDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgdG9nZ2xlT3V0cHV0QnRuLnF1ZXJ5U2VsZWN0b3IoJ2knKS5jbGFzc05hbWUgPSAnZmFzIGZhLWNoZXZyb24tZG93bic7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICANCiAgICAvLyBDYW52YXMgZXZlbnRzDQogICAgZmxvd0VkaXRvci5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB3aW5kb3cuY2FudmFzTWFuYWdlci5oYW5kbGVDYW52YXNDbGljayk7DQogICAgZmxvd0VkaXRvci5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgd2luZG93LmNhbnZhc01hbmFnZXIuc3RhcnRDYW52YXNQYW4pOw0KICAgIGZsb3dFZGl0b3IuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgd2luZG93LmNhbnZhc01hbmFnZXIuaGFuZGxlTW91c2VXaGVlbCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsNCiAgICANCiAgICAvLyBEb2N1bWVudC1sZXZlbCBtb3VzZSBldmVudHMgZm9yIHNtb290aCBkcmFnZ2luZyBhbmQgcGFubmluZw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLmhhbmRsZURvY3VtZW50TW91c2VEb3duKTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB3aW5kb3cuY2FudmFzTWFuYWdlci5oYW5kbGVEb2N1bWVudE1vdXNlTW92ZSk7DQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLmhhbmRsZURvY3VtZW50TW91c2VVcCk7DQogICAgDQogICAgLy8gS2V5Ym9hcmQgc2hvcnRjdXRzDQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleURvd24pOw0KfQ0KDQovLyBUb2dnbGUgY29uZmlnIHBhbmVsDQpmdW5jdGlvbiB0b2dnbGVDb25maWdQYW5lbCgpIHsNCiAgICBjb25zdCBjb25maWdQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmbG93LWNvbmZpZy1wYW5lbCcpOw0KICAgIGNvbnN0IHRvZ2dsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtY29uZmlnJyk7DQogICAgY29uc3QgaWNvbiA9IHRvZ2dsZUJ0bi5xdWVyeVNlbGVjdG9yKCdpJyk7DQogICAgDQogICAgaWYgKGNvbmZpZ1BhbmVsLmNsYXNzTGlzdC5jb250YWlucygnY29sbGFwc2VkJykpIHsNCiAgICAgICAgLy8gRXhwYW5kDQogICAgICAgIGNvbmZpZ1BhbmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbGxhcHNlZCcpOw0KICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1yaWdodCc7DQogICAgICAgIHRvZ2dsZUJ0bi50aXRsZSA9ICdDb2xsYXBzZSBDb25maWd1cmF0aW9uIFBhbmVsJzsNCiAgICB9IGVsc2Ugew0KICAgICAgICAvLyBDb2xsYXBzZQ0KICAgICAgICBjb25maWdQYW5lbC5jbGFzc0xpc3QuYWRkKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgaWNvbi5jbGFzc05hbWUgPSAnZmFzIGZhLWNoZXZyb24tbGVmdCc7DQogICAgICAgIHRvZ2dsZUJ0bi50aXRsZSA9ICdFeHBhbmQgQ29uZmlndXJhdGlvbiBQYW5lbCc7DQogICAgfQ0KfQ0KDQovLyBUb2dnbGUgdG9vbGJveA0KZnVuY3Rpb24gdG9nZ2xlVG9vbGJveCgpIHsNCiAgICBjb25zdCB0b29sYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zsb3ctdG9vbGJveCcpOw0KICAgIGNvbnN0IHRvb2xib3hDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rvb2xib3gtY29udGVudCcpOw0KICAgIGNvbnN0IHRvZ2dsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtdG9vbGJveCcpOw0KICAgIGNvbnN0IGljb24gPSB0b2dnbGVCdG4ucXVlcnlTZWxlY3RvcignaScpOw0KICAgIA0KICAgIGlmICh0b29sYm94LmNsYXNzTGlzdC5jb250YWlucygnY29sbGFwc2VkJykpIHsNCiAgICAgICAgLy8gRXhwYW5kDQogICAgICAgIHRvb2xib3guY2xhc3NMaXN0LnJlbW92ZSgnY29sbGFwc2VkJyk7DQogICAgICAgIHRvb2xib3hDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnJzsNCiAgICAgICAgaWNvbi5jbGFzc05hbWUgPSAnZmFzIGZhLWNoZXZyb24tbGVmdCc7DQogICAgICAgIHRvZ2dsZUJ0bi50aXRsZSA9ICdDb2xsYXBzZSBUb29sYm94JzsNCiAgICB9IGVsc2Ugew0KICAgICAgICAvLyBDb2xsYXBzZQ0KICAgICAgICB0b29sYm94LmNsYXNzTGlzdC5hZGQoJ2NvbGxhcHNlZCcpOw0KICAgICAgICB0b29sYm94Q29udGVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1yaWdodCc7DQogICAgICAgIHRvZ2dsZUJ0bi50aXRsZSA9ICdFeHBhbmQgVG9vbGJveCc7DQogICAgfQ0KfQ0KDQovLyBFeGFtcGxlOiB1aS1tYW5hZ2VyLmpzDQp3aW5kb3cudWlNYW5hZ2VyID0gew0KICAgIHBvcHVsYXRlVG9vbGJveCwNCiAgICBzZXR1cEV2ZW50SGFuZGxlcnMsDQogICAgdG9nZ2xlQ29uZmlnUGFuZWwsDQogICAgdG9nZ2xlVG9vbGJveA0KfTsNCg0KLy8gbWFpbi5qcyAtIEVudHJ5IHBvaW50IGZvciBGbG93IEVkaXRvcg0KY29uc29sZS5sb2coJ0Zsb3cgRWRpdG9yIGFwcCBsb2FkaW5nLi4uJyk7DQoNCi8vIEdsb2JhbCB2YXJpYWJsZXMgKHNjb3BlZCB0byBhdm9pZCBnbG9iYWwgcG9sbHV0aW9uKQ0KbGV0IGZsb3dFZGl0b3IgPSB7DQogICAgbm9kZXM6IG5ldyBNYXAoKSwNCiAgICBjb25uZWN0aW9uczogbmV3IE1hcCgpLA0KICAgIHNlbGVjdGVkTm9kZTogbnVsbCwNCiAgICBkcmFnZ2luZ05vZGU6IG51bGwsDQogICAgY29ubmVjdGluZ0Zyb206IG51bGwsDQogICAgY2FudmFzOiBudWxsLA0KICAgIG5vZGVDb3VudGVyOiAwLA0KICAgIGlzUnVubmluZzogZmFsc2UsDQogICAgY3VycmVudEZpbGVQYXRoOiBudWxsLA0KICAgIGlzQWN0aXZlOiB0cnVlLA0KICAgIC8vIENhbnZhcyBwYW5uaW5nIHN0YXRlDQogICAgaXNQYW5uaW5nOiBmYWxzZSwNCiAgICBwYW5TdGFydDogeyB4OiAwLCB5OiAwIH0sDQogICAgcGFuT2Zmc2V0OiB7IHg6IC01MDAwLCB5OiAtNTAwMCB9LCAvLyBDZW50ZXIgdGhlIGxhcmdlIGNhbnZhcyBpbml0aWFsbHkNCiAgICBsYXN0UGFuT2Zmc2V0OiB7IHg6IC01MDAwLCB5OiAtNTAwMCB9LA0KICAgIC8vIFpvb20gc3RhdGUNCiAgICB6b29tTGV2ZWw6IDEuMCwNCiAgICBtaW5ab29tOiAwLjEsDQogICAgbWF4Wm9vbTogMy4wLA0KICAgIHpvb21TdGVwOiAwLjEsDQogICAgLy8gVGFnIHN5c3RlbQ0KICAgIHRhZ3M6IG5ldyBNYXAoKSwNCiAgICB0YWdDb3VudGVyOiAwLA0KICAgIGRyYWdnaW5nVGFnOiBudWxsLA0KICAgIHRhZ0RyYWdPZmZzZXQ6IG51bGwsDQogICAgdGFnVXBkYXRlVGltZW91dDogbnVsbA0KfTsNCg0KLy8gSW5pdGlhbGl6ZSB3aGVuIERPTSBpcyByZWFkeQ0KYXN5bmMgZnVuY3Rpb24gaW5pdEZsb3dFZGl0b3IoKSB7DQogICAgY29uc29sZS5sb2coJ0Zsb3cgRWRpdG9yIGluaXRpYWxpemluZy4uLicpOw0KICAgIA0KICAgIC8vIENoZWNrIGlmIFN5cG5leEFQSSBpcyBhdmFpbGFibGUgKGxvY2FsIHZhcmlhYmxlIGluIHNhbmRib3hlZCBlbnZpcm9ubWVudCkNCiAgICBpZiAodHlwZW9mIHN5cG5leEFQSSA9PT0gJ3VuZGVmaW5lZCcgfHwgIXN5cG5leEFQSSkgew0KICAgICAgICBjb25zb2xlLndhcm4oJ1N5cG5leEFQSSBub3QgYXZhaWxhYmxlIC0gcnVubmluZyBpbiBzdGFuZGFsb25lIG1vZGUnKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCdTeXBuZXhBUEkgYXZhaWxhYmxlOicsIHN5cG5leEFQSSk7DQogICAgY29uc29sZS5sb2coJ0FwcCBJRDonLCBzeXBuZXhBUEkuZ2V0QXBwSWQoKSk7DQogICAgY29uc29sZS5sb2coJ0luaXRpYWxpemVkOicsIHN5cG5leEFQSS5pc0luaXRpYWxpemVkKCkpOw0KICAgIA0KICAgIC8vIEluaXRpYWxpemUgc2NhbGUgZGV0ZWN0aW9uIGZvciBhcHAgc2NhbGluZyBjb21wZW5zYXRpb24NCiAgICBpZiAod2luZG93LmZsb3dFZGl0b3JVdGlscykgew0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmluaXRTY2FsZURldGVjdGlvbigpOw0KICAgICAgICBjb25zb2xlLmxvZygnU2NhbGUgZGV0ZWN0aW9uIGluaXRpYWxpemVkJyk7DQogICAgfQ0KICAgIA0KICAgIC8vIFRlc3QgVkZTIEFQSQ0KICAgIHRyeSB7DQogICAgICAgIGNvbnNvbGUubG9nKCdUZXN0aW5nIFZGUyBBUEkuLi4nKTsNCiAgICAgICAgY29uc3QgdGVzdFJlc3VsdCA9IGF3YWl0IHN5cG5leEFQSS5saXN0VmlydHVhbEZpbGVzKCcvJyk7DQogICAgICAgIGNvbnNvbGUubG9nKCdWRlMgdGVzdCByZXN1bHQ6JywgdGVzdFJlc3VsdCk7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignVkZTIEFQSSB0ZXN0IGZhaWxlZDonLCBlcnJvcik7DQogICAgfQ0KICAgIA0KICAgIC8vIEluaXRpYWxpemUgY2FudmFzDQogICAgZmxvd0VkaXRvci5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvdy1jYW52YXMnKTsNCiAgICBpZiAoIWZsb3dFZGl0b3IuY2FudmFzKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Zsb3cgY2FudmFzIG5vdCBmb3VuZCcpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIENyZWF0ZSBTVkcgbWFya2VyIGRlZmluaXRpb25zIGZvciBjb25uZWN0aW9uIGFycm93cw0KICAgIGNvbnN0IGRlZnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2RlZnMnKTsNCiAgICBjb25zdCBtYXJrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ21hcmtlcicpOw0KICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2Fycm93aGVhZCcpOw0KICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoJ21hcmtlcldpZHRoJywgJzEwJyk7DQogICAgbWFya2VyLnNldEF0dHJpYnV0ZSgnbWFya2VySGVpZ2h0JywgJzcnKTsNCiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKCdyZWZYJywgJzknKTsNCiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKCdyZWZZJywgJzMuNScpOw0KICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoJ29yaWVudCcsICdhdXRvJyk7DQogICAgbWFya2VyLnNldEF0dHJpYnV0ZSgnbWFya2VyVW5pdHMnLCAnc3Ryb2tlV2lkdGgnKTsNCiAgICANCiAgICBjb25zdCBwb2x5Z29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdwb2x5Z29uJyk7DQogICAgcG9seWdvbi5zZXRBdHRyaWJ1dGUoJ3BvaW50cycsICcwIDAsIDEwIDMuNSwgMCA3Jyk7DQogICAgcG9seWdvbi5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnIzRDQUY1MCcpOw0KICAgIA0KICAgIG1hcmtlci5hcHBlbmRDaGlsZChwb2x5Z29uKTsNCiAgICBkZWZzLmFwcGVuZENoaWxkKG1hcmtlcik7DQogICAgDQogICAgLy8gQ3JlYXRlIGEgdGVtcG9yYXJ5IFNWRyBjb250YWluZXIgZm9yIHRoZSBtYXJrZXIgZGVmaW5pdGlvbg0KICAgIGNvbnN0IG1hcmtlclN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnc3ZnJyk7DQogICAgbWFya2VyU3ZnLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsNCiAgICBtYXJrZXJTdmcuc3R5bGUud2lkdGggPSAnMCc7DQogICAgbWFya2VyU3ZnLnN0eWxlLmhlaWdodCA9ICcwJzsNCiAgICBtYXJrZXJTdmcuYXBwZW5kQ2hpbGQoZGVmcyk7DQogICAgZmxvd0VkaXRvci5jYW52YXMuYXBwZW5kQ2hpbGQobWFya2VyU3ZnKTsNCiAgICANCiAgICAvLyBJbml0aWFsaXplIGNhbnZhcyB0cmFuc2Zvcm0gZm9yIHBhbm5pbmcNCiAgICB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICANCiAgICAvLyBMb2FkIG5vZGVzIGZyb20gVkZTDQogICAgY29uc29sZS5sb2coJ0Fib3V0IHRvIGxvYWQgbm9kZXMgZnJvbSBWRlMuLi4nKTsNCiAgICBhd2FpdCBub2RlUmVnaXN0cnkubG9hZE5vZGVzRnJvbVZGUygpOw0KICAgIGNvbnNvbGUubG9nKCdGaW5pc2hlZCBsb2FkaW5nIG5vZGVzIGZyb20gVkZTJyk7DQogICAgDQogICAgLy8gUG9wdWxhdGUgdG9vbGJveCB3aXRoIGxvYWRlZCBub2Rlcw0KICAgIGNvbnNvbGUubG9nKCdBYm91dCB0byBwb3B1bGF0ZSB0b29sYm94Li4uJyk7DQogICAgd2luZG93LnVpTWFuYWdlci5wb3B1bGF0ZVRvb2xib3goKTsNCiAgICBjb25zb2xlLmxvZygnRmluaXNoZWQgcG9wdWxhdGluZyB0b29sYm94Jyk7DQogICAgDQogICAgLy8gU2V0IHVwIGV2ZW50IGhhbmRsZXJzDQogICAgd2luZG93LnVpTWFuYWdlci5zZXR1cEV2ZW50SGFuZGxlcnMoKTsNCiAgICANCiAgICAvLyBDb25uZWN0IHRvIFdlYlNvY2tldCBmb3IgcmVhbC10aW1lIHVwZGF0ZXMNCiAgICBjb25uZWN0V2ViU29ja2V0KCk7DQogICAgDQogICAgLy8gSGFuZGxlIHdpbmRvdyByZXNpemUgdG8gdXBkYXRlIGNvbm5lY3Rpb25zDQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHsNCiAgICAgICAgc2V0VGltZW91dChyZWRyYXdBbGxDb25uZWN0aW9ucywgMTAwKTsNCiAgICB9KTsNCiAgICANCiAgICAvLyBIYW5kbGUgYXBwIGNsZWFudXAgd2hlbiB3aW5kb3cgaXMgdW5sb2FkZWQNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgY2xlYW51cEZsb3dFZGl0b3IpOw0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwYWdlaGlkZScsIGNsZWFudXBGbG93RWRpdG9yKTsNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndW5sb2FkJywgY2xlYW51cEZsb3dFZGl0b3IpOw0KICAgIA0KICAgIC8vIEZsb3cgRWRpdG9yIGxvYWRlZCBzdWNjZXNzZnVsbHkgKG5vIG5vdGlmaWNhdGlvbiBuZWVkZWQpDQogICAgDQogICAgLy8gVXBkYXRlIGZpbGVuYW1lIGRpc3BsYXkNCiAgICB3aW5kb3cuZmlsZU1hbmFnZXIudXBkYXRlRmlsZW5hbWVEaXNwbGF5KCk7DQogICAgDQogICAgY29uc29sZS5sb2coJ0Zsb3cgRWRpdG9yIGluaXRpYWxpemF0aW9uIGNvbXBsZXRlJyk7DQp9DQoNCi8vIENsZWFudXAgZnVuY3Rpb24gdG8gcmVtb3ZlIHRvb2x0aXBzIGFuZCBldmVudCBsaXN0ZW5lcnMNCmZ1bmN0aW9uIGNsZWFudXBGbG93RWRpdG9yKCkgew0KICAgIC8vIE1hcmsgYXBwIGFzIGluYWN0aXZlIHRvIHByZXZlbnQgbmV3IHRvb2x0aXBzDQogICAgZmxvd0VkaXRvci5pc0FjdGl2ZSA9IGZhbHNlOw0KICAgIA0KICAgIC8vIFJlbW92ZSBhbnkgbGluZ2VyaW5nIHRvb2x0aXBzIChjaGVjayBtdWx0aXBsZSBwb3NzaWJsZSBsb2NhdGlvbnMpDQogICAgY29uc3QgdG9vbHRpcHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29ubmVjdGlvbi10b29sdGlwLCAjY29ubmVjdGlvbi10b29sdGlwJyk7DQogICAgdG9vbHRpcHMuZm9yRWFjaCh0b29sdGlwID0+IHsNCiAgICAgICAgaWYgKHRvb2x0aXAucGFyZW50Tm9kZSkgew0KICAgICAgICAgICAgdG9vbHRpcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRvb2x0aXApOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgLy8gUmVtb3ZlIGdsb2JhbCBldmVudCBsaXN0ZW5lcnMNCiAgICBpZiAod2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcikgew0KICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB3aW5kb3cuZmxvd0VkaXRvclRvb2x0aXBIYW5kbGVyKTsNCiAgICAgICAgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlciA9IG51bGw7DQogICAgfQ0KICAgIA0KICAgIC8vIENsZWFyIGFueSBvdGhlciBnbG9iYWwgcmVmZXJlbmNlcw0KICAgIGlmICh3aW5kb3cuZmxvd0VkaXRvclRvb2x0aXBIYW5kbGVyKSB7DQogICAgICAgIGRlbGV0ZSB3aW5kb3cuZmxvd0VkaXRvclRvb2x0aXBIYW5kbGVyOw0KICAgIH0NCiAgICANCiAgICAvLyBBbHNvIHJlbW92ZSBhbnkgdG9vbHRpcHMgdGhhdCBtaWdodCBiZSBpbiB0aGUgYm9keQ0KICAgIGNvbnN0IGJvZHlUb29sdGlwcyA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvckFsbCgnLmNvbm5lY3Rpb24tdG9vbHRpcCcpOw0KICAgIGJvZHlUb29sdGlwcy5mb3JFYWNoKHRvb2x0aXAgPT4gew0KICAgICAgICBpZiAodG9vbHRpcC5wYXJlbnROb2RlKSB7DQogICAgICAgICAgICB0b29sdGlwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodG9vbHRpcCk7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICBjb25zb2xlLmxvZygnRmxvdyBFZGl0b3IgY2xlYW51cCBjb21wbGV0ZWQnKTsNCn0NCg0KLy8gQ29ubmVjdCB0byBXZWJTb2NrZXQgc2VydmVyDQphc3luYyBmdW5jdGlvbiBjb25uZWN0V2ViU29ja2V0KCkgew0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGNvbm5lY3RlZCA9IGF3YWl0IHN5cG5leEFQSS5jb25uZWN0U29ja2V0KCk7DQogICAgICAgIGlmIChjb25uZWN0ZWQpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0ZWQgdG8gV2ViU29ja2V0IHNlcnZlcicpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBKb2luIGZsb3cgZWRpdG9yIHJvb20NCiAgICAgICAgICAgIHN5cG5leEFQSS5qb2luUm9vbSgnZmxvdy1lZGl0b3InKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBtZXNzYWdlcw0KICAgICAgICAgICAgc3lwbmV4QVBJLm9uKCdmbG93X3VwZGF0ZScsIChkYXRhKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlY2VpdmVkIGZsb3cgdXBkYXRlOicsIGRhdGEpOw0KICAgICAgICAgICAgICAgIGhhbmRsZUZsb3dVcGRhdGUoZGF0YSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gU2VuZCBpbml0aWFsIGNvbm5lY3Rpb24gbWVzc2FnZQ0KICAgICAgICAgICAgc3lwbmV4QVBJLnNlbmRNZXNzYWdlKCdmbG93X2Nvbm5lY3RlZCcsIHsNCiAgICAgICAgICAgICAgICBhcHBJZDogc3lwbmV4QVBJLmdldEFwcElkKCksDQogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpDQogICAgICAgICAgICB9LCAnZmxvdy1lZGl0b3InKTsNCiAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNvbm5lY3QgdG8gV2ViU29ja2V0IHNlcnZlcicpOw0KICAgICAgICB9DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGNvbm5lY3Rpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgIH0NCn0NCg0KLy8gQWRkIGEgbmV3IG5vZGUgdG8gdGhlIGNhbnZhcyAoZHluYW1pYyB2ZXJzaW9uKQ0KZnVuY3Rpb24gYWRkTm9kZSh0eXBlKSB7DQogICAgY29uc3Qgbm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZSh0eXBlKTsNCiAgICBpZiAoIW5vZGVEZWYpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignVW5rbm93biBub2RlIHR5cGU6JywgdHlwZSk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgY29uc3Qgbm9kZUlkID0gYG5vZGVfJHsrK2Zsb3dFZGl0b3Iubm9kZUNvdW50ZXJ9YDsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgcG9zaXRpb24gcmVsYXRpdmUgdG8gY3VycmVudCB2aWV3cG9ydCBjZW50ZXINCiAgICBjb25zdCBjZW50ZXIgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0Vmlld3BvcnRDZW50ZXJJbkNhbnZhcygpIDoNCiAgICAgICAgeyB4OiA1MDAwLCB5OiA1MDAwIH07IC8vIEZhbGxiYWNrIHRvIGNhbnZhcyBjZW50ZXINCiAgICANCiAgICAvLyBBZGQgc29tZSByYW5kb20gb2Zmc2V0IGFyb3VuZCB0aGUgY2VudGVyDQogICAgY29uc3Qgb2Zmc2V0WCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIwMDsgLy8gLTEwMCB0byArMTAwDQogICAgY29uc3Qgb2Zmc2V0WSA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIwMDsgLy8gLTEwMCB0byArMTAwDQogICAgDQogICAgY29uc3Qgbm9kZSA9IHsNCiAgICAgICAgaWQ6IG5vZGVJZCwNCiAgICAgICAgdHlwZTogdHlwZSwNCiAgICAgICAgeDogY2VudGVyLnggKyBvZmZzZXRYLA0KICAgICAgICB5OiBjZW50ZXIueSArIG9mZnNldFksDQogICAgICAgIGNvbmZpZzogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShub2RlRGVmLmNvbmZpZykpLCAvLyBEZWVwIGNvcHkNCiAgICAgICAgZGF0YToge30NCiAgICB9Ow0KICAgIA0KICAgIC8vIEluaXRpYWxpemUgc3BlY2lhbCBub2RlIHN0YXRlcw0KICAgIGlmICh0eXBlID09PSAncmVwZWF0ZXInKSB7DQogICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZSA9IHsNCiAgICAgICAgICAgIGNvdW50OiAwLA0KICAgICAgICAgICAgaW50ZXJ2YWw6IG51bGwsDQogICAgICAgICAgICBpc1J1bm5pbmc6IGZhbHNlDQogICAgICAgIH07DQogICAgfQ0KICAgIA0KICAgIGZsb3dFZGl0b3Iubm9kZXMuc2V0KG5vZGVJZCwgbm9kZSk7DQogICAgDQogICAgLy8gQ3JlYXRlIG5vZGUgZWxlbWVudCB1c2luZyB0aGUgcmVuZGVyZXINCiAgICBjb25zdCBub2RlRWxlbWVudCA9IG5vZGVSZW5kZXJlci5jcmVhdGVOb2RlRWxlbWVudChub2RlKTsNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5hcHBlbmRDaGlsZChub2RlRWxlbWVudCk7DQogICAgDQogICAgLy8gU2VuZCB1cGRhdGUgdmlhIFdlYlNvY2tldA0KICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNlbmRNZXNzYWdlKSB7DQogICAgICAgIHN5cG5leEFQSS5zZW5kTWVzc2FnZSgnbm9kZV9hZGRlZCcsIHsNCiAgICAgICAgICAgIG5vZGVJZDogbm9kZUlkLA0KICAgICAgICAgICAgdHlwZTogdHlwZSwNCiAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IG5vZGUueCwgeTogbm9kZS55IH0NCiAgICAgICAgfSwgJ2Zsb3ctZWRpdG9yJyk7DQogICAgfQ0KICAgIA0KICAgIGNvbnNvbGUubG9nKCdBZGRlZCBub2RlOicsIG5vZGVJZCwgdHlwZSk7DQp9DQoNCi8vIEhhbmRsZSBmbG93IHVwZGF0ZXMgZnJvbSBXZWJTb2NrZXQNCmZ1bmN0aW9uIGhhbmRsZUZsb3dVcGRhdGUoZGF0YSkgew0KICAgIGNvbnNvbGUubG9nKCdIYW5kbGluZyBmbG93IHVwZGF0ZTonLCBkYXRhKTsNCiAgICAvLyBIYW5kbGUgcmVhbC10aW1lIHVwZGF0ZXMgZnJvbSBvdGhlciBpbnN0YW5jZXMNCn0NCg0KLy8gSW5pdGlhbGl6ZSB3aGVuIERPTSBpcyByZWFkeQ0KaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdsb2FkaW5nJykgew0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0Rmxvd0VkaXRvcik7DQp9IGVsc2Ugew0KICAgIC8vIERPTSBpcyBhbHJlYWR5IGxvYWRlZA0KICAgIGluaXRGbG93RWRpdG9yKCk7DQp9DQoNCg0KY29uc29sZS5sb2coJ0Zsb3cgRWRpdG9yIHNjcmlwdCBsb2FkZWQnKTsgPC9zY3JpcHQ+"
  },
  "package_info": {
    "format_version": "1.0",
    "created_at": "2025-07-22T02:31:24.725928",
    "packaged_by": "Sypnex OS App Packager",
    "source_directory": ".\\flow_editor"
  },
  "additional_files": [
    {
      "vfs_path": "/nodes/nodes-pack.json",
      "filename": "nodes-pack.json",
      "data": "ew0KICAidmVyc2lvbiI6ICIxLjAuMCIsDQogICJwYWNrZWRfYXQiOiAiMjAyNS0wNy0yMlQwMToyMzo0NS4yNTM2NzAiLA0KICAidG90YWxfbm9kZXMiOiAxMywNCiAgIm5vZGVzIjogew0KICAgICJhdWRpbyI6IHsNCiAgICAgICJpZCI6ICJhdWRpbyIsDQogICAgICAibmFtZSI6ICJBdWRpbyBQbGF5ZXIiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXkgYXVkaW8gZmlsZXMgYW5kIGNvbnRyb2wgcGxheWJhY2siLA0KICAgICAgImljb24iOiAiZmFzIGZhLXZvbHVtZS11cCIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAibWVkaWEiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImZyb250ZW5kX29ubHkiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJpbmFyeSIsDQogICAgICAgICAgIm5hbWUiOiAiQmluYXJ5IiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYXVkaW9fZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiQXVkaW8gRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInVybCIsDQogICAgICAgICAgIm5hbWUiOiAiVVJMIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJiaW5hcnkiLA0KICAgICAgICAgICJuYW1lIjogIkJpbmFyeSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImF1ZGlvX2RhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkF1ZGlvIERhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJhdWRpb191cmwiLA0KICAgICAgICAgICJuYW1lIjogIkF1ZGlvIFVSTCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkdXJhdGlvbiIsDQogICAgICAgICAgIm5hbWUiOiAiRHVyYXRpb24iLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJvcmlnaW5hbCIsDQogICAgICAgICAgIm5hbWUiOiAiT3JpZ2luYWwiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJhdXRvUGxheSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJBdXRvIFBsYXkiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJmYWxzZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAidm9sdW1lIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIlZvbHVtZSAoMC0xKSIsDQogICAgICAgICAgInZhbHVlIjogMSwNCiAgICAgICAgICAibWluIjogMCwNCiAgICAgICAgICAibWF4IjogMSwNCiAgICAgICAgICAic3RlcCI6IDAuMQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImF1ZGlvX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJjb25kaXRpb24iOiB7DQogICAgICAiaWQiOiAiY29uZGl0aW9uIiwNCiAgICAgICJuYW1lIjogIkNvbmRpdGlvbiIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiQ29tcGFyZSBpbnB1dCB2YWx1ZSB0byBhIGNvbmRpdGlvbiBhbmQgb3V0cHV0IHRydWUvZmFsc2UiLA0KICAgICAgImljb24iOiAiZmFzIGZhLXF1ZXN0aW9uLWNpcmNsZSIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAibG9naWMiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ2YWx1ZSIsDQogICAgICAgICAgIm5hbWUiOiAiVmFsdWUiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJyZXN1bHQiLA0KICAgICAgICAgICJuYW1lIjogIlJlc3VsdCIsDQogICAgICAgICAgInR5cGUiOiAiYm9vbGVhbiINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJvcGVyYXRvciI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJPcGVyYXRvciIsDQogICAgICAgICAgInZhbHVlIjogImVxdWFscyIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAiZXF1YWxzIiwNCiAgICAgICAgICAgICJub3RfZXF1YWxzIiwNCiAgICAgICAgICAgICJncmVhdGVyX3RoYW4iLA0KICAgICAgICAgICAgImxlc3NfdGhhbiIsDQogICAgICAgICAgICAiZ3JlYXRlcl90aGFuX29yX2VxdWFsIiwNCiAgICAgICAgICAgICJsZXNzX3RoYW5fb3JfZXF1YWwiLA0KICAgICAgICAgICAgImNvbnRhaW5zIiwNCiAgICAgICAgICAgICJub3RfY29udGFpbnMiLA0KICAgICAgICAgICAgInN0YXJ0c193aXRoIiwNCiAgICAgICAgICAgICJlbmRzX3dpdGgiLA0KICAgICAgICAgICAgImlzX2VtcHR5IiwNCiAgICAgICAgICAgICJpc19ub3RfZW1wdHkiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiY29tcGFyZV92YWx1ZSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiQ29tcGFyZSBUbyIsDQogICAgICAgICAgInZhbHVlIjogIiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlZhbHVlIHRvIGNvbXBhcmUgYWdhaW5zdCINCiAgICAgICAgfSwNCiAgICAgICAgImNhc2Vfc2Vuc2l0aXZlIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkNhc2UgU2Vuc2l0aXZlIiwNCiAgICAgICAgICAidmFsdWUiOiAidHJ1ZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImNvbmRpdGlvbl9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAiZGlzcGxheSI6IHsNCiAgICAgICJpZCI6ICJkaXNwbGF5IiwNCiAgICAgICJuYW1lIjogIkRpc3BsYXkgVGV4dCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRGlzcGxheSB0ZXh0IGRhdGEgaW4gdmFyaW91cyBmb3JtYXRzIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1leWUiLA0KICAgICAgImNvbG9yIjogInN1Y2Nlc3MiLA0KICAgICAgImNhdGVnb3J5IjogIm91dHB1dCIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiZnJvbnRlbmRfb25seSIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJqc29uIiwNCiAgICAgICAgICAibmFtZSI6ICJKU09OIiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJpbmFyeSIsDQogICAgICAgICAgIm5hbWUiOiAiQmluYXJ5IiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGlzcGxheWVkIiwNCiAgICAgICAgICAibmFtZSI6ICJEaXNwbGF5ZWQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiaW5wdXRfcG9ydCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbnB1dCBQb3J0IiwNCiAgICAgICAgICAidmFsdWUiOiAiYXV0byIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAiYXV0byIsDQogICAgICAgICAgICAidGV4dCIsDQogICAgICAgICAgICAianNvbiIsDQogICAgICAgICAgICAiZGF0YSIsDQogICAgICAgICAgICAiYmluYXJ5Ig0KICAgICAgICAgIF0NCiAgICAgICAgfSwNCiAgICAgICAgImZvcm1hdCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJGb3JtYXQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0ZXh0IiwNCiAgICAgICAgICAgICJqc29uIiwNCiAgICAgICAgICAgICJodG1sIg0KICAgICAgICAgIF0NCiAgICAgICAgfSwNCiAgICAgICAgIm1heExlbmd0aCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJNYXggTGVuZ3RoIiwNCiAgICAgICAgICAidmFsdWUiOiAxMDAwLA0KICAgICAgICAgICJtaW4iOiAxLA0KICAgICAgICAgICJtYXgiOiAxMDAwMCwNCiAgICAgICAgICAic3RlcCI6IDEwMA0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImRpc3BsYXlfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgImh0dHAiOiB7DQogICAgICAiaWQiOiAiaHR0cCIsDQogICAgICAibmFtZSI6ICJIVFRQIFJlcXVlc3QiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIk1ha2UgSFRUUCByZXF1ZXN0cyB0byBleHRlcm5hbCBBUElzIGFuZCBzZXJ2aWNlcyIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtZ2xvYmUiLA0KICAgICAgImNvbG9yIjogInByaW1hcnkiLA0KICAgICAgImNhdGVnb3J5IjogIm5ldHdvcmsiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAianNvbiIsDQogICAgICAgICAgIm5hbWUiOiAiSlNPTiIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJiaW5hcnkiLA0KICAgICAgICAgICJuYW1lIjogIkJpbmFyeSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInN0YXR1c19jb2RlIiwNCiAgICAgICAgICAibmFtZSI6ICJTdGF0dXMgQ29kZSIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImhlYWRlcnMiLA0KICAgICAgICAgICJuYW1lIjogIkhlYWRlcnMiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidXJsIiwNCiAgICAgICAgICAibmFtZSI6ICJVUkwiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAidXJsIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJVUkwiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJodHRwczovL2pzb25wbGFjZWhvbGRlci50eXBpY29kZS5jb20vcG9zdHMvMSINCiAgICAgICAgfSwNCiAgICAgICAgIm1ldGhvZCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJNZXRob2QiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJHRVQiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgIkdFVCIsDQogICAgICAgICAgICAiUE9TVCIsDQogICAgICAgICAgICAiUFVUIiwNCiAgICAgICAgICAgICJERUxFVEUiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiaGVhZGVycyI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0YXJlYSIsDQogICAgICAgICAgImxhYmVsIjogIkhlYWRlcnMgKEpTT04pIiwNCiAgICAgICAgICAidmFsdWUiOiAie1wiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwifSINCiAgICAgICAgfSwNCiAgICAgICAgImJvZHkiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dGFyZWEiLA0KICAgICAgICAgICJsYWJlbCI6ICJCb2R5IChKU09OKSIsDQogICAgICAgICAgInZhbHVlIjogIntcIm1lc3NhZ2VcIjogXCJ7e1ZBTFVFfX1cIiwgXCJ0aW1lc3RhbXBcIjogXCJ7e0pTT046dGltZXN0YW1wfX1cIn0iDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAiaHR0cF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAiaW1hZ2UiOiB7DQogICAgICAiaWQiOiAiaW1hZ2UiLA0KICAgICAgIm5hbWUiOiAiSW1hZ2UgRGlzcGxheSIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRGlzcGxheSBpbWFnZXMgYW5kIGNvbnRyb2wgdmlzdWFsaXphdGlvbiIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtaW1hZ2UiLA0KICAgICAgImNvbG9yIjogImluZm8iLA0KICAgICAgImNhdGVnb3J5IjogIm1lZGlhIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJmcm9udGVuZF9vbmx5IiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJiaW5hcnkiLA0KICAgICAgICAgICJuYW1lIjogIkJpbmFyeSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImltYWdlX2RhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkltYWdlIERhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ1cmwiLA0KICAgICAgICAgICJuYW1lIjogIlVSTCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYmluYXJ5IiwNCiAgICAgICAgICAibmFtZSI6ICJCaW5hcnkiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJpbWFnZV9kYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJJbWFnZSBEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiaW1hZ2VfdXJsIiwNCiAgICAgICAgICAibmFtZSI6ICJJbWFnZSBVUkwiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGltZW5zaW9ucyIsDQogICAgICAgICAgIm5hbWUiOiAiRGltZW5zaW9ucyIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJvcmlnaW5hbCIsDQogICAgICAgICAgIm5hbWUiOiAiT3JpZ2luYWwiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJtYXhfcHJldmlld19zaXplIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIk1heCBQcmV2aWV3IFNpemUiLA0KICAgICAgICAgICJ2YWx1ZSI6IDMwMCwNCiAgICAgICAgICAibWluIjogNTAsDQogICAgICAgICAgIm1heCI6IDgwMCwNCiAgICAgICAgICAic3RlcCI6IDUwDQogICAgICAgIH0sDQogICAgICAgICJzaG93X2luZm8iOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiU2hvdyBJbmZvIiwNCiAgICAgICAgICAidmFsdWUiOiAidHJ1ZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImltYWdlX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJqc29uX2V4dHJhY3QiOiB7DQogICAgICAiaWQiOiAianNvbl9leHRyYWN0IiwNCiAgICAgICJuYW1lIjogIkpTT04gRXh0cmFjdCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRXh0cmFjdCB2YWx1ZXMgZnJvbSBKU09OIGRhdGEgdXNpbmcgZG90IG5vdGF0aW9uIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1jb2RlLWJyYW5jaCIsDQogICAgICAiY29sb3IiOiAiaW5mbyIsDQogICAgICAiY2F0ZWdvcnkiOiAiZGF0YSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAianNvbiIsDQogICAgICAgICAgIm5hbWUiOiAiSlNPTiIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJUZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJUZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImpzb24iLA0KICAgICAgICAgICJuYW1lIjogIkpTT04iLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZXh0cmFjdGVkX3ZhbHVlIiwNCiAgICAgICAgICAibmFtZSI6ICJFeHRyYWN0ZWQgVmFsdWUiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZmllbGRfcGF0aCIsDQogICAgICAgICAgIm5hbWUiOiAiRmllbGQgUGF0aCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJvcmlnaW5hbCIsDQogICAgICAgICAgIm5hbWUiOiAiT3JpZ2luYWwiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZmllbGRfcGF0aCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiRmllbGQgUGF0aCIsDQogICAgICAgICAgInZhbHVlIjogImRhdGEuaXRlbXMiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJVc2UgZG90IG5vdGF0aW9uIChlLmcuLCBkYXRhLml0ZW1zLjAubmFtZSkiDQogICAgICAgIH0sDQogICAgICAgICJkaXNwbGF5X2Zvcm1hdCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJEaXNwbGF5IEZvcm1hdCIsDQogICAgICAgICAgInZhbHVlIjogInRleHQiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRleHQiLA0KICAgICAgICAgICAgImpzb24iDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImpzb25fZXh0cmFjdF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAibGxtX2NoYXQiOiB7DQogICAgICAiaWQiOiAibGxtX2NoYXQiLA0KICAgICAgIm5hbWUiOiAiTExNIENoYXQiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIkNoYXQgd2l0aCBMYXJnZSBMYW5ndWFnZSBNb2RlbHMgdXNpbmcgT2xsYW1hIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1yb2JvdCIsDQogICAgICAiY29sb3IiOiAiaW5mbyIsDQogICAgICAiY2F0ZWdvcnkiOiAiYWkiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJwcm9tcHQiLA0KICAgICAgICAgICJuYW1lIjogIlByb21wdCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJzeXN0ZW1fbWVzc2FnZSIsDQogICAgICAgICAgIm5hbWUiOiAiU3lzdGVtIE1lc3NhZ2UiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiY29udGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiQ29udGV4dCIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInJlc3BvbnNlIiwNCiAgICAgICAgICAibmFtZSI6ICJSZXNwb25zZSIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0b2tlbnNfdXNlZCIsDQogICAgICAgICAgIm5hbWUiOiAiVG9rZW5zIFVzZWQiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJtb2RlbF91c2VkIiwNCiAgICAgICAgICAibmFtZSI6ICJNb2RlbCBVc2VkIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZ1bGxfcmVzcG9uc2UiLA0KICAgICAgICAgICJuYW1lIjogIkZ1bGwgUmVzcG9uc2UiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZW5kcG9pbnQiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIk9sbGFtYSBFbmRwb2ludCIsDQogICAgICAgICAgInZhbHVlIjogImh0dHA6Ly8xMjcuMC4wLjE6MTE0MzQvdjEiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJodHRwOi8vMTI3LjAuMC4xOjExNDM0L3YxIg0KICAgICAgICB9LA0KICAgICAgICAibW9kZWwiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIk1vZGVsIE5hbWUiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJIYW1tZXJBSS9tbi1tYWctbWVsbC1yMTpsYXRlc3QiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJsbGFtYTIsIGNvZGVsbGFtYSwgZXRjLiINCiAgICAgICAgfSwNCiAgICAgICAgInRlbXBlcmF0dXJlIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIlRlbXBlcmF0dXJlIiwNCiAgICAgICAgICAidmFsdWUiOiAwLjcsDQogICAgICAgICAgIm1pbiI6IDAsDQogICAgICAgICAgIm1heCI6IDIsDQogICAgICAgICAgInN0ZXAiOiAwLjENCiAgICAgICAgfSwNCiAgICAgICAgIm1heF90b2tlbnMiOiB7DQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICAgICAibGFiZWwiOiAiTWF4IFRva2VucyIsDQogICAgICAgICAgInZhbHVlIjogMjA0OCwNCiAgICAgICAgICAibWluIjogMSwNCiAgICAgICAgICAibWF4IjogODE5MiwNCiAgICAgICAgICAic3RlcCI6IDENCiAgICAgICAgfSwNCiAgICAgICAgInN5c3RlbV9wcm9tcHQiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dGFyZWEiLA0KICAgICAgICAgICJsYWJlbCI6ICJTeXN0ZW0gUHJvbXB0IiwNCiAgICAgICAgICAidmFsdWUiOiAiWW91IGFyZSBhIGhlbHBmdWwgQUkgYXNzaXN0YW50LiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIkRlZmluZSB0aGUgQUkncyByb2xlIGFuZCBiZWhhdmlvciINCiAgICAgICAgfSwNCiAgICAgICAgImluY2x1ZGVfY29udGV4dCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbmNsdWRlIENvbnRleHQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ0cnVlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAibGxtX2NoYXRfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgImxvZ2ljYWxfZ2F0ZSI6IHsNCiAgICAgICJpZCI6ICJsb2dpY2FsX2dhdGUiLA0KICAgICAgIm5hbWUiOiAiTG9naWNhbCBHYXRlIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPbmx5IGNvbnRpbnVlIGV4ZWN1dGlvbiBpZiBpbnB1dCBpcyB0cnVlIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1maWx0ZXIiLA0KICAgICAgImNvbG9yIjogImluZm8iLA0KICAgICAgImNhdGVnb3J5IjogImxvZ2ljIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiY29uZGl0aW9uIiwNCiAgICAgICAgICAibmFtZSI6ICJDb25kaXRpb24iLA0KICAgICAgICAgICJ0eXBlIjogImJvb2xlYW4iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImludmVydCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbnZlcnQgTG9naWMiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJmYWxzZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiZGVzY3JpcHRpb24iOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIkRlc2NyaXB0aW9uIiwNCiAgICAgICAgICAidmFsdWUiOiAiIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiT3B0aW9uYWwgZGVzY3JpcHRpb24gb2Ygd2hhdCB0aGlzIGdhdGUgZG9lcyINCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJsb2dpY2FsX2dhdGVfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgInJlcGVhdGVyIjogew0KICAgICAgImlkIjogInJlcGVhdGVyIiwNCiAgICAgICJuYW1lIjogIlJlcGVhdGVyIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJSZXBlYXQgY29ubmVjdGVkIHdvcmtmbG93IGF0IGludGVydmFscyIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtcmVkbyIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAidHJpZ2dlciIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImNvdW50IiwNCiAgICAgICAgICAibmFtZSI6ICJDb3VudCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImludGVydmFsIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkludGVydmFsIChtcykiLA0KICAgICAgICAgICJ2YWx1ZSI6IDEwMDAsDQogICAgICAgICAgIm1pbiI6IDEwMCwNCiAgICAgICAgICAibWF4IjogMzAwMDAwLA0KICAgICAgICAgICJzdGVwIjogMTAwDQogICAgICAgIH0sDQogICAgICAgICJjb3VudCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJDb3VudCAoMCA9IGluZmluaXRlKSIsDQogICAgICAgICAgInZhbHVlIjogMCwNCiAgICAgICAgICAibWluIjogMCwNCiAgICAgICAgICAic3RlcCI6IDENCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJyZXBlYXRlcl9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAidGV4dCI6IHsNCiAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIk91dHB1dCBzdGF0aWMgdGV4dCBjb250ZW50IiwNCiAgICAgICJpY29uIjogImZhcyBmYS1mb250IiwNCiAgICAgICJjb2xvciI6ICJzZWNvbmRhcnkiLA0KICAgICAgImNhdGVnb3J5IjogImRhdGEiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidXBwZXJjYXNlIiwNCiAgICAgICAgICAibmFtZSI6ICJVcHBlcmNhc2UiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAibG93ZXJjYXNlIiwNCiAgICAgICAgICAibmFtZSI6ICJMb3dlcmNhc2UiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAid29yZF9jb3VudCIsDQogICAgICAgICAgIm5hbWUiOiAiV29yZCBDb3VudCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImxlbmd0aCIsDQogICAgICAgICAgIm5hbWUiOiAiTGVuZ3RoIiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAidGV4dF9jb250ZW50Ijogew0KICAgICAgICAgICJ0eXBlIjogInRleHRhcmVhIiwNCiAgICAgICAgICAibGFiZWwiOiAiVGV4dCBDb250ZW50IiwNCiAgICAgICAgICAidmFsdWUiOiAiSGVsbG8sIFdvcmxkISINCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJ0ZXh0X2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJ0aW1lciI6IHsNCiAgICAgICJpZCI6ICJ0aW1lciIsDQogICAgICAibmFtZSI6ICJUaW1lciIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRGVsYXkgZXhlY3V0aW9uIGZvciBzcGVjaWZpZWQgbWlsbGlzZWNvbmRzIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1jbG9jayIsDQogICAgICAiY29sb3IiOiAid2FybmluZyIsDQogICAgICAiY2F0ZWdvcnkiOiAidHJpZ2dlciIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0aW1lc3RhbXAiLA0KICAgICAgICAgICJuYW1lIjogIlRpbWVzdGFtcCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImVsYXBzZWQiLA0KICAgICAgICAgICJuYW1lIjogIkVsYXBzZWQiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJpbnRlcnZhbCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJJbnRlcnZhbCAobXMpIiwNCiAgICAgICAgICAidmFsdWUiOiAxMDAwLA0KICAgICAgICAgICJtaW4iOiAxMDAsDQogICAgICAgICAgIm1heCI6IDYwMDAwLA0KICAgICAgICAgICJzdGVwIjogMTAwDQogICAgICAgIH0sDQogICAgICAgICJjb3VudCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJDb3VudCIsDQogICAgICAgICAgInZhbHVlIjogMSwNCiAgICAgICAgICAibWluIjogMSwNCiAgICAgICAgICAibWF4IjogMTAwLA0KICAgICAgICAgICJzdGVwIjogMQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInRpbWVyX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJ2ZnNfbG9hZCI6IHsNCiAgICAgICJpZCI6ICJ2ZnNfbG9hZCIsDQogICAgICAibmFtZSI6ICJWRlMgTG9hZCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiTG9hZCBkYXRhIGZyb20gdGhlIFZpcnR1YWwgRmlsZSBTeXN0ZW0iLA0KICAgICAgImljb24iOiAiZmFzIGZhLWZvbGRlci1vcGVuIiwNCiAgICAgICJjb2xvciI6ICJwcmltYXJ5IiwNCiAgICAgICJjYXRlZ29yeSI6ICJzdG9yYWdlIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZmlsZV9wYXRoIiwNCiAgICAgICAgICAibmFtZSI6ICJGaWxlIFBhdGgiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZmlsZV9wYXRoIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJGaWxlIFBhdGgiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIvbXlfZGF0YS5qc29uIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiL2Fic29sdXRlL3BhdGgvaW4vdmZzIg0KICAgICAgICB9LA0KICAgICAgICAiZm9ybWF0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkZvcm1hdCIsDQogICAgICAgICAgInZhbHVlIjogImpzb24iLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgImpzb24iLA0KICAgICAgICAgICAgInRleHQiLA0KICAgICAgICAgICAgImJpbmFyeSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJhdXRvX3JlbG9hZCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJBdXRvIFJlbG9hZCBvbiBDaGFuZ2UiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJmYWxzZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInZmc19sb2FkX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJ2ZnNfc2F2ZSI6IHsNCiAgICAgICJpZCI6ICJ2ZnNfc2F2ZSIsDQogICAgICAibmFtZSI6ICJWRlMgU2F2ZSIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiU2F2ZSBkYXRhIHRvIHRoZSBWaXJ0dWFsIEZpbGUgU3lzdGVtIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1zYXZlIiwNCiAgICAgICJjb2xvciI6ICJwcmltYXJ5IiwNCiAgICAgICJjYXRlZ29yeSI6ICJzdG9yYWdlIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInN1Y2Nlc3MiLA0KICAgICAgICAgICJuYW1lIjogIlN1Y2Nlc3MiLA0KICAgICAgICAgICJ0eXBlIjogImJvb2xlYW4iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiZmlsZV9wYXRoIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJGaWxlIFBhdGgiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIvbXlfZGF0YS5qc29uIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiL2Fic29sdXRlL3BhdGgvaW4vdmZzIg0KICAgICAgICB9LA0KICAgICAgICAiZm9ybWF0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkZvcm1hdCIsDQogICAgICAgICAgInZhbHVlIjogImpzb24iLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgImpzb24iLA0KICAgICAgICAgICAgInRleHQiLA0KICAgICAgICAgICAgImJpbmFyeSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJvdmVyd3JpdGUiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiT3ZlcndyaXRlIiwNCiAgICAgICAgICAidmFsdWUiOiAidHJ1ZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiYXBwZW5kIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkFwcGVuZCBNb2RlIiwNCiAgICAgICAgICAidmFsdWUiOiAiZmFsc2UiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRydWUiLA0KICAgICAgICAgICAgImZhbHNlIg0KICAgICAgICAgIF0NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJ2ZnNfc2F2ZV9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfQ0KICB9DQp9",
      "size": 21438
    }
  ]
}