{
  "app_metadata": {
    "id": "flow_editor",
    "name": "Flow Editor",
    "description": "Visual node-based workflow editor for creating and executing data processing pipelines",
    "icon": "fas fa-project-diagram",
    "keywords": [
      "flow",
      "workflow",
      "nodes",
      "pipeline",
      "visual",
      "editor"
    ],
    "author": "Sypnex OS",
    "version": "1.1.4",
    "type": "user_app",
    "scripts": [
      "js/utils.js",
      "js/node-registry.js",
      "js/canvas.js",
      "js/node-config.js",
      "js/node-renderer.js",
      "js/data-executors.js",
      "js/http-executors.js",
      "js/media-executors.js",
      "js/flow-executors.js",
      "js/ai-executors.js",
      "js/execution-engine.js",
      "js/workflow.js",
      "js/canvas-manager.js",
      "js/tag-manager.js",
      "js/file-manager.js",
      "js/ui-manager.js",
      "js/main.js"
    ],
    "styles": [
      "css/layout.css",
      "css/nodes.css",
      "css/components.css",
      "css/node-types.css",
      "css/responsive.css",
      "css/os-theme.css"
    ],
    "additional_files": [
      {
        "vfs_path": "/nodes/nodes-pack.json",
        "source_file": "node-definitions/nodes-pack.json"
      }
    ],
    "settings": [
      {
        "key": "DEFAULT_HTTP_TIMEOUT",
        "name": "HTTP Timeout (ms)",
        "type": "number",
        "value": 30000,
        "description": "Default timeout for HTTP requests in milliseconds"
      },
      {
        "key": "AUTO_SAVE_INTERVAL",
        "name": "Auto Save Interval (s)",
        "type": "number",
        "value": 30,
        "description": "Auto save workflows every N seconds (0 = disabled)"
      },
      {
        "key": "MAX_NODES",
        "name": "Maximum Nodes",
        "type": "number",
        "value": 50,
        "description": "Maximum number of nodes allowed in a workflow"
      }
    ]
  },
  "files": {
    "flow_editor.app": "ew0KICAiaWQiOiAiZmxvd19lZGl0b3IiLA0KICAibmFtZSI6ICJGbG93IEVkaXRvciIsDQogICJkZXNjcmlwdGlvbiI6ICJWaXN1YWwgbm9kZS1iYXNlZCB3b3JrZmxvdyBlZGl0b3IgZm9yIGNyZWF0aW5nIGFuZCBleGVjdXRpbmcgZGF0YSBwcm9jZXNzaW5nIHBpcGVsaW5lcyIsDQogICJpY29uIjogImZhcyBmYS1wcm9qZWN0LWRpYWdyYW0iLA0KICAia2V5d29yZHMiOiBbImZsb3ciLCAid29ya2Zsb3ciLCAibm9kZXMiLCAicGlwZWxpbmUiLCAidmlzdWFsIiwgImVkaXRvciJdLA0KICAiYXV0aG9yIjogIlN5cG5leCBPUyIsDQogICJ2ZXJzaW9uIjogIjEuMS40IiwNCiAgInR5cGUiOiAidXNlcl9hcHAiLA0KICAic2NyaXB0cyI6IFsNCiAgICAianMvdXRpbHMuanMiLA0KICAgICJqcy9ub2RlLXJlZ2lzdHJ5LmpzIiwNCiAgICAianMvY2FudmFzLmpzIiwNCiAgICAianMvbm9kZS1jb25maWcuanMiLA0KICAgICJqcy9ub2RlLXJlbmRlcmVyLmpzIiwNCiAgICAianMvZGF0YS1leGVjdXRvcnMuanMiLA0KICAgICJqcy9odHRwLWV4ZWN1dG9ycy5qcyIsDQogICAgImpzL21lZGlhLWV4ZWN1dG9ycy5qcyIsDQogICAgImpzL2Zsb3ctZXhlY3V0b3JzLmpzIiwNCiAgICAianMvYWktZXhlY3V0b3JzLmpzIiwNCiAgICAianMvZXhlY3V0aW9uLWVuZ2luZS5qcyIsDQogICAgImpzL3dvcmtmbG93LmpzIiwNCiAgICAianMvY2FudmFzLW1hbmFnZXIuanMiLA0KICAgICJqcy90YWctbWFuYWdlci5qcyIsDQogICAgImpzL2ZpbGUtbWFuYWdlci5qcyIsDQogICAgImpzL3VpLW1hbmFnZXIuanMiLA0KICAgICJqcy9tYWluLmpzIg0KICBdLA0KICAic3R5bGVzIjogWw0KICAgICJjc3MvbGF5b3V0LmNzcyIsDQogICAgImNzcy9ub2Rlcy5jc3MiLA0KICAgICJjc3MvY29tcG9uZW50cy5jc3MiLA0KICAgICJjc3Mvbm9kZS10eXBlcy5jc3MiLA0KICAgICJjc3MvcmVzcG9uc2l2ZS5jc3MiLA0KICAgICJjc3Mvb3MtdGhlbWUuY3NzIg0KICBdLA0KICAiYWRkaXRpb25hbF9maWxlcyI6IFsNCiAgICB7DQogICAgICAidmZzX3BhdGgiOiAiL25vZGVzL25vZGVzLXBhY2suanNvbiIsDQogICAgICAic291cmNlX2ZpbGUiOiAibm9kZS1kZWZpbml0aW9ucy9ub2Rlcy1wYWNrLmpzb24iDQogICAgfQ0KICBdLA0KICAic2V0dGluZ3MiOiBbDQogICAgew0KICAgICAgImtleSI6ICJERUZBVUxUX0hUVFBfVElNRU9VVCIsDQogICAgICAibmFtZSI6ICJIVFRQIFRpbWVvdXQgKG1zKSIsDQogICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgInZhbHVlIjogMzAwMDAsDQogICAgICAiZGVzY3JpcHRpb24iOiAiRGVmYXVsdCB0aW1lb3V0IGZvciBIVFRQIHJlcXVlc3RzIGluIG1pbGxpc2Vjb25kcyINCiAgICB9LA0KICAgIHsNCiAgICAgICJrZXkiOiAiQVVUT19TQVZFX0lOVEVSVkFMIiwNCiAgICAgICJuYW1lIjogIkF1dG8gU2F2ZSBJbnRlcnZhbCAocykiLA0KICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICJ2YWx1ZSI6IDMwLA0KICAgICAgImRlc2NyaXB0aW9uIjogIkF1dG8gc2F2ZSB3b3JrZmxvd3MgZXZlcnkgTiBzZWNvbmRzICgwID0gZGlzYWJsZWQpIg0KICAgIH0sDQogICAgew0KICAgICAgImtleSI6ICJNQVhfTk9ERVMiLA0KICAgICAgIm5hbWUiOiAiTWF4aW11bSBOb2RlcyIsDQogICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgInZhbHVlIjogNTAsDQogICAgICAiZGVzY3JpcHRpb24iOiAiTWF4aW11bSBudW1iZXIgb2Ygbm9kZXMgYWxsb3dlZCBpbiBhIHdvcmtmbG93Ig0KICAgIH0NCiAgXQ0KfQ==",
    "flow_editor.html": "PGRpdiBjbGFzcz0iYXBwLWNvbnRhaW5lciI+DQogICAgPGRpdiBjbGFzcz0iYXBwLWNvbnRlbnQiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LWVkaXRvciI+DQogICAgICAgICAgICA8IS0tIExlZnQgVG9vbGJveCAtLT4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctdG9vbGJveCIgaWQ9ImZsb3ctdG9vbGJveCI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbGJveC1oZWFkZXIiPg0KICAgICAgICAgICAgICAgICAgICA8aDQ+PGkgY2xhc3M9ImZhcyBmYS10b29scyI+PC9pPiBOb2RlczwvaDQ+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InRvZ2dsZS10b29sYm94IiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJDb2xsYXBzZSBUb29sYm94Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1sZWZ0Ij48L2k+DQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2xib3gtY29udGVudCIgaWQ9InRvb2xib3gtY29udGVudCI+DQogICAgICAgICAgICAgICAgICAgIDwhLS0gTm9kZXMgd2lsbCBiZSBsb2FkZWQgZHluYW1pY2FsbHkgZnJvbSBWRlMgLS0+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxvYWRpbmctbm9kZXMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbXV0ZWQiPkxvYWRpbmcgbm9kZXMuLi48L3A+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgIDwhLS0gTWFpbiB3b3Jrc3BhY2UgLS0+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LXdvcmtzcGFjZSI+DQogICAgICAgICAgICAgICAgPCEtLSBUb29sYmFyIC0tPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctdG9vbGJhciI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2xiYXItbGVmdCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJydW4td29ya2Zsb3ciIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGxheSI+PC9pPiA8c3BhbiBjbGFzcz0iYnRuLXRleHQiPlJ1biBXb3JrZmxvdzwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3RvcC13b3JrZmxvdyIgY2xhc3M9ImJ0biBidG4tZGFuZ2VyIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc3RvcCI+PC9pPiA8c3BhbiBjbGFzcz0iYnRuLXRleHQiPlN0b3A8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImN1cnJlbnQtZmlsZS1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iY3VycmVudC1maWxlbmFtZSIgY2xhc3M9ImN1cnJlbnQtZmlsZW5hbWUiPnVudGl0bGVkLmZsb3c8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sYmFyLXJpZ2h0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gWm9vbSBjb250cm9scyBzdGF5IHZpc2libGUgLS0+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ6b29tLWNvbnRyb2xzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJ6b29tLW91dCIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJab29tIE91dCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoLW1pbnVzIj48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9Inpvb20tbGV2ZWwiIGNsYXNzPSJ6b29tLWxldmVsIj4xMDAlPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Inpvb20taW4iIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0aXRsZT0iWm9vbSBJbiI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoLXBsdXMiPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJ6b29tLWZpdCIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJab29tIHRvIEZpdCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhwYW5kLWFycm93cy1hbHQiPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIEhhbWJ1cmdlciBNZW51IEJ1dHRvbiAtLT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImhhbWJ1cmdlci1tZW51IiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBoYW1idXJnZXItYnRuIiB0aXRsZT0iTWVudSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1iYXJzIj48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPCEtLSBEcm9wZG93biBNZW51IC0gT25seSBmaWxlIG9wZXJhdGlvbnMgYW5kIGRlbGV0ZS9jbGVhciBhY3Rpb25zIC0tPg0KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImRyb3Bkb3duLW1lbnUiIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWVudS1zZWN0aW9uIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1lbnUtc2VjdGlvbi10aXRsZSI+RmlsZSBBY3Rpb25zPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtZW51LWl0ZW0iIGRhdGEtYWN0aW9uPSJzYXZlLWZsb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2F2ZSI+PC9pPiBTYXZlDQogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1lbnUtaXRlbSIgZGF0YS1hY3Rpb249InNhdmUtZmxvdy1hcyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYXZlIj48L2k+IFNhdmUgQXMNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLWFjdGlvbj0ibG9hZC1mbG93Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWZvbGRlci1vcGVuIj48L2k+IExvYWQNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1lbnUtc2VjdGlvbiI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtZW51LXNlY3Rpb24tdGl0bGUiPlZpZXcgQWN0aW9uczwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLWFjdGlvbj0iYWRkLXRhZyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10YWciPjwvaT4gQWRkIFRhZw0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtZW51LWl0ZW0iIGRhdGEtYWN0aW9uPSJyZXNldC12aWV3Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNyb3NzaGFpcnMiPjwvaT4gUmVzZXQgVmlldw0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWVudS1zZWN0aW9uIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1lbnUtc2VjdGlvbi10aXRsZSI+RWRpdCBBY3Rpb25zPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtZW51LWl0ZW0gZGFuZ2VyIiBkYXRhLWFjdGlvbj0iZGVsZXRlLXNlbGVjdGVkIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRyYXNoIj48L2k+IERlbGV0ZSBTZWxlY3RlZA0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtZW51LWl0ZW0gZGFuZ2VyIiBkYXRhLWFjdGlvbj0iY2xlYXItY2FudmFzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCI+PC9pPiBDbGVhciBBbGwNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgICAgICAgIDwhLS0gTWFpbiBjYW52YXMgYXJlYSAtLT4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LWNhbnZhcy1jb250YWluZXIiPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJmbG93LWNhbnZhcyIgY2xhc3M9ImZsb3ctY2FudmFzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gTm9kZXMgd2lsbCBiZSBhZGRlZCBoZXJlIGR5bmFtaWNhbGx5IC0tPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KDQogICAgICAgICAgICA8IS0tIENvbmZpZ3VyYXRpb24gcGFuZWwgLS0+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LWNvbmZpZy1wYW5lbCIgaWQ9ImZsb3ctY29uZmlnLXBhbmVsIj4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctaGVhZGVyIj4NCiAgICAgICAgICAgICAgICAgICAgPGg0PjxpIGNsYXNzPSJmYXMgZmEtY29nIj48L2k+IENvbmZpZ3VyYXRpb248L2g0Pg0KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJ0b2dnbGUtY29uZmlnIiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHRpdGxlPSJDb2xsYXBzZSBDb25maWd1cmF0aW9uIFBhbmVsIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1yaWdodCI+PC9pPg0KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctY29udGVudCIgaWQ9ImNvbmZpZy1jb250ZW50Ij4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0ibm9kZS1jb25maWciPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idGFnLXBhbmVsIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxoNT48aSBjbGFzcz0iZmFzIGZhLXRhZ3MiPjwvaT4gQXJlYSBUYWdzPC9oNT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LW11dGVkIj5ObyB0YWdzIHlldDwvcD4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgPCEtLSBPdXRwdXQgcGFuZWwgLS0+DQogICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctb3V0cHV0LXBhbmVsIGNvbGxhcHNlZCIgaWQ9ImZsb3ctb3V0cHV0LXBhbmVsIj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im91dHB1dC1oZWFkZXIiPg0KICAgICAgICAgICAgICAgIDxoND48aSBjbGFzcz0iZmFzIGZhLXRlcm1pbmFsIj48L2k+IEV4ZWN1dGlvbiBPdXRwdXQ8L2g0Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im91dHB1dC1jb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InRvZ2dsZS1vdXRwdXQiIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgdGl0bGU9IlNob3cvSGlkZSBPdXRwdXQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLWRvd24iPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImNsZWFyLW91dHB1dCIgY2xhc3M9ImJ0biBidG4tc20gYnRuLW91dGxpbmUtc2Vjb25kYXJ5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJhc2giPjwvaT4gQ2xlYXINCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im91dHB1dC1jb250ZW50IiBpZD0ib3V0cHV0LWNvbnRlbnQiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQogICAgICAgICAgICAgICAgPGRpdiBpZD0iZXhlY3V0aW9uLW91dHB1dCIgY2xhc3M9ImV4ZWN1dGlvbi1vdXRwdXQiPg0KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1tdXRlZCI+V29ya2Zsb3cgb3V0cHV0IHdpbGwgYXBwZWFyIGhlcmU8L3A+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQo8L2Rpdj4NCjxzdHlsZT4vKiA9PT09PSBTdHlsZTogY3NzL2xheW91dC5jc3MgPT09PT0gKi8NCi8qIEZsb3cgRWRpdG9yIExheW91dCAmIFN0cnVjdHVyZSAqLw0KDQovKiBFbnN1cmUgYXBwLWNvbnRhaW5lciB1c2VzIGZ1bGwgaGVpZ2h0ICovDQouYXBwLWNvbnRhaW5lciB7DQogICAgaGVpZ2h0OiAxMDB2aDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KLmFwcC1jb250ZW50IHsNCiAgICBmbGV4OiAxOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIGdhcDogMTBweDsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KICAgIG1pbi1oZWlnaHQ6IDA7DQp9DQoNCi8qIEZsb3cgRWRpdG9yIExheW91dCAqLw0KLmZsb3ctZWRpdG9yIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXg6IDE7DQogICAgZ2FwOiAwOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgbWluLWhlaWdodDogMDsNCn0NCg0KLyogTGVmdCBUb29sYm94ICovDQouZmxvdy10b29sYm94IHsNCiAgICB3aWR0aDogMjUwcHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgZmxleC1zaHJpbms6IDA7DQp9DQoNCi50b29sYm94LWhlYWRlciB7DQogICAgcGFkZGluZzogMTVweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQoudG9vbGJveC1oZWFkZXIgaDQgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LXNpemU6IDE2cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KfQ0KDQojdG9nZ2xlLXRvb2xib3ggew0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQojdG9nZ2xlLXRvb2xib3g6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCi8qIENvbGxhcHNlZCBzdGF0ZSAqLw0KLmZsb3ctdG9vbGJveC5jb2xsYXBzZWQgew0KICAgIHdpZHRoOiA1MHB4Ow0KfQ0KDQouZmxvdy10b29sYm94LmNvbGxhcHNlZCAudG9vbGJveC1jb250ZW50IHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouZmxvdy10b29sYm94LmNvbGxhcHNlZCAudG9vbGJveC1oZWFkZXIgaDQgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi50b29sYm94LWNvbnRlbnQgew0KICAgIGZsZXg6IDE7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KfQ0KDQovKiBNYWluIFdvcmtzcGFjZSAqLw0KLmZsb3ctd29ya3NwYWNlIHsNCiAgICBmbGV4OiAxOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBtaW4td2lkdGg6IDA7DQp9DQoNCi8qIFRvb2xiYXIgKi8NCi5mbG93LXRvb2xiYXIgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgcGFkZGluZzogMTJweCAyMHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGZsZXgtc2hyaW5rOiAwOw0KfQ0KDQoudG9vbGJhci1sZWZ0IHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGdhcDogMTBweDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQouY3VycmVudC1maWxlLWluZm8gew0KICAgIG1hcmdpbi1sZWZ0OiAxNXB4Ow0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCn0NCg0KLmN1cnJlbnQtZmlsZW5hbWUgew0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQoudG9vbGJhci1yaWdodCB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBnYXA6IDhweDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCg0KLyogWm9vbSBDb250cm9scyAqLw0KLnpvb20tY29udHJvbHMgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDRweDsNCiAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNnB4Ow0KfQ0KDQouem9vbS1sZXZlbCB7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIG1pbi13aWR0aDogNDBweDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgdXNlci1zZWxlY3Q6IG5vbmU7DQp9DQoNCi56b29tLWNvbnRyb2xzIGJ1dHRvbiB7DQogICAgcGFkZGluZzogNHB4IDZweDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQouem9vbS1jb250cm9scyBidXR0b246aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCi56b29tLWNvbnRyb2xzIGJ1dHRvbjphY3RpdmUgew0KICAgIHRyYW5zZm9ybTogc2NhbGUoMC45NSk7DQp9DQoNCi8qIENhbnZhcyBDb250YWluZXIgKi8NCi5mbG93LWNhbnZhcy1jb250YWluZXIgew0KICAgIGZsZXg6IDE7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQp9DQoNCi5mbG93LWNhbnZhcyB7DQogICAgd2lkdGg6IDEwMDAwcHg7DQogICAgaGVpZ2h0OiAxMDAwMHB4Ow0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBiYWNrZ3JvdW5kOiANCiAgICAgICAgcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCAyMHB4IDIwcHgsIHZhcigtLWJvcmRlci1jb2xvcikgMXB4LCB0cmFuc3BhcmVudCAxcHgpLA0KICAgICAgICByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDQwcHggNDBweCwgdmFyKC0tYm9yZGVyLWNvbG9yKSAxcHgsIHRyYW5zcGFyZW50IDFweCk7DQogICAgYmFja2dyb3VuZC1zaXplOiA0MHB4IDQwcHg7DQogICAgY3Vyc29yOiBncmFiOw0KICAgIHRyYW5zZm9ybS1vcmlnaW46IDAgMDsNCiAgICB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOw0KfQ0KDQouZmxvdy1jYW52YXM6YWN0aXZlIHsNCiAgICBjdXJzb3I6IGdyYWJiaW5nOw0KfQ0KDQouZmxvdy1jYW52YXMucGFubmluZyB7DQogICAgY3Vyc29yOiBncmFiYmluZzsNCn0NCg0KLyogQ29uZmlndXJhdGlvbiBQYW5lbCAqLw0KLmZsb3ctY29uZmlnLXBhbmVsIHsNCiAgICB3aWR0aDogMzAwcHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBmbGV4LXNocmluazogMDsNCn0NCg0KLmNvbmZpZy1oZWFkZXIgew0KICAgIHBhZGRpbmc6IDE1cHg7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCg0KLmNvbmZpZy1oZWFkZXIgaDQgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LXNpemU6IDE2cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KfQ0KDQojdG9nZ2xlLWNvbmZpZyB7DQogICAgcGFkZGluZzogNHB4IDhweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQp9DQoNCiN0b2dnbGUtY29uZmlnOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ib3JkZXItY29sb3IpOw0KfQ0KDQovKiBDb2xsYXBzZWQgc3RhdGUgKi8NCi5mbG93LWNvbmZpZy1wYW5lbC5jb2xsYXBzZWQgew0KICAgIHdpZHRoOiA1MHB4Ow0KfQ0KDQouZmxvdy1jb25maWctcGFuZWwuY29sbGFwc2VkIC5jb25maWctY29udGVudCB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLmZsb3ctY29uZmlnLXBhbmVsLmNvbGxhcHNlZCAuY29uZmlnLWhlYWRlciBoNCB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLmNvbmZpZy1jb250ZW50IHsNCiAgICBmbGV4OiAxOw0KICAgIG92ZXJmbG93LXk6IGF1dG87DQogICAgcGFkZGluZzogMTVweDsNCn0NCg0KLyogT3V0cHV0IFBhbmVsICovDQouZmxvdy1vdXRwdXQtcGFuZWwgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgZmxleC1zaHJpbms6IDA7DQogICAgbWF4LWhlaWdodDogMzAwcHg7DQp9DQoNCi5vdXRwdXQtaGVhZGVyIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHBhZGRpbmc6IDEycHggMTVweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCn0NCg0KLm91dHB1dC1oZWFkZXIgaDQgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LXNpemU6IDE2cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KfQ0KDQoub3V0cHV0LWNvbnRlbnQgew0KICAgIHBhZGRpbmc6IDE1cHg7DQogICAgbWF4LWhlaWdodDogMjUwcHg7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCiAgICBvdmVyZmxvdy14OiBoaWRkZW47DQp9DQoNCi5mbG93LW91dHB1dC1wYW5lbC5jb2xsYXBzZWQgLm91dHB1dC1jb250ZW50IHsNCiAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7DQp9DQoNCi5mbG93LW91dHB1dC1wYW5lbCAub3V0cHV0LWhlYWRlciB7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouZmxvdy1vdXRwdXQtcGFuZWwgLm91dHB1dC1jb250cm9scyB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBnYXA6IDhweDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQoNCi8qID09PT09IFN0eWxlOiBjc3Mvbm9kZXMuY3NzID09PT09ICovDQovKiBGbG93IEVkaXRvciBOb2RlcyAmIENvbm5lY3Rpb25zICovDQoNCi8qIE5vZGUgU3R5bGVzICovDQouZmxvdy1ub2RlIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgbWluLXdpZHRoOiAxNTBweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDJweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KICAgIGN1cnNvcjogZ3JhYjsNCiAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjEpOw0KICAgIHRyYW5zaXRpb246IGJveC1zaGFkb3cgMC4ycyBlYXNlLCB0cmFuc2Zvcm0gMC4xcyBlYXNlOw0KICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07DQp9DQoNCi5mbG93LW5vZGU6YWN0aXZlIHsNCiAgICBjdXJzb3I6IGdyYWJiaW5nOw0KICAgIHRyYW5zaXRpb246IG5vbmU7DQp9DQoNCi5mbG93LW5vZGU6aG92ZXIgew0KICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjE1KTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQp9DQoNCi5mbG93LW5vZGUuc2VsZWN0ZWQgew0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgYm94LXNoYWRvdzogMCAwIDAgMnB4IHJnYmEodmFyKC0tcHJpbWFyeS1jb2xvci1yZ2IpLCAwLjIpOw0KfQ0KDQouZmxvdy1ub2RlLWhlYWRlciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDhweDsNCiAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQoubm9kZS1kZWxldGUtYnRuIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgcmlnaHQ6IC01cHg7DQogICAgdG9wOiAtNXB4Ow0KICAgIHdpZHRoOiAyMHB4Ow0KICAgIGhlaWdodDogMjBweDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICBmb250LXNpemU6IDEwcHg7DQogICAgb3BhY2l0eTogMDsNCiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMnMgZWFzZTsNCiAgICB6LWluZGV4OiAxMDsNCn0NCg0KLmZsb3ctbm9kZTpob3ZlciAubm9kZS1kZWxldGUtYnRuIHsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KDQoubm9kZS1kZWxldGUtYnRuOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiAjZDMyZjJmOw0KICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsNCn0NCg0KLmZsb3ctbm9kZS10eXBlIHsNCiAgICBwYWRkaW5nOiAycHggNnB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICBiYWNrZ3JvdW5kOiAjNmM3NTdkOw0KICAgIGNvbG9yOiB3aGl0ZTsNCn0NCg0KLmZsb3ctbm9kZS1jb250ZW50IHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnRzIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHBvaW50ZXItZXZlbnRzOiBub25lOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnQgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTJweDsNCiAgICBoZWlnaHQ6IDEycHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHBvaW50ZXItZXZlbnRzOiBhbGw7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KLmZsb3ctbm9kZS1wb3J0OmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIHRyYW5zZm9ybTogc2NhbGUoMS4yKTsNCn0NCg0KLmZsb3ctbm9kZS1wb3J0LmlucHV0IHsNCiAgICBsZWZ0OiAtNnB4Ow0KICAgIHRvcDogNTAlOw0KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsNCn0NCg0KLmZsb3ctbm9kZS1wb3J0Lm91dHB1dCB7DQogICAgcmlnaHQ6IC02cHg7DQogICAgdG9wOiA1MCU7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpOw0KfQ0KDQovKiBDb25uZWN0aW9uIExpbmVzICovDQouZmxvdy1jb25uZWN0aW9uIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQogICAgei1pbmRleDogMTsNCn0NCg0KLmZsb3ctY29ubmVjdGlvbi1saW5lIHsNCiAgICBzdHJva2U6IHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgc3Ryb2tlLXdpZHRoOiA4Ow0KICAgIGZpbGw6IG5vbmU7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCiAgICBvcGFjaXR5OiAwLjY7IC8qIFNsaWdodGx5IHRyYW5zcGFyZW50IGJ5IGRlZmF1bHQgKi8NCn0NCg0KLmZsb3ctY29ubmVjdGlvbi1saW5lOmhvdmVyIHsNCiAgICBzdHJva2U6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIG9wYWNpdHk6IDE7DQogICAgc3Ryb2tlLXdpZHRoOiAxMDsNCn0NCg0KLmZsb3ctY29ubmVjdGlvbi1saW5lLmNvbm5lY3RlZCB7DQogICAgc3Ryb2tlOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBvcGFjaXR5OiAwLjg7DQp9DQoNCi8qIFJ1bm5pbmcgU3RhdGUgKi8NCi5mbG93LW5vZGUucnVubmluZyB7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCiAgICBhbmltYXRpb246IHB1bHNlIDJzIGluZmluaXRlOw0KfQ0KDQovKiBXYWl0aW5nIGZvciBJbnB1dHMgU3RhdGUgKi8NCi5mbG93LW5vZGUud2FpdGluZy1pbnB1dHMgew0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0td2FybmluZy1jb2xvcik7DQogICAgYW5pbWF0aW9uOiB3YWl0aW5nLXB1bHNlIDJzIGluZmluaXRlOw0KfQ0KDQovKiBDb21wbGV0ZWQgU3RhdGUgKi8NCi5mbG93LW5vZGUuY29tcGxldGVkIHsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tc3VjY2Vzcy1jb2xvci1yZ2IpLCAwLjEpOw0KfQ0KDQovKiBFcnJvciBTdGF0ZSAqLw0KLmZsb3ctbm9kZS5lcnJvciB7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1lcnJvci1jb2xvci1yZ2IpLCAwLjEpOw0KfQ0KDQpAa2V5ZnJhbWVzIHB1bHNlIHsNCiAgICAwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDAgcmdiYSh2YXIoLS1zdWNjZXNzLWNvbG9yLXJnYiksIDAuNCk7IH0NCiAgICA3MCUgeyBib3gtc2hhZG93OiAwIDAgMCAxMHB4IHJnYmEodmFyKC0tc3VjY2Vzcy1jb2xvci1yZ2IpLCAwKTsgfQ0KICAgIDEwMCUgeyBib3gtc2hhZG93OiAwIDAgMCAwIHJnYmEodmFyKC0tc3VjY2Vzcy1jb2xvci1yZ2IpLCAwKTsgfQ0KfQ0KDQpAa2V5ZnJhbWVzIHdhaXRpbmctcHVsc2Ugew0KICAgIDAlIHsgYm94LXNoYWRvdzogMCAwIDAgMCByZ2JhKHZhcigtLXdhcm5pbmctY29sb3ItcmdiKSwgMC40KTsgfQ0KICAgIDcwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDEwcHggcmdiYSh2YXIoLS13YXJuaW5nLWNvbG9yLXJnYiksIDApOyB9DQogICAgMTAwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDAgcmdiYSh2YXIoLS13YXJuaW5nLWNvbG9yLXJnYiksIDApOyB9DQp9DQoNCg0KLyogPT09PT0gU3R5bGU6IGNzcy9jb21wb25lbnRzLmNzcyA9PT09PSAqLw0KLyogRmxvdyBFZGl0b3IgVUkgQ29tcG9uZW50cyAqLw0KDQovKiBOb2RlIENhdGVnb3J5IFRvb2xib3ggKi8NCi5ub2RlLWNhdGVnb3J5IHsNCiAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KfQ0KDQoubm9kZS1jYXRlZ29yeSBoNSB7DQogICAgbWFyZ2luOiAwIDAgMTBweCAwOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOw0KICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsNCiAgICBwYWRkaW5nOiAwIDVweDsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG4gew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDEwcHg7DQogICAgcGFkZGluZzogMTJweCAxNXB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgICBjdXJzb3I6IGdyYWI7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCiAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi50b29sYm94LW5vZGUtYnRuOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xKTsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG46YWN0aXZlIHsNCiAgICBjdXJzb3I6IGdyYWJiaW5nOw0KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG4gaSB7DQogICAgZm9udC1zaXplOiAxNnB4Ow0KICAgIHdpZHRoOiAyMHB4Ow0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLnRvb2xib3gtbm9kZS1idG4gc3BhbiB7DQogICAgZmxleDogMTsNCiAgICBmb250LXdlaWdodDogNTAwOw0KfQ0KDQovKiBCdXR0b25zICovDQouZmxvdy10b29sYmFyIC5idG4gew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDZweDsNCiAgICBwYWRkaW5nOiA4cHggMTJweDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYm9yZGVyLXJhZGl1czogNnB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuOmhvdmVyIHsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xKTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLW91dGxpbmUtZGFuZ2VyIHsNCiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLW91dGxpbmUtZGFuZ2VyOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KfQ0KDQouZmxvdy10b29sYmFyIC5idG4tb3V0bGluZS1zZWNvbmRhcnkgew0KICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQouZmxvdy10b29sYmFyIC5idG4tb3V0bGluZS1zZWNvbmRhcnk6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQovKiBDb25maWd1cmF0aW9uIFN0eWxlcyAqLw0KLmNvbmZpZy1ncm91cCB7DQogICAgbWFyZ2luLWJvdHRvbTogMTVweDsNCn0NCg0KLmNvbmZpZy1ncm91cCBsYWJlbCB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luLWJvdHRvbTogNXB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCn0NCg0KLmNvbmZpZy1ncm91cCBpbnB1dCB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4ycyBlYXNlOw0KfQ0KDQouY29uZmlnLWdyb3VwIHNlbGVjdCB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZ2xhc3MtYm9yZGVyKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLWdsYXNzLWJnKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi5jb25maWctZ3JvdXAgaW5wdXQ6Zm9jdXMgew0KICAgIG91dGxpbmU6IG5vbmU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWNvbG9yKTsNCiAgICBib3gtc2hhZG93OiAwIDAgMCAycHggcmdiYSh2YXIoLS1wcmltYXJ5LWNvbG9yLXJnYiksIDAuMSk7DQp9DQoNCi5jb25maWctZ3JvdXAgc2VsZWN0OmZvY3VzIHsNCiAgICBvdXRsaW5lOiBub25lOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDIxMiwgMjU1LCAwLjA1KTsNCn0NCg0KLmNvbmZpZy1ncm91cCBzZWxlY3Qgb3B0aW9uIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWJnKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQp9DQoNCi5jb25maWctZ3JvdXAgc2VsZWN0IG9wdGlvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZ2xhc3MtYmcpOw0KfQ0KDQouY29uZmlnLWdyb3VwIHRleHRhcmVhIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiA4cHggMTJweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHJlc2l6ZTogdmVydGljYWw7DQogICAgbWluLWhlaWdodDogODBweDsNCiAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOw0KfQ0KDQovKiBUYWcgUGFuZWwgKi8NCiN0YWctcGFuZWwgew0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgcGFkZGluZy10b3A6IDIwcHg7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCiN0YWctcGFuZWwgaDUgew0KICAgIG1hcmdpbjogMCAwIDE1cHggMDsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogOHB4Ow0KfQ0KDQoudGFnLWl0ZW0gew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDEwcHg7DQogICAgcGFkZGluZzogOHB4IDEycHg7DQogICAgbWFyZ2luLWJvdHRvbTogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNnB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQoudGFnLWl0ZW06aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpOw0KfQ0KDQoudGFnLWNvbG9yIHsNCiAgICB3aWR0aDogMTJweDsNCiAgICBoZWlnaHQ6IDEycHg7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgIGZsZXgtc2hyaW5rOiAwOw0KfQ0KDQoudGFnLWluZm8gew0KICAgIGZsZXg6IDE7DQogICAgbWluLXdpZHRoOiAwOw0KfQ0KDQoudGFnLW5hbWUgew0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgZm9udC1zaXplOiAxM3B4Ow0KICAgIG1hcmdpbi1ib3R0b206IDJweDsNCn0NCg0KLnRhZy1kZXNjcmlwdGlvbiB7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIG9wYWNpdHk6IDAuNzsNCn0NCg0KLnRhZy1kZWxldGUgew0KICAgIGJhY2tncm91bmQ6IG5vbmU7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGNvbG9yOiBpbmhlcml0Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBwYWRkaW5nOiA0cHg7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG9wYWNpdHk6IDAuNjsNCiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMnMgZWFzZTsNCn0NCg0KLnRhZy1kZWxldGU6aG92ZXIgew0KICAgIG9wYWNpdHk6IDE7DQogICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjEpOw0KfQ0KDQovKiBPdXRwdXQgU3R5bGVzICovDQouZXhlY3V0aW9uLW91dHB1dCB7DQogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsNCiAgICBmb250LXNpemU6IDEzcHg7DQogICAgbGluZS1oZWlnaHQ6IDEuNDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQp9DQoNCi5leGVjdXRpb24tb3V0cHV0IC5sb2ctZW50cnkgew0KICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICBwYWRkaW5nOiA0cHggMDsNCn0NCg0KLmV4ZWN1dGlvbi1vdXRwdXQgLmxvZy1lbnRyeS5pbmZvIHsNCiAgICBjb2xvcjogdmFyKC0taW5mby1jb2xvcik7DQp9DQoNCi5leGVjdXRpb24tb3V0cHV0IC5sb2ctZW50cnkuc3VjY2VzcyB7DQogICAgY29sb3I6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KfQ0KDQouZXhlY3V0aW9uLW91dHB1dCAubG9nLWVudHJ5LmVycm9yIHsNCiAgICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KfQ0KDQouZXhlY3V0aW9uLW91dHB1dCAubG9nLWVudHJ5Lndhcm5pbmcgew0KICAgIGNvbG9yOiB2YXIoLS13YXJuaW5nLWNvbG9yKTsNCn0NCg0KLyogSW5wdXQvT3V0cHV0IE1hcHBpbmdzIENvbmZpZ3VyYXRpb24gU3R5bGVzICovDQouaW5wdXQtbWFwcGluZ3MtY29uZmlnLA0KLm91dHB1dC1tYXBwaW5ncy1jb25maWcgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBtYXJnaW4tdG9wOiA0cHg7DQp9DQoNCi5pbnB1dC1tYXBwaW5nLWNvbmZpZywNCi5vdXRwdXQtbWFwcGluZy1jb25maWcgew0KICAgIG1hcmdpbi1ib3R0b206IDhweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIGJvcmRlci1sZWZ0OiAzcHggc29saWQgdmFyKC0tcHJpbWFyeS1jb2xvcik7DQp9DQoNCi5pbnB1dC1tYXBwaW5nLWNvbmZpZzpsYXN0LWNoaWxkLA0KLm91dHB1dC1tYXBwaW5nLWNvbmZpZzpsYXN0LWNoaWxkIHsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQouaW5wdXQtbWFwcGluZy1jb25maWcgbGFiZWwsDQoub3V0cHV0LW1hcHBpbmctY29uZmlnIGxhYmVsIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgbWFyZ2luLWJvdHRvbTogNHB4Ow0KfQ0KDQouaW5wdXQtbWFwcGluZy1zZWxlY3QsDQoub3V0cHV0LW1hcHBpbmctc2VsZWN0LA0KLmlucHV0LXRhcmdldC1zZWxlY3Qgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDhweCAxMnB4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWdsYXNzLWJvcmRlcik7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1nbGFzcy1iZyk7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouaW5wdXQtbWFwcGluZy1zZWxlY3Q6Zm9jdXMsDQoub3V0cHV0LW1hcHBpbmctc2VsZWN0OmZvY3VzLA0KLmlucHV0LXRhcmdldC1zZWxlY3Q6Zm9jdXMgew0KICAgIG91dGxpbmU6IG5vbmU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMjEyLCAyNTUsIDAuMDUpOw0KfQ0KDQouaW5wdXQtbWFwcGluZy1zZWxlY3Qgb3B0aW9uLA0KLm91dHB1dC1tYXBwaW5nLXNlbGVjdCBvcHRpb24sDQouaW5wdXQtdGFyZ2V0LXNlbGVjdCBvcHRpb24gew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktYmcpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBwYWRkaW5nOiA4cHggMTJweDsNCn0NCg0KLmlucHV0LW1hcHBpbmctc2VsZWN0IG9wdGlvbjpob3ZlciwNCi5vdXRwdXQtbWFwcGluZy1zZWxlY3Qgb3B0aW9uOmhvdmVyLA0KLmlucHV0LXRhcmdldC1zZWxlY3Qgb3B0aW9uOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1nbGFzcy1iZyk7DQp9DQoNCi8qIExlZ2FjeSBzdHlsZXMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKi8NCi5pbnB1dC1tYXBwaW5ncyB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIG1hcmdpbi10b3A6IDRweDsNCn0NCg0KLmlucHV0LW1hcHBpbmcgew0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgbWFyZ2luLWJvdHRvbTogNHB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIGxpbmUtaGVpZ2h0OiAxLjI7DQp9DQoNCi5pbnB1dC1tYXBwaW5nOmxhc3QtY2hpbGQgew0KICAgIG1hcmdpbi1ib3R0b206IDA7DQp9DQoNCi5pbnB1dC1tYXBwaW5nIC5zb3VyY2Utbm9kZSB7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCn0NCg0KLmlucHV0LW1hcHBpbmcgLnNvdXJjZS1wb3J0IHsNCiAgICBvcGFjaXR5OiAwLjg7DQogICAgZm9udC1zdHlsZTogaXRhbGljOw0KfQ0KDQovKiBDb2xsYXBzaWJsZSBDb25maWd1cmF0aW9uIFNlY3Rpb25zIC0gVXNpbmcgZXhpc3RpbmcgT1MgdGhlbWUgKi8NCi5jb25maWctc2VjdGlvbiB7DQogICAgbWFyZ2luLWJvdHRvbTogMTVweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KfQ0KDQouY29uZmlnLXNlY3Rpb24taGVhZGVyIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA4cHg7DQogICAgcGFkZGluZzogMTJweCAxNXB4Ow0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KICAgIHVzZXItc2VsZWN0OiBub25lOw0KfQ0KDQouY29uZmlnLXNlY3Rpb24taGVhZGVyOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ib3JkZXItY29sb3IpOw0KfQ0KDQouY29uZmlnLXNlY3Rpb24taGVhZGVyLmNvbGxhcHNlZCB7DQogICAgYm9yZGVyLWJvdHRvbTogbm9uZTsNCn0NCg0KLmNvbmZpZy1zZWN0aW9uLWhlYWRlciBpIHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzIGVhc2U7DQp9DQoNCi5jb25maWctc2VjdGlvbi1oZWFkZXIgc3BhbiB7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KfQ0KDQouY29uZmlnLWNvdW50IHsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgbWFyZ2luLWxlZnQ6IGF1dG87DQp9DQoNCi5jb25maWctc2VjdGlvbi1jb250ZW50IHsNCiAgICBwYWRkaW5nOiAxNXB4Ow0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KfQ0KDQouY29uZmlnLXNlY3Rpb24taGVhZGVyLmNvbGxhcHNlZCArIC5jb25maWctc2VjdGlvbi1jb250ZW50IHsNCiAgICBib3JkZXItdG9wOiBub25lOw0KfQ0KDQovKiBBZGp1c3QgZXhpc3RpbmcgY29uZmlnIGdyb3VwcyB3aXRoaW4gc2VjdGlvbnMgKi8NCi5jb25maWctc2VjdGlvbiAuY29uZmlnLWdyb3VwIHsNCiAgICBtYXJnaW4tYm90dG9tOiAxMnB4Ow0KfQ0KDQouY29uZmlnLXNlY3Rpb24gLmNvbmZpZy1ncm91cDpsYXN0LWNoaWxkIHsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQoNCi8qID09PT09IFN0eWxlOiBjc3Mvbm9kZS10eXBlcy5jc3MgPT09PT0gKi8NCi8qIEZsb3cgRWRpdG9yIE5vZGUgVHlwZSBTcGVjaWZpYyBTdHlsZXMgKi8NCg0KLyogRGlzcGxheSBOb2RlIENvbnRlbnQgKi8NCi5kaXNwbGF5LWNvbnRlbnQgew0KICAgIHBhZGRpbmc6IDhweDsNCn0NCg0KLmRpc3BsYXktdGV4dCB7DQogICAgbWluLWhlaWdodDogNDBweDsNCiAgICBtYXgtaGVpZ2h0OiAyMDBweDsNCiAgICB3aWR0aDogMjIwcHg7DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgbWFyZ2luLWJvdHRvbTogOHB4Ow0KICAgIHJlc2l6ZTogbm9uZTsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQouZGlzcGxheS10ZXh0IHByZSB7DQogICAgbWFyZ2luOiAwOw0KICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7DQogICAgd2hpdGUtc3BhY2U6IHByZS13cmFwOw0KICAgIHdvcmQtYnJlYWs6IGJyZWFrLXdvcmQ7DQogICAgdXNlci1zZWxlY3Q6IHRleHQ7DQp9DQoNCi5kaXNwbGF5LWZvcm1hdCB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQp9DQoNCi8qIEF1ZGlvIFBsYXllciBTdHlsZXMgKi8NCi5hdWRpby1jb250cm9scyB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGdhcDogMTBweDsNCiAgICBtYXJnaW4tdG9wOiAxMHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCn0NCg0KLmF1ZGlvLXBsYXktYnRuLA0KLmF1ZGlvLXN0b3AtYnRuIHsNCiAgICB3aWR0aDogMzJweDsNCiAgICBoZWlnaHQ6IDMycHg7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQouYXVkaW8tcGxheS1idG4gew0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCn0NCg0KLmF1ZGlvLXN0b3AtYnRuIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KfQ0KDQouYXVkaW8tcGxheS1idG46aG92ZXIsDQouYXVkaW8tc3RvcC1idG46aG92ZXIgew0KICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsNCiAgICBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjIpOw0KfQ0KDQouYXVkaW8tc3RhdHVzIHsNCiAgICBmbGV4OiAxOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQovKiBKU09OIEV4dHJhY3QgRGlzcGxheSAqLw0KLmpzb24tZXh0cmFjdC1kaXNwbGF5IHsNCiAgICBtYXJnaW4tdG9wOiAxMHB4Ow0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCn0NCg0KLmV4dHJhY3QtbGFiZWwgew0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgbWFyZ2luLWJvdHRvbTogNHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQp9DQoNCi5leHRyYWN0LXZhbHVlIHsNCiAgICBmb250LXNpemU6IDE0cHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgd29yZC1icmVhazogYnJlYWstYWxsOw0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQp9DQoNCi5leHRyYWN0LXZhbHVlLnN1Y2Nlc3Mgew0KICAgIGNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLXN1Y2Nlc3MtY29sb3IpOw0KfQ0KDQouZXh0cmFjdC12YWx1ZS5lcnJvciB7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCn0NCg0KLyogUmVwZWF0ZXIgTm9kZSBTdHlsZXMgKi8NCi5yZXBlYXRlci1jb250ZW50IHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDhweDsNCiAgICBwYWRkaW5nOiA4cHg7DQp9DQoNCi5yZXBlYXRlci1zdGF0dXMgew0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBtaW4td2lkdGg6IDgwcHg7DQp9DQoNCi5yZXBlYXRlci1zdGF0dXMuc3RvcHBlZCB7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjEpOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCn0NCg0KLnJlcGVhdGVyLXN0YXR1cy5ydW5uaW5nIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgYW5pbWF0aW9uOiBwdWxzZSAycyBpbmZpbml0ZTsNCn0NCg0KLnJlcGVhdGVyLWNvbnRyb2xzIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGdhcDogOHB4Ow0KfQ0KDQoucmVwZWF0ZXItc3RhcnQtYnRuLA0KLnJlcGVhdGVyLXN0b3AtYnRuIHsNCiAgICB3aWR0aDogMjhweDsNCiAgICBoZWlnaHQ6IDI4cHg7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlOw0KfQ0KDQoucmVwZWF0ZXItc3RhcnQtYnRuIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCiAgICBjb2xvcjogd2hpdGU7DQp9DQoNCi5yZXBlYXRlci1zdG9wLWJ0biB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGNvbG9yOiB3aGl0ZTsNCn0NCg0KLnJlcGVhdGVyLXN0YXJ0LWJ0bjpob3ZlciwNCi5yZXBlYXRlci1zdG9wLWJ0bjpob3ZlciB7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOw0KICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMik7DQp9DQoNCi8qIEltYWdlIE5vZGUgU3R5bGVzICovDQouaW1hZ2UtY29udGFpbmVyIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDhweDsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgbWluLWhlaWdodDogMTIwcHg7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQp9DQoNCi5pbWFnZS10aHVtYm5haWwgew0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIG9iamVjdC1maXQ6IGNvbnRhaW47DQogICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMnMgZWFzZTsNCn0NCg0KLmltYWdlLXRodW1ibmFpbDpob3ZlciB7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjA1KTsNCiAgICBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjIpOw0KfQ0KDQouaW1hZ2UtaW5mbyB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjA1KTsNCiAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDNweDsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLmltYWdlLWVycm9yIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDRweDsNCiAgICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLmltYWdlLWVycm9yIGkgew0KICAgIGZvbnQtc2l6ZTogMTZweDsNCn0NCg0KLyogSW1hZ2UgTW9kYWwgU3R5bGVzICovDQouaW1hZ2UtbW9kYWwgew0KICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICB0b3A6IDA7DQogICAgbGVmdDogMDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjgpOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICB6LWluZGV4OiAxMDAwOw0KICAgIHBhZGRpbmc6IDIwcHg7DQp9DQoNCi5pbWFnZS1tb2RhbC1jb250ZW50IHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA4cHg7DQogICAgbWF4LXdpZHRoOiA5MCU7DQogICAgbWF4LWhlaWdodDogOTAlOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDAsMCwwLDAuMyk7DQp9DQoNCi5pbWFnZS1tb2RhbC1oZWFkZXIgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgcGFkZGluZzogMTVweCAyMHB4Ow0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KfQ0KDQouaW1hZ2UtbW9kYWwtaGVhZGVyIHNwYW4gew0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQouaW1hZ2UtbW9kYWwtY2xvc2Ugew0KICAgIGJhY2tncm91bmQ6IG5vbmU7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGZvbnQtc2l6ZTogMjRweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHBhZGRpbmc6IDA7DQogICAgd2lkdGg6IDMwcHg7DQogICAgaGVpZ2h0OiAzMHB4Ow0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsNCn0NCg0KLmltYWdlLW1vZGFsLWNsb3NlOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMSk7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KfQ0KDQouaW1hZ2UtbW9kYWwtYm9keSB7DQogICAgcGFkZGluZzogMjBweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDE1cHg7DQogICAgbWF4LWhlaWdodDogY2FsYyg5MHZoIC0gMTAwcHgpOw0KICAgIG92ZXJmbG93LXk6IGF1dG87DQp9DQoNCi5pbWFnZS1tb2RhbC1pbWFnZSB7DQogICAgbWF4LXdpZHRoOiAxMDAlOw0KICAgIG1heC1oZWlnaHQ6IDcwdmg7DQogICAgb2JqZWN0LWZpdDogY29udGFpbjsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xKTsNCn0NCg0KLmltYWdlLW1vZGFsLWluZm8gew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wNSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQovKiBSYW5kb20gUXVvdGUgTm9kZSBTdHlsZXMgKi8NCi5xdW90ZS1jb250ZW50IHsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLnF1b3RlLXRleHQgew0KICAgIG1hcmdpbi1ib3R0b206IDhweDsNCiAgICBtaW4taGVpZ2h0OiA0MHB4Ow0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCn0NCg0KLnF1b3RlLWRpc3BsYXkgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LXN0eWxlOiBpdGFsaWM7DQogICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpOw0KICAgIGZvbnQtc2l6ZTogMTNweDsNCiAgICBsaW5lLWhlaWdodDogMS40Ow0KICAgIG1heC13aWR0aDogMTAwJTsNCiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQp9DQoNCi5xdW90ZS1pbmZvIHsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgIHBhZGRpbmctdG9wOiA4cHg7DQp9DQoNCi8qIExMTSBDaGF0IE5vZGUgU3R5bGVzICovDQoubGxtLXJlc3BvbnNlIHsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgyMywgMTYyLCAxODQsIDAuMSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG1hcmdpbjogNHB4IDA7DQp9DQoNCi5yZXNwb25zZS1wcmV2aWV3IHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgbGluZS1oZWlnaHQ6IDEuMzsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICAgIG1hcmdpbi1ib3R0b206IDRweDsNCn0NCg0KLnVzYWdlLWluZm8gew0KICAgIGZvbnQtc2l6ZTogMTBweDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHJnYmEoMCwwLDAsMC4xKTsNCiAgICBwYWRkaW5nLXRvcDogNHB4Ow0KfQ0KDQoubGxtLWVycm9yIHsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgyMjAsIDUzLCA2OSwgMC4xKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgbWFyZ2luOiA0cHggMDsNCiAgICBjb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA2cHg7DQp9DQoNCi5sbG0tZXJyb3IgaSB7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KfQ0KDQovKiBUZXh0IE5vZGUgU3R5bGVzICovDQoudGV4dC1jb250ZW50IHsNCiAgICBwYWRkaW5nOiA4cHg7DQogICAgYmFja2dyb3VuZDogcmdiYSgxMDgsIDExNywgMTI1LCAwLjEpOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBtYXJnaW46IDRweCAwOw0KfQ0KDQoudGV4dC1wcmV2aWV3IHsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgbGluZS1oZWlnaHQ6IDEuMzsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICAgIG1hcmdpbi1ib3R0b206IDRweDsNCn0NCg0KLnRleHQtaW5mbyB7DQogICAgZm9udC1zaXplOiAxMHB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgwLDAsMCwwLjEpOw0KICAgIHBhZGRpbmctdG9wOiA0cHg7DQp9DQoNCi8qIE5vZGUgU3RhdHVzIERpc3BsYXkgKi8NCi5ub2RlLXN0YXR1cyB7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4wNSk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG1hcmdpbjogNHB4IDA7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQouc3RhdHVzLXRleHQgew0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogNTAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICBtYXJnaW4tYm90dG9tOiA0cHg7DQp9DQoNCi5zdGF0dXMtaW5mbyB7DQogICAgZm9udC1zaXplOiAxMHB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCn0NCg0KLyogQ29udGVudCBEaXNwbGF5IGluIENvbmZpZyBQYW5lbCAqLw0KLmNvbnRlbnQtZGlzcGxheSB7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjA1KTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgcGFkZGluZzogMTJweDsNCiAgICBtYXJnaW4tdG9wOiA4cHg7DQp9DQoNCi5jb250ZW50LXRleHQgew0KICAgIG1hcmdpbjogMDsNCiAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBsaW5lLWhlaWdodDogMS40Ow0KICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsNCiAgICB3b3JkLWJyZWFrOiBicmVhay13b3JkOw0KICAgIG1heC1oZWlnaHQ6IDMwMHB4Ow0KICAgIG92ZXJmbG93LXk6IGF1dG87DQogICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jb2xvcik7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgcGFkZGluZzogOHB4Ow0KICAgIHVzZXItc2VsZWN0OiB0ZXh0Ow0KfQ0KDQouY29udGVudC1pbmZvIHsNCiAgICBtYXJnaW4tdG9wOiA4cHg7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi8qIFRlcm1pbmFsIE5vZGUgU3R5bGVzICovDQoudGVybWluYWwtZXJyb3Igew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBwYWRkaW5nOiA4cHggMTJweDsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDIyMCwgNTMsIDY5LCAwLjEpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgbWFyZ2luLXRvcDogOHB4Ow0KfQ0KDQoudGVybWluYWwtZXJyb3IgaSB7DQogICAgbWFyZ2luLXJpZ2h0OiA4cHg7DQogICAgY29sb3I6IHZhcigtLWVycm9yLWNvbG9yKTsNCn0NCg0KDQovKiA9PT09PSBTdHlsZTogY3NzL3Jlc3BvbnNpdmUuY3NzID09PT09ICovDQovKiBGbG93IEVkaXRvciBSZXNwb25zaXZlIERlc2lnbiAmIEVmZmVjdHMgKi8NCg0KLyogSGFtYnVyZ2VyIE1lbnUgU3R5bGVzIC0gQWx3YXlzIHZpc2libGUgKi8NCi5oYW1idXJnZXItYnRuIHsNCiAgICBwYWRkaW5nOiA4cHggMTJweDsNCn0NCg0KLmRyb3Bkb3duLW1lbnUgew0KICAgIGRpc3BsYXk6IG5vbmU7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY29sb3IpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlci1jb2xvcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLCAwLCAwLCAwLjIpOw0KICAgIHotaW5kZXg6IDk5OTk7DQogICAgbWluLXdpZHRoOiAxODBweDsNCiAgICB3aWR0aDogMTgwcHg7DQogICAgbWF4LWhlaWdodDogNzB2aDsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KICAgIHBhZGRpbmc6IDA7DQogICAgbWFyZ2luOiAwOw0KfQ0KDQouZHJvcGRvd24tbWVudS5zaG93IHsNCiAgICBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50Ow0KfQ0KDQoubWVudS1zZWN0aW9uIHsNCiAgICBwYWRkaW5nOiA4cHggMDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsNCn0NCg0KLm1lbnUtc2VjdGlvbjpsYXN0LWNoaWxkIHsNCiAgICBib3JkZXItYm90dG9tOiBub25lOw0KfQ0KDQoubWVudS1zZWN0aW9uLXRpdGxlIHsNCiAgICBwYWRkaW5nOiA4cHggMTZweDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7DQogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsNCiAgICBsZXR0ZXItc3BhY2luZzogMC41cHg7DQp9DQoNCi5tZW51LWl0ZW0gew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBnYXA6IDEwcHg7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogMTBweCAxNnB4Ow0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1jb2xvcik7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZTsNCiAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KfQ0KDQoubWVudS1pdGVtOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ib3JkZXItY29sb3IpOw0KfQ0KDQoubWVudS1pdGVtLmRhbmdlciB7DQogICAgY29sb3I6ICNmZjZiNmI7DQp9DQoNCi5tZW51LWl0ZW0uZGFuZ2VyOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMTA3LCAxMDcsIDAuMSk7DQp9DQoNCi5tZW51LXpvb20tY29udHJvbHMgew0KICAgIHBhZGRpbmc6IDAgMTZweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgZ2FwOiA0cHg7DQp9DQoNCi5tZW51LXpvb20tbGV2ZWwgew0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBmb250LXdlaWdodDogNTAwOw0KICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgcGFkZGluZzogNHB4IDA7DQogICAgYmFja2dyb3VuZDogdmFyKC0tYm9yZGVyLWNvbG9yKTsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgbWFyZ2luOiA0cHggMDsNCn0NCg0KLnpvb20tYnRuIHsNCiAgICBwYWRkaW5nOiA2cHggMTJweCAhaW1wb3J0YW50Ow0KICAgIGZvbnQtc2l6ZTogMTJweCAhaW1wb3J0YW50Ow0KfQ0KDQovKiBSZXNwb25zaXZlIERlc2lnbiAqLw0KQG1lZGlhIChtYXgtd2lkdGg6IDEyMDBweCkgew0KICAgIC5mbG93LWVkaXRvciB7DQogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgICAgIG1pbi1oZWlnaHQ6IDA7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LXRvb2xib3ggew0KICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgaGVpZ2h0OiBhdXRvOw0KICAgICAgICBib3JkZXItcmlnaHQ6IG5vbmU7DQogICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgICAgICBmbGV4LXNocmluazogMDsNCiAgICAgICAgbWF4LWhlaWdodDogMjAwcHg7DQogICAgfQ0KICAgIA0KICAgIC50b29sYm94LWNvbnRlbnQgew0KICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICBmbGV4LXdyYXA6IHdyYXA7DQogICAgICAgIGdhcDogMTBweDsNCiAgICAgICAgcGFkZGluZzogMTVweDsNCiAgICAgICAgb3ZlcmZsb3cteTogYXV0bzsNCiAgICB9DQogICAgDQogICAgLm5vZGUtY2F0ZWdvcnkgew0KICAgICAgICBtYXJnaW4tYm90dG9tOiAwOw0KICAgICAgICBmbGV4OiAxOw0KICAgICAgICBtaW4td2lkdGg6IDIwMHB4Ow0KICAgIH0NCiAgICANCiAgICAuZmxvdy13b3Jrc3BhY2Ugew0KICAgICAgICBmbGV4OiAxOw0KICAgICAgICBtaW4taGVpZ2h0OiAwOw0KICAgIH0NCiAgICANCiAgICAuZmxvdy1jb25maWctcGFuZWwgew0KICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgYm9yZGVyLWxlZnQ6IG5vbmU7DQogICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOw0KICAgICAgICBmbGV4LXNocmluazogMDsNCiAgICAgICAgbWF4LWhlaWdodDogMzAwcHg7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LW91dHB1dC1wYW5lbCB7DQogICAgICAgIG1heC1oZWlnaHQ6IDIwMHB4Ow0KICAgIH0NCiAgICANCiAgICAub3V0cHV0LWNvbnRlbnQgew0KICAgICAgICBtYXgtaGVpZ2h0OiAxNTBweDsNCiAgICB9DQp9DQoNCkBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgew0KICAgIC5hcHAtY29udGVudCB7DQogICAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgICAgZ2FwOiA1cHg7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LXRvb2xiYXIgew0KICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgICAgICBnYXA6IDEwcHg7DQogICAgICAgIHBhZGRpbmc6IDhweCAxNXB4Ow0KICAgIH0NCiAgICANCiAgICAudG9vbGJhci1sZWZ0LA0KICAgIC50b29sYmFyLXJpZ2h0IHsNCiAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICBmbGV4LXdyYXA6IHdyYXA7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LXRvb2xiYXIgLmJ0biB7DQogICAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICAgICAgcGFkZGluZzogNnB4IDEwcHg7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LXRvb2xib3ggew0KICAgICAgICBtYXgtaGVpZ2h0OiAxNTBweDsNCiAgICB9DQogICAgDQogICAgLmZsb3ctY29uZmlnLXBhbmVsIHsNCiAgICAgICAgbWF4LWhlaWdodDogMjUwcHg7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LW91dHB1dC1wYW5lbCB7DQogICAgICAgIG1heC1oZWlnaHQ6IDE1MHB4Ow0KICAgIH0NCiAgICANCiAgICAub3V0cHV0LWNvbnRlbnQgew0KICAgICAgICBtYXgtaGVpZ2h0OiAxMDBweDsNCiAgICAgICAgcGFkZGluZzogMTBweDsNCiAgICB9DQp9DQoNCkBtZWRpYSAobWF4LXdpZHRoOiA0ODBweCkgew0KICAgIC50b29sYmFyLWxlZnQsDQogICAgLnRvb2xiYXItcmlnaHQgew0KICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgICAgICBnYXA6IDVweDsNCiAgICAgICAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7DQogICAgfQ0KICAgIA0KICAgIC5mbG93LXRvb2xiYXIgLmJ0biB7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgfQ0KICAgIA0KICAgIC56b29tLWNvbnRyb2xzIHsNCiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgfQ0KfQ0KDQoNCi8qID09PT09IFN0eWxlOiBjc3Mvb3MtdGhlbWUuY3NzID09PT09ICovDQovKiBGbG93IEVkaXRvciAtIFN5cG5leE9TIFRoZW1lIEludGVncmF0aW9uICovDQovKiBUaGlzIGZpbGUgZW5zdXJlcyB0aGUgZmxvdyBlZGl0b3IgbWF0Y2hlcyB0aGUgT1MgYWVzdGhldGljIHBlcmZlY3RseSAqLw0KDQo6cm9vdCB7DQogICAgLyogT3ZlcnJpZGUgZmxvdyBlZGl0b3IgdmFyaWFibGVzIHdpdGggT1MgdmFyaWFibGVzICovDQogICAgLS1zdXJmYWNlLWNvbG9yOiB2YXIoLS1nbGFzcy1iZyk7DQogICAgLS1ib3JkZXItY29sb3I6IHZhcigtLWdsYXNzLWJvcmRlcik7DQogICAgLS10ZXh0LWNvbG9yOiB2YXIoLS10ZXh0LXByaW1hcnkpOw0KICAgIC0tdGV4dC1tdXRlZDogdmFyKC0tdGV4dC1zZWNvbmRhcnkpOw0KICAgIC0tcHJpbWFyeS1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCiAgICAtLXByaW1hcnktY29sb3ItcmdiOiAwLCAyMTIsIDI1NTsNCiAgICAtLWVycm9yLWNvbG9yOiAjZmY0NzU3Ow0KICAgIC0tc3VjY2Vzcy1jb2xvcjogIzJlZDU3MzsNCiAgICAtLXdhcm5pbmctY29sb3I6ICNmZmE1MDI7DQp9DQoNCi8qIEVuaGFuY2VkIGdsYXNzIG1vcnBoaXNtIGZvciBmbG93IGVkaXRvciAqLw0KLmZsb3ctZWRpdG9yIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1nbGFzcy1iZyk7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZ2xhc3MtYm9yZGVyKTsNCiAgICBib3JkZXItcmFkaXVzOiAxMnB4Ow0KICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsNCiAgICBib3gtc2hhZG93OiAwIDhweCAzMnB4IHJnYmEoMCwgMCwgMCwgMC4zKTsNCn0NCg0KLyogVG9vbGJveCB3aXRoIGJldHRlciBnbGFzcyBlZmZlY3QgKi8NCi5mbG93LXRvb2xib3ggew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMjYsIDI2LCAyNiwgMC45KTsNCiAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCB2YXIoLS1nbGFzcy1ib3JkZXIpOw0KICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxNXB4KTsNCn0NCg0KLnRvb2xib3gtaGVhZGVyIHsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDEwLCAxMCwgMTAsIDAuOCk7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHZhcigtLWdsYXNzLWJvcmRlcik7DQp9DQoNCi50b29sYm94LWhlYWRlciBoNCB7DQogICAgY29sb3I6IHZhcigtLWFjY2VudC1jb2xvcik7DQogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMjEyLCAyNTUsIDAuMyk7DQp9DQoNCi8qIEVuaGFuY2VkIG5vZGUgc3R5bGluZyB3aXRoIGdsYXNzIG1vcnBoaXNtICovDQouZmxvdy1ub2RlIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1nbGFzcy1iZyk7DQogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZ2xhc3MtYm9yZGVyKTsNCiAgICBib3JkZXItcmFkaXVzOiAxMnB4Ow0KICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsNCiAgICBib3gtc2hhZG93OiAwIDRweCAyMHB4IHJnYmEoMCwgMCwgMCwgMC4yKTsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlOw0KfQ0KDQouZmxvdy1ub2RlOmhvdmVyIHsNCiAgICBib3gtc2hhZG93OiAwIDhweCAzMnB4IHJnYmEoMCwgMjEyLCAyNTUsIDAuMik7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCn0NCg0KLmZsb3ctbm9kZS5zZWxlY3RlZCB7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpOw0KICAgIGJveC1zaGFkb3c6IDAgMCAwIDNweCByZ2JhKDAsIDIxMiwgMjU1LCAwLjMpOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMjEyLCAyNTUsIDAuMDUpOw0KfQ0KDQovKiBOb2RlIHBvcnRzIHdpdGggbmVvbiBnbG93ICovDQouZmxvdy1ub2RlLXBvcnQgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWdsYXNzLWJnKTsNCiAgICBib3JkZXI6IDJweCBzb2xpZCB2YXIoLS1nbGFzcy1ib3JkZXIpOw0KICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMCwgMCwgMC41KTsNCiAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlOw0KfQ0KDQouZmxvdy1ub2RlLXBvcnQ6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWFjY2VudC1jb2xvcik7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpOw0KICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4IHJnYmEoMCwgMjEyLCAyNTUsIDAuOCk7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjMpOw0KfQ0KDQovKiBDb25uZWN0aW9uIGxpbmVzIHdpdGggbmVvbiBlZmZlY3QgKi8NCi5mbG93LWNvbm5lY3Rpb24tbGluZSB7DQogICAgc3Ryb2tlOiB2YXIoLS1nbGFzcy1ib3JkZXIpOw0KICAgIHN0cm9rZS13aWR0aDogMzsNCiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAzcHggcmdiYSgwLCAyMTIsIDI1NSwgMC4zKSk7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsNCn0NCg0KLmZsb3ctY29ubmVjdGlvbi1saW5lOmhvdmVyLA0KLmZsb3ctY29ubmVjdGlvbi1saW5lLmNvbm5lY3RlZCB7DQogICAgc3Ryb2tlOiB2YXIoLS1hY2NlbnQtY29sb3IpOw0KICAgIHN0cm9rZS13aWR0aDogNDsNCiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCA4cHggcmdiYSgwLCAyMTIsIDI1NSwgMC44KSk7DQp9DQoNCi8qIFRvb2xiYXIgd2l0aCBnbGFzcyBlZmZlY3QgKi8NCi5mbG93LXRvb2xiYXIgew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMTAsIDEwLCAxMCwgMC45KTsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0tZ2xhc3MtYm9yZGVyKTsNCiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTVweCk7DQp9DQoNCi8qIEVuaGFuY2VkIGJ1dHRvbiBzdHlsaW5nICovDQoudG9vbGJveC1ub2RlLWJ0biB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZ2xhc3MtYmcpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWdsYXNzLWJvcmRlcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7DQogICAgY29sb3I6IHZhcigtLXRleHQtcHJpbWFyeSk7DQp9DQoNCi50b29sYm94LW5vZGUtYnRuOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDIxMiwgMjU1LCAwLjEpOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQogICAgYm94LXNoYWRvdzogMCA0cHggMTVweCByZ2JhKDAsIDIxMiwgMjU1LCAwLjIpOw0KICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpOw0KfQ0KDQovKiBGbG93IHRvb2xiYXIgYnV0dG9ucyAqLw0KLmZsb3ctdG9vbGJhciAuYnRuIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1nbGFzcy1iZyk7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZ2xhc3MtYm9yZGVyKTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1wcmltYXJ5KTsNCiAgICBib3JkZXItcmFkaXVzOiA4cHg7DQogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEwcHgpOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7DQp9DQoNCi5mbG93LXRvb2xiYXIgLmJ0bjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLCAyMTIsIDI1NSwgMC4xKTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLWFjY2VudC1jb2xvcik7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOw0KICAgIGJveC1zaGFkb3c6IDAgNHB4IDE1cHggcmdiYSgwLCAyMTIsIDI1NSwgMC4yKTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLXN1Y2Nlc3Mgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWFjY2VudC1jb2xvcik7DQogICAgY29sb3I6IHZhcigtLXByaW1hcnktYmcpOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCn0NCg0KLmZsb3ctdG9vbGJhciAuYnRuLXN1Y2Nlc3M6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHZhcigtLWFjY2VudC1ob3Zlcik7DQogICAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDAsIDIxMiwgMjU1LCAwLjQpOw0KfQ0KDQouZmxvdy10b29sYmFyIC5idG4tZGFuZ2VyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1lcnJvci1jb2xvcik7DQogICAgY29sb3I6IHdoaXRlOw0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KfQ0KDQouZmxvdy10b29sYmFyIC5idG4tZGFuZ2VyOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiAjZmYzNzQyOw0KICAgIGJveC1zaGFkb3c6IDAgNHB4IDIwcHggcmdiYSgyNTUsIDcxLCA4NywgMC40KTsNCn0NCg0KLyogTm9kZSB0eXBlIHN0eWxpbmcgKi8NCi5mbG93LW5vZGUtdHlwZSB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50LWNvbG9yKTsNCiAgICBjb2xvcjogdmFyKC0tcHJpbWFyeS1iZyk7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgICB0ZXh0LXNoYWRvdzogbm9uZTsNCiAgICBib3JkZXItcmFkaXVzOiA2cHg7DQp9DQoNCi8qIE5vZGUgZGVsZXRlIGJ1dHRvbiAqLw0KLm5vZGUtZGVsZXRlLWJ0biB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGJvcmRlcjogMnB4IHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKTsNCiAgICBib3gtc2hhZG93OiAwIDJweCAxMHB4IHJnYmEoMjU1LCA3MSwgODcsIDAuMyk7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsNCn0NCg0KLm5vZGUtZGVsZXRlLWJ0bjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogI2ZmMzc0MjsNCiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7DQogICAgYm94LXNoYWRvdzogMCA0cHggMTVweCByZ2JhKDI1NSwgNzEsIDg3LCAwLjUpOw0KfQ0KDQovKiBDdXJyZW50IGZpbGVuYW1lIHN0eWxpbmcgKi8NCi5jdXJyZW50LWZpbGVuYW1lIHsNCiAgICBjb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHJnYmEoMCwgMjEyLCAyNTUsIDAuMyk7DQp9DQoNCi8qIFpvb20gY29udHJvbHMgKi8NCi56b29tLWNvbnRyb2xzIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZ2FwOiA4cHg7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZ2xhc3MtYmcpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWdsYXNzLWJvcmRlcik7DQogICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgIHBhZGRpbmc6IDRweDsNCiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7DQp9DQoNCi56b29tLWxldmVsIHsNCiAgICBjb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKTsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIG1pbi13aWR0aDogNDVweDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KfQ0KDQovKiBMb2FkaW5nIHN0YXRlICovDQoubG9hZGluZy1ub2RlcyB7DQogICAgY29sb3I6IHZhcigtLXRleHQtc2Vjb25kYXJ5KTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgcGFkZGluZzogMjBweDsNCiAgICBmb250LXN0eWxlOiBpdGFsaWM7DQp9DQoNCi8qIE5vZGUgY2F0ZWdvcmllcyAqLw0KLm5vZGUtY2F0ZWdvcnkgaDUgew0KICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpOw0KICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7DQogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsNCiAgICBmb250LXdlaWdodDogNzAwOw0KICAgIGZvbnQtc2l6ZTogMTFweDsNCn0NCg0KLyogQ2FudmFzIHRhZ3MgYW5kIGNvbmZpZ3VyYXRpb24gbGlzdCB0YWdzICovDQouZmxvdy10YWcsDQouYXJlYS10YWcsDQoudGFnLWl0ZW0sDQouY2FudmFzLXRhZyB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50LWNvbG9yKSAhaW1wb3J0YW50Ow0KICAgIGNvbG9yOiB2YXIoLS1wcmltYXJ5LWJnKSAhaW1wb3J0YW50Ow0KICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLWFjY2VudC1jb2xvcikgIWltcG9ydGFudDsNCiAgICBib3JkZXItcmFkaXVzOiA4cHg7DQogICAgYm94LXNoYWRvdzogMCAycHggMTBweCByZ2JhKDAsIDIxMiwgMjU1LCAwLjMpOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7DQp9DQoNCi5mbG93LXRhZzpob3ZlciwNCi5hcmVhLXRhZzpob3ZlciwNCi50YWctaXRlbTpob3ZlciwNCi5jYW52YXMtdGFnOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQtaG92ZXIpICFpbXBvcnRhbnQ7DQogICAgYm94LXNoYWRvdzogMCA0cHggMTVweCByZ2JhKDAsIDIxMiwgMjU1LCAwLjUpOw0KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsNCn0NCg0KLyogVGFnIHRleHQgYW5kIGljb25zICovDQouZmxvdy10YWcgLnRhZy10ZXh0LA0KLmFyZWEtdGFnIC50YWctdGV4dCwNCi50YWctaXRlbSAudGFnLXRleHQsDQouY2FudmFzLXRhZyAudGFnLXRleHQsDQouZmxvdy10YWcgaSwNCi5hcmVhLXRhZyBpLA0KLnRhZy1pdGVtIGksDQouY2FudmFzLXRhZyBpIHsNCiAgICBjb2xvcjogdmFyKC0tcHJpbWFyeS1iZykgIWltcG9ydGFudDsNCn0NCg0KLyogVGFnIGluZGljYXRvciBjaXJjbGVzL2RvdHMgaW4gY29uZmlndXJhdGlvbiBhcmVhICovDQoudGFnLWluZGljYXRvciwNCi50YWctY29sb3ItaW5kaWNhdG9yLA0KLnRhZy1jaXJjbGUsDQoudGFnLWRvdCwNCi5hcmVhLXRhZy1pbmRpY2F0b3IsDQoudGFnLWNvbG9yIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpICFpbXBvcnRhbnQ7DQogICAgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50LWNvbG9yKSAhaW1wb3J0YW50Ow0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50LWNvbG9yKSAhaW1wb3J0YW50Ow0KfQ0KDQovKiBUYWcgaXRlbXMgaW4gY29uZmlndXJhdGlvbiBsaXN0IC0gbWF0Y2ggbm9kZSBsaXN0IHN0eWxpbmcgKi8NCi50YWctaXRlbSB7DQogICAgYmFja2dyb3VuZDogdmFyKC0tZ2xhc3MtYmcpICFpbXBvcnRhbnQ7DQogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZ2xhc3MtYm9yZGVyKSAhaW1wb3J0YW50Ow0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1wcmltYXJ5KSAhaW1wb3J0YW50Ow0KfQ0KDQoudGFnLWl0ZW06aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMjEyLCAyNTUsIDAuMSkgIWltcG9ydGFudDsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLWFjY2VudC1jb2xvcikgIWltcG9ydGFudDsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7DQogICAgYm94LXNoYWRvdzogMCA0cHggMTVweCByZ2JhKDAsIDIxMiwgMjU1LCAwLjIpOw0KfQ0KDQoudGFnLWl0ZW0gLnRhZy1uYW1lIHsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1wcmltYXJ5KSAhaW1wb3J0YW50Ow0KfQ0KDQoudGFnLWl0ZW0gLnRhZy1pbmZvIHsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1wcmltYXJ5KSAhaW1wb3J0YW50Ow0KfQ0KDQovKiBUYWcgZGVsZXRlIGJ1dHRvbiBzdHlsaW5nICovDQoudGFnLWRlbGV0ZSwNCi50YWctaXRlbSAudGFnLWRlbGV0ZSB7DQogICAgY29sb3I6IHZhcigtLXRleHQtcHJpbWFyeSkgIWltcG9ydGFudDsNCiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudCAhaW1wb3J0YW50Ow0KICAgIGJvcmRlcjogbm9uZSAhaW1wb3J0YW50Ow0KfQ0KDQoudGFnLWRlbGV0ZTpob3ZlciwNCi50YWctaXRlbSAudGFnLWRlbGV0ZTpob3ZlciB7DQogICAgY29sb3I6IHZhcigtLWFjY2VudC1jb2xvcikgIWltcG9ydGFudDsNCn0NCg0KLnRhZy1kZWxldGUgaSwNCi50YWctaXRlbSAudGFnLWRlbGV0ZSBpIHsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1wcmltYXJ5KSAhaW1wb3J0YW50Ow0KfQ0KDQoudGFnLWRlbGV0ZTpob3ZlciBpLA0KLnRhZy1pdGVtIC50YWctZGVsZXRlOmhvdmVyIGkgew0KICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29sb3IpICFpbXBvcnRhbnQ7DQp9DQoNCi8qIENvbmZpZ3VyYXRpb24gYXJlYSBoZWFkZXIgdGV4dCAqLw0KLmNvbmZpZy1oZWFkZXIsDQouY29uZmlndXJhdGlvbi1oZWFkZXIsDQouZmxvdy1jb25maWctaGVhZGVyLA0KLmNvbmZpZy1wbGFjZWhvbGRlciwNCi5jb25maWd1cmF0aW9uLXBsYWNlaG9sZGVyLA0KLmZsb3ctY29uZmlnLWFyZWEgcCwNCi5mbG93LWNvbmZpZy1hcmVhIC5wbGFjZWhvbGRlciwNCi5mbG93LWNvbmZpZy1hcmVhIC5jb25maWctbWVzc2FnZSwNCi5jb25maWctYXJlYSBwLA0KLmNvbmZpZy1hcmVhIC5wbGFjZWhvbGRlciwNCi5jb25maWctYXJlYSAuY29uZmlnLW1lc3NhZ2UsDQouZmxvdy1jb25maWd1cmF0aW9uIHAsDQouZmxvdy1jb25maWd1cmF0aW9uIC5wbGFjZWhvbGRlciwNCi50ZXh0LW11dGVkIHsNCiAgICBjb2xvcjogdmFyKC0tdGV4dC1zZWNvbmRhcnkpICFpbXBvcnRhbnQ7DQp9DQoNCi8qIFJ1bm5pbmcgc3RhdGUgd2l0aCBwdWxzaW5nIGVmZmVjdCAqLw0KLmZsb3ctbm9kZS5ydW5uaW5nIHsNCiAgICBhbmltYXRpb246IHB1bHNlLW5lb24gMnMgaW5maW5pdGU7DQogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zdWNjZXNzLWNvbG9yKTsNCn0NCg0KQGtleWZyYW1lcyBwdWxzZS1uZW9uIHsNCiAgICAwJSwgMTAwJSB7IA0KICAgICAgICBib3gtc2hhZG93OiAwIDAgNXB4IHJnYmEoNDYsIDIxMywgMTE1LCAwLjUpOw0KICAgIH0NCiAgICA1MCUgeyANCiAgICAgICAgYm94LXNoYWRvdzogMCAwIDIwcHggcmdiYSg0NiwgMjEzLCAxMTUsIDAuOCksIDAgMCAzMHB4IHJnYmEoNDYsIDIxMywgMTE1LCAwLjQpOw0KICAgIH0NCn0NCg0KLyogRXJyb3Igc3RhdGUgKi8NCi5mbG93LW5vZGUuZXJyb3Igew0KICAgIGJvcmRlci1jb2xvcjogdmFyKC0tZXJyb3ItY29sb3IpOw0KICAgIGFuaW1hdGlvbjogcHVsc2UtZXJyb3ItbmVvbiAxcyBpbmZpbml0ZTsNCn0NCg0KQGtleWZyYW1lcyBwdWxzZS1lcnJvci1uZW9uIHsNCiAgICAwJSwgMTAwJSB7IA0KICAgICAgICBib3gtc2hhZG93OiAwIDAgNXB4IHJnYmEoMjU1LCA3MSwgODcsIDAuNSk7DQogICAgfQ0KICAgIDUwJSB7IA0KICAgICAgICBib3gtc2hhZG93OiAwIDAgMjBweCByZ2JhKDI1NSwgNzEsIDg3LCAwLjgpLCAwIDAgMzBweCByZ2JhKDI1NSwgNzEsIDg3LCAwLjQpOw0KICAgIH0NCn0NCg0KLyogUmVzcG9uc2l2ZSBhZGp1c3RtZW50cyAqLw0KQG1lZGlhIChtYXgtd2lkdGg6IDc2OHB4KSB7DQogICAgLmZsb3ctdG9vbGJveCB7DQogICAgICAgIHdpZHRoOiAyMDBweDsNCiAgICB9DQogICAgDQogICAgLmZsb3ctbm9kZSB7DQogICAgICAgIG1pbi13aWR0aDogMTIwcHg7DQogICAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICB9DQogICAgDQogICAgLnRvb2xib3gtbm9kZS1idG4gew0KICAgICAgICBwYWRkaW5nOiA4cHggMTBweDsNCiAgICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIH0NCn0NCjwvc3R5bGU+DQo8c2NyaXB0Pi8vID09PT09IFNjcmlwdDoganMvdXRpbHMuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL25vZGUtcmVnaXN0cnkuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL2NhbnZhcy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvbm9kZS1jb25maWcuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL25vZGUtcmVuZGVyZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL2RhdGEtZXhlY3V0b3JzLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9odHRwLWV4ZWN1dG9ycy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvbWVkaWEtZXhlY3V0b3JzLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9mbG93LWV4ZWN1dG9ycy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvYWktZXhlY3V0b3JzLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9leGVjdXRpb24tZW5naW5lLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy93b3JrZmxvdy5qcyA9PT09PQ0KDQoNCi8vID09PT09IFNjcmlwdDoganMvY2FudmFzLW1hbmFnZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL3RhZy1tYW5hZ2VyLmpzID09PT09DQoNCg0KLy8gPT09PT0gU2NyaXB0OiBqcy9maWxlLW1hbmFnZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL3VpLW1hbmFnZXIuanMgPT09PT0NCg0KDQovLyA9PT09PSBTY3JpcHQ6IGpzL21haW4uanMgPT09PT0NCg0KDQovLyB1dGlscy5qcyAtIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBGbG93IEVkaXRvcg0KDQovLyBDYW52YXMtc3BlY2lmaWMgY29vcmRpbmF0ZSB0cmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMNCi8vIChBcHAgc2NhbGluZyB1dGlsaXRpZXMgYXJlIG5vdyBjZW50cmFsaXplZCBpbiBzeXBuZXhBUEkuc2NhbGluZykNCg0KLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBlc2NhcGUgSFRNTA0KZnVuY3Rpb24gZXNjYXBlSHRtbCh0ZXh0KSB7DQogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgZGl2LnRleHRDb250ZW50ID0gdGV4dDsNCiAgICByZXR1cm4gZGl2LmlubmVySFRNTDsNCn0NCg0KLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBmb3JtYXQgZmlsZSBzaXplDQpmdW5jdGlvbiBmb3JtYXRGaWxlU2l6ZShieXRlcykgew0KICAgIGlmIChieXRlcyA9PT0gMCkgcmV0dXJuICcwIEJ5dGVzJzsNCiAgICBjb25zdCBrID0gMTAyNDsNCiAgICBjb25zdCBzaXplcyA9IFsnQnl0ZXMnLCAnS0InLCAnTUInLCAnR0InXTsNCiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhrKSk7DQogICAgcmV0dXJuIHBhcnNlRmxvYXQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMikpICsgJyAnICsgc2l6ZXNbaV07DQp9DQoNCi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gZGVib3VuY2UgZnVuY3Rpb24gY2FsbHMNCmZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMsIHdhaXQpIHsNCiAgICBsZXQgdGltZW91dDsNCiAgICByZXR1cm4gZnVuY3Rpb24gZXhlY3V0ZWRGdW5jdGlvbiguLi5hcmdzKSB7DQogICAgICAgIGNvbnN0IGxhdGVyID0gKCkgPT4gew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOw0KICAgICAgICAgICAgZnVuYyguLi5hcmdzKTsNCiAgICAgICAgfTsNCiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOw0KICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7DQogICAgfTsNCn0NCg0KDQovLyBIZWxwZXIgbWV0aG9kIGZvciB0ZW1wbGF0ZSBwcm9jZXNzaW5nDQpmdW5jdGlvbiBwcm9jZXNzVGVtcGxhdGVzKHRlbXBsYXRlLCBkYXRhKSB7DQogICAgbGV0IHJlc3VsdCA9IHRlbXBsYXRlOw0KICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgZGF0YSAhPT0gbnVsbCkgew0KICAgICAgICAvLyBDaGVjayBpZiBkYXRhLmRhdGEgaXMgYSBKU09OIHN0cmluZyBhbmQgdHJ5IHRvIHBhcnNlIGl0DQogICAgICAgIGxldCB0ZW1wbGF0ZURhdGEgPSBkYXRhOw0KICAgICAgICBpZiAoZGF0YS5kYXRhICYmIHR5cGVvZiBkYXRhLmRhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZERhdGEgPSBKU09OLnBhcnNlKGRhdGEuZGF0YSk7DQogICAgICAgICAgICAgICAgLy8gTWVyZ2UgdGhlIHBhcnNlZCBKU09OIHdpdGggdGhlIG9yaWdpbmFsIGRhdGEgb2JqZWN0DQogICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhID0geyAuLi5kYXRhLCAuLi5wYXJzZWREYXRhIH07DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgLy8gSWYgcGFyc2luZyBmYWlscywganVzdCB1c2UgdGhlIG9yaWdpbmFsIGRhdGENCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZURhdGEgPSBkYXRhOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBGaW5kIGFsbCB0ZW1wbGF0ZSBwYXR0ZXJucyBsaWtlIHt7a2V5fX0gb3Ige3twYXRoLnRvLnZhbHVlfX0NCiAgICAgICAgY29uc3QgdGVtcGxhdGVQYXR0ZXJuID0gL1x7XHsoW159XSspXH1cfS9nOw0KICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSh0ZW1wbGF0ZVBhdHRlcm4sIChtYXRjaCwgcGF0aCkgPT4gew0KICAgICAgICAgICAgLy8gVHJ5IHRvIGdldCBuZXN0ZWQgdmFsdWUgdXNpbmcgZG90IG5vdGF0aW9uDQogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV4dHJhY3ROZXN0ZWRWYWx1ZSh0ZW1wbGF0ZURhdGEsIHBhdGgpOw0KICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSB2YWx1ZSBpZiBmb3VuZCwgb3RoZXJ3aXNlIGtlZXAgdGhlIG9yaWdpbmFsIHRlbXBsYXRlDQogICAgICAgICAgICByZXR1cm4gdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDogbWF0Y2g7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQovLyBIZWxwZXIgbWV0aG9kIGZvciBleHRyYWN0aW5nIG5lc3RlZCBKU09OIHZhbHVlcw0KZnVuY3Rpb24gZXh0cmFjdE5lc3RlZFZhbHVlKG9iaiwgcGF0aCkgew0KICAgIGNvbnN0IGtleXMgPSBwYXRoLnNwbGl0KCcuJyk7DQogICAgbGV0IGN1cnJlbnQgPSBvYmo7DQoNCiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7DQogICAgICAgIGlmIChjdXJyZW50ID09PSBudWxsIHx8IGN1cnJlbnQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBIYW5kbGUgYXJyYXkgYWNjZXNzIGxpa2UgIml0ZW1zWzBdLm5hbWUiDQogICAgICAgIGNvbnN0IGFycmF5TWF0Y2ggPSBrZXkubWF0Y2goL14oLispXFsoXGQrKVxdJC8pOw0KICAgICAgICBpZiAoYXJyYXlNYXRjaCkgew0KICAgICAgICAgICAgY29uc3QgYXJyYXlLZXkgPSBhcnJheU1hdGNoWzFdOw0KICAgICAgICAgICAgY29uc3QgYXJyYXlJbmRleCA9IHBhcnNlSW50KGFycmF5TWF0Y2hbMl0pOw0KDQogICAgICAgICAgICBpZiAoY3VycmVudFthcnJheUtleV0gJiYgQXJyYXkuaXNBcnJheShjdXJyZW50W2FycmF5S2V5XSkpIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudFthcnJheUtleV1bYXJyYXlJbmRleF07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnRba2V5XTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiBjdXJyZW50Ow0KfQ0KDQovLyBIZWxwZXIgbWV0aG9kIHRvIGRldGVjdCBpbWFnZSB0eXBlIGZyb20gYmFzZTY0IGRhdGENCmZ1bmN0aW9uIGRldGVjdEltYWdlVHlwZUZyb21CYXNlNjQoYmFzZTY0RGF0YSkgew0KICAgIC8vIENoZWNrIHRoZSBmaXJzdCBmZXcgYnl0ZXMgdG8gZGV0ZXJtaW5lIGltYWdlIHR5cGUNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBiaW5hcnlTdHJpbmcgPSBhdG9iKGJhc2U2NERhdGEpOw0KICAgICAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJpbmFyeVN0cmluZy5sZW5ndGgpOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpbmFyeVN0cmluZy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENoZWNrIGZpbGUgc2lnbmF0dXJlcw0KICAgICAgICBpZiAoYnl0ZXNbMF0gPT09IDB4RkYgJiYgYnl0ZXNbMV0gPT09IDB4RDggJiYgYnl0ZXNbMl0gPT09IDB4RkYpIHsNCiAgICAgICAgICAgIHJldHVybiAnaW1hZ2UvanBlZyc7DQogICAgICAgIH0gZWxzZSBpZiAoYnl0ZXNbMF0gPT09IDB4ODkgJiYgYnl0ZXNbMV0gPT09IDB4NTAgJiYgYnl0ZXNbMl0gPT09IDB4NEUgJiYgYnl0ZXNbM10gPT09IDB4NDcpIHsNCiAgICAgICAgICAgIHJldHVybiAnaW1hZ2UvcG5nJzsNCiAgICAgICAgfSBlbHNlIGlmIChieXRlc1swXSA9PT0gMHg0NyAmJiBieXRlc1sxXSA9PT0gMHg0OSAmJiBieXRlc1syXSA9PT0gMHg0Nikgew0KICAgICAgICAgICAgcmV0dXJuICdpbWFnZS9naWYnOw0KICAgICAgICB9IGVsc2UgaWYgKGJ5dGVzWzBdID09PSAweDUyICYmIGJ5dGVzWzFdID09PSAweDQ5ICYmIGJ5dGVzWzJdID09PSAweDQ2ICYmIGJ5dGVzWzNdID09PSAweDQ2KSB7DQogICAgICAgICAgICByZXR1cm4gJ2ltYWdlL3dlYnAnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gRGVmYXVsdCB0byBQTkcgaWYgd2UgY2FuJ3QgZGV0ZXJtaW5lDQogICAgICAgICAgICByZXR1cm4gJ2ltYWdlL3BuZyc7DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIC8vIERlZmF1bHQgdG8gUE5HIGlmIHRoZXJlJ3MgYW4gZXJyb3INCiAgICAgICAgcmV0dXJuICdpbWFnZS9wbmcnOw0KICAgIH0NCn0NCg0KLy8gQ29udmVydCB2aWV3cG9ydCBjb29yZGluYXRlcyB0byBjYW52YXMgY29vcmRpbmF0ZXMgKGFjY291bnRpbmcgZm9yIHBhbiBhbmQgem9vbSkNCmZ1bmN0aW9uIHZpZXdwb3J0VG9DYW52YXNDb29yZHModmlld3BvcnRYLCB2aWV3cG9ydFkpIHsNCiAgICBpZiAodHlwZW9mIGZsb3dFZGl0b3IgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHJldHVybiB7IHg6IHZpZXdwb3J0WCwgeTogdmlld3BvcnRZIH07DQogICAgfQ0KICAgIA0KICAgIHJldHVybiB7DQogICAgICAgIHg6ICh2aWV3cG9ydFggLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsLA0KICAgICAgICB5OiAodmlld3BvcnRZIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbA0KICAgIH07DQp9DQoNCi8vIENvbnZlcnQgY2FudmFzIGNvb3JkaW5hdGVzIHRvIHZpZXdwb3J0IGNvb3JkaW5hdGVzIChhY2NvdW50aW5nIGZvciBwYW4gYW5kIHpvb20pDQpmdW5jdGlvbiBjYW52YXNUb1ZpZXdwb3J0Q29vcmRzKGNhbnZhc1gsIGNhbnZhc1kpIHsNCiAgICBpZiAodHlwZW9mIGZsb3dFZGl0b3IgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHJldHVybiB7IHg6IGNhbnZhc1gsIHk6IGNhbnZhc1kgfTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIHsNCiAgICAgICAgeDogKGNhbnZhc1ggKiBmbG93RWRpdG9yLnpvb21MZXZlbCkgKyBmbG93RWRpdG9yLnBhbk9mZnNldC54LA0KICAgICAgICB5OiAoY2FudmFzWSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsKSArIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkNCiAgICB9Ow0KfQ0KDQovLyBHZXQgdGhlIGNlbnRlciBvZiB0aGUgY3VycmVudCB2aWV3cG9ydCBpbiBjYW52YXMgY29vcmRpbmF0ZXMNCmZ1bmN0aW9uIGdldFZpZXdwb3J0Q2VudGVySW5DYW52YXMoKSB7DQogICAgaWYgKHR5cGVvZiBmbG93RWRpdG9yID09PSAndW5kZWZpbmVkJyB8fCAhZmxvd0VkaXRvci5jYW52YXMpIHsNCiAgICAgICAgcmV0dXJuIHsgeDogMCwgeTogMCB9Ow0KICAgIH0NCiAgICANCiAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgIGlmICghY29udGFpbmVyKSB7DQogICAgICAgIHJldHVybiB7IHg6IDAsIHk6IDAgfTsNCiAgICB9DQogICAgDQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclggPSBjb250YWluZXJSZWN0LndpZHRoIC8gMjsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclkgPSBjb250YWluZXJSZWN0LmhlaWdodCAvIDI7DQogICAgDQogICAgcmV0dXJuIHZpZXdwb3J0VG9DYW52YXNDb29yZHModmlld3BvcnRDZW50ZXJYLCB2aWV3cG9ydENlbnRlclkpOw0KfQ0KDQovLyBDZW50ZXIgdGhlIHZpZXdwb3J0IG9uIHNwZWNpZmljIGNhbnZhcyBjb29yZGluYXRlcw0KZnVuY3Rpb24gY2VudGVyVmlld3BvcnRPbkNhbnZhcyhjYW52YXNYLCBjYW52YXNZKSB7DQogICAgaWYgKHR5cGVvZiBmbG93RWRpdG9yID09PSAndW5kZWZpbmVkJyB8fCAhZmxvd0VkaXRvci5jYW52YXMpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgIGlmICghY29udGFpbmVyKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclggPSBjb250YWluZXJSZWN0LndpZHRoIC8gMjsNCiAgICBjb25zdCB2aWV3cG9ydENlbnRlclkgPSBjb250YWluZXJSZWN0LmhlaWdodCAvIDI7DQogICAgDQogICAgLy8gQ2FsY3VsYXRlIHBhbiBvZmZzZXQgdG8gY2VudGVyIHRoZSBzcGVjaWZpZWQgY2FudmFzIGNvb3JkaW5hdGVzIGluIHRoZSB2aWV3cG9ydA0KICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSB2aWV3cG9ydENlbnRlclggLSAoY2FudmFzWCAqIGZsb3dFZGl0b3Iuem9vbUxldmVsKTsNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gdmlld3BvcnRDZW50ZXJZIC0gKGNhbnZhc1kgKiBmbG93RWRpdG9yLnpvb21MZXZlbCk7DQogICAgDQogICAgLy8gVXBkYXRlIHRoZSB0cmFuc2Zvcm0NCiAgICBpZiAod2luZG93LmNhbnZhc01hbmFnZXIgJiYgd2luZG93LmNhbnZhc01hbmFnZXIudXBkYXRlQ2FudmFzVHJhbnNmb3JtKSB7DQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgIH0NCn0NCg0KLy8gRXhwb3J0IHV0aWxpdGllcyBmb3IgdXNlIGluIG90aGVyIG1vZHVsZXMNCi8vIENhbnZhcy1zcGVjaWZpYyB1dGlsaXRpZXMgb25seSAtIHNjYWxpbmcgdXRpbGl0aWVzIGFyZSBub3cgaW4gc3lwbmV4QVBJLnNjYWxpbmcNCndpbmRvdy5mbG93RWRpdG9yVXRpbHMgPSB7DQogICAgLy8gQ2FudmFzLXNwZWNpZmljIGNvb3JkaW5hdGUgdHJhbnNmb3JtYXRpb25zDQogICAgdmlld3BvcnRUb0NhbnZhc0Nvb3JkcywNCiAgICBjYW52YXNUb1ZpZXdwb3J0Q29vcmRzLA0KICAgIGdldFZpZXdwb3J0Q2VudGVySW5DYW52YXMsDQogICAgY2VudGVyVmlld3BvcnRPbkNhbnZhcywNCiAgICANCiAgICAvLyBHZW5lcmFsIHV0aWxpdGllcw0KICAgIGVzY2FwZUh0bWwsDQogICAgZm9ybWF0RmlsZVNpemUsDQogICAgZGVib3VuY2UsDQogICAgcHJvY2Vzc1RlbXBsYXRlcywNCiAgICBleHRyYWN0TmVzdGVkVmFsdWUsDQogICAgZGV0ZWN0SW1hZ2VUeXBlRnJvbUJhc2U2NA0KfTsNCg0KLy8gUmVwbGFjZSB0ZW1wbGF0ZSBwbGFjZWhvbGRlcnMgaW4gSlNPTiBib2R5DQpmdW5jdGlvbiByZXBsYWNlVGVtcGxhdGVQbGFjZWhvbGRlcnMoYm9keSwgdGVtcGxhdGVEYXRhKSB7DQoNCiAgICBpZiAoIWJvZHkpIHsNCiAgICAgICAgcmV0dXJuIGJvZHk7DQogICAgfQ0KDQogICAgLy8gSGFuZGxlIGJvdGggc3RyaW5nIGFuZCBvYmplY3QgaW5wdXRzDQogICAgbGV0IGJvZHlTdHJpbmc7DQogICAgbGV0IGlzSnNvblN0cmluZyA9IGZhbHNlOw0KDQogICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykgew0KICAgICAgICBib2R5U3RyaW5nID0gYm9keTsNCiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbHJlYWR5IGEgSlNPTiBzdHJpbmcNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIEpTT04ucGFyc2UoYm9keSk7DQogICAgICAgICAgICBpc0pzb25TdHJpbmcgPSB0cnVlOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAvLyBOb3QgYSBKU09OIHN0cmluZywgdHJlYXQgYXMgcmVndWxhciBzdHJpbmcNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnKSB7DQogICAgICAgIGJvZHlTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShib2R5KTsNCiAgICAgICAgaXNKc29uU3RyaW5nID0gdHJ1ZTsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gYm9keTsNCiAgICB9DQoNCg0KICAgIC8vIFJlcGxhY2UgcGxhY2Vob2xkZXJzIHdpdGggdGVtcGxhdGUgZGF0YQ0KICAgIGlmICh0ZW1wbGF0ZURhdGEgIT09IHVuZGVmaW5lZCAmJiB0ZW1wbGF0ZURhdGEgIT09IG51bGwpIHsNCiAgICAgICAgY29uc3QgYmVmb3JlUmVwbGFjZSA9IGJvZHlTdHJpbmc7DQoNCg0KICAgICAgICAvLyBTaW1wbGUgSlNPTiBmaWVsZCByZXBsYWNlbWVudCAtIGp1c3Qge3tmaWVsZH19IG9yIHt7bmVzdGVkLmZpZWxkfX0NCiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wbGF0ZURhdGEgPT09ICdvYmplY3QnKSB7DQoNCiAgICAgICAgICAgIC8vIFVzZSBhIHNpbXBsZXIsIG1vcmUgZXhwbGljaXQgcmVnZXgNCiAgICAgICAgICAgIGNvbnN0IHBsYWNlaG9sZGVyUmVnZXggPSAvXHtceyhbXn1dKylcfVx9L2c7DQoNCiAgICAgICAgICAgIC8vIFRlc3QgaWYgdGhlIHJlZ2V4IGZpbmRzIGFueXRoaW5nDQogICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gYm9keVN0cmluZy5tYXRjaChwbGFjZWhvbGRlclJlZ2V4KTsNCg0KICAgICAgICAgICAgYm9keVN0cmluZyA9IGJvZHlTdHJpbmcucmVwbGFjZShwbGFjZWhvbGRlclJlZ2V4LCAobWF0Y2gsIGZpZWxkUGF0aCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0TmVzdGVkVmFsdWUodGVtcGxhdGVEYXRhLCBmaWVsZFBhdGgpOw0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXBsYWNlbWVudDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBlc2NhcGUgdGhlIHN0cmluZyBwcm9wZXJseSBmb3IgSlNPTiBjb250ZXh0DQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlbWVudCA9IHZhbHVlLnJlcGxhY2UoL1xcL2csICdcXFxcJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvIi9nLCAnXFwiJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXG4vZywgJ1xcbicpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xyL2csICdcXHInKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cdC9nLCAnXFx0Jyk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3Igbm9uLXN0cmluZ3MsIGNvbnZlcnQgdG8gSlNPTiBzdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50ID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXBsYWNlbWVudDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2g7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRlbXBsYXRlRGF0YSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIC8vIEZvciBzdHJpbmdzLCBqdXN0IHJlcGxhY2Uge3tWQUxVRX19IGFzIGEgZmFsbGJhY2sNCiAgICAgICAgICAgIGJvZHlTdHJpbmcgPSBib2R5U3RyaW5nLnJlcGxhY2UoL3t7VkFMVUV9fS9nLCBKU09OLnN0cmluZ2lmeSh0ZW1wbGF0ZURhdGEpKTsNCiAgICAgICAgfQ0KDQogICAgfSBlbHNlIHsNCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShib2R5U3RyaW5nKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSB0ZW1wbGF0ZS1yZXBsYWNlZCBib2R5OicsIGVycm9yKTsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0JvZHkgc3RyaW5nIHdhczonLCBib2R5U3RyaW5nKTsNCiAgICAgICAgICAgIHJldHVybiBib2R5Ow0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGJvZHlTdHJpbmc7DQogICAgfQ0KfQ0KDQovLyBHZXQgbmVzdGVkIHZhbHVlIGZyb20gb2JqZWN0IHVzaW5nIGRvdCBub3RhdGlvbg0KZnVuY3Rpb24gZ2V0TmVzdGVkVmFsdWUob2JqLCBwYXRoKSB7DQogICAgY29uc3QgcmVzdWx0ID0gcGF0aC5zcGxpdCgnLicpLnJlZHVjZSgoY3VycmVudCwga2V5KSA9PiB7DQogICAgICAgIGNvbnN0IHZhbHVlID0gY3VycmVudCAmJiBjdXJyZW50W2tleV0gIT09IHVuZGVmaW5lZCA/IGN1cnJlbnRba2V5XSA6IHVuZGVmaW5lZDsNCiAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgIH0sIG9iaik7DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KDQovLyBVcGRhdGUgSlNPTiBleHRyYWN0IG5vZGUgZGlzcGxheQ0KZnVuY3Rpb24gdXBkYXRlSnNvbkV4dHJhY3REaXNwbGF5KG5vZGVJZCwgbGFiZWwsIHZhbHVlLCBzdGF0dXMgPSAnbm9ybWFsJykgew0KICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgY29uc3QgY29udGVudEVsZW1lbnQgPSBub2RlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZmxvdy1ub2RlLWNvbnRlbnQnKTsNCiAgICAgICAgaWYgKGNvbnRlbnRFbGVtZW50KSB7DQogICAgICAgICAgICBjb25zdCBzdGF0dXNDbGFzcyA9IHN0YXR1cyA9PT0gJ2Vycm9yJyA/ICd0ZXh0LWRhbmdlcicgOiBzdGF0dXMgPT09ICdzdWNjZXNzJyA/ICd0ZXh0LXN1Y2Nlc3MnIDogJ3RleHQtbXV0ZWQnOw0KDQogICAgICAgICAgICAvLyBTaG93IGp1c3QgYSBzdGF0dXMgb24gdGhlIG5vZGUsIGZ1bGwgY29udGVudCB3aWxsIGJlIGluIGNvbmZpZyBwYW5lbA0KICAgICAgICAgICAgY29uc3QgdHJ1bmNhdGVkVmFsdWUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLmxlbmd0aCA+IDUwID8NCiAgICAgICAgICAgICAgICB2YWx1ZS5zdWJzdHJpbmcoMCwgNTApICsgJy4uLicgOiB2YWx1ZTsNCg0KICAgICAgICAgICAgY29udGVudEVsZW1lbnQuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5vZGUtc3RhdHVzIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3RhdHVzLXRleHQiPlZhbHVlIGV4dHJhY3RlZDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0dXMtaW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+JHtsYWJlbH06ICR7ZXNjYXBlSHRtbChTdHJpbmcodHJ1bmNhdGVkVmFsdWUpKX08L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIEFkZCBleGVjdXRpb24gbG9nIGVudHJ5DQpmdW5jdGlvbiBhZGRFeGVjdXRpb25Mb2cobWVzc2FnZSwgdHlwZSA9ICdpbmZvJykgew0KICAgIGNvbnN0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGVjdXRpb24tb3V0cHV0Jyk7DQogICAgaWYgKG91dHB1dCkgew0KICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpOw0KICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJsb2ctZW50cnkgJHt0eXBlfSI+WyR7dGltZXN0YW1wfV0gJHttZXNzYWdlfTwvZGl2PmA7DQogICAgICAgIG91dHB1dC5zY3JvbGxUb3AgPSBvdXRwdXQuc2Nyb2xsSGVpZ2h0Ow0KICAgIH0NCn0NCg0KLy8gQ2xlYXIgZXhlY3V0aW9uIG91dHB1dA0KZnVuY3Rpb24gY2xlYXJPdXRwdXQoKSB7DQogICAgY29uc3Qgb3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4ZWN1dGlvbi1vdXRwdXQnKTsNCiAgICBpZiAob3V0cHV0KSB7DQogICAgICAgIG91dHB1dC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9nLWVudHJ5IGluZm8iPk91dHB1dCBjbGVhcmVkPC9kaXY+JzsNCiAgICB9DQp9DQoNCg0KLy8gSW50ZXJhY3RpdmUgaGVscGVyIGZ1bmN0aW9ucyBmb3Igc3BlY2lhbCBub2RlIHR5cGVzDQoNCi8vIEF1ZGlvIGNvbnRyb2wgZnVuY3Rpb25zDQpmdW5jdGlvbiBwbGF5QXVkaW8obm9kZUlkKSB7DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKCFub2RlIHx8ICFub2RlLmxhc3RBdWRpb1VybCkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdObyBhdWRpbyBkYXRhIGF2YWlsYWJsZSBmb3Igbm9kZTonLCBub2RlSWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gQ3JlYXRlIG9yIHJldXNlIGF1ZGlvIGVsZW1lbnQNCiAgICBpZiAoIW5vZGUuYXVkaW9FbGVtZW50KSB7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50ID0gbmV3IEF1ZGlvKG5vZGUubGFzdEF1ZGlvVXJsKTsNCiAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQudm9sdW1lID0gcGFyc2VGbG9hdChub2RlLmNvbmZpZy52b2x1bWUudmFsdWUpOw0KICAgIH0NCg0KICAgIG5vZGUuYXVkaW9FbGVtZW50LnBsYXkoKS5jYXRjaChlcnJvciA9PiB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwbGF5IGF1ZGlvOicsIGVycm9yKTsNCiAgICB9KTsNCg0KfQ0KDQpmdW5jdGlvbiBzdG9wQXVkaW8obm9kZUlkKSB7DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKCFub2RlIHx8ICFub2RlLmF1ZGlvRWxlbWVudCkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdObyBhdWRpbyBlbGVtZW50IGZvdW5kIGZvciBub2RlOicsIG5vZGVJZCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBub2RlLmF1ZGlvRWxlbWVudC5wYXVzZSgpOw0KICAgIG5vZGUuYXVkaW9FbGVtZW50LmN1cnJlbnRUaW1lID0gMDsNCg0KfQ0KDQovLyBJbWFnZSBkaXNwbGF5IGZ1bmN0aW9ucw0KZnVuY3Rpb24gc2hvd0Z1bGxJbWFnZShub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUgfHwgIW5vZGUubGFzdEltYWdlVXJsKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGltYWdlIGRhdGEgYXZhaWxhYmxlIGZvciBub2RlOicsIG5vZGVJZCk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBDcmVhdGUgYSBtb2RhbCB0byBzaG93IHRoZSBmdWxsIGltYWdlDQogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBtb2RhbC5jbGFzc05hbWUgPSAnaW1hZ2UtbW9kYWwnOw0KICAgIG1vZGFsLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICAgICAgdG9wOiAwOw0KICAgICAgICBsZWZ0OiAwOw0KICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuOCk7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICB6LWluZGV4OiAxMDAwMDsNCiAgICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGA7DQoNCiAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsNCiAgICBpbWcuc3JjID0gbm9kZS5sYXN0SW1hZ2VVcmw7DQogICAgaW1nLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICAgIG1heC13aWR0aDogOTAlOw0KICAgICAgICBtYXgtaGVpZ2h0OiA5MCU7DQogICAgICAgIG9iamVjdC1maXQ6IGNvbnRhaW47DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCiAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDAsIDAsIDAsIDAuNSk7DQogICAgYDsNCg0KICAgIG1vZGFsLmFwcGVuZENoaWxkKGltZyk7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtb2RhbCk7DQoNCiAgICAvLyBDbG9zZSBtb2RhbCBvbiBjbGljaw0KICAgIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG1vZGFsKTsNCiAgICB9KTsNCg0KfQ0KDQovLyBSZXBlYXRlciBjb250cm9sIGZ1bmN0aW9ucw0KZnVuY3Rpb24gc3RhcnRSZXBlYXRlcihub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUgfHwgbm9kZS50eXBlICE9PSAncmVwZWF0ZXInKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgcmVwZWF0ZXIgbm9kZTonLCBub2RlSWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gRXhlY3V0ZSB0aGUgcmVwZWF0ZXIgbm9kZSB0byBzdGFydCBpdA0KICAgIGV4ZWN1dGlvbkVuZ2luZS5leGVjdXRlTm9kZShub2RlLCB7fSwgbmV3IFNldCgpKS50aGVuKCgpID0+IHsNCiAgICAgICAgLy8gUmVmcmVzaCB0aGUgY29uZmlnIHBhbmVsIHRvIHVwZGF0ZSB0aGUgVUkNCiAgICAgICAgc2hvd05vZGVDb25maWcobm9kZUlkKTsNCiAgICB9KS5jYXRjaChlcnJvciA9PiB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzdGFydCByZXBlYXRlcjonLCBlcnJvcik7DQogICAgfSk7DQp9DQoNCmZ1bmN0aW9uIHN0b3BSZXBlYXRlcihub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUgfHwgbm9kZS50eXBlICE9PSAncmVwZWF0ZXInKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgcmVwZWF0ZXIgbm9kZTonLCBub2RlSWQpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gU3RvcCB0aGUgcmVwZWF0ZXIgdXNpbmcgdGhlIGV4ZWN1dGlvbiBlbmdpbmUgbWV0aG9kDQogICAgZXhlY3V0aW9uRW5naW5lLnN0b3BSZXBlYXRlcihub2RlKTsNCg0KICAgIC8vIFJlZnJlc2ggdGhlIGNvbmZpZyBwYW5lbCB0byB1cGRhdGUgdGhlIFVJDQogICAgc2hvd05vZGVDb25maWcobm9kZUlkKTsNCn0NCg0KDQoNCi8vIFVwZGF0ZSBpbnB1dCBtYXBwaW5nIHdoZW4gdXNlciBzZWxlY3RzIGEgZGlmZmVyZW50IG91dHB1dCBwb3J0DQpmdW5jdGlvbiB1cGRhdGVJbnB1dE1hcHBpbmcobm9kZUlkLCBpbnB1dFBvcnQsIHNlbGVjdGVkT3V0cHV0UG9ydCkgew0KICAgIC8vIEZpbmQgdGhlIGNvbm5lY3Rpb24gdGhhdCBnb2VzIHRvIHRoaXMgaW5wdXQgcG9ydCAoaWdub3JlIGZyb20ucG9ydE5hbWUpDQogICAgY29uc3QgY29ubmVjdGlvbiA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkuZmluZChjb25uID0+DQogICAgICAgIGNvbm4udG8ubm9kZUlkID09PSBub2RlSWQgJiYgY29ubi50by5wb3J0TmFtZSA9PT0gaW5wdXRQb3J0DQogICAgKTsNCiAgICBpZiAoY29ubmVjdGlvbikgew0KICAgICAgICAvLyBSZW1vdmUgdGhlIG9sZCBjb25uZWN0aW9uDQogICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuZGVsZXRlKGNvbm5lY3Rpb24uaWQpOw0KICAgICAgICBpZiAoY29ubmVjdGlvbi5zdmcpIGNvbm5lY3Rpb24uc3ZnLnJlbW92ZSgpOw0KICAgICAgICAvLyBDcmVhdGUgYSBuZXcgY29ubmVjdGlvbiB3aXRoIHRoZSB1cGRhdGVkIHBvcnQgbmFtZSBhbmQgbmV3IElEDQogICAgICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb25JZCA9IGBjb25uXyR7Y29ubmVjdGlvbi5mcm9tLm5vZGVJZH1fJHtzZWxlY3RlZE91dHB1dFBvcnR9XyR7Y29ubmVjdGlvbi50by5ub2RlSWR9XyR7Y29ubmVjdGlvbi50by5wb3J0TmFtZX1gOw0KICAgICAgICBjb25zdCBuZXdDb25uZWN0aW9uID0gew0KICAgICAgICAgICAgaWQ6IG5ld0Nvbm5lY3Rpb25JZCwNCiAgICAgICAgICAgIGZyb206IHsgbm9kZUlkOiBjb25uZWN0aW9uLmZyb20ubm9kZUlkLCBwb3J0TmFtZTogc2VsZWN0ZWRPdXRwdXRQb3J0IH0sDQogICAgICAgICAgICB0bzogeyBub2RlSWQ6IGNvbm5lY3Rpb24udG8ubm9kZUlkLCBwb3J0TmFtZTogY29ubmVjdGlvbi50by5wb3J0TmFtZSB9DQogICAgICAgIH07DQogICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuc2V0KG5ld0Nvbm5lY3Rpb25JZCwgbmV3Q29ubmVjdGlvbik7DQogICAgICAgIGRyYXdDb25uZWN0aW9uKG5ld0Nvbm5lY3Rpb24pOw0KICAgICAgICAvLyBSZWZyZXNoIHRoZSBub2RlIGNvbmZpZyBwYW5lbCB0byBzaG93IHVwZGF0ZWQgc3RhdGUNCiAgICAgICAgaWYgKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID09PSBub2RlSWQpIHsNCiAgICAgICAgICAgIHNob3dOb2RlQ29uZmlnKG5vZGVJZCk7DQogICAgICAgIH0NCiAgICAgICAgLy8gQXV0by1zYXZlIHRoZSB3b3JrZmxvdyB0byBwZXJzaXN0IHRoZSBtYXBwaW5nIGNoYW5nZQ0KICAgICAgICBpZiAod2luZG93LmZpbGVNYW5hZ2VyLnNhdmVGbG93KSB7DQogICAgICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIuc2F2ZUZsb3coKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gVXBkYXRlIG91dHB1dCBtYXBwaW5nIHdoZW4gdXNlciBzZWxlY3RzIGEgZGlmZmVyZW50IG91dHB1dCBwb3J0DQpmdW5jdGlvbiB1cGRhdGVPdXRwdXRNYXBwaW5nKG5vZGVJZCwgb3V0cHV0UG9ydCwgdGFyZ2V0Tm9kZUlkLCBzZWxlY3RlZE91dHB1dFBvcnQpIHsNCiAgICAvLyBSZW1vdmUgYWxsIGNvbm5lY3Rpb25zIGZyb20gdGhpcyBub2RlIHRvIHRoZSB0YXJnZXQgbm9kZSAocmVnYXJkbGVzcyBvZiBwb3J0KQ0KICAgIGNvbnN0IGNvbm5lY3Rpb25zVG9SZW1vdmUgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLmZpbHRlcihjb25uID0+DQogICAgICAgIGNvbm4uZnJvbS5ub2RlSWQgPT09IG5vZGVJZCAmJiBjb25uLnRvLm5vZGVJZCA9PT0gdGFyZ2V0Tm9kZUlkDQogICAgKTsNCiAgICBjb25uZWN0aW9uc1RvUmVtb3ZlLmZvckVhY2goY29ubiA9PiB7DQogICAgICAgIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuZGVsZXRlKGNvbm4uaWQpOw0KICAgICAgICBpZiAoY29ubi5zdmcpIGNvbm4uc3ZnLnJlbW92ZSgpOw0KICAgIH0pOw0KICAgIC8vIEFkZCB0aGUgbmV3IGNvbm5lY3Rpb24NCiAgICBjb25zdCBuZXdDb25uZWN0aW9uSWQgPSBgY29ubl8ke25vZGVJZH1fJHtzZWxlY3RlZE91dHB1dFBvcnR9XyR7dGFyZ2V0Tm9kZUlkfWA7DQogICAgY29uc3QgbmV3Q29ubmVjdGlvbiA9IHsNCiAgICAgICAgaWQ6IG5ld0Nvbm5lY3Rpb25JZCwNCiAgICAgICAgZnJvbTogeyBub2RlSWQ6IG5vZGVJZCwgcG9ydE5hbWU6IHNlbGVjdGVkT3V0cHV0UG9ydCB9LA0KICAgICAgICB0bzogeyBub2RlSWQ6IHRhcmdldE5vZGVJZCwgcG9ydE5hbWU6IGNvbm5lY3Rpb25zVG9SZW1vdmVbMF0/LnRvLnBvcnROYW1lIHx8ICdkYXRhJyB9DQogICAgfTsNCiAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnNldChuZXdDb25uZWN0aW9uSWQsIG5ld0Nvbm5lY3Rpb24pOw0KICAgIGRyYXdDb25uZWN0aW9uKG5ld0Nvbm5lY3Rpb24pOw0KICAgIC8vIFJlZnJlc2ggdGhlIHRhcmdldCBub2RlIGlmIHNlbGVjdGVkDQogICAgaWYgKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID09PSB0YXJnZXROb2RlSWQpIHsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBzaG93Tm9kZUNvbmZpZyh0YXJnZXROb2RlSWQpOw0KICAgICAgICB9LCAxMCk7DQogICAgfQ0KICAgIC8vIEF1dG8tc2F2ZQ0KICAgIGlmICh3aW5kb3cuZmlsZU1hbmFnZXIuc2F2ZUZsb3cpIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvdygpOw0KfQ0KDQoNCi8vIG5vZGUtcmVnaXN0cnkuanMgLSBEeW5hbWljIG5vZGUgcmVnaXN0cnkgZm9yIEZsb3cgRWRpdG9yDQoNCmNsYXNzIE5vZGVSZWdpc3RyeSB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMubm9kZVR5cGVzID0gbmV3IE1hcCgpOw0KICAgICAgICB0aGlzLmV4ZWN1dG9ycyA9IG5ldyBNYXAoKTsNCiAgICAgICAgdGhpcy5sb2FkZWQgPSBmYWxzZTsNCiAgICB9DQogICAgDQogICAgYXN5bmMgbG9hZE5vZGVzRnJvbVZGUygpIHsNCiAgICAgICAgaWYgKHRoaXMubG9hZGVkKSByZXR1cm47DQogICAgICAgIA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBMb2FkIHRoZSBwYWNrZWQgbm9kZXMgZmlsZSBkaXJlY3RseQ0KICAgICAgICAgICAgY29uc3QgcGFja0ZpbGVQYXRoID0gJy9ub2Rlcy9ub2Rlcy1wYWNrLmpzb24nOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgc3lwbmV4QVBJLnJlYWRWaXJ0dWFsRmlsZVRleHQocGFja0ZpbGVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IHBhY2tEYXRhID0gSlNPTi5wYXJzZShjb250ZW50KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBSZWdpc3RlciBhbGwgbm9kZXMgZnJvbSB0aGUgcGFjaw0KICAgICAgICAgICAgZm9yIChjb25zdCBbbm9kZUlkLCBub2RlRGVmXSBvZiBPYmplY3QuZW50cmllcyhwYWNrRGF0YS5ub2RlcykpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyTm9kZShub2RlRGVmKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdGhpcy5sb2FkZWQgPSB0cnVlOw0KICAgICAgICAgICAgDQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBub2RlcyBmcm9tIFZGUyBwYWNrZWQgZmlsZTonLCBlcnJvcik7DQogICAgICAgICAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgdG8gaW5kaWNhdGUgZmFpbHVyZQ0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIGxvYWROb2RlRmlsZShmaWxlUGF0aCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHN5cG5leEFQSS5yZWFkVmlydHVhbEZpbGVUZXh0KGZpbGVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IG5vZGVEZWYgPSBKU09OLnBhcnNlKGNvbnRlbnQpOw0KICAgICAgICAgICAgdGhpcy5yZWdpc3Rlck5vZGUobm9kZURlZik7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBub2RlIGZyb20gJHtmaWxlUGF0aH06YCwgZXJyb3IpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIHJlZ2lzdGVyTm9kZShub2RlRGVmKSB7DQogICAgICAgIHRoaXMubm9kZVR5cGVzLnNldChub2RlRGVmLmlkLCBub2RlRGVmKTsNCiAgICB9DQogICAgDQogICAgcmVnaXN0ZXJFeGVjdXRvcihuYW1lLCBleGVjdXRvcikgew0KICAgICAgICB0aGlzLmV4ZWN1dG9ycy5zZXQobmFtZSwgZXhlY3V0b3IpOw0KICAgIH0NCiAgICANCiAgICBnZXROb2RlVHlwZShpZCkgew0KICAgICAgICByZXR1cm4gdGhpcy5ub2RlVHlwZXMuZ2V0KGlkKTsNCiAgICB9DQogICAgDQogICAgZ2V0RXhlY3V0b3IobmFtZSkgew0KICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRvcnMuZ2V0KG5hbWUpOw0KICAgIH0NCiAgICANCiAgICBnZXRBbGxOb2RlVHlwZXMoKSB7DQogICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMubm9kZVR5cGVzLnZhbHVlcygpKTsNCiAgICB9DQogICAgDQogICAgZ2V0Tm9kZVR5cGVzQnlDYXRlZ29yeShjYXRlZ29yeSkgew0KICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxOb2RlVHlwZXMoKS5maWx0ZXIobm9kZSA9PiBub2RlLmNhdGVnb3J5ID09PSBjYXRlZ29yeSk7DQogICAgfQ0KfQ0KDQovLyBHbG9iYWwgbm9kZSByZWdpc3RyeSBpbnN0YW5jZQ0KY29uc3Qgbm9kZVJlZ2lzdHJ5ID0gbmV3IE5vZGVSZWdpc3RyeSgpOw0KDQoNCi8vIGNhbnZhcy5qcyAtIENhbnZhcyBldmVudCBoYW5kbGVycyBhbmQgZHJhd2luZyBsb2dpYyBmb3IgRmxvdyBFZGl0b3INCg0KLy8gU3RhcnQgZHJhZ2dpbmcgYSBub2RlDQpmdW5jdGlvbiBzdGFydERyYWdnaW5nTm9kZShub2RlSWQsIGUpIHsNCiAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICANCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUpIHJldHVybjsNCiAgICANCiAgICBmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSA9IG5vZGVJZDsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgb2Zmc2V0IGZyb20gbW91c2UgdG8gbm9kZSBjb3JuZXIgdXNpbmcgc2NhbGVkIGNvb3JkaW5hdGVzDQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub2RlSWQpOw0KICAgIGNvbnN0IHJlY3QgPSAodHlwZW9mIHN5cG5leEFQSSAhPT0gJ3VuZGVmaW5lZCcgJiYgc3lwbmV4QVBJLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdCkgPyANCiAgICAgICAgc3lwbmV4QVBJLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChub2RlRWxlbWVudCkgOiANCiAgICAgICAgbm9kZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgY29uc3QgbW91c2VDb29yZHMgPSAodHlwZW9mIHN5cG5leEFQSSAhPT0gJ3VuZGVmaW5lZCcgJiYgc3lwbmV4QVBJLmdldFNjYWxlZE1vdXNlQ29vcmRzKSA/IA0KICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOiANCiAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgIA0KICAgIGZsb3dFZGl0b3IuZHJhZ09mZnNldCA9IHsNCiAgICAgICAgeDogbW91c2VDb29yZHMueCAtIHJlY3QubGVmdCwNCiAgICAgICAgeTogbW91c2VDb29yZHMueSAtIHJlY3QudG9wDQogICAgfTsNCiAgICANCiAgICBub2RlRWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZ3JhYmJpbmcnOw0KICAgIG5vZGVFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxMDAwJzsgLy8gQnJpbmcgdG8gZnJvbnQgd2hpbGUgZHJhZ2dpbmcNCiAgICANCiAgICAvLyBDYWNoZSBjYW52YXMgcmVjdCBmb3IgcGVyZm9ybWFuY2UgKHNjYWxlZCkNCiAgICBmbG93RWRpdG9yLmNhbnZhc1JlY3QgPSAodHlwZW9mIHN5cG5leEFQSSAhPT0gJ3VuZGVmaW5lZCcgJiYgc3lwbmV4QVBJLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdCkgPyANCiAgICAgICAgc3lwbmV4QVBJLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdChmbG93RWRpdG9yLmNhbnZhcykgOiANCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQp9DQoNCi8vIFNlbGVjdCBhIG5vZGUNCmZ1bmN0aW9uIHNlbGVjdE5vZGUobm9kZUlkKSB7DQogICAgLy8gUmVtb3ZlIHByZXZpb3VzIHNlbGVjdGlvbg0KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mbG93LW5vZGUuc2VsZWN0ZWQnKS5mb3JFYWNoKG5vZGUgPT4gew0KICAgICAgICBub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7DQogICAgfSk7DQogICAgDQogICAgLy8gU2VsZWN0IG5ldyBub2RlDQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub2RlSWQpOw0KICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOw0KICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG5vZGVJZDsNCiAgICAgICAgc2hvd05vZGVDb25maWcobm9kZUlkKTsNCiAgICB9DQp9DQoNCg0KLy8gU3RhcnQgYSBjb25uZWN0aW9uIGZyb20gYSBwb3J0DQpmdW5jdGlvbiBzdGFydENvbm5lY3Rpb24obm9kZUlkLCBwb3J0TmFtZSwgaXNPdXRwdXQpIHsNCiAgICBpZiAoaXNPdXRwdXQpIHsNCiAgICAgICAgLy8gU3RhcnRpbmcgZnJvbSBvdXRwdXQgcG9ydA0KICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tID0gew0KICAgICAgICAgICAgbm9kZUlkOiBub2RlSWQsDQogICAgICAgICAgICBwb3J0TmFtZTogcG9ydE5hbWUsDQogICAgICAgICAgICBpc091dHB1dDogdHJ1ZQ0KICAgICAgICB9Ow0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIFN0YXJ0aW5nIGZyb20gaW5wdXQgcG9ydCAtIGNoZWNrIGlmIHdlIGhhdmUgYSBwZW5kaW5nIGNvbm5lY3Rpb24NCiAgICAgICAgaWYgKGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20gJiYgZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbS5pc091dHB1dCkgew0KICAgICAgICAgICAgLy8gQ29tcGxldGUgdGhlIGNvbm5lY3Rpb24NCiAgICAgICAgICAgIGNvbnN0IGZyb21Ob2RlSWQgPSBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tLm5vZGVJZDsNCiAgICAgICAgICAgIGNvbnN0IGZyb21Qb3J0ID0gZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbS5wb3J0TmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY3JlYXRlQ29ubmVjdGlvbihmcm9tTm9kZUlkLCBmcm9tUG9ydCwgbm9kZUlkLCBwb3J0TmFtZSk7DQogICAgICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3RpbmdGcm9tID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gVXBkYXRlIGNvbm5lY3Rpb25zIGZvciBhIHNwZWNpZmljIG5vZGUNCmZ1bmN0aW9uIHVwZGF0ZUNvbm5lY3Rpb25zRm9yTm9kZShub2RlSWQpIHsNCiAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb24gb2YgZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkgew0KICAgICAgICBpZiAoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCA9PT0gbm9kZUlkIHx8IGNvbm5lY3Rpb24udG8ubm9kZUlkID09PSBub2RlSWQpIHsNCiAgICAgICAgICAgIHVwZGF0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFVwZGF0ZSBhIHNpbmdsZSBjb25uZWN0aW9uDQpmdW5jdGlvbiB1cGRhdGVDb25uZWN0aW9uKGNvbm5lY3Rpb24pIHsNCiAgICBjb25zdCBmcm9tTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQpOw0KICAgIGNvbnN0IHRvTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbm5lY3Rpb24udG8ubm9kZUlkKTsNCiAgICANCiAgICBpZiAoIWZyb21Ob2RlIHx8ICF0b05vZGUgfHwgIWNvbm5lY3Rpb24uc3ZnKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gR2V0IG5vZGUgZGF0YSBwb3NpdGlvbnMNCiAgICBjb25zdCBmcm9tTm9kZURhdGEgPSBmbG93RWRpdG9yLm5vZGVzLmdldChjb25uZWN0aW9uLmZyb20ubm9kZUlkKTsNCiAgICBjb25zdCB0b05vZGVEYXRhID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubmVjdGlvbi50by5ub2RlSWQpOw0KICAgIA0KICAgIGlmICghZnJvbU5vZGVEYXRhIHx8ICF0b05vZGVEYXRhKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gR2V0IGFjdHVhbCBub2RlIGRpbWVuc2lvbnMgZnJvbSBjb21wdXRlZCBzdHlsZXMNCiAgICBjb25zdCBmcm9tU3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZnJvbU5vZGUpOw0KICAgIGNvbnN0IHRvU3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodG9Ob2RlKTsNCiAgICANCiAgICBjb25zdCBmcm9tV2lkdGggPSBwYXJzZUZsb2F0KGZyb21TdHlsZXMud2lkdGgpIHx8IDIwMDsNCiAgICBjb25zdCBmcm9tSGVpZ2h0ID0gcGFyc2VGbG9hdChmcm9tU3R5bGVzLmhlaWdodCkgfHwgODA7DQogICAgY29uc3QgdG9XaWR0aCA9IHBhcnNlRmxvYXQodG9TdHlsZXMud2lkdGgpIHx8IDIwMDsNCiAgICBjb25zdCB0b0hlaWdodCA9IHBhcnNlRmxvYXQodG9TdHlsZXMuaGVpZ2h0KSB8fCA4MDsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgY29ubmVjdGlvbiBwb3NpdGlvbnMgZGlyZWN0bHkgZnJvbSBub2RlIGRhdGEgKG5vIGV4dHJhIHRyYW5zZm9ybXMpDQogICAgLy8gRnJvbSBvdXRwdXQgcG9ydCAocmlnaHQgc2lkZSBvZiBmcm9tIG5vZGUsIG1pZGRsZSB2ZXJ0aWNhbGx5KQ0KICAgIGNvbnN0IGZyb21YID0gZnJvbU5vZGVEYXRhLnggKyBmcm9tV2lkdGg7DQogICAgY29uc3QgZnJvbVkgPSBmcm9tTm9kZURhdGEueSArIGZyb21IZWlnaHQgLyAyOw0KICAgIA0KICAgIC8vIFRvIGlucHV0IHBvcnQgKGxlZnQgc2lkZSBvZiB0byBub2RlLCBtaWRkbGUgdmVydGljYWxseSkgIA0KICAgIGNvbnN0IHRvWCA9IHRvTm9kZURhdGEueDsNCiAgICBjb25zdCB0b1kgPSB0b05vZGVEYXRhLnkgKyB0b0hlaWdodCAvIDI7DQogICAgDQogICAgDQogICAgLy8gVXBkYXRlIHRoZSBwYXRoDQogICAgY29uc3QgcGF0aCA9IGNvbm5lY3Rpb24uc3ZnLnF1ZXJ5U2VsZWN0b3IoJ3BhdGgnKTsNCiAgICBpZiAocGF0aCkgew0KICAgICAgICBjb25zdCBjb250cm9sUG9pbnQxWCA9IGZyb21YICsgKHRvWCAtIGZyb21YKSAqIDAuNTsNCiAgICAgICAgY29uc3QgY29udHJvbFBvaW50MlggPSBmcm9tWCArICh0b1ggLSBmcm9tWCkgKiAwLjU7DQogICAgICAgIGNvbnN0IHBhdGhEID0gYE0gJHtmcm9tWH0gJHtmcm9tWX0gQyAke2NvbnRyb2xQb2ludDFYfSAke2Zyb21ZfSAke2NvbnRyb2xQb2ludDJYfSAke3RvWX0gJHt0b1h9ICR7dG9ZfWA7DQogICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdkJywgcGF0aEQpOw0KICAgIH0gZWxzZSB7DQogICAgfQ0KfQ0KDQovLyBSZWRyYXcgYWxsIGNvbm5lY3Rpb25zIChmb3Igd2luZG93IHJlc2l6ZSwgZXRjLikNCmZ1bmN0aW9uIHJlZHJhd0FsbENvbm5lY3Rpb25zKCkgew0KICAgIGZvciAoY29uc3QgY29ubmVjdGlvbiBvZiBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKSB7DQogICAgICAgIHVwZGF0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7DQogICAgfQ0KfQ0KDQovLyBEZWxldGUgYSBub2RlIGFuZCBhbGwgaXRzIGNvbm5lY3Rpb25zDQphc3luYyBmdW5jdGlvbiBkZWxldGVOb2RlKG5vZGVJZCkgew0KICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IHN5cG5leEFQSS5zaG93Q29uZmlybWF0aW9uKA0KICAgICAgICAnRGVsZXRlIE5vZGUnLA0KICAgICAgICAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIG5vZGU/JywNCiAgICAgICAgew0KICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsDQogICAgICAgICAgICBjb25maXJtVGV4dDogJ0RlbGV0ZScsDQogICAgICAgICAgICBjYW5jZWxUZXh0OiAnQ2FuY2VsJywNCiAgICAgICAgICAgIGljb246ICdmYXMgZmEtY3ViZScNCiAgICAgICAgfQ0KICAgICk7DQogICAgDQogICAgaWYgKGNvbmZpcm1lZCkgew0KICAgICAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICAgICAgDQogICAgICAgIC8vIENsZWFuIHVwIGF1ZGlvIGVsZW1lbnRzIGlmIHRoaXMgaXMgYW4gYXVkaW8gbm9kZQ0KICAgICAgICBpZiAobm9kZSAmJiBub2RlLnR5cGUgPT09ICdhdWRpbycgJiYgbm9kZS5hdWRpb0VsZW1lbnQpIHsNCiAgICAgICAgICAgIC8vIFBhdXNlIGFuZCBzdG9wIHRoZSBhdWRpbw0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQucGF1c2UoKTsNCiAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LmN1cnJlbnRUaW1lID0gMDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gUmVtb3ZlIGV2ZW50IGxpc3RlbmVycyBwcm9wZXJseQ0KICAgICAgICAgICAgaWYgKG5vZGUuYXVkaW9FdmVudExpc3RlbmVycykgew0KICAgICAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgbm9kZS5hdWRpb0V2ZW50TGlzdGVuZXJzLmVuZGVkKTsNCiAgICAgICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIG5vZGUuYXVkaW9FdmVudExpc3RlbmVycy5lcnJvcik7DQogICAgICAgICAgICAgICAgbm9kZS5hdWRpb0V2ZW50TGlzdGVuZXJzID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gU3RvcmUgdGhlIHNyYyBiZWZvcmUgY2xlYXJpbmcgaXQgZm9yIGNsZWFudXANCiAgICAgICAgICAgIGNvbnN0IGF1ZGlvU3JjID0gbm9kZS5hdWRpb0VsZW1lbnQuc3JjOw0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuc3JjID0gJyc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFJldm9rZSBibG9iIFVSTCBpZiBpdCBleGlzdHMNCiAgICAgICAgICAgIGlmIChhdWRpb1NyYyAmJiBhdWRpb1NyYy5zdGFydHNXaXRoKCdibG9iOicpKSB7DQogICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChhdWRpb1NyYyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENsZWFyIHRoZSBhdWRpbyBlbGVtZW50IHJlZmVyZW5jZQ0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBSZW1vdmUgYWxsIGNvbm5lY3Rpb25zIGludm9sdmluZyB0aGlzIG5vZGUNCiAgICAgICAgY29uc3QgY29ubmVjdGlvbnNUb0RlbGV0ZSA9IFtdOw0KICAgICAgICBmb3IgKGNvbnN0IFtjb25uZWN0aW9uSWQsIGNvbm5lY3Rpb25dIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuZW50cmllcygpKSB7DQogICAgICAgICAgICBpZiAoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCA9PT0gbm9kZUlkIHx8IGNvbm5lY3Rpb24udG8ubm9kZUlkID09PSBub2RlSWQpIHsNCiAgICAgICAgICAgICAgICBjb25uZWN0aW9uc1RvRGVsZXRlLnB1c2goY29ubmVjdGlvbklkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRGVsZXRlIGNvbm5lY3Rpb25zDQogICAgICAgIGZvciAoY29uc3QgY29ubmVjdGlvbklkIG9mIGNvbm5lY3Rpb25zVG9EZWxldGUpIHsNCiAgICAgICAgICAgIGRlbGV0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbklkKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gUmVtb3ZlIG5vZGUgZnJvbSBkYXRhIHN0cnVjdHVyZQ0KICAgICAgICBmbG93RWRpdG9yLm5vZGVzLmRlbGV0ZShub2RlSWQpOw0KICAgICAgICANCiAgICAgICAgLy8gUmVtb3ZlIG5vZGUgZWxlbWVudCBmcm9tIERPTQ0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGVJZCk7DQogICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgbm9kZUVsZW1lbnQucmVtb3ZlKCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIERlc2VsZWN0IGlmIHRoaXMgd2FzIHRoZSBzZWxlY3RlZCBub2RlDQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9PT0gbm9kZUlkKSB7DQogICAgICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG51bGw7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9kZS1jb25maWcnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPic7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgfQ0KfQ0KDQovLyBEZWxldGUgYSBjb25uZWN0aW9uDQpmdW5jdGlvbiBkZWxldGVDb25uZWN0aW9uKGNvbm5lY3Rpb25JZCkgew0KICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmdldChjb25uZWN0aW9uSWQpOw0KICAgIGlmIChjb25uZWN0aW9uICYmIGNvbm5lY3Rpb24uc3ZnKSB7DQogICAgICAgIGNvbm5lY3Rpb24uc3ZnLnJlbW92ZSgpOw0KICAgIH0NCiAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmRlbGV0ZShjb25uZWN0aW9uSWQpOw0KfQ0KDQovLyBEZWxldGUgc2VsZWN0ZWQgbm9kZQ0KYXN5bmMgZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWROb2RlKCkgew0KICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSkgew0KICAgICAgICBhd2FpdCBkZWxldGVOb2RlKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlKTsNCiAgICB9DQp9DQoNCi8vIEhhbmRsZSBrZXlib2FyZCBzaG9ydGN1dHMNCmZ1bmN0aW9uIGhhbmRsZUtleURvd24oZSkgew0KICAgIGlmIChlLmtleSA9PT0gJ0RlbGV0ZScgfHwgKGUua2V5ID09PSAnQmFja3NwYWNlJyAmJiBlLmN0cmxLZXkpKSB7DQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSkgew0KICAgICAgICAgICAgZGVsZXRlU2VsZWN0ZWROb2RlKCk7DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGUua2V5ID09PSAnRXNjYXBlJykgew0KICAgICAgICAvLyBEZXNlbGVjdCBub2RlDQogICAgICAgIGlmIChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSkgew0KICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSk7DQogICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQpIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7DQogICAgICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG51bGw7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9kZS1jb25maWcnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPic7DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJ3MnICYmICFlLnNoaWZ0S2V5KSB7DQogICAgICAgIC8vIEN0cmwvQ21kICsgUzogU2F2ZQ0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvdygpOw0KICAgIH0gZWxzZSBpZiAoKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpICYmIGUuc2hpZnRLZXkgJiYgZS5rZXkgPT09ICdTJykgew0KICAgICAgICAvLyBDdHJsL0NtZCArIFNoaWZ0ICsgUzogU2F2ZSBBcw0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvd0FzKCk7DQogICAgfSBlbHNlIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgZS5rZXkgPT09ICdvJykgew0KICAgICAgICAvLyBDdHJsL0NtZCArIE86IExvYWQNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIubG9hZEZsb3coKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJz0nKSB7DQogICAgICAgIC8vIEN0cmwvQ21kICsgPTogWm9vbSBJbg0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21JbigpOw0KICAgIH0gZWxzZSBpZiAoKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpICYmIGUua2V5ID09PSAnLScpIHsNCiAgICAgICAgLy8gQ3RybC9DbWQgKyAtOiBab29tIE91dA0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21PdXQoKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJzAnKSB7DQogICAgICAgIC8vIEN0cmwvQ21kICsgMDogUmVzZXQgem9vbSBhbmQgcGFuDQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgd2luZG93LmNhbnZhc01hbmFnZXIucmVzZXRDYW52YXNQYW4oKTsNCiAgICB9IGVsc2UgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiAoZS5zaGlmdEtleSkgJiYgZS5rZXkgPT09ICdGJykgew0KICAgICAgICAvLyBDdHJsL0NtZCArIFNoaWZ0ICsgRjogWm9vbSB0byBmaXQNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci56b29tVG9GaXQoKTsNCiAgICB9DQp9DQoNCi8vIEhhbmRsZSBwb3J0IG1vdXNlIGV2ZW50cyBmb3IgY29ubmVjdGlvbnMNCmZ1bmN0aW9uIGhhbmRsZVBvcnRNb3VzZURvd24oZSwgbm9kZUlkLCBwb3J0TmFtZSwgaXNPdXRwdXQpIHsNCiAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICANCiAgICBpZiAoaXNPdXRwdXQpIHsNCiAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbSA9IHsgbm9kZUlkLCBwb3J0TmFtZSB9Ow0KICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdjb25uZWN0aW5nJyk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20pIHsNCiAgICAgICAgICAgIGNyZWF0ZUNvbm5lY3Rpb24oZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbS5ub2RlSWQsIGZsb3dFZGl0b3IuY29ubmVjdGluZ0Zyb20ucG9ydE5hbWUsIG5vZGVJZCwgcG9ydE5hbWUpOw0KICAgICAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW5nRnJvbSA9IG51bGw7DQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmxvdy1ub2RlLXBvcnQnKS5mb3JFYWNoKHBvcnQgPT4gcG9ydC5jbGFzc0xpc3QucmVtb3ZlKCdjb25uZWN0aW5nJykpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovLyBDcmVhdGUgYSBjb25uZWN0aW9uIGJldHdlZW4gbm9kZXMNCmZ1bmN0aW9uIGNyZWF0ZUNvbm5lY3Rpb24oZnJvbU5vZGVJZCwgZnJvbVBvcnQsIHRvTm9kZUlkLCB0b1BvcnQpIHsNCiAgICAvLyBDaGVjayBpZiBjb25uZWN0aW9uIGFscmVhZHkgZXhpc3RzDQogICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpIHsNCiAgICAgICAgaWYgKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgPT09IGZyb21Ob2RlSWQgJiYgDQogICAgICAgICAgICBjb25uZWN0aW9uLmZyb20ucG9ydE5hbWUgPT09IGZyb21Qb3J0ICYmDQogICAgICAgICAgICBjb25uZWN0aW9uLnRvLm5vZGVJZCA9PT0gdG9Ob2RlSWQgJiYgDQogICAgICAgICAgICBjb25uZWN0aW9uLnRvLnBvcnROYW1lID09PSB0b1BvcnQpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBjb25zdCBjb25uZWN0aW9uSWQgPSBgY29ubl8ke2Zyb21Ob2RlSWR9XyR7ZnJvbVBvcnR9XyR7dG9Ob2RlSWR9XyR7dG9Qb3J0fWA7DQogICAgY29uc3QgY29ubmVjdGlvbiA9IHsNCiAgICAgICAgaWQ6IGNvbm5lY3Rpb25JZCwNCiAgICAgICAgZnJvbTogeyBub2RlSWQ6IGZyb21Ob2RlSWQsIHBvcnROYW1lOiBmcm9tUG9ydCB9LA0KICAgICAgICB0bzogeyBub2RlSWQ6IHRvTm9kZUlkLCBwb3J0TmFtZTogdG9Qb3J0IH0NCiAgICB9Ow0KICAgIA0KICAgIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuc2V0KGNvbm5lY3Rpb25JZCwgY29ubmVjdGlvbik7DQogICAgZHJhd0Nvbm5lY3Rpb24oY29ubmVjdGlvbik7DQogICAgDQp9DQoNCi8vIERyYXcgYSBjb25uZWN0aW9uIG9uIHRoZSBjYW52YXMNCmZ1bmN0aW9uIGRyYXdDb25uZWN0aW9uKGNvbm5lY3Rpb24pIHsNCiAgICBjb25zdCBmcm9tTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQpOw0KICAgIGNvbnN0IHRvTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbm5lY3Rpb24udG8ubm9kZUlkKTsNCiAgICANCiAgICBpZiAoIWZyb21Ob2RlIHx8ICF0b05vZGUpIHJldHVybjsNCiAgICANCiAgICAvLyBDcmVhdGUgU1ZHIGVsZW1lbnQgZm9yIHRoZSBjb25uZWN0aW9uDQogICAgY29uc3Qgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTsNCiAgICBzdmcuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOw0KICAgIHN2Zy5zdHlsZS50b3AgPSAnMCc7DQogICAgc3ZnLnN0eWxlLmxlZnQgPSAnMCc7DQogICAgc3ZnLnN0eWxlLndpZHRoID0gJzEwMCUnOw0KICAgIHN2Zy5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7DQogICAgc3ZnLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7IC8vIERvbid0IGNhcHR1cmUgZXZlbnRzIGJ5IGRlZmF1bHQNCiAgICBzdmcuc3R5bGUuekluZGV4ID0gJzEnOw0KICAgIHN2Zy5kYXRhc2V0LmNvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb24uaWQ7DQogICAgDQogICAgY29uc3QgcGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncGF0aCcpOw0KICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnIzRDQUY1MCcpOw0KICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpOw0KICAgIHBhdGguc2V0QXR0cmlidXRlKCdmaWxsJywgJ25vbmUnKTsNCiAgICBwYXRoLnNldEF0dHJpYnV0ZSgnbWFya2VyLWVuZCcsICd1cmwoI2Fycm93aGVhZCknKTsNCiAgICBwYXRoLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJzsNCiAgICBwYXRoLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnYXV0byc7IC8vIE9ubHkgdGhlIHBhdGggY2FwdHVyZXMgZXZlbnRzDQogICAgDQogICAgLy8gQWRkIGhvdmVyIGVmZmVjdHMNCiAgICBwYXRoLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoKSA9PiB7DQogICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnNCcpOw0KICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyNmZjZiNmInKTsNCiAgICAgICAgLy8gU2hvdyBkZWxldGUgdG9vbHRpcA0KICAgICAgICBzaG93Q29ubmVjdGlvblRvb2x0aXAoY29ubmVjdGlvbi5pZCwgJ0NsaWNrIHRvIGRlbGV0ZSBjb25uZWN0aW9uJyk7DQogICAgfSk7DQogICAgDQogICAgcGF0aC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT4gew0KICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzInKTsNCiAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICcjNENBRjUwJyk7DQogICAgICAgIGhpZGVDb25uZWN0aW9uVG9vbHRpcCgpOw0KICAgIH0pOw0KICAgIA0KICAgIC8vIEFkZCBjbGljayB0byBkZWxldGUNCiAgICBwYXRoLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHsNCiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgc3lwbmV4QVBJLnNob3dDb25maXJtYXRpb24oDQogICAgICAgICAgICAnRGVsZXRlIENvbm5lY3Rpb24nLA0KICAgICAgICAgICAgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBjb25uZWN0aW9uPycsDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsDQogICAgICAgICAgICAgICAgY29uZmlybVRleHQ6ICdEZWxldGUnLA0KICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6ICdDYW5jZWwnLA0KICAgICAgICAgICAgICAgIGljb246ICdmYXMgZmEtbGluaycNCiAgICAgICAgICAgIH0NCiAgICAgICAgKTsNCiAgICAgICAgDQogICAgICAgIGlmIChjb25maXJtZWQpIHsNCiAgICAgICAgICAgIGRlbGV0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbi5pZCk7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICBzdmcuYXBwZW5kQ2hpbGQocGF0aCk7DQogICAgZmxvd0VkaXRvci5jYW52YXMuYXBwZW5kQ2hpbGQoc3ZnKTsNCiAgICANCiAgICAvLyBTdG9yZSBTVkcgcmVmZXJlbmNlDQogICAgY29ubmVjdGlvbi5zdmcgPSBzdmc7DQogICAgDQogICAgLy8gVXBkYXRlIGNvbm5lY3Rpb24gcG9zaXRpb24NCiAgICB1cGRhdGVDb25uZWN0aW9uKGNvbm5lY3Rpb24pOw0KfQ0KDQovLyBTaG93IGNvbm5lY3Rpb24gdG9vbHRpcA0KZnVuY3Rpb24gc2hvd0Nvbm5lY3Rpb25Ub29sdGlwKGNvbm5lY3Rpb25JZCwgbWVzc2FnZSkgew0KICAgIC8vIENoZWNrIGlmIGFwcCBpcyBzdGlsbCBhY3RpdmUNCiAgICBpZiAoIWZsb3dFZGl0b3IuaXNBY3RpdmUpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBSZW1vdmUgZXhpc3RpbmcgdG9vbHRpcA0KICAgIGhpZGVDb25uZWN0aW9uVG9vbHRpcCgpOw0KICAgIA0KICAgIGNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICB0b29sdGlwLmNsYXNzTmFtZSA9ICdjb25uZWN0aW9uLXRvb2x0aXAnOw0KICAgIHRvb2x0aXAudGV4dENvbnRlbnQgPSBtZXNzYWdlOw0KICAgIHRvb2x0aXAuc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuOCk7DQogICAgICAgIGNvbG9yOiB3aGl0ZTsNCiAgICAgICAgcGFkZGluZzogNHB4IDhweDsNCiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgICAgICBmb250LXNpemU6IDEycHg7DQogICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOw0KICAgICAgICB6LWluZGV4OiAxMDAwMDsNCiAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICAgICAgZGlzcGxheTogbm9uZTsNCiAgICBgOw0KICAgIA0KICAgIHRvb2x0aXAuaWQgPSAnY29ubmVjdGlvbi10b29sdGlwJzsNCiAgICANCiAgICAvLyBUcnkgdG8gYXBwZW5kIHRvIGFwcCBjb250YWluZXIgZmlyc3QsIGZhbGxiYWNrIHRvIGJvZHkNCiAgICBjb25zdCBhcHBDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXBwLWNvbnRhaW5lcicpOw0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGFwcENvbnRhaW5lciB8fCBkb2N1bWVudC5ib2R5Ow0KICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0b29sdGlwKTsNCiAgICANCiAgICAvLyBQb3NpdGlvbiB0b29sdGlwIG5lYXIgbW91c2UgKHdpbGwgYmUgdXBkYXRlZCBvbiBtb3VzZW1vdmUpDQogICAgY29uc3QgdG9vbHRpcE1vdXNlTW92ZUhhbmRsZXIgPSAoZSkgPT4gdXBkYXRlVG9vbHRpcFBvc2l0aW9uKGUpOw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRvb2x0aXBNb3VzZU1vdmVIYW5kbGVyKTsNCiAgICANCiAgICAvLyBTdG9yZSB0aGUgaGFuZGxlciByZWZlcmVuY2UgZm9yIGNsZWFudXANCiAgICB3aW5kb3cuZmxvd0VkaXRvclRvb2x0aXBIYW5kbGVyID0gdG9vbHRpcE1vdXNlTW92ZUhhbmRsZXI7DQogICAgDQogICAgLy8gU2hvdyB0aGUgdG9vbHRpcCBhZnRlciBhIHNtYWxsIGRlbGF5IHRvIHByZXZlbnQgZmxpY2tlcmluZw0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBpZiAodG9vbHRpcC5wYXJlbnROb2RlICYmIGZsb3dFZGl0b3IuaXNBY3RpdmUpIHsNCiAgICAgICAgICAgIHRvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgIH0NCiAgICB9LCAxMCk7DQp9DQoNCi8vIFVwZGF0ZSB0b29sdGlwIHBvc2l0aW9uDQpmdW5jdGlvbiB1cGRhdGVUb29sdGlwUG9zaXRpb24oZSkgew0KICAgIGNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29ubmVjdGlvbi10b29sdGlwJyk7DQogICAgaWYgKHRvb2x0aXApIHsNCiAgICAgICAgLy8gVXNlIHNjYWxlZCBjb29yZGluYXRlcyBmb3IgdG9vbHRpcCBwb3NpdGlvbmluZw0KICAgICAgICBjb25zdCBtb3VzZUNvb3JkcyA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkTW91c2VDb29yZHMpID8gDQogICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOiANCiAgICAgICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICAgICAgdG9vbHRpcC5zdHlsZS5sZWZ0ID0gKG1vdXNlQ29vcmRzLnggKyAxMCkgKyAncHgnOw0KICAgICAgICB0b29sdGlwLnN0eWxlLnRvcCA9IChtb3VzZUNvb3Jkcy55IC0gMTApICsgJ3B4JzsNCiAgICB9DQp9DQoNCi8vIEhpZGUgY29ubmVjdGlvbiB0b29sdGlwDQpmdW5jdGlvbiBoaWRlQ29ubmVjdGlvblRvb2x0aXAoKSB7DQogICAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25uZWN0aW9uLXRvb2x0aXAnKTsNCiAgICBpZiAodG9vbHRpcCkgew0KICAgICAgICAvLyBSZW1vdmUgdGhlIHNwZWNpZmljIGV2ZW50IGxpc3RlbmVyIHdlIGFkZGVkDQogICAgICAgIGlmICh3aW5kb3cuZmxvd0VkaXRvclRvb2x0aXBIYW5kbGVyKSB7DQogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB3aW5kb3cuZmxvd0VkaXRvclRvb2x0aXBIYW5kbGVyKTsNCiAgICAgICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBIaWRlIGFuZCByZW1vdmUgdGhlIHRvb2x0aXANCiAgICAgICAgdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBpZiAodG9vbHRpcC5wYXJlbnROb2RlKSB7DQogICAgICAgICAgICB0b29sdGlwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodG9vbHRpcCk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIENsZWFyIHRoZSBjYW52YXMNCmFzeW5jIGZ1bmN0aW9uIGNsZWFyQ2FudmFzKCkgew0KICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IHN5cG5leEFQSS5zaG93Q29uZmlybWF0aW9uKA0KICAgICAgICAnQ2xlYXIgQ2FudmFzJywNCiAgICAgICAgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciB0aGUgY2FudmFzPyBUaGlzIHdpbGwgZGVsZXRlIGFsbCBub2RlcyBhbmQgY29ubmVjdGlvbnMuJywNCiAgICAgICAgew0KICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsDQogICAgICAgICAgICBjb25maXJtVGV4dDogJ0NsZWFyIEFsbCcsDQogICAgICAgICAgICBjYW5jZWxUZXh0OiAnQ2FuY2VsJywNCiAgICAgICAgICAgIGljb246ICdmYXMgZmEtdHJhc2gtYWx0Jw0KICAgICAgICB9DQogICAgKTsNCiAgICANCiAgICBpZiAoY29uZmlybWVkKSB7DQogICAgICAgIGNsZWFyQ2FudmFzU2lsZW50KCk7DQogICAgfQ0KfQ0KDQovLyBDbGVhciB0aGUgY2FudmFzIHdpdGhvdXQgY29uZmlybWF0aW9uICh1c2VkIGludGVybmFsbHkpDQpmdW5jdGlvbiBjbGVhckNhbnZhc1NpbGVudCgpIHsNCiAgICAvLyBIaWRlIGFueSBhY3RpdmUgdG9vbHRpcHMNCiAgICBoaWRlQ29ubmVjdGlvblRvb2x0aXAoKTsNCiAgICAgICAgDQogICAgICAgIC8vIENsZWFyIGFsbCBjb25uZWN0aW9ucw0KICAgICAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb24gb2YgZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkgew0KICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb24uc3ZnKSB7DQogICAgICAgICAgICAgICAgY29ubmVjdGlvbi5zdmcucmVtb3ZlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZmxvd0VkaXRvci5jb25uZWN0aW9ucy5jbGVhcigpOw0KICAgICAgICANCiAgICAgICAgLy8gQ2xlYXIgYWxsIG5vZGVzDQogICAgICAgIGZvciAoY29uc3Qgbm9kZUlkIG9mIGZsb3dFZGl0b3Iubm9kZXMua2V5cygpKSB7DQogICAgICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGVJZCk7DQogICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5yZW1vdmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmbG93RWRpdG9yLm5vZGVzLmNsZWFyKCk7DQogICAgICAgIA0KICAgICAgICAvLyBDbGVhciBhbGwgdGFncw0KICAgICAgICBmb3IgKGNvbnN0IHRhZ0lkIG9mIGZsb3dFZGl0b3IudGFncy5rZXlzKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IHRhZ0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWdJZCk7DQogICAgICAgICAgICBpZiAodGFnRWxlbWVudCkgew0KICAgICAgICAgICAgICAgIHRhZ0VsZW1lbnQucmVtb3ZlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZmxvd0VkaXRvci50YWdzLmNsZWFyKCk7DQogICAgICAgIA0KICAgICAgICAvLyBVcGRhdGUgdGFnIHBhbmVsIHRvIHJlZmxlY3QgY2xlYXJlZCB0YWdzDQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93LnRhZ01hbmFnZXIudXBkYXRlVGFnUGFuZWwgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgIHdpbmRvdy50YWdNYW5hZ2VyLnVwZGF0ZVRhZ1BhbmVsKCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFJlc2V0IGNvdW50ZXJzDQogICAgICAgIGZsb3dFZGl0b3Iubm9kZUNvdW50ZXIgPSAwOw0KICAgICAgICBmbG93RWRpdG9yLnRhZ0NvdW50ZXIgPSAwOw0KICAgICAgICBmbG93RWRpdG9yLnNlbGVjdGVkTm9kZSA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAvLyBDbGVhciBjdXJyZW50IGZpbGUgcGF0aA0KICAgICAgICBmbG93RWRpdG9yLmN1cnJlbnRGaWxlUGF0aCA9IG51bGw7DQogICAgICAgIA0KICAgICAgICAvLyBSZXNldCBwYW4gb2Zmc2V0IHRvIGNlbnRlciBvZiBsYXJnZSBjYW52YXMNCiAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQgPSB7IHg6IC01MDAwLCB5OiAtNTAwMCB9Ow0KICAgICAgICANCiAgICAgICAgLy8gUmVzZXQgem9vbSBsZXZlbA0KICAgICAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IDEuMDsNCiAgICAgICAgDQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93LmNhbnZhc01hbmFnZXIudXBkYXRlQ2FudmFzVHJhbnNmb3JtID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gVXBkYXRlIGZpbGVuYW1lIGRpc3BsYXkNCiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuZmlsZU1hbmFnZXIudXBkYXRlRmlsZW5hbWVEaXNwbGF5ID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIudXBkYXRlRmlsZW5hbWVEaXNwbGF5KCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIENsZWFyIGNvbmZpZyBwYW5lbA0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9kZS1jb25maWcnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtbXV0ZWQiPlNlbGVjdCBhIG5vZGUgdG8gY29uZmlndXJlIGl0PC9wPic7DQp9IA0KDQoNCi8vIFNob3cgbm9kZSBjb25maWd1cmF0aW9uDQphc3luYyBmdW5jdGlvbiBzaG93Tm9kZUNvbmZpZyhub2RlSWQpIHsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGUpIHJldHVybjsNCiAgICANCiAgICBjb25zdCBub2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKG5vZGUudHlwZSk7DQogICAgaWYgKCFub2RlRGVmKSByZXR1cm47DQoNCiAgICAvLyBMb2FkIHNhdmVkIGNvbmZpZ3VyYXRpb24gc2VjdGlvbiBzdGF0ZXMNCiAgICBsZXQgc2VjdGlvblN0YXRlcyA9IHt9Ow0KICAgIHRyeSB7DQogICAgICAgIGlmICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2V0dGluZykgew0KICAgICAgICAgICAgLy8gTG9hZCBzdGF0ZXMgZm9yIGFsbCBwb3NzaWJsZSBzZWN0aW9ucw0KICAgICAgICAgICAgY29uc3Qgc2VjdGlvbnMgPSBbJ25vZGUtY29udGVudCcsICdpbnB1dC1jb25uZWN0aW9ucycsICdvdXRwdXQtY29ubmVjdGlvbnMnLCAnbm9kZS1zZXR0aW5ncycsICdvdXRwdXQtZGF0YSddOw0KICAgICAgICAgICAgZm9yIChjb25zdCBzZWN0aW9uSWQgb2Ygc2VjdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IHRvIGV4cGFuZGVkIGZvciBub2RlLWNvbnRlbnQsIGNvbGxhcHNlZCBmb3Igb3RoZXJzDQogICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdEV4cGFuZGVkID0gc2VjdGlvbklkID09PSAnbm9kZS1jb250ZW50JzsNCiAgICAgICAgICAgICAgICBzZWN0aW9uU3RhdGVzW3NlY3Rpb25JZF0gPSBhd2FpdCBzeXBuZXhBUEkuZ2V0U2V0dGluZyhgY29uZmlnX3NlY3Rpb25fJHtzZWN0aW9uSWR9YCwgZGVmYXVsdEV4cGFuZGVkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGxvYWQgY29uZmlnIHNlY3Rpb24gc3RhdGVzOicsIGVycm9yKTsNCiAgICAgICAgLy8gVXNlIGRlZmF1bHRzIGlmIGxvYWRpbmcgZmFpbHMNCiAgICAgICAgc2VjdGlvblN0YXRlcyA9IHsNCiAgICAgICAgICAgICdub2RlLWNvbnRlbnQnOiB0cnVlLA0KICAgICAgICAgICAgJ2lucHV0LWNvbm5lY3Rpb25zJzogZmFsc2UsDQogICAgICAgICAgICAnb3V0cHV0LWNvbm5lY3Rpb25zJzogZmFsc2UsDQogICAgICAgICAgICAnbm9kZS1zZXR0aW5ncyc6IGZhbHNlLA0KICAgICAgICAgICAgJ291dHB1dC1kYXRhJzogZmFsc2UNCiAgICAgICAgfTsNCiAgICB9DQogICAgDQogICAgLy8gU2hvdyBjb25maWcgcGFuZWwgd2l0aCBub2RlIGNvbmZpZ3VyYXRpb24NCiAgICBjb25zdCBjb25maWdQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2RlLWNvbmZpZycpOw0KICAgIGlmIChjb25maWdQYW5lbCkgew0KICAgICAgICBsZXQgY29uZmlnSHRtbCA9IGA8aDQ+JHtub2RlRGVmLm5hbWV9IENvbmZpZ3VyYXRpb248L2g0PmA7DQogICAgICAgIA0KICAgICAgICAvLyBBZGQgc3BlY2lhbCBjb250ZW50IGRpc3BsYXkgZm9yIGRpZmZlcmVudCBub2RlIHR5cGVzDQogICAgICAgIGxldCBoYXNTcGVjaWFsQ29udGVudCA9IGZhbHNlOw0KICAgICAgICBsZXQgc3BlY2lhbENvbnRlbnRIdG1sID0gJyc7DQogICAgICAgIA0KICAgICAgICBpZiAobm9kZS50eXBlID09PSAnZGlzcGxheScgJiYgbm9kZS5sYXN0Q29udGVudCkgew0KICAgICAgICAgICAgaGFzU3BlY2lhbENvbnRlbnQgPSB0cnVlOw0KICAgICAgICAgICAgc3BlY2lhbENvbnRlbnRIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+TGFzdCBDb250ZW50PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1kaXNwbGF5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwcmUgY2xhc3M9ImNvbnRlbnQtdGV4dCI+JHtlc2NhcGVIdG1sKG5vZGUubGFzdENvbnRlbnQpfTwvcHJlPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+Rm9ybWF0OiAke25vZGUubGFzdEZvcm1hdH0g4oCiIExlbmd0aDogJHtub2RlLmxhc3RDb250ZW50Lmxlbmd0aH0gY2hhcnM8L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdpbWFnZScgJiYgbm9kZS5sYXN0SW1hZ2VEYXRhKSB7DQogICAgICAgICAgICBoYXNTcGVjaWFsQ29udGVudCA9IHRydWU7DQogICAgICAgICAgICBzcGVjaWFsQ29udGVudEh0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5JbWFnZSBQcmV2aWV3PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW1hZ2UtZGlzcGxheSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz0iJHtub2RlLmxhc3RJbWFnZVVybH0iIGFsdD0iSW1hZ2UgcHJldmlldyIgc3R5bGU9Im1heC13aWR0aDogMjAwcHg7IG1heC1oZWlnaHQ6IDE1MHB4OyBib3JkZXI6IDFweCBzb2xpZCAjY2NjOyBib3JkZXItcmFkaXVzOiA0cHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImltYWdlLWluZm8iPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5TaXplOiAke25vZGUubGFzdEltYWdlSW5mbz8ud2lkdGggfHwgJz8nfXgke25vZGUubGFzdEltYWdlSW5mbz8uaGVpZ2h0IHx8ICc/J30g4oCiIEZvcm1hdDogJHtub2RlLmxhc3RJbWFnZUluZm8/LmZvcm1hdCB8fCAnPyd9PC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tcHJpbWFyeSBtdC0yIHZpZXctZnVsbC1pbWFnZS1idG4iIGRhdGEtbm9kZS1pZD0iJHtub2RlSWR9Ij5WaWV3IEZ1bGwgSW1hZ2U8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gJ2F1ZGlvJyAmJiBub2RlLmxhc3RBdWRpb0RhdGEpIHsNCiAgICAgICAgICAgIGhhc1NwZWNpYWxDb250ZW50ID0gdHJ1ZTsNCiAgICAgICAgICAgIHNwZWNpYWxDb250ZW50SHRtbCArPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgPGxhYmVsPkF1ZGlvIENvbnRyb2xzPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYXVkaW8tZGlzcGxheSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhdWRpby1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+QXVkaW8gbG9hZGVkIHN1Y2Nlc3NmdWxseTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImF1ZGlvLWNvbnRyb2xzIG10LTIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLXN1Y2Nlc3MgcGxheS1hdWRpby1idG4iIGRhdGEtbm9kZS1pZD0iJHtub2RlSWR9Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1wbGF5Ij48L2k+IFBsYXkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1kYW5nZXIgc3RvcC1hdWRpby1idG4iIGRhdGEtbm9kZS1pZD0iJHtub2RlSWR9Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zdG9wIj48L2k+IFN0b3ANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAndmZzX2xvYWQnKSB7DQogICAgICAgICAgICBoYXNTcGVjaWFsQ29udGVudCA9IHRydWU7DQogICAgICAgICAgICBzcGVjaWFsQ29udGVudEh0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5WRlMgTG9hZCBTdGF0dXM8L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZnMtbG9hZC1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbD5MYXN0IGxvYWRlZDogJHtub2RlLmxhc3RMb2FkZWRGaWxlIHx8ICdOb25lJ308L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAnbGxtX2NoYXQnICYmIG5vZGUubGFzdFJlc3BvbnNlKSB7DQogICAgICAgICAgICBoYXNTcGVjaWFsQ29udGVudCA9IHRydWU7DQogICAgICAgICAgICBzcGVjaWFsQ29udGVudEh0bWwgKz0gYA0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5MYXN0IFJlc3BvbnNlPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1kaXNwbGF5Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwcmUgY2xhc3M9ImNvbnRlbnQtdGV4dCI+JHtlc2NhcGVIdG1sKG5vZGUubGFzdFJlc3BvbnNlKX08L3ByZT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRlbnQtaW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsPlRva2VuczogJHtub2RlLmxhc3RVc2FnZT8udG90YWxfdG9rZW5zIHx8IDB9IOKAoiBNb2RlbDogJHtub2RlLmxhc3RNb2RlbCB8fCAnVW5rbm93bid9PC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAncmVwZWF0ZXInKSB7DQogICAgICAgICAgICBoYXNTcGVjaWFsQ29udGVudCA9IHRydWU7DQogICAgICAgICAgICBjb25zdCBpc1J1bm5pbmcgPSBub2RlLnJlcGVhdGVyU3RhdGUgJiYgbm9kZS5yZXBlYXRlclN0YXRlLmlzUnVubmluZzsNCiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gbm9kZS5yZXBlYXRlclN0YXRlID8gbm9kZS5yZXBlYXRlclN0YXRlLmNvdW50IDogMDsNCiAgICAgICAgICAgIHNwZWNpYWxDb250ZW50SHRtbCArPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlJlcGVhdGVyIENvbnRyb2xzPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVwZWF0ZXItZGlzcGxheSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZXBlYXRlci1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+U3RhdHVzOiAke2lzUnVubmluZyA/ICdSdW5uaW5nJyA6ICdTdG9wcGVkJ30g4oCiIENvdW50OiAke2NvdW50fTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlcGVhdGVyLWNvbnRyb2xzIG10LTIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLXN1Y2Nlc3Mgc3RhcnQtcmVwZWF0ZXItYnRuIiBkYXRhLW5vZGUtaWQ9IiR7bm9kZUlkfSIgJHtpc1J1bm5pbmcgPyAnZGlzYWJsZWQnIDogJyd9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBsYXkiPjwvaT4gU3RhcnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1kYW5nZXIgc3RvcC1yZXBlYXRlci1idG4iIGRhdGEtbm9kZS1pZD0iJHtub2RlSWR9IiAkeyFpc1J1bm5pbmcgPyAnZGlzYWJsZWQnIDogJyd9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXN0b3AiPjwvaT4gU3RvcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgYDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gV3JhcCBzcGVjaWFsIGNvbnRlbnQgaW4gYSBjb2xsYXBzaWJsZSBzZWN0aW9uIGlmIHByZXNlbnQNCiAgICAgICAgaWYgKGhhc1NwZWNpYWxDb250ZW50KSB7DQogICAgICAgICAgICBjb25zdCBpc0V4cGFuZGVkID0gc2VjdGlvblN0YXRlc1snbm9kZS1jb250ZW50J107DQogICAgICAgICAgICBjb25zdCBoZWFkZXJDbGFzcyA9IGlzRXhwYW5kZWQgPyAnJyA6ICdjb2xsYXBzZWQnOw0KICAgICAgICAgICAgY29uc3QgaWNvbkNsYXNzID0gaXNFeHBhbmRlZCA/ICdmYXMgZmEtY2hldnJvbi1kb3duJyA6ICdmYXMgZmEtY2hldnJvbi1yaWdodCc7DQogICAgICAgICAgICBjb25zdCBjb250ZW50U3R5bGUgPSBpc0V4cGFuZGVkID8gJycgOiAnIHN0eWxlPSJkaXNwbGF5OiBub25lOyInOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbiI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1zZWN0aW9uLWhlYWRlciAke2hlYWRlckNsYXNzfSIgZGF0YS1zZWN0aW9uPSJub2RlLWNvbnRlbnQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9IiR7aWNvbkNsYXNzfSI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+Tm9kZSBDb250ZW50PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLXNlY3Rpb24tY29udGVudCIgaWQ9Im5vZGUtY29udGVudC1jb250ZW50IiR7Y29udGVudFN0eWxlfT4NCiAgICAgICAgICAgICAgICAgICAgICAgICR7c3BlY2lhbENvbnRlbnRIdG1sfQ0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFNob3cgaW5wdXQgbWFwcGluZ3MgY29uZmlndXJhdGlvbiAod2hhdCB0aGlzIG5vZGUgcmVjZWl2ZXMgZnJvbSBvdGhlciBub2RlcykNCiAgICAgICAgY29uc3QgaW5wdXRDb25uZWN0aW9ucyA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkNCiAgICAgICAgICAgIC5maWx0ZXIoY29ubiA9PiBjb25uLnRvLm5vZGVJZCA9PT0gbm9kZUlkKTsNCiAgICAgICAgDQogICAgICAgIGlmIChpbnB1dENvbm5lY3Rpb25zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGNvbnN0IGlzRXhwYW5kZWQgPSBzZWN0aW9uU3RhdGVzWydpbnB1dC1jb25uZWN0aW9ucyddOw0KICAgICAgICAgICAgY29uc3QgaGVhZGVyQ2xhc3MgPSBpc0V4cGFuZGVkID8gJycgOiAnY29sbGFwc2VkJzsNCiAgICAgICAgICAgIGNvbnN0IGljb25DbGFzcyA9IGlzRXhwYW5kZWQgPyAnZmFzIGZhLWNoZXZyb24tZG93bicgOiAnZmFzIGZhLWNoZXZyb24tcmlnaHQnOw0KICAgICAgICAgICAgY29uc3QgY29udGVudFN0eWxlID0gaXNFeHBhbmRlZCA/ICcnIDogJyBzdHlsZT0iZGlzcGxheTogbm9uZTsiJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLXNlY3Rpb24iPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbi1oZWFkZXIgJHtoZWFkZXJDbGFzc30iIGRhdGEtc2VjdGlvbj0iaW5wdXQtY29ubmVjdGlvbnMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9IiR7aWNvbkNsYXNzfSI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+SW5wdXQgQ29ubmVjdGlvbnM8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8c21hbGwgY2xhc3M9ImNvbmZpZy1jb3VudCI+KCR7aW5wdXRDb25uZWN0aW9ucy5sZW5ndGh9KTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbi1jb250ZW50IiBpZD0iaW5wdXQtY29ubmVjdGlvbnMtY29udGVudCIke2NvbnRlbnRTdHlsZX0+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnB1dC1tYXBwaW5ncy1jb25maWciPg0KICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIChjb25zdCBjb25uIG9mIGlucHV0Q29ubmVjdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VOb2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubi5mcm9tLm5vZGVJZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlTm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZShzb3VyY2VOb2RlPy50eXBlIHx8ICd1bmtub3duJyk7DQogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlTm9kZU5hbWUgPSBzb3VyY2VOb2RlRGVmPy5uYW1lIHx8IHNvdXJjZU5vZGU/LnR5cGUgfHwgJ3Vua25vd24nOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkT3V0cHV0ID0gc291cmNlTm9kZURlZj8ub3V0cHV0cz8uZmluZChvdXRwdXQgPT4gb3V0cHV0LmlkID09PSBjb25uLmZyb20ucG9ydE5hbWUpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dE5hbWUgPSBzZWxlY3RlZE91dHB1dCA/IHNlbGVjdGVkT3V0cHV0Lm5hbWUgOiBjb25uLmZyb20ucG9ydE5hbWU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2ltcGxlOiBTaG93IHdoYXQgSSdtIHJlY2VpdmluZyBhbmQgbGV0IG1lIGNob29zZSBteSBpbnB1dCBwb3J0DQogICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LW1hcHBpbmctY29uZmlnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbm5lY3Rpb24taGVhZGVyIj5Gcm9tICR7c291cmNlTm9kZU5hbWV9ICgke291dHB1dE5hbWV9KTwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29ubmVjdGlvbi1jb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+VG8gbXkgaW5wdXQ6PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0iaW5wdXRfdGFyZ2V0XyR7bm9kZUlkfXwke2Nvbm4udG8ucG9ydE5hbWV9IiBjbGFzcz0iaW5wdXQtdGFyZ2V0LXNlbGVjdCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPlNlbGVjdC4uLjwvb3B0aW9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtub2RlRGVmLmlucHV0cy5tYXAoaW5wdXQgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxvcHRpb24gdmFsdWU9IiR7aW5wdXQuaWR9IiAke2Nvbm4udG8ucG9ydE5hbWUgPT09IGlucHV0LmlkID8gJ3NlbGVjdGVkJyA6ICcnfT4ke2lucHV0Lm5hbWV9PC9vcHRpb24+YA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5qb2luKCcnKX0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBTaG93IG91dHB1dCBtYXBwaW5ncyBjb25maWd1cmF0aW9uICh3aGF0IG90aGVyIG5vZGVzIHJlY2VpdmUgZnJvbSB0aGlzIG5vZGUpDQogICAgICAgIGNvbnN0IG91dHB1dENvbm5lY3Rpb25zID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKQ0KICAgICAgICAgICAgLmZpbHRlcihjb25uID0+IGNvbm4uZnJvbS5ub2RlSWQgPT09IG5vZGVJZCk7DQogICAgICAgIA0KICAgICAgICBpZiAob3V0cHV0Q29ubmVjdGlvbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgY29uc3QgaXNFeHBhbmRlZCA9IHNlY3Rpb25TdGF0ZXNbJ291dHB1dC1jb25uZWN0aW9ucyddOw0KICAgICAgICAgICAgY29uc3QgaGVhZGVyQ2xhc3MgPSBpc0V4cGFuZGVkID8gJycgOiAnY29sbGFwc2VkJzsNCiAgICAgICAgICAgIGNvbnN0IGljb25DbGFzcyA9IGlzRXhwYW5kZWQgPyAnZmFzIGZhLWNoZXZyb24tZG93bicgOiAnZmFzIGZhLWNoZXZyb24tcmlnaHQnOw0KICAgICAgICAgICAgY29uc3QgY29udGVudFN0eWxlID0gaXNFeHBhbmRlZCA/ICcnIDogJyBzdHlsZT0iZGlzcGxheTogbm9uZTsiJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLXNlY3Rpb24iPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbi1oZWFkZXIgJHtoZWFkZXJDbGFzc30iIGRhdGEtc2VjdGlvbj0ib3V0cHV0LWNvbm5lY3Rpb25zIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSIke2ljb25DbGFzc30iPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPk91dHB1dCBDb25uZWN0aW9uczwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbCBjbGFzcz0iY29uZmlnLWNvdW50Ij4oJHtvdXRwdXRDb25uZWN0aW9ucy5sZW5ndGh9KTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbi1jb250ZW50IiBpZD0ib3V0cHV0LWNvbm5lY3Rpb25zLWNvbnRlbnQiJHtjb250ZW50U3R5bGV9Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3V0cHV0LW1hcHBpbmdzLWNvbmZpZyI+DQogICAgICAgICAgICBgOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgKGNvbnN0IGNvbm4gb2Ygb3V0cHV0Q29ubmVjdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubi50by5ub2RlSWQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUodGFyZ2V0Tm9kZT8udHlwZSB8fCAndW5rbm93bicpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGVOYW1lID0gdGFyZ2V0Tm9kZURlZj8ubmFtZSB8fCB0YXJnZXROb2RlPy50eXBlIHx8ICd1bmtub3duJzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHZXQgYXZhaWxhYmxlIG91dHB1dHMgZnJvbSBUSElTIG5vZGUgKHNvdXJjZSBub2RlKQ0KICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZU5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUobm9kZS50eXBlKTsNCiAgICAgICAgICAgICAgICBjb25zdCBhdmFpbGFibGVPdXRwdXRzID0gc291cmNlTm9kZURlZj8ub3V0cHV0cyB8fCBbXTsNCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3V0cHV0LW1hcHBpbmctY29uZmlnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbm5lY3Rpb24taGVhZGVyIj5UbyAke3RhcmdldE5vZGVOYW1lfTwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29ubmVjdGlvbi1jb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+U2VuZCBvdXRwdXQ6PC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0ib3V0cHV0X21hcHBpbmdfJHtub2RlSWR9fCR7Y29ubi5mcm9tLnBvcnROYW1lfXwke2Nvbm4udG8ubm9kZUlkfSIgY2xhc3M9Im91dHB1dC1tYXBwaW5nLXNlbGVjdCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPlNlbGVjdC4uLjwvb3B0aW9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHthdmFpbGFibGVPdXRwdXRzLm1hcChvdXRwdXQgPT4gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxvcHRpb24gdmFsdWU9IiR7b3V0cHV0LmlkfSIgJHtjb25uLmZyb20ucG9ydE5hbWUgPT09IG91dHB1dC5pZCA/ICdzZWxlY3RlZCcgOiAnJ30+JHtvdXRwdXQubmFtZX08L29wdGlvbj5gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmpvaW4oJycpfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIGA7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEdlbmVyYXRlIGNvbmZpZ3VyYXRpb24gZmllbGRzIC0gZ3JvdXBlZCBmb3IgYmV0dGVyIG9yZ2FuaXphdGlvbg0KICAgICAgICBjb25zdCBjb25maWdFbnRyaWVzID0gT2JqZWN0LmVudHJpZXMobm9kZURlZi5jb25maWcpOw0KICAgICAgICBpZiAoY29uZmlnRW50cmllcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBjb25zdCBpc0V4cGFuZGVkID0gc2VjdGlvblN0YXRlc1snbm9kZS1zZXR0aW5ncyddOw0KICAgICAgICAgICAgY29uc3QgaGVhZGVyQ2xhc3MgPSBpc0V4cGFuZGVkID8gJycgOiAnY29sbGFwc2VkJzsNCiAgICAgICAgICAgIGNvbnN0IGljb25DbGFzcyA9IGlzRXhwYW5kZWQgPyAnZmFzIGZhLWNoZXZyb24tZG93bicgOiAnZmFzIGZhLWNoZXZyb24tcmlnaHQnOw0KICAgICAgICAgICAgY29uc3QgY29udGVudFN0eWxlID0gaXNFeHBhbmRlZCA/ICcnIDogJyBzdHlsZT0iZGlzcGxheTogbm9uZTsiJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLXNlY3Rpb24iPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbi1oZWFkZXIgJHtoZWFkZXJDbGFzc30iIGRhdGEtc2VjdGlvbj0ibm9kZS1zZXR0aW5ncyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iJHtpY29uQ2xhc3N9Ij48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5Ob2RlIFNldHRpbmdzPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsIGNsYXNzPSJjb25maWctY291bnQiPigke2NvbmZpZ0VudHJpZXMubGVuZ3RofSk8L3NtYWxsPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uZmlnLXNlY3Rpb24tY29udGVudCIgaWQ9Im5vZGUtc2V0dGluZ3MtY29udGVudCIke2NvbnRlbnRTdHlsZX0+DQogICAgICAgICAgICBgOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGNvbmZpZ10gb2YgY29uZmlnRW50cmllcykgew0KICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iY29uZmlnXyR7bm9kZUlkfV8ke2tleX0iPiR7Y29uZmlnLmxhYmVsfTwvbGFiZWw+DQogICAgICAgICAgICAgICAgYDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnR5cGUgPT09ICdzZWxlY3QnKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxzZWxlY3QgaWQ9ImNvbmZpZ18ke25vZGVJZH1fJHtrZXl9Ij5gOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3Igbm9kZV9yZWZlcmVuY2Ugbm9kZQ0KICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnbm9kZV9yZWZlcmVuY2UnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnc291cmNlX25vZGVfaWQnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUG9wdWxhdGUgd2l0aCBhbGwgYXZhaWxhYmxlIG5vZGVzIChleGNsdWRpbmcgdGhpcyBub2RlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxvcHRpb24gdmFsdWU9IiI+U2VsZWN0IGEgbm9kZS4uLjwvb3B0aW9uPmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbYXZhaWxhYmxlTm9kZUlkLCBhdmFpbGFibGVOb2RlXSBvZiBmbG93RWRpdG9yLm5vZGVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdmFpbGFibGVOb2RlSWQgIT09IG5vZGVJZCkgeyAvLyBEb24ndCBpbmNsdWRlIHNlbGYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF2YWlsYWJsZU5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUoYXZhaWxhYmxlTm9kZS50eXBlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVOYW1lID0gYXZhaWxhYmxlTm9kZURlZiA/IGF2YWlsYWJsZU5vZGVEZWYubmFtZSA6IGF2YWlsYWJsZU5vZGUudHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gbm9kZS5jb25maWdba2V5XS52YWx1ZSA9PT0gYXZhaWxhYmxlTm9kZUlkID8gJ3NlbGVjdGVkJyA6ICcnOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPG9wdGlvbiB2YWx1ZT0iJHthdmFpbGFibGVOb2RlSWR9IiAke3NlbGVjdGVkfT4ke25vZGVOYW1lfSAoJHthdmFpbGFibGVOb2RlSWR9KTwvb3B0aW9uPmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ291dHB1dF9wb3J0X2lkJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBvcHVsYXRlIHdpdGggb3V0cHV0IHBvcnRzIG9mIHRoZSBzZWxlY3RlZCBzb3VyY2Ugbm9kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxvcHRpb24gdmFsdWU9IiI+U2VsZWN0IG91dHB1dCBwb3J0Li4uPC9vcHRpb24+YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE5vZGVJZCA9IG5vZGUuY29uZmlnLnNvdXJjZV9ub2RlX2lkLnZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE5vZGVJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChzZWxlY3RlZE5vZGVJZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE5vZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZShzZWxlY3RlZE5vZGUudHlwZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWROb2RlRGVmICYmIHNlbGVjdGVkTm9kZURlZi5vdXRwdXRzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBvdXRwdXQgb2Ygc2VsZWN0ZWROb2RlRGVmLm91dHB1dHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBub2RlLmNvbmZpZ1trZXldLnZhbHVlID09PSBvdXRwdXQuaWQgPyAnc2VsZWN0ZWQnIDogJyc7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxvcHRpb24gdmFsdWU9IiR7b3V0cHV0LmlkfSIgJHtzZWxlY3RlZH0+JHtvdXRwdXQubmFtZX0gKCR7b3V0cHV0LnR5cGV9KTwvb3B0aW9uPmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWd1bGFyIHNlbGVjdCBmaWVsZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5vcHRpb25zLmZvckVhY2gob3B0aW9uID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBub2RlLmNvbmZpZ1trZXldLnZhbHVlID09PSBvcHRpb24gPyAnc2VsZWN0ZWQnIDogJyc7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxvcHRpb24gdmFsdWU9IiR7b3B0aW9ufSIgJHtzZWxlY3RlZH0+JHtvcHRpb259PC9vcHRpb24+YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZ3VsYXIgc2VsZWN0IGZpZWxkIGZvciBvdGhlciBub2Rlcw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLm9wdGlvbnMuZm9yRWFjaChvcHRpb24gPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gbm9kZS5jb25maWdba2V5XS52YWx1ZSA9PT0gb3B0aW9uID8gJ3NlbGVjdGVkJyA6ICcnOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYDxvcHRpb24gdmFsdWU9IiR7b3B0aW9ufSIgJHtzZWxlY3RlZH0+JHtvcHRpb259PC9vcHRpb24+YDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGA8L3NlbGVjdD5gOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLnR5cGUgPT09ICd0ZXh0YXJlYScpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPHRleHRhcmVhIGlkPSJjb25maWdfJHtub2RlSWR9XyR7a2V5fSI+JHtub2RlLmNvbmZpZ1trZXldLnZhbHVlfTwvdGV4dGFyZWE+YDsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy50eXBlID09PSAnbnVtYmVyJykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW4gPSBjb25maWcubWluID8gYCBtaW49IiR7Y29uZmlnLm1pbn0iYCA6ICcnOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSBjb25maWcubWF4ID8gYCBtYXg9IiR7Y29uZmlnLm1heH0iYCA6ICcnOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGVwID0gY29uZmlnLnN0ZXAgPyBgIHN0ZXA9IiR7Y29uZmlnLnN0ZXB9ImAgOiAnJzsNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImNvbmZpZ18ke25vZGVJZH1fJHtrZXl9IiB2YWx1ZT0iJHtub2RlLmNvbmZpZ1trZXldLnZhbHVlfSIke21pbn0ke21heH0ke3N0ZXB9PmA7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgPGlucHV0IHR5cGU9IiR7Y29uZmlnLnR5cGV9IiBpZD0iY29uZmlnXyR7bm9kZUlkfV8ke2tleX0iIHZhbHVlPSIke25vZGUuY29uZmlnW2tleV0udmFsdWV9Ij5gOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGA8L2Rpdj5gOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBTaG93IG91dHB1dCBkYXRhIGZvciBhbGwgcG9ydHMgKGlmIG5vZGUgaGFzIGJlZW4gZXhlY3V0ZWQpIC0gYXQgdGhlIGJvdHRvbQ0KICAgICAgICBpZiAobm9kZS5sYXN0T3V0cHV0RGF0YSAmJiBub2RlLmxhc3RFeGVjdXRpb25UaW1lKSB7DQogICAgICAgICAgICBjb25zdCBub2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKG5vZGUudHlwZSk7DQogICAgICAgICAgICBjb25zdCBvdXRwdXRzID0gbm9kZURlZi5vdXRwdXRzIHx8IFtdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAob3V0cHV0cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgY29uc3QgaXNFeHBhbmRlZCA9IHNlY3Rpb25TdGF0ZXNbJ291dHB1dC1kYXRhJ107DQogICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyQ2xhc3MgPSBpc0V4cGFuZGVkID8gJycgOiAnY29sbGFwc2VkJzsNCiAgICAgICAgICAgICAgICBjb25zdCBpY29uQ2xhc3MgPSBpc0V4cGFuZGVkID8gJ2ZhcyBmYS1jaGV2cm9uLWRvd24nIDogJ2ZhcyBmYS1jaGV2cm9uLXJpZ2h0JzsNCiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50U3R5bGUgPSBpc0V4cGFuZGVkID8gJycgOiAnIHN0eWxlPSJkaXNwbGF5OiBub25lOyInOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbmZpZ0h0bWwgKz0gYA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbiI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25maWctc2VjdGlvbi1oZWFkZXIgJHtoZWFkZXJDbGFzc30iIGRhdGEtc2VjdGlvbj0ib3V0cHV0LWRhdGEiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSIke2ljb25DbGFzc30iPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5PdXRwdXQgRGF0YTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGwgY2xhc3M9ImNvbmZpZy1jb3VudCI+KCR7b3V0cHV0cy5sZW5ndGh9IHBvcnRzKTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZpZy1zZWN0aW9uLWNvbnRlbnQiIGlkPSJvdXRwdXQtZGF0YS1jb250ZW50IiR7Y29udGVudFN0eWxlfT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6IDEycHg7IGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsgbWFyZ2luLWJvdHRvbTogOHB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExhc3QgZXhlY3V0ZWQ6ICR7bmV3IERhdGUobm9kZS5sYXN0RXhlY3V0aW9uVGltZSkudG9Mb2NhbGVTdHJpbmcoKX0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgb3V0cHV0IG9mIG91dHB1dHMpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IGdldE91dHB1dFBvcnREYXRhKG5vZGUuaWQsIG91dHB1dC5pZCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZCA9IGZvcm1hdERhdGFQcmV2aWV3KG91dHB1dERhdGEpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgY29uZmlnSHRtbCArPSBgDQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LWRpc3BsYXkiIHN0eWxlPSJtYXJnaW4tYm90dG9tOiA4cHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDogNTAwOyBtYXJnaW4tYm90dG9tOiA2cHg7IGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTsgZm9udC1zaXplOiAxM3B4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7b3V0cHV0Lm5hbWV9IDxzcGFuIHN0eWxlPSJjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7IGZvbnQtd2VpZ2h0OiBub3JtYWw7IGZvbnQtc2l6ZTogMTFweDsiPigke2Zvcm1hdHRlZC50eXBlfSk8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHByZSBjbGFzcz0iY29udGVudC10ZXh0IiBzdHlsZT0ibWFyZ2luLWJvdHRvbTogNHB4OyBtYXgtaGVpZ2h0OiA4MHB4OyI+JHtlc2NhcGVIdG1sKGZvcm1hdHRlZC5wcmV2aWV3KX08L3ByZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2Zvcm1hdHRlZC5sZW5ndGggIT09IHVuZGVmaW5lZCA/IGA8ZGl2IHN0eWxlPSJmb250LXNpemU6IDExcHg7IGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsiPkxlbmd0aDogJHtmb3JtYXR0ZWQubGVuZ3RofTwvZGl2PmAgOiAnJ30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2Zvcm1hdHRlZC5rZXlzICE9PSB1bmRlZmluZWQgPyBgPGRpdiBzdHlsZT0iZm9udC1zaXplOiAxMXB4OyBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7Ij5LZXlzOiAke2Zvcm1hdHRlZC5rZXlzfTwvZGl2PmAgOiAnJ30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2Zvcm1hdHRlZC5zaXplICE9PSB1bmRlZmluZWQgPyBgPGRpdiBzdHlsZT0iZm9udC1zaXplOiAxMXB4OyBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7Ij5TaXplOiAkeyhmb3JtYXR0ZWQuc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMil9IEtCPC9kaXY+YCA6ICcnfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7Zm9ybWF0dGVkLmVzdGltYXRlZFNpemUgIT09IHVuZGVmaW5lZCA/IGA8ZGl2IHN0eWxlPSJmb250LXNpemU6IDExcHg7IGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsiPkVzdC4gU2l6ZTogJHsoZm9ybWF0dGVkLmVzdGltYXRlZFNpemUgLyAxMDI0KS50b0ZpeGVkKDIpfSBLQjwvZGl2PmAgOiAnJ30NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb25maWdIdG1sICs9IGANCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25maWdQYW5lbC5pbm5lckhUTUwgPSBjb25maWdIdG1sOw0KICAgICAgICANCiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycyBmb3IgbWFwcGluZyBzZWxlY3RzDQogICAgICAgIC8vIE5vIGlucHV0IG1hcHBpbmcgc2VsZWN0cyBhbnltb3JlIC0gbm9kZXMgY2FuJ3QgY29udHJvbCB3aGF0IHRoZXkgcmVjZWl2ZQ0KICAgICAgICANCiAgICAgICAgY29uc3QgaW5wdXRUYXJnZXRTZWxlY3RzID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXRhcmdldC1zZWxlY3QnKTsNCiAgICAgICAgaW5wdXRUYXJnZXRTZWxlY3RzLmZvckVhY2goc2VsZWN0ID0+IHsNCiAgICAgICAgICAgIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IFtub2RlSWQsIGN1cnJlbnRJbnB1dFBvcnRdID0gZS50YXJnZXQuaWQucmVwbGFjZSgnaW5wdXRfdGFyZ2V0XycsICcnKS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkSW5wdXRQb3J0ID0gZS50YXJnZXQudmFsdWU7DQogICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgY29ubmVjdGlvbg0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLmZpbmQoY29ubiA9Pg0KICAgICAgICAgICAgICAgICAgICBjb25uLnRvLm5vZGVJZCA9PT0gbm9kZUlkICYmIGNvbm4udG8ucG9ydE5hbWUgPT09IGN1cnJlbnRJbnB1dFBvcnQNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uICYmIHNlbGVjdGVkSW5wdXRQb3J0KSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBhbGwgY29ubmVjdGlvbnMgZnJvbSB0aGUgc2FtZSBmcm9tTm9kZSB0byB0aGlzIG5vZGUgKHJlZ2FyZGxlc3Mgb2YgcG9ydCkNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbnNUb1JlbW92ZSA9IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkuZmlsdGVyKGNvbm4gPT4NCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4uZnJvbS5ub2RlSWQgPT09IGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgJiYgY29ubi50by5ub2RlSWQgPT09IG5vZGVJZA0KICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uc1RvUmVtb3ZlLmZvckVhY2goY29ubiA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLmRlbGV0ZShjb25uLmlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25uLnN2ZykgY29ubi5zdmcucmVtb3ZlKCk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIG5ldyBjb25uZWN0aW9uDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb25JZCA9IGBjb25uXyR7Y29ubmVjdGlvbi5mcm9tLm5vZGVJZH1fJHtjb25uZWN0aW9uLmZyb20ucG9ydE5hbWV9XyR7bm9kZUlkfV8ke3NlbGVjdGVkSW5wdXRQb3J0fWA7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb24gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZDogbmV3Q29ubmVjdGlvbklkLA0KICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogeyBub2RlSWQ6IGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQsIHBvcnROYW1lOiBjb25uZWN0aW9uLmZyb20ucG9ydE5hbWUgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB7IG5vZGVJZDogbm9kZUlkLCBwb3J0TmFtZTogc2VsZWN0ZWRJbnB1dFBvcnQgfQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnNldChuZXdDb25uZWN0aW9uSWQsIG5ld0Nvbm5lY3Rpb24pOw0KICAgICAgICAgICAgICAgICAgICBkcmF3Q29ubmVjdGlvbihuZXdDb25uZWN0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXV0by1zYXZlDQogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2F2ZUZsb3cpIHdpbmRvdy5zYXZlRmxvdygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGNvbnN0IG91dHB1dE1hcHBpbmdTZWxlY3RzID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLm91dHB1dC1tYXBwaW5nLXNlbGVjdCcpOw0KICAgICAgICBvdXRwdXRNYXBwaW5nU2VsZWN0cy5mb3JFYWNoKHNlbGVjdCA9PiB7DQogICAgICAgICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGUudGFyZ2V0LmlkLnJlcGxhY2UoJ291dHB1dF9tYXBwaW5nXycsICcnKS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJZCA9IHBhcnRzWzBdOw0KICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dFBvcnQgPSBwYXJ0c1sxXTsNCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlSWQgPSBwYXJ0c1syXTsNCiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZE91dHB1dFBvcnQgPSBlLnRhcmdldC52YWx1ZTsNCiAgICAgICAgICAgICAgICB1cGRhdGVPdXRwdXRNYXBwaW5nKG5vZGVJZCwgb3V0cHV0UG9ydCwgdGFyZ2V0Tm9kZUlkLCBzZWxlY3RlZE91dHB1dFBvcnQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycyBmb3Igc3BlY2lhbCBidXR0b25zDQogICAgICAgIGNvbnN0IHZpZXdGdWxsSW1hZ2VCdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcudmlldy1mdWxsLWltYWdlLWJ0bicpOw0KICAgICAgICBpZiAodmlld0Z1bGxJbWFnZUJ0bikgew0KICAgICAgICAgICAgdmlld0Z1bGxJbWFnZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtaWQnKTsNCiAgICAgICAgICAgICAgICBzaG93RnVsbEltYWdlKG5vZGVJZCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uc3QgcGxheUF1ZGlvQnRuID0gY29uZmlnUGFuZWwucXVlcnlTZWxlY3RvcignLnBsYXktYXVkaW8tYnRuJyk7DQogICAgICAgIGlmIChwbGF5QXVkaW9CdG4pIHsNCiAgICAgICAgICAgIHBsYXlBdWRpb0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW5vZGUtaWQnKTsNCiAgICAgICAgICAgICAgICBwbGF5QXVkaW8obm9kZUlkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCBzdG9wQXVkaW9CdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcuc3RvcC1hdWRpby1idG4nKTsNCiAgICAgICAgaWYgKHN0b3BBdWRpb0J0bikgew0KICAgICAgICAgICAgc3RvcEF1ZGlvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9kZS1pZCcpOw0KICAgICAgICAgICAgICAgIHN0b3BBdWRpbyhub2RlSWQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGNvbnN0IHN0YXJ0UmVwZWF0ZXJCdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcuc3RhcnQtcmVwZWF0ZXItYnRuJyk7DQogICAgICAgIGlmIChzdGFydFJlcGVhdGVyQnRuKSB7DQogICAgICAgICAgICBzdGFydFJlcGVhdGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9kZS1pZCcpOw0KICAgICAgICAgICAgICAgIHN0YXJ0UmVwZWF0ZXIobm9kZUlkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCBzdG9wUmVwZWF0ZXJCdG4gPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yKCcuc3RvcC1yZXBlYXRlci1idG4nKTsNCiAgICAgICAgaWYgKHN0b3BSZXBlYXRlckJ0bikgew0KICAgICAgICAgICAgc3RvcFJlcGVhdGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBub2RlSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9kZS1pZCcpOw0KICAgICAgICAgICAgICAgIHN0b3BSZXBlYXRlcihub2RlSWQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEFkZCBjaGFuZ2UgbGlzdGVuZXJzDQogICAgICAgIGZvciAoY29uc3QgW2tleSwgY29uZmlnXSBvZiBPYmplY3QuZW50cmllcyhub2RlRGVmLmNvbmZpZykpIHsNCiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgY29uZmlnXyR7bm9kZUlkfV8ke2tleX1gKTsNCiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7DQogICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBub2RlLmNvbmZpZ1trZXldLnZhbHVlID0gZS50YXJnZXQudmFsdWU7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBkaXNwbGF5IG5vZGUgZm9ybWF0IGNoYW5nZXMNCiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ2Rpc3BsYXknICYmIGtleSA9PT0gJ2Zvcm1hdCcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZGlzcGxheS1mb3JtYXQtJHtub2RlSWR9YCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybWF0RWxlbWVudCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdEVsZW1lbnQudGV4dENvbnRlbnQgPSBlLnRhcmdldC52YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3Igbm9kZV9yZWZlcmVuY2Ugc291cmNlIG5vZGUgY2hhbmdlcw0KICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnbm9kZV9yZWZlcmVuY2UnICYmIGtleSA9PT0gJ3NvdXJjZV9ub2RlX2lkJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBvdXRwdXQgcG9ydCBkcm9wZG93biB3aGVuIHNvdXJjZSBub2RlIGNoYW5nZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dFBvcnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgY29uZmlnXyR7bm9kZUlkfV9vdXRwdXRfcG9ydF9pZGApOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG91dHB1dFBvcnRTZWxlY3QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciBhbmQgcmVwb3B1bGF0ZSBvdXRwdXQgcG9ydCBvcHRpb25zDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0UG9ydFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj5TZWxlY3Qgb3V0cHV0IHBvcnQuLi48L29wdGlvbj4nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTm9kZUlkID0gZS50YXJnZXQudmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkTm9kZUlkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KHNlbGVjdGVkTm9kZUlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkTm9kZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWROb2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKHNlbGVjdGVkTm9kZS50eXBlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE5vZGVEZWYgJiYgc2VsZWN0ZWROb2RlRGVmLm91dHB1dHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG91dHB1dCBvZiBzZWxlY3RlZE5vZGVEZWYub3V0cHV0cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gb3V0cHV0LmlkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBgJHtvdXRwdXQubmFtZX0gKCR7b3V0cHV0LnR5cGV9KWA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFBvcnRTZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIG91dHB1dCBwb3J0IHZhbHVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jb25maWcub3V0cHV0X3BvcnRfaWQudmFsdWUgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBBZGQgY29sbGFwc2libGUgc2VjdGlvbiBmdW5jdGlvbmFsaXR5IHdpdGggcGVyc2lzdGVuY2UNCiAgICAgICAgY29uc3Qgc2VjdGlvbkhlYWRlcnMgPSBjb25maWdQYW5lbC5xdWVyeVNlbGVjdG9yQWxsKCcuY29uZmlnLXNlY3Rpb24taGVhZGVyJyk7DQogICAgICAgIHNlY3Rpb25IZWFkZXJzLmZvckVhY2goaGVhZGVyID0+IHsNCiAgICAgICAgICAgIGhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7DQogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlY3Rpb25JZCA9IGhlYWRlci5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2VjdGlvbicpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtzZWN0aW9uSWR9LWNvbnRlbnRgKTsNCiAgICAgICAgICAgICAgICBjb25zdCBpY29uID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJ2knKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoY29udGVudCAmJiBpY29uKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29sbGFwc2VkID0gaGVhZGVyLmNsYXNzTGlzdC5jb250YWlucygnY29sbGFwc2VkJyk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb2xsYXBzZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4cGFuZA0KICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbGxhcHNlZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5zdHlsZS5kaXNwbGF5ID0gJyc7DQogICAgICAgICAgICAgICAgICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1kb3duJzsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbGxhcHNlDQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LmFkZCgnY29sbGFwc2VkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1yaWdodCc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdGhlIHN0YXRlIHRvIGFwcCBzZXR0aW5ncyAodHJ1ZSA9IGV4cGFuZGVkLCBmYWxzZSA9IGNvbGxhcHNlZCkNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuc2V0U2V0dGluZykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzRXhwYW5kZWQgPSAhaGVhZGVyLmNsYXNzTGlzdC5jb250YWlucygnY29sbGFwc2VkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3lwbmV4QVBJLnNldFNldHRpbmcoYGNvbmZpZ19zZWN0aW9uXyR7c2VjdGlvbklkfWAsIGlzRXhwYW5kZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gc2F2ZSBjb25maWcgc2VjdGlvbiBzdGF0ZTonLCBlcnJvcik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfQ0KfQ0KDQovLyBub2RlLXJlbmRlcmVyLmpzIC0gRHluYW1pYyBub2RlIHJlbmRlcmluZyBmb3IgRmxvdyBFZGl0b3INCg0KY2xhc3MgTm9kZVJlbmRlcmVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgdGhpcy50ZW1wbGF0ZXMgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMuc2V0dXBTdGFuZGFyZFRlbXBsYXRlKCk7DQogICAgfQ0KICAgIA0KICAgIHNldHVwU3RhbmRhcmRUZW1wbGF0ZSgpIHsNCiAgICAgICAgdGhpcy50ZW1wbGF0ZXMuc2V0KCdzdGFuZGFyZCcsIHsNCiAgICAgICAgICAgIHJlbmRlcjogKG5vZGUsIG5vZGVEZWYpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dHMgPSBub2RlRGVmLmlucHV0cyB8fCBbXTsNCiAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRzID0gbm9kZURlZi5vdXRwdXRzIHx8IFtdOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBgDQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsb3ctbm9kZS1oZWFkZXIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9IiR7bm9kZURlZi5pY29ufSI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtub2RlRGVmLm5hbWV9PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZsb3ctbm9kZS10eXBlICR7bm9kZS50eXBlfSI+JHtub2RlLnR5cGUudG9VcHBlckNhc2UoKX08L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJub2RlLWRlbGV0ZS1idG4iIHRpdGxlPSJEZWxldGUgbm9kZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbG93LW5vZGUtY29udGVudCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJub2RlLWRlZmF1bHQtY29udGVudCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsIGNsYXNzPSJ0ZXh0LW11dGVkIj4ke25vZGVEZWYuZGVzY3JpcHRpb259PC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxvdy1ub2RlLXBvcnRzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICR7aW5wdXRzLm1hcChpbnB1dCA9PiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBjbGFzcz0iZmxvdy1ub2RlLXBvcnQgaW5wdXQiIGRhdGEtcG9ydD0iJHtpbnB1dC5pZH0iPjwvZGl2PmANCiAgICAgICAgICAgICAgICAgICAgICAgICkuam9pbignJyl9DQogICAgICAgICAgICAgICAgICAgICAgICAke291dHB1dHMubWFwKG91dHB1dCA9PiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBjbGFzcz0iZmxvdy1ub2RlLXBvcnQgb3V0cHV0IiBkYXRhLXBvcnQ9IiR7b3V0cHV0LmlkfSI+PC9kaXY+YA0KICAgICAgICAgICAgICAgICAgICAgICAgKS5qb2luKCcnKX0NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIA0KICAgIHJlZ2lzdGVyVGVtcGxhdGUobmFtZSwgdGVtcGxhdGUpIHsNCiAgICAgICAgdGhpcy50ZW1wbGF0ZXMuc2V0KG5hbWUsIHRlbXBsYXRlKTsNCiAgICB9DQogICAgDQogICAgcmVuZGVyTm9kZShub2RlKSB7DQogICAgICAgIGNvbnN0IG5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUobm9kZS50eXBlKTsNCiAgICAgICAgaWYgKCFub2RlRGVmKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBObyBub2RlIGRlZmluaXRpb24gZm91bmQgZm9yIHR5cGU6ICR7bm9kZS50eXBlfWApOw0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCB0ZW1wbGF0ZU5hbWUgPSBub2RlRGVmLnRlbXBsYXRlIHx8ICdzdGFuZGFyZCc7DQogICAgICAgIGNvbnN0IHRlbXBsYXRlID0gdGhpcy50ZW1wbGF0ZXMuZ2V0KHRlbXBsYXRlTmFtZSk7DQogICAgICAgIA0KICAgICAgICBpZiAoIXRlbXBsYXRlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBObyB0ZW1wbGF0ZSBmb3VuZDogJHt0ZW1wbGF0ZU5hbWV9YCk7DQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHJldHVybiB0ZW1wbGF0ZS5yZW5kZXIobm9kZSwgbm9kZURlZik7DQogICAgfQ0KICAgIA0KICAgIGNyZWF0ZU5vZGVFbGVtZW50KG5vZGUpIHsNCiAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NOYW1lID0gYGZsb3ctbm9kZSAke25vZGUudHlwZX0tbm9kZWA7DQogICAgICAgIG5vZGVFbGVtZW50LmlkID0gbm9kZS5pZDsNCiAgICAgICAgbm9kZUVsZW1lbnQuc3R5bGUubGVmdCA9IG5vZGUueCArICdweCc7DQogICAgICAgIG5vZGVFbGVtZW50LnN0eWxlLnRvcCA9IG5vZGUueSArICdweCc7DQogICAgICAgIA0KICAgICAgICAvLyBSZW5kZXIgdGhlIG5vZGUgY29udGVudA0KICAgICAgICBub2RlRWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLnJlbmRlck5vZGUobm9kZSk7DQogICAgICAgIA0KICAgICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzIGFuZCBnZXQgdGhlIHVwZGF0ZWQgZWxlbWVudA0KICAgICAgICBjb25zdCBmaW5hbEVsZW1lbnQgPSB0aGlzLmFkZE5vZGVFdmVudExpc3RlbmVycyhub2RlRWxlbWVudCwgbm9kZSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gZmluYWxFbGVtZW50Ow0KICAgIH0NCiAgICANCiAgICBhZGROb2RlRXZlbnRMaXN0ZW5lcnMobm9kZUVsZW1lbnQsIG5vZGUpIHsNCiAgICAgICAgLy8gRGVsZXRlIGJ1dHRvbg0KICAgICAgICBjb25zdCBkZWxldGVCdG4gPSBub2RlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcubm9kZS1kZWxldGUtYnRuJyk7DQogICAgICAgIGlmIChkZWxldGVCdG4pIHsNCiAgICAgICAgICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgICAgICBkZWxldGVOb2RlKG5vZGUuaWQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIE5vZGUgc2VsZWN0aW9uDQogICAgICAgIG5vZGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcubm9kZS1kZWxldGUtYnRuJykpIHJldHVybjsNCiAgICAgICAgICAgIHNlbGVjdE5vZGUobm9kZS5pZCk7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgLy8gTm9kZSBkcmFnZ2luZw0KICAgICAgICBub2RlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZSkgPT4gew0KICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJy5ub2RlLWRlbGV0ZS1idG4nKSkgcmV0dXJuOw0KICAgICAgICAgICAgc3RhcnREcmFnZ2luZ05vZGUobm9kZS5pZCwgZSk7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgLy8gUG9ydCBjb25uZWN0aW9ucw0KICAgICAgICBjb25zdCBwb3J0cyA9IG5vZGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mbG93LW5vZGUtcG9ydCcpOw0KICAgICAgICBwb3J0cy5mb3JFYWNoKHBvcnQgPT4gew0KICAgICAgICAgICAgcG9ydC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZSkgPT4gew0KICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgc3RhcnRDb25uZWN0aW9uKG5vZGUuaWQsIHBvcnQuZGF0YXNldC5wb3J0LCBwb3J0LmNsYXNzTGlzdC5jb250YWlucygnb3V0cHV0JykpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIG5vZGVFbGVtZW50Ow0KICAgIH0NCn0NCg0KLy8gR2xvYmFsIG5vZGUgcmVuZGVyZXIgaW5zdGFuY2UNCmNvbnN0IG5vZGVSZW5kZXJlciA9IG5ldyBOb2RlUmVuZGVyZXIoKTsNCg0KDQovLyBUZXh0IE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVUZXh0Tm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCB0ZXh0Q29udGVudCA9IG5vZGUuY29uZmlnLnRleHRfY29udGVudC52YWx1ZTsNCg0KICAgIHJldHVybiB7IHRleHQ6IHRleHRDb250ZW50IH07DQp9DQoNCg0KLy8gSlNPTiBFeHRyYWN0IE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVKc29uRXh0cmFjdE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgZmllbGRQYXRoID0gbm9kZS5jb25maWcuZmllbGRfcGF0aC52YWx1ZTsNCiAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBub2RlLmNvbmZpZy5kZWZhdWx0X3ZhbHVlPy52YWx1ZSB8fCAnJzsNCg0KICAgIC8vIEFjY2VwdCBhbnkgaW5wdXQgZGF0YSwgbm90IGp1c3QganNvbl9kYXRhDQogICAgbGV0IGpzb25EYXRhID0gbnVsbDsNCg0KICAgIC8vIFRyeSB0byBmaW5kIEpTT04gZGF0YSBmcm9tIGFueSBpbnB1dA0KICAgIGlmIChpbnB1dERhdGEuanNvbl9kYXRhKSB7DQogICAgICAgIGpzb25EYXRhID0gaW5wdXREYXRhLmpzb25fZGF0YTsNCiAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5kYXRhKSB7DQogICAgICAgIGpzb25EYXRhID0gaW5wdXREYXRhLmRhdGE7DQogICAgfSBlbHNlIGlmIChpbnB1dERhdGEudGV4dCkgew0KICAgICAgICBqc29uRGF0YSA9IGlucHV0RGF0YS50ZXh0Ow0KICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLnJlc3BvbnNlKSB7DQogICAgICAgIGpzb25EYXRhID0gaW5wdXREYXRhLnJlc3BvbnNlOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIFVzZSB0aGUgZmlyc3QgYXZhaWxhYmxlIGlucHV0DQogICAgICAgIGNvbnN0IGZpcnN0SW5wdXQgPSBPYmplY3QudmFsdWVzKGlucHV0RGF0YSlbMF07DQogICAgICAgIGpzb25EYXRhID0gZmlyc3RJbnB1dDsNCiAgICB9DQoNCg0KICAgIGxldCBleHRyYWN0ZWRWYWx1ZSA9IG51bGw7DQoNCiAgICB0cnkgew0KICAgICAgICAvLyBQYXJzZSBKU09OIGlmIGl0J3MgYSBzdHJpbmcNCiAgICAgICAgaWYgKHR5cGVvZiBqc29uRGF0YSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIGpzb25EYXRhID0gSlNPTi5wYXJzZShqc29uRGF0YSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBFeHRyYWN0IHZhbHVlIHVzaW5nIGRvdCBub3RhdGlvbg0KICAgICAgICBleHRyYWN0ZWRWYWx1ZSA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZXh0cmFjdE5lc3RlZFZhbHVlKGpzb25EYXRhLCBmaWVsZFBhdGgpOw0KDQogICAgICAgIC8vIFVzZSBkZWZhdWx0IHZhbHVlIGlmIGV4dHJhY3Rpb24gZmFpbGVkDQogICAgICAgIGlmIChleHRyYWN0ZWRWYWx1ZSA9PT0gbnVsbCB8fCBleHRyYWN0ZWRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBleHRyYWN0ZWRWYWx1ZSA9IGRlZmF1bHRWYWx1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEZvcm1hdCB0aGUgb3V0cHV0IGFzIHN0cmluZyBmb3IgY29uc2lzdGVuY3kNCiAgICAgICAgbGV0IGZvcm1hdHRlZFZhbHVlID0gU3RyaW5nKGV4dHJhY3RlZFZhbHVlKTsNCg0KICAgICAgICAvLyBTdG9yZSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICAgICAgbm9kZS5sYXN0RXh0cmFjdGVkVmFsdWUgPSBmb3JtYXR0ZWRWYWx1ZTsNCiAgICAgICAgbm9kZS5sYXN0RmllbGRQYXRoID0gZmllbGRQYXRoOw0KDQogICAgICAgIC8vIERlYnVnIGxvZ2dpbmcNCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZGF0YTogZm9ybWF0dGVkVmFsdWUsDQogICAgICAgICAgICB0ZXh0OiBmb3JtYXR0ZWRWYWx1ZSwNCiAgICAgICAgICAgIGpzb246IGV4dHJhY3RlZFZhbHVlLA0KICAgICAgICAgICAgZXh0cmFjdGVkX3ZhbHVlOiBmb3JtYXR0ZWRWYWx1ZSwNCiAgICAgICAgICAgIGZpZWxkX3BhdGg6IGZpZWxkUGF0aCwNCiAgICAgICAgICAgIG9yaWdpbmFsOiBqc29uRGF0YQ0KICAgICAgICB9Ow0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pTT04gRXh0cmFjdCBlcnJvcjonLCBlcnJvcik7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBkYXRhOiBkZWZhdWx0VmFsdWUsDQogICAgICAgICAgICB0ZXh0OiBkZWZhdWx0VmFsdWUsDQogICAgICAgICAgICBqc29uOiBudWxsLA0KICAgICAgICAgICAgZXh0cmFjdGVkX3ZhbHVlOiBkZWZhdWx0VmFsdWUsDQogICAgICAgICAgICBmaWVsZF9wYXRoOiBmaWVsZFBhdGgsDQogICAgICAgICAgICBvcmlnaW5hbDoganNvbkRhdGEsDQogICAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZQ0KICAgICAgICB9Ow0KICAgIH0NCn0NCg0KDQovLyBSYW5kb20gTGluZSBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlUmFuZG9tUXVvdGVOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IHNraXBFbXB0eSA9IG5vZGUuY29uZmlnLnNraXBfZW1wdHkudmFsdWUgPT09ICd0cnVlJzsNCiAgICBjb25zdCB0cmltV2hpdGVzcGFjZSA9IG5vZGUuY29uZmlnLnRyaW1fd2hpdGVzcGFjZS52YWx1ZSA9PT0gJ3RydWUnOw0KICAgIGNvbnN0IG1heExlbmd0aCA9IHBhcnNlSW50KG5vZGUuY29uZmlnLm1heF9sZW5ndGgudmFsdWUpOw0KDQoNCiAgICBsZXQgdGV4dCA9IGlucHV0RGF0YS50ZXh0Ow0KICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KHRleHQpOw0KICAgIH0NCg0KDQogICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpOw0KDQogICAgbGV0IHZhbGlkTGluZXMgPSBsaW5lczsNCg0KICAgIGlmIChza2lwRW1wdHkpIHsNCiAgICAgICAgdmFsaWRMaW5lcyA9IGxpbmVzLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpLmxlbmd0aCA+IDApOw0KICAgIH0NCg0KICAgIGlmICh0cmltV2hpdGVzcGFjZSkgew0KICAgICAgICB2YWxpZExpbmVzID0gdmFsaWRMaW5lcy5tYXAobGluZSA9PiBsaW5lLnRyaW0oKSk7DQogICAgfQ0KDQogICAgaWYgKHZhbGlkTGluZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHJldHVybiB7IHJhbmRvbV9saW5lOiBudWxsLCBsaW5lX251bWJlcjogMCwgdG90YWxfbGluZXM6IDAgfTsNCiAgICB9DQoNCiAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbGlkTGluZXMubGVuZ3RoKTsNCiAgICBsZXQgcmFuZG9tTGluZSA9IHZhbGlkTGluZXNbcmFuZG9tSW5kZXhdOw0KDQoNCiAgICBpZiAobWF4TGVuZ3RoID4gMCAmJiByYW5kb21MaW5lLmxlbmd0aCA+IG1heExlbmd0aCkgew0KICAgICAgICByYW5kb21MaW5lID0gcmFuZG9tTGluZS5zdWJzdHJpbmcoMCwgbWF4TGVuZ3RoKSArICcuLi4nOw0KICAgIH0NCg0KICAgIGNvbnN0IHJlc3VsdCA9IHsNCiAgICAgICAgcmFuZG9tX2xpbmU6IHJhbmRvbUxpbmUsDQogICAgICAgIGxpbmVfbnVtYmVyOiByYW5kb21JbmRleCArIDEsDQogICAgICAgIHRvdGFsX2xpbmVzOiB2YWxpZExpbmVzLmxlbmd0aA0KICAgIH07DQoNCiAgICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQovLyBNYXRoIE9wZXJhdGlvbnMgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZU1hdGhOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5vZGUuY29uZmlnLm9wZXJhdGlvbi52YWx1ZTsNCiAgICBjb25zdCBjb25maWdWYWx1ZUEgPSBwYXJzZUZsb2F0KG5vZGUuY29uZmlnLnZhbHVlX2EudmFsdWUpIHx8IDA7DQogICAgY29uc3QgY29uZmlnVmFsdWVCID0gcGFyc2VGbG9hdChub2RlLmNvbmZpZy52YWx1ZV9iLnZhbHVlKSB8fCAwOw0KICAgIGxldCBkZWNpbWFsUGxhY2VzID0gcGFyc2VJbnQobm9kZS5jb25maWcuZGVjaW1hbF9wbGFjZXMudmFsdWUpOw0KICAgIGlmIChpc05hTihkZWNpbWFsUGxhY2VzKSkgZGVjaW1hbFBsYWNlcyA9IDA7IC8vIERlZmF1bHQgdG8gMCBpZiBub3QgYSBudW1iZXINCg0KICAgIC8vIEdldCB2YWx1ZXMgZnJvbSBpbnB1dHMgb3IgY29uZmlnDQogICAgbGV0IHZhbHVlQSA9IGlucHV0RGF0YS52YWx1ZV9hICE9PSB1bmRlZmluZWQgPyBpbnB1dERhdGEudmFsdWVfYSA6IA0KICAgICAgICAgICAgICAgICBpbnB1dERhdGEubnVtYmVyX2EgIT09IHVuZGVmaW5lZCA/IGlucHV0RGF0YS5udW1iZXJfYSA6IGNvbmZpZ1ZhbHVlQTsNCiAgICBsZXQgdmFsdWVCID0gaW5wdXREYXRhLnZhbHVlX2IgIT09IHVuZGVmaW5lZCA/IGlucHV0RGF0YS52YWx1ZV9iIDogDQogICAgICAgICAgICAgICAgIGlucHV0RGF0YS5udW1iZXJfYiAhPT0gdW5kZWZpbmVkID8gaW5wdXREYXRhLm51bWJlcl9iIDogY29uZmlnVmFsdWVCOw0KDQogICAgLy8gQ29udmVydCB0byBudW1iZXJzDQogICAgaWYgKHR5cGVvZiB2YWx1ZUEgPT09ICdzdHJpbmcnKSB2YWx1ZUEgPSBwYXJzZUZsb2F0KHZhbHVlQSkgfHwgMDsNCiAgICBpZiAodHlwZW9mIHZhbHVlQiA9PT0gJ3N0cmluZycpIHZhbHVlQiA9IHBhcnNlRmxvYXQodmFsdWVCKSB8fCAwOw0KICAgIGlmICh0eXBlb2YgdmFsdWVBID09PSAnb2JqZWN0JyAmJiB2YWx1ZUEgIT09IG51bGwpIHsNCiAgICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QgbnVtZXJpYyB2YWx1ZSBmcm9tIG9iamVjdA0KICAgICAgICB2YWx1ZUEgPSBwYXJzZUZsb2F0KHZhbHVlQS52YWx1ZSB8fCB2YWx1ZUEucmVzdWx0IHx8IHZhbHVlQS5kYXRhIHx8IDApOw0KICAgIH0NCiAgICBpZiAodHlwZW9mIHZhbHVlQiA9PT0gJ29iamVjdCcgJiYgdmFsdWVCICE9PSBudWxsKSB7DQogICAgICAgIHZhbHVlQiA9IHBhcnNlRmxvYXQodmFsdWVCLnZhbHVlIHx8IHZhbHVlQi5yZXN1bHQgfHwgdmFsdWVCLmRhdGEgfHwgMCk7DQogICAgfQ0KDQogICAgbGV0IHJlc3VsdCA9IDA7DQoNCiAgICB0cnkgew0KICAgICAgICBzd2l0Y2ggKG9wZXJhdGlvbikgew0KICAgICAgICAgICAgY2FzZSAnYWRkJzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZUEgKyB2YWx1ZUI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdzdWJ0cmFjdCc6DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWVBIC0gdmFsdWVCOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnbXVsdGlwbHknOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlQSAqIHZhbHVlQjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2RpdmlkZSc6DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlQiA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKCdEaXZpc2lvbiBieSB6ZXJvJyk7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWVBIC8gdmFsdWVCOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnbW9kdWxvJzoNCiAgICAgICAgICAgICAgICBpZiAodmFsdWVCID09PSAwKSB0aHJvdyBuZXcgRXJyb3IoJ01vZHVsbyBieSB6ZXJvJyk7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWVBICUgdmFsdWVCOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAncG93ZXInOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1hdGgucG93KHZhbHVlQSwgdmFsdWVCKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ21pbic6DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gTWF0aC5taW4odmFsdWVBLCB2YWx1ZUIpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnbWF4JzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBNYXRoLm1heCh2YWx1ZUEsIHZhbHVlQik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhYnMnOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1hdGguYWJzKHZhbHVlQSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdyb3VuZCc6DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gTWF0aC5yb3VuZCh2YWx1ZUEpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnZmxvb3InOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1hdGguZmxvb3IodmFsdWVBKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2NlaWwnOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1hdGguY2VpbCh2YWx1ZUEpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZUE7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSb3VuZCB0byBzcGVjaWZpZWQgZGVjaW1hbCBwbGFjZXMNCiAgICAgICAgaWYgKGRlY2ltYWxQbGFjZXMgPj0gMCkgew0KICAgICAgICAgICAgcmVzdWx0ID0gcGFyc2VGbG9hdChyZXN1bHQudG9GaXhlZChkZWNpbWFsUGxhY2VzKSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTdG9yZSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICAgICAgbm9kZS5sYXN0VmFsdWVBID0gdmFsdWVBOw0KICAgICAgICBub2RlLmxhc3RWYWx1ZUIgPSB2YWx1ZUI7DQogICAgICAgIG5vZGUubGFzdFJlc3VsdCA9IHJlc3VsdDsNCiAgICAgICAgbm9kZS5sYXN0T3BlcmF0aW9uID0gb3BlcmF0aW9uOw0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICByZXN1bHQ6IHJlc3VsdCwNCiAgICAgICAgICAgIGRhdGE6IHJlc3VsdCwNCiAgICAgICAgICAgIHRleHQ6IHJlc3VsdC50b1N0cmluZygpLA0KICAgICAgICAgICAgZm9ybWF0dGVkOiBkZWNpbWFsUGxhY2VzID09PSAwID8gcmVzdWx0LnRvU3RyaW5nKCkgOiByZXN1bHQudG9GaXhlZChkZWNpbWFsUGxhY2VzKQ0KICAgICAgICB9Ow0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ01hdGggb3BlcmF0aW9uIGVycm9yOicsIGVycm9yKTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIHJlc3VsdDogMCwNCiAgICAgICAgICAgIGRhdGE6IDAsDQogICAgICAgICAgICB0ZXh0OiAiMCIsDQogICAgICAgICAgICBmb3JtYXR0ZWQ6IGRlY2ltYWxQbGFjZXMgPT09IDAgPyAiMCIgOiAiMC4wMCIsDQogICAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZQ0KICAgICAgICB9Ow0KICAgIH0NCn0NCg0KLy8gQXJyYXkgT3BlcmF0aW9ucyBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlQXJyYXlOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5vZGUuY29uZmlnLm9wZXJhdGlvbi52YWx1ZTsNCiAgICBjb25zdCBmaWVsZFBhdGggPSBub2RlLmNvbmZpZy5maWVsZF9wYXRoLnZhbHVlOw0KICAgIGNvbnN0IGZpbHRlclZhbHVlID0gbm9kZS5jb25maWcuZmlsdGVyX3ZhbHVlLnZhbHVlOw0KICAgIGNvbnN0IGZpbHRlck9wZXJhdG9yID0gbm9kZS5jb25maWcuZmlsdGVyX29wZXJhdG9yLnZhbHVlOw0KICAgIGNvbnN0IGpvaW5TZXBhcmF0b3IgPSBub2RlLmNvbmZpZy5qb2luX3NlcGFyYXRvci52YWx1ZSB8fCAnLCAnOw0KICAgIGNvbnN0IHNsaWNlU3RhcnQgPSBwYXJzZUludChub2RlLmNvbmZpZy5zbGljZV9zdGFydC52YWx1ZSkgfHwgMDsNCiAgICBjb25zdCBzbGljZUVuZCA9IHBhcnNlSW50KG5vZGUuY29uZmlnLnNsaWNlX2VuZC52YWx1ZSkgfHwgMDsNCg0KICAgIC8vIEdldCBhcnJheSBmcm9tIGlucHV0DQogICAgbGV0IGFycmF5ID0gaW5wdXREYXRhLmFycmF5IHx8IGlucHV0RGF0YS5kYXRhOw0KICAgIA0KICAgIC8vIFBhcnNlIGlmIGl0J3MgYSBzdHJpbmcNCiAgICBpZiAodHlwZW9mIGFycmF5ID09PSAnc3RyaW5nJykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXJyYXkgPSBKU09OLnBhcnNlKGFycmF5KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHBhcnNlIGFycmF5OicsIGUpOw0KICAgICAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiBudWxsLCBlcnJvcjogJ0ludmFsaWQgYXJyYXkgZGF0YScgfTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmICghQXJyYXkuaXNBcnJheShhcnJheSkpIHsNCiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiBudWxsLCBlcnJvcjogJ0lucHV0IGlzIG5vdCBhbiBhcnJheScgfTsNCiAgICB9DQoNCiAgICBsZXQgcmVzdWx0ID0gbnVsbDsNCg0KICAgIHRyeSB7DQogICAgICAgIHN3aXRjaCAob3BlcmF0aW9uKSB7DQogICAgICAgICAgICBjYXNlICdtYXAnOg0KICAgICAgICAgICAgICAgIGlmIChmaWVsZFBhdGgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXJyYXkubWFwKGl0ZW0gPT4gd2luZG93LmZsb3dFZGl0b3JVdGlscy5leHRyYWN0TmVzdGVkVmFsdWUoaXRlbSwgZmllbGRQYXRoKSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXJyYXkuc2xpY2UoKTsgLy8gUmV0dXJuIGNvcHkgb2YgYXJyYXkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdmaWx0ZXInOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFycmF5LmZpbHRlcihpdGVtID0+IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gZmllbGRQYXRoID8gd2luZG93LmZsb3dFZGl0b3JVdGlscy5leHRyYWN0TmVzdGVkVmFsdWUoaXRlbSwgZmllbGRQYXRoKSA6IGl0ZW07DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwZXJmb3JtRmlsdGVyT3BlcmF0aW9uKHZhbHVlLCBmaWx0ZXJWYWx1ZSwgZmlsdGVyT3BlcmF0b3IpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnbGVuZ3RoJzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBhcnJheS5sZW5ndGg7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdqb2luJzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBhcnJheS5tYXAoaXRlbSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZFBhdGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmV4dHJhY3ROZXN0ZWRWYWx1ZShpdGVtLCBmaWVsZFBhdGgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IFN0cmluZyhpdGVtKTsNCiAgICAgICAgICAgICAgICB9KS5qb2luKGpvaW5TZXBhcmF0b3IpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnZmlyc3QnOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFycmF5Lmxlbmd0aCA+IDAgPyBhcnJheVswXSA6IG51bGw7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdsYXN0JzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBhcnJheS5sZW5ndGggPiAwID8gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV0gOiBudWxsOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnc2xpY2UnOg0KICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHNsaWNlRW5kID4gMCA/IHNsaWNlRW5kIDogYXJyYXkubGVuZ3RoOw0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFycmF5LnNsaWNlKHNsaWNlU3RhcnQsIGVuZCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdyZXZlcnNlJzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBhcnJheS5zbGljZSgpLnJldmVyc2UoKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3NvcnQnOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFycmF5LnNsaWNlKCkuc29ydCgoYSwgYikgPT4gew0KICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVBID0gZmllbGRQYXRoID8gd2luZG93LmZsb3dFZGl0b3JVdGlscy5leHRyYWN0TmVzdGVkVmFsdWUoYSwgZmllbGRQYXRoKSA6IGE7DQogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZUIgPSBmaWVsZFBhdGggPyB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmV4dHJhY3ROZXN0ZWRWYWx1ZShiLCBmaWVsZFBhdGgpIDogYjsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlQSA8IHZhbHVlQiA/IC0xIDogdmFsdWVBID4gdmFsdWVCID8gMSA6IDA7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICd1bmlxdWUnOg0KICAgICAgICAgICAgICAgIGlmIChmaWVsZFBhdGgpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VlbiA9IG5ldyBTZXQoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXJyYXkuZmlsdGVyKGl0ZW0gPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmV4dHJhY3ROZXN0ZWRWYWx1ZShpdGVtLCBmaWVsZFBhdGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlZW4uaGFzKHZhbHVlKSkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vlbi5hZGQodmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsuLi5uZXcgU2V0KGFycmF5KV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBhcnJheTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN0b3JlIGZvciBkaXNwbGF5IGluIGNvbmZpZyBwYW5lbA0KICAgICAgICBub2RlLmxhc3RBcnJheSA9IGFycmF5Ow0KICAgICAgICBub2RlLmxhc3RSZXN1bHQgPSByZXN1bHQ7DQogICAgICAgIG5vZGUubGFzdE9wZXJhdGlvbiA9IG9wZXJhdGlvbjsNCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgcmVzdWx0OiByZXN1bHQsDQogICAgICAgICAgICBkYXRhOiByZXN1bHQsDQogICAgICAgICAgICB0ZXh0OiBBcnJheS5pc0FycmF5KHJlc3VsdCkgPyBKU09OLnN0cmluZ2lmeShyZXN1bHQpIDogU3RyaW5nKHJlc3VsdCksDQogICAgICAgICAgICBsZW5ndGg6IEFycmF5LmlzQXJyYXkocmVzdWx0KSA/IHJlc3VsdC5sZW5ndGggOiBBcnJheS5pc0FycmF5KGFycmF5KSA/IGFycmF5Lmxlbmd0aCA6IDAsDQogICAgICAgICAgICBmaXJzdDogQXJyYXkuaXNBcnJheShhcnJheSkgJiYgYXJyYXkubGVuZ3RoID4gMCA/IGFycmF5WzBdIDogbnVsbCwNCiAgICAgICAgICAgIGxhc3Q6IEFycmF5LmlzQXJyYXkoYXJyYXkpICYmIGFycmF5Lmxlbmd0aCA+IDAgPyBhcnJheVthcnJheS5sZW5ndGggLSAxXSA6IG51bGwNCiAgICAgICAgfTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdBcnJheSBvcGVyYXRpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgcmVzdWx0OiBudWxsLA0KICAgICAgICAgICAgZGF0YTogbnVsbCwNCiAgICAgICAgICAgIHRleHQ6ICIiLA0KICAgICAgICAgICAgbGVuZ3RoOiAwLA0KICAgICAgICAgICAgZmlyc3Q6IG51bGwsDQogICAgICAgICAgICBsYXN0OiBudWxsLA0KICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UNCiAgICAgICAgfTsNCiAgICB9DQp9DQoNCi8vIEhlbHBlciBmdW5jdGlvbiBmb3IgYXJyYXkgZmlsdGVyaW5nDQpmdW5jdGlvbiBwZXJmb3JtRmlsdGVyT3BlcmF0aW9uKHZhbHVlLCBmaWx0ZXJWYWx1ZSwgb3BlcmF0b3IpIHsNCiAgICBjb25zdCB2YWx1ZVN0ciA9IFN0cmluZyh2YWx1ZSkudG9Mb3dlckNhc2UoKTsNCiAgICBjb25zdCBmaWx0ZXJTdHIgPSBTdHJpbmcoZmlsdGVyVmFsdWUpLnRvTG93ZXJDYXNlKCk7DQogICAgDQogICAgc3dpdGNoIChvcGVyYXRvcikgew0KICAgICAgICBjYXNlICdlcXVhbHMnOg0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IGZpbHRlclZhbHVlOw0KICAgICAgICBjYXNlICdub3RfZXF1YWxzJzoNCiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPSBmaWx0ZXJWYWx1ZTsNCiAgICAgICAgY2FzZSAnY29udGFpbnMnOg0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlU3RyLmluY2x1ZGVzKGZpbHRlclN0cik7DQogICAgICAgIGNhc2UgJ2dyZWF0ZXJfdGhhbic6DQogICAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlKSA+IE51bWJlcihmaWx0ZXJWYWx1ZSk7DQogICAgICAgIGNhc2UgJ2xlc3NfdGhhbic6DQogICAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlKSA8IE51bWJlcihmaWx0ZXJWYWx1ZSk7DQogICAgICAgIGNhc2UgJ3N0YXJ0c193aXRoJzoNCiAgICAgICAgICAgIHJldHVybiB2YWx1ZVN0ci5zdGFydHNXaXRoKGZpbHRlclN0cik7DQogICAgICAgIGNhc2UgJ2VuZHNfd2l0aCc6DQogICAgICAgICAgICByZXR1cm4gdmFsdWVTdHIuZW5kc1dpdGgoZmlsdGVyU3RyKTsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCn0NCg0KLy8gU3RyaW5nIE9wZXJhdGlvbnMgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVN0cmluZ05vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3Qgb3BlcmF0aW9uID0gbm9kZS5jb25maWcub3BlcmF0aW9uLnZhbHVlOw0KICAgIGNvbnN0IGNvbmZpZ1RleHRCID0gbm9kZS5jb25maWcudGV4dF9iLnZhbHVlOw0KICAgIA0KICAgIC8vIFByb2Nlc3MgZXNjYXBlIHNlcXVlbmNlcyBpbiBzZXBhcmF0b3IgKGUuZy4sIFxuLCBcclxuLCBcdCwgZXRjLikNCiAgICBsZXQgc2VwYXJhdG9yID0gbm9kZS5jb25maWcuc2VwYXJhdG9yLnZhbHVlIHx8ICcsJzsNCiAgICBzZXBhcmF0b3IgPSBzZXBhcmF0b3INCiAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCAnXG4nKQ0KICAgICAgICAucmVwbGFjZSgvXFxyL2csICdccicpDQogICAgICAgIC5yZXBsYWNlKC9cXHQvZywgJ1x0JykNCiAgICAgICAgLnJlcGxhY2UoL1xcXFwvZywgJ1xcJyk7DQogICAgDQogICAgY29uc3Qgc2VhcmNoVGV4dCA9IG5vZGUuY29uZmlnLnNlYXJjaF90ZXh0LnZhbHVlOw0KICAgIGNvbnN0IHJlcGxhY2VUZXh0ID0gbm9kZS5jb25maWcucmVwbGFjZV90ZXh0LnZhbHVlOw0KICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBwYXJzZUludChub2RlLmNvbmZpZy5zdGFydF9pbmRleC52YWx1ZSkgfHwgMDsNCiAgICBjb25zdCBlbmRJbmRleCA9IHBhcnNlSW50KG5vZGUuY29uZmlnLmVuZF9pbmRleC52YWx1ZSkgfHwgMDsNCiAgICBjb25zdCByZXBlYXRDb3VudCA9IHBhcnNlSW50KG5vZGUuY29uZmlnLnJlcGVhdF9jb3VudC52YWx1ZSkgfHwgMTsNCiAgICBjb25zdCBjYXNlU2Vuc2l0aXZlID0gbm9kZS5jb25maWcuY2FzZV9zZW5zaXRpdmUudmFsdWUgPT09ICd0cnVlJzsNCg0KICAgIC8vIEdldCB0ZXh0IGlucHV0cw0KICAgIGxldCB0ZXh0QSA9IGlucHV0RGF0YS50ZXh0IHx8IGlucHV0RGF0YS5kYXRhIHx8ICcnOw0KICAgIGxldCB0ZXh0QiA9IGlucHV0RGF0YS50ZXh0X2IgfHwgY29uZmlnVGV4dEIgfHwgJyc7DQoNCiAgICAvLyBEZWJ1ZyBsb2dnaW5nIGZvciBpbnB1dCBzeW5jaHJvbml6YXRpb24NCg0KICAgIC8vIENvbnZlcnQgdG8gc3RyaW5ncw0KICAgIGlmICh0eXBlb2YgdGV4dEEgIT09ICdzdHJpbmcnKSB0ZXh0QSA9IFN0cmluZyh0ZXh0QSk7DQogICAgaWYgKHR5cGVvZiB0ZXh0QiAhPT0gJ3N0cmluZycpIHRleHRCID0gU3RyaW5nKHRleHRCKTsNCg0KICAgIGxldCByZXN1bHQgPSAnJzsNCg0KICAgIHRyeSB7DQogICAgICAgIHN3aXRjaCAob3BlcmF0aW9uKSB7DQogICAgICAgICAgICBjYXNlICdjb25jYXRlbmF0ZSc6DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEEgKyB0ZXh0QjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3NwbGl0JzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSB0ZXh0QS5zcGxpdChzZXBhcmF0b3IpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAncmVwbGFjZSc6DQogICAgICAgICAgICAgICAgaWYgKGNhc2VTZW5zaXRpdmUpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEEucmVwbGFjZShuZXcgUmVnRXhwKGVzY2FwZVJlZ2V4KHNlYXJjaFRleHQpLCAnZycpLCByZXBsYWNlVGV4dCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEEucmVwbGFjZShuZXcgUmVnRXhwKGVzY2FwZVJlZ2V4KHNlYXJjaFRleHQpLCAnZ2knKSwgcmVwbGFjZVRleHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3RyaW0nOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRleHRBLnRyaW0oKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3VwcGVyY2FzZSc6DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEEudG9VcHBlckNhc2UoKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2xvd2VyY2FzZSc6DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEEudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3N1YnN0cmluZyc6DQogICAgICAgICAgICAgICAgY29uc3QgZW5kID0gZW5kSW5kZXggPiAwID8gZW5kSW5kZXggOiB0ZXh0QS5sZW5ndGg7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEEuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdyZWdleF9tYXRjaCc6DQogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hGbGFncyA9IGNhc2VTZW5zaXRpdmUgPyAnZycgOiAnZ2knOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSB0ZXh0QS5tYXRjaChuZXcgUmVnRXhwKHNlYXJjaFRleHQsIG1hdGNoRmxhZ3MpKTsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBtYXRjaGVzIHx8IFtdOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAncmVnZXhfcmVwbGFjZSc6DQogICAgICAgICAgICAgICAgY29uc3QgcmVwbGFjZUZsYWdzID0gY2FzZVNlbnNpdGl2ZSA/ICdnJyA6ICdnaSc7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEEucmVwbGFjZShuZXcgUmVnRXhwKHNlYXJjaFRleHQsIHJlcGxhY2VGbGFncyksIHJlcGxhY2VUZXh0KTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3N0YXJ0c193aXRoJzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjYXNlU2Vuc2l0aXZlID8gdGV4dEEuc3RhcnRzV2l0aChzZWFyY2hUZXh0KSA6IA0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEEudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKHNlYXJjaFRleHQudG9Mb3dlckNhc2UoKSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdlbmRzX3dpdGgnOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNhc2VTZW5zaXRpdmUgPyB0ZXh0QS5lbmRzV2l0aChzZWFyY2hUZXh0KSA6IA0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEEudG9Mb3dlckNhc2UoKS5lbmRzV2l0aChzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnY29udGFpbnMnOg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNhc2VTZW5zaXRpdmUgPyB0ZXh0QS5pbmNsdWRlcyhzZWFyY2hUZXh0KSA6IA0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEEudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAncmVwZWF0JzoNCiAgICAgICAgICAgICAgICByZXN1bHQgPSB0ZXh0QS5yZXBlYXQoTWF0aC5tYXgoMCwgTWF0aC5taW4ocmVwZWF0Q291bnQsIDEwMCkpKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2xhc3RfbGluZSc6DQogICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0QS5zcGxpdCgnXG4nKS5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKS5sZW5ndGggPiAwKTsNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBsaW5lcy5sZW5ndGggPiAwID8gbGluZXNbbGluZXMubGVuZ3RoIC0gMV0gOiAnJzsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gdGV4dEE7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTdG9yZSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICAgICAgbm9kZS5sYXN0VGV4dEEgPSB0ZXh0QTsNCiAgICAgICAgbm9kZS5sYXN0VGV4dEIgPSB0ZXh0QjsNCiAgICAgICAgbm9kZS5sYXN0UmVzdWx0ID0gcmVzdWx0Ow0KICAgICAgICBub2RlLmxhc3RPcGVyYXRpb24gPSBvcGVyYXRpb247DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIHJlc3VsdDogQXJyYXkuaXNBcnJheShyZXN1bHQpID8gcmVzdWx0IDogU3RyaW5nKHJlc3VsdCksDQogICAgICAgICAgICBkYXRhOiByZXN1bHQsDQogICAgICAgICAgICBhcnJheTogQXJyYXkuaXNBcnJheShyZXN1bHQpID8gcmVzdWx0IDogbnVsbCwNCiAgICAgICAgICAgIGxlbmd0aDogU3RyaW5nKHJlc3VsdCkubGVuZ3RoLA0KICAgICAgICAgICAgd29yZF9jb3VudDogU3RyaW5nKHJlc3VsdCkudHJpbSgpLnNwbGl0KC9ccysvKS5maWx0ZXIod29yZCA9PiB3b3JkLmxlbmd0aCA+IDApLmxlbmd0aA0KICAgICAgICB9Ow0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N0cmluZyBvcGVyYXRpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgcmVzdWx0OiAnJywNCiAgICAgICAgICAgIGRhdGE6ICcnLA0KICAgICAgICAgICAgYXJyYXk6IG51bGwsDQogICAgICAgICAgICBsZW5ndGg6IDAsDQogICAgICAgICAgICB3b3JkX2NvdW50OiAwLA0KICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UNCiAgICAgICAgfTsNCiAgICB9DQp9DQoNCi8vIEhlbHBlciBmdW5jdGlvbiB0byBlc2NhcGUgcmVnZXggc3BlY2lhbCBjaGFyYWN0ZXJzDQpmdW5jdGlvbiBlc2NhcGVSZWdleChzdHJpbmcpIHsNCiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXVxcXS9nLCAnXFwkJicpOw0KfQ0KDQovLyBOb2RlIFJlZmVyZW5jZSBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlTm9kZVJlZmVyZW5jZU5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3Qgc291cmNlTm9kZUlkID0gbm9kZS5jb25maWcuc291cmNlX25vZGVfaWQudmFsdWU7DQogICAgY29uc3Qgb3V0cHV0UG9ydElkID0gbm9kZS5jb25maWcub3V0cHV0X3BvcnRfaWQudmFsdWU7DQogICAgY29uc3QgZmFsbGJhY2tWYWx1ZSA9IG5vZGUuY29uZmlnLmZhbGxiYWNrX3ZhbHVlLnZhbHVlIHx8IG51bGw7DQoNCiAgICAvLyBWYWxpZGF0ZSBpbnB1dHMNCiAgICBpZiAoIXNvdXJjZU5vZGVJZCkgew0KICAgICAgICBjb25zb2xlLndhcm4oJ05vZGUgUmVmZXJlbmNlOiBObyBzb3VyY2Ugbm9kZSBzZWxlY3RlZCcpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZGF0YTogZmFsbGJhY2tWYWx1ZSwNCiAgICAgICAgICAgIHRleHQ6IFN0cmluZyhmYWxsYmFja1ZhbHVlIHx8ICcnKSwNCiAgICAgICAgICAgIGpzb246IGZhbGxiYWNrVmFsdWUsDQogICAgICAgICAgICBudW1iZXI6IGlzTmFOKE51bWJlcihmYWxsYmFja1ZhbHVlKSkgPyAwIDogTnVtYmVyKGZhbGxiYWNrVmFsdWUpLA0KICAgICAgICAgICAgYm9vbGVhbjogQm9vbGVhbihmYWxsYmFja1ZhbHVlKSwNCiAgICAgICAgICAgIGJpbmFyeTogbnVsbCwNCiAgICAgICAgICAgIG9yaWdpbmFsOiBmYWxsYmFja1ZhbHVlLA0KICAgICAgICAgICAgZXJyb3I6ICdObyBzb3VyY2Ugbm9kZSBzZWxlY3RlZCcNCiAgICAgICAgfTsNCiAgICB9DQoNCiAgICBpZiAoIW91dHB1dFBvcnRJZCkgew0KICAgICAgICBjb25zb2xlLndhcm4oJ05vZGUgUmVmZXJlbmNlOiBObyBvdXRwdXQgcG9ydCBzZWxlY3RlZCcpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZGF0YTogZmFsbGJhY2tWYWx1ZSwNCiAgICAgICAgICAgIHRleHQ6IFN0cmluZyhmYWxsYmFja1ZhbHVlIHx8ICcnKSwNCiAgICAgICAgICAgIGpzb246IGZhbGxiYWNrVmFsdWUsDQogICAgICAgICAgICBudW1iZXI6IGlzTmFOKE51bWJlcihmYWxsYmFja1ZhbHVlKSkgPyAwIDogTnVtYmVyKGZhbGxiYWNrVmFsdWUpLA0KICAgICAgICAgICAgYm9vbGVhbjogQm9vbGVhbihmYWxsYmFja1ZhbHVlKSwNCiAgICAgICAgICAgIGJpbmFyeTogbnVsbCwNCiAgICAgICAgICAgIG9yaWdpbmFsOiBmYWxsYmFja1ZhbHVlLA0KICAgICAgICAgICAgZXJyb3I6ICdObyBvdXRwdXQgcG9ydCBzZWxlY3RlZCcNCiAgICAgICAgfTsNCiAgICB9DQoNCiAgICB0cnkgew0KICAgICAgICAvLyBHZXQgdGhlIHJlZmVyZW5jZWQgZGF0YSB1c2luZyB0aGUgZXhpc3RpbmcgZnVuY3Rpb24NCiAgICAgICAgY29uc3QgcmVmZXJlbmNlZERhdGEgPSBnZXRPdXRwdXRQb3J0RGF0YShzb3VyY2VOb2RlSWQsIG91dHB1dFBvcnRJZCk7DQogICAgICAgIA0KICAgICAgICBpZiAocmVmZXJlbmNlZERhdGEgPT09IG51bGwgfHwgcmVmZXJlbmNlZERhdGEgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgY29uc29sZS53YXJuKGBOb2RlIFJlZmVyZW5jZTogTm8gZGF0YSBmb3VuZCBmb3Igbm9kZSAke3NvdXJjZU5vZGVJZH0sIHBvcnQgJHtvdXRwdXRQb3J0SWR9YCk7DQogICAgICAgICAgICBjb25zdCBmYWxsYmFjayA9IGZhbGxiYWNrVmFsdWUgIT09ICcnID8gZmFsbGJhY2tWYWx1ZSA6IG51bGw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgZGF0YTogZmFsbGJhY2ssDQogICAgICAgICAgICAgICAgdGV4dDogU3RyaW5nKGZhbGxiYWNrIHx8ICcnKSwNCiAgICAgICAgICAgICAgICBqc29uOiBmYWxsYmFjaywNCiAgICAgICAgICAgICAgICBudW1iZXI6IGlzTmFOKE51bWJlcihmYWxsYmFjaykpID8gMCA6IE51bWJlcihmYWxsYmFjayksDQogICAgICAgICAgICAgICAgYm9vbGVhbjogQm9vbGVhbihmYWxsYmFjayksDQogICAgICAgICAgICAgICAgYmluYXJ5OiBudWxsLA0KICAgICAgICAgICAgICAgIG9yaWdpbmFsOiBmYWxsYmFjaywNCiAgICAgICAgICAgICAgICBlcnJvcjogYE5vIGRhdGEgZm91bmQgZm9yIG5vZGUgJHtzb3VyY2VOb2RlSWR9LCBwb3J0ICR7b3V0cHV0UG9ydElkfWANCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTdWNjZXNzZnVsbHkgZ290IHRoZSBkYXRhIC0gZm9ybWF0IGl0IGZvciBhbGwgb3V0cHV0IHR5cGVzDQogICAgICAgIGxldCB0ZXh0VmFsdWUgPSBTdHJpbmcocmVmZXJlbmNlZERhdGEpOw0KICAgICAgICBsZXQganNvblZhbHVlID0gcmVmZXJlbmNlZERhdGE7DQogICAgICAgIGxldCBudW1iZXJWYWx1ZSA9IDA7DQogICAgICAgIGxldCBib29sZWFuVmFsdWUgPSBCb29sZWFuKHJlZmVyZW5jZWREYXRhKTsNCg0KICAgICAgICAvLyBIYW5kbGUgZGlmZmVyZW50IGRhdGEgdHlwZXMgYXBwcm9wcmlhdGVseQ0KICAgICAgICBpZiAodHlwZW9mIHJlZmVyZW5jZWREYXRhID09PSAnbnVtYmVyJykgew0KICAgICAgICAgICAgbnVtYmVyVmFsdWUgPSByZWZlcmVuY2VkRGF0YTsNCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVmZXJlbmNlZERhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBOdW1iZXIocmVmZXJlbmNlZERhdGEpOw0KICAgICAgICAgICAgbnVtYmVyVmFsdWUgPSBpc05hTihwYXJzZWQpID8gMCA6IHBhcnNlZDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEZvciBKU09OIG91dHB1dCwgdHJ5IHRvIHByZXNlcnZlIG9iamVjdCBzdHJ1Y3R1cmUNCiAgICAgICAgaWYgKHR5cGVvZiByZWZlcmVuY2VkRGF0YSA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgIGpzb25WYWx1ZSA9IHJlZmVyZW5jZWREYXRhOw0KICAgICAgICAgICAgdGV4dFZhbHVlID0gSlNPTi5zdHJpbmdpZnkocmVmZXJlbmNlZERhdGEsIG51bGwsIDIpOw0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZWZlcmVuY2VkRGF0YSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFzIEpTT04NCiAgICAgICAgICAgICAgICBqc29uVmFsdWUgPSBKU09OLnBhcnNlKHJlZmVyZW5jZWREYXRhKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgICAgIC8vIE5vdCB2YWxpZCBKU09OLCBrZWVwIGFzIHN0cmluZw0KICAgICAgICAgICAgICAgIGpzb25WYWx1ZSA9IHJlZmVyZW5jZWREYXRhOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgY29uc29sZS5sb2coYE5vZGUgUmVmZXJlbmNlOiBTdWNjZXNzZnVsbHkgcmV0cmlldmVkIGRhdGEgZnJvbSAke3NvdXJjZU5vZGVJZH0uJHtvdXRwdXRQb3J0SWR9OmAsIHJlZmVyZW5jZWREYXRhKTsNCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZGF0YTogcmVmZXJlbmNlZERhdGEsDQogICAgICAgICAgICB0ZXh0OiB0ZXh0VmFsdWUsDQogICAgICAgICAgICBqc29uOiBqc29uVmFsdWUsDQogICAgICAgICAgICBudW1iZXI6IG51bWJlclZhbHVlLA0KICAgICAgICAgICAgYm9vbGVhbjogYm9vbGVhblZhbHVlLA0KICAgICAgICAgICAgYmluYXJ5OiAocmVmZXJlbmNlZERhdGEgaW5zdGFuY2VvZiBCbG9iIHx8IHJlZmVyZW5jZWREYXRhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpID8gcmVmZXJlbmNlZERhdGEgOiBudWxsLA0KICAgICAgICAgICAgb3JpZ2luYWw6IHJlZmVyZW5jZWREYXRhDQogICAgICAgIH07DQoNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdOb2RlIFJlZmVyZW5jZSBleGVjdXRpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICBjb25zdCBmYWxsYmFjayA9IGZhbGxiYWNrVmFsdWUgIT09ICcnID8gZmFsbGJhY2tWYWx1ZSA6IG51bGw7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZGF0YTogZmFsbGJhY2ssDQogICAgICAgICAgICB0ZXh0OiBTdHJpbmcoZmFsbGJhY2sgfHwgJycpLA0KICAgICAgICAgICAganNvbjogZmFsbGJhY2ssDQogICAgICAgICAgICBudW1iZXI6IGlzTmFOKE51bWJlcihmYWxsYmFjaykpID8gMCA6IE51bWJlcihmYWxsYmFjayksDQogICAgICAgICAgICBib29sZWFuOiBCb29sZWFuKGZhbGxiYWNrKSwNCiAgICAgICAgICAgIGJpbmFyeTogbnVsbCwNCiAgICAgICAgICAgIG9yaWdpbmFsOiBmYWxsYmFjaywNCiAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlDQogICAgICAgIH07DQogICAgfQ0KfQ0KDQovLyBSYW5kb20gTnVtYmVyIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVSYW5kb21Ob2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IG1pblZhbHVlID0gcGFyc2VGbG9hdChub2RlLmNvbmZpZy5taW5fdmFsdWUudmFsdWUpIHx8IDA7DQogICAgY29uc3QgbWF4VmFsdWUgPSBwYXJzZUZsb2F0KG5vZGUuY29uZmlnLm1heF92YWx1ZS52YWx1ZSkgfHwgMTAwOw0KICAgIGNvbnN0IGRlY2ltYWxQbGFjZXMgPSBwYXJzZUludChub2RlLmNvbmZpZy5kZWNpbWFsX3BsYWNlcy52YWx1ZSkgfHwgMDsNCiAgICBjb25zdCBvdXRwdXRUeXBlID0gbm9kZS5jb25maWcub3V0cHV0X3R5cGUudmFsdWUgfHwgJ2ludGVnZXInOw0KDQogICAgLy8gVmFsaWRhdGUgcmFuZ2UNCiAgICBpZiAobWluVmFsdWUgPj0gbWF4VmFsdWUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignUmFuZG9tOiBNaW5pbXVtIHZhbHVlIG11c3QgYmUgbGVzcyB0aGFuIG1heGltdW0gdmFsdWUnKTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIG51bWJlcjogMCwNCiAgICAgICAgICAgIHRleHQ6ICcwJywNCiAgICAgICAgICAgIGRhdGE6ICcwJywNCiAgICAgICAgICAgIGludGVnZXI6IDAsDQogICAgICAgICAgICBmbG9hdDogMC4wLA0KICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJhbmdlOiBtaW5pbXVtIG11c3QgYmUgbGVzcyB0aGFuIG1heGltdW0nDQogICAgICAgIH07DQogICAgfQ0KDQogICAgdHJ5IHsNCiAgICAgICAgLy8gR2VuZXJhdGUgcmFuZG9tIG51bWJlciBiZXR3ZWVuIG1pbiBhbmQgbWF4DQogICAgICAgIGxldCByYW5kb21WYWx1ZSA9IE1hdGgucmFuZG9tKCkgKiAobWF4VmFsdWUgLSBtaW5WYWx1ZSkgKyBtaW5WYWx1ZTsNCg0KICAgICAgICAvLyBBcHBseSBvdXRwdXQgdHlwZSBhbmQgZGVjaW1hbCBwbGFjZXMNCiAgICAgICAgaWYgKG91dHB1dFR5cGUgPT09ICdpbnRlZ2VyJyB8fCBkZWNpbWFsUGxhY2VzID09PSAwKSB7DQogICAgICAgICAgICByYW5kb21WYWx1ZSA9IE1hdGgucm91bmQocmFuZG9tVmFsdWUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmFuZG9tVmFsdWUgPSBwYXJzZUZsb2F0KHJhbmRvbVZhbHVlLnRvRml4ZWQoZGVjaW1hbFBsYWNlcykpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU3RvcmUgZm9yIGRpc3BsYXkgaW4gY29uZmlnIHBhbmVsDQogICAgICAgIG5vZGUubGFzdFJhbmRvbVZhbHVlID0gcmFuZG9tVmFsdWU7DQogICAgICAgIG5vZGUubGFzdFJhbmdlID0gYCR7bWluVmFsdWV9IC0gJHttYXhWYWx1ZX1gOw0KICAgICAgICBub2RlLmxhc3RPdXRwdXRUeXBlID0gb3V0cHV0VHlwZTsNCg0KICAgICAgICBjb25zb2xlLmxvZyhgUmFuZG9tOiBHZW5lcmF0ZWQgJHtyYW5kb21WYWx1ZX0gKCR7b3V0cHV0VHlwZX0pIGluIHJhbmdlICR7bWluVmFsdWV9LSR7bWF4VmFsdWV9YCk7DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIG51bWJlcjogcmFuZG9tVmFsdWUsDQogICAgICAgICAgICB0ZXh0OiBTdHJpbmcocmFuZG9tVmFsdWUpLCAvLyBDb252ZXJ0IHRvIHN0cmluZyBmb3IgVkZTIGNvbXBhdGliaWxpdHkNCiAgICAgICAgICAgIGRhdGE6IFN0cmluZyhyYW5kb21WYWx1ZSksIC8vIENvbnZlcnQgdG8gc3RyaW5nIGZvciBWRlMgY29tcGF0aWJpbGl0eSAgDQogICAgICAgICAgICBpbnRlZ2VyOiBNYXRoLnJvdW5kKHJhbmRvbVZhbHVlKSwNCiAgICAgICAgICAgIGZsb2F0OiBwYXJzZUZsb2F0KHJhbmRvbVZhbHVlLnRvRml4ZWQoTWF0aC5tYXgoZGVjaW1hbFBsYWNlcywgMSkpKQ0KICAgICAgICB9Ow0KDQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignUmFuZG9tIGV4ZWN1dGlvbiBlcnJvcjonLCBlcnJvcik7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBudW1iZXI6IDAsDQogICAgICAgICAgICB0ZXh0OiAnMCcsDQogICAgICAgICAgICBkYXRhOiAnMCcsDQogICAgICAgICAgICBpbnRlZ2VyOiAwLA0KICAgICAgICAgICAgZmxvYXQ6IDAuMCwNCiAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlDQogICAgICAgIH07DQogICAgfQ0KfQ0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cuZGF0YUV4ZWN1dG9ycyA9IHsNCiAgICBleGVjdXRlVGV4dE5vZGUsDQogICAgZXhlY3V0ZUpzb25FeHRyYWN0Tm9kZSwNCiAgICBleGVjdXRlUmFuZG9tUXVvdGVOb2RlLA0KICAgIGV4ZWN1dGVNYXRoTm9kZSwNCiAgICBleGVjdXRlQXJyYXlOb2RlLA0KICAgIGV4ZWN1dGVTdHJpbmdOb2RlLA0KICAgIGV4ZWN1dGVOb2RlUmVmZXJlbmNlTm9kZSwNCiAgICBleGVjdXRlUmFuZG9tTm9kZQ0KfTsNCg0KDQovLyBIVFRQIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVIdHRwTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCB1cmwgPSBub2RlLmNvbmZpZy51cmwudmFsdWU7DQogICAgY29uc3QgbWV0aG9kID0gbm9kZS5jb25maWcubWV0aG9kLnZhbHVlOw0KICAgIGNvbnN0IGhlYWRlcnMgPSBKU09OLnBhcnNlKG5vZGUuY29uZmlnLmhlYWRlcnMudmFsdWUgfHwgJ3t9Jyk7DQogICAgY29uc3QgYm9keSA9IG5vZGUuY29uZmlnLmJvZHkudmFsdWU7DQogICAgY29uc3QgdXNlVGVtcGxhdGUgPSB0cnVlOyAvLyBBbHdheXMgZW5hYmxlIHRlbXBsYXRlIHByb2Nlc3NpbmcNCg0KICAgIGxldCBwcm9jZXNzZWRCb2R5ID0gYm9keTsNCg0KICAgIGNvbnNvbGUubG9nKCdIVFRQIE5vZGUgRGVidWc6Jywgew0KICAgICAgICBpbnB1dERhdGE6IGlucHV0RGF0YSwNCiAgICAgICAgb3JpZ2luYWxCb2R5OiBib2R5LA0KICAgICAgICB1c2VUZW1wbGF0ZTogdXNlVGVtcGxhdGUNCiAgICB9KTsNCg0KICAgIC8vIFByb2Nlc3MgdGVtcGxhdGVzIGZpcnN0IG9uIHRoZSBzdHJpbmcgYm9keQ0KICAgIGlmICh1c2VUZW1wbGF0ZSAmJiBpbnB1dERhdGEpIHsNCiAgICAgICAgcHJvY2Vzc2VkQm9keSA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMucHJvY2Vzc1RlbXBsYXRlcyhwcm9jZXNzZWRCb2R5LCBpbnB1dERhdGEpOw0KICAgICAgICBjb25zb2xlLmxvZygnSFRUUCBOb2RlIFRlbXBsYXRlIFByb2Nlc3Npbmc6Jywgew0KICAgICAgICAgICAgb3JpZ2luYWxCb2R5OiBib2R5LA0KICAgICAgICAgICAgcHJvY2Vzc2VkQm9keTogcHJvY2Vzc2VkQm9keSwNCiAgICAgICAgICAgIGlucHV0RGF0YTogaW5wdXREYXRhDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8vIFRoZW4gcGFyc2UgYXMgSlNPTiBpZiBpdCdzIGEgc3RyaW5nIGFuZCBsb29rcyBsaWtlIEpTT04NCiAgICBpZiAodHlwZW9mIHByb2Nlc3NlZEJvZHkgPT09ICdzdHJpbmcnICYmIHByb2Nlc3NlZEJvZHkudHJpbSgpLnN0YXJ0c1dpdGgoJ3snKSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcHJvY2Vzc2VkQm9keSA9IEpTT04ucGFyc2UocHJvY2Vzc2VkQm9keSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIHBhcnNlIGJvZHkgYXMgSlNPTiwgdXNpbmcgYXMgc3RyaW5nOicsIGUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gVXNlIE9TIHByb3h5IHRvIGJ5cGFzcyBDT1JTDQogICAgY29uc3QgcHJveHlSZXF1ZXN0ID0gew0KICAgICAgICB1cmw6IHVybCwNCiAgICAgICAgbWV0aG9kOiBtZXRob2QsDQogICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsDQogICAgICAgIGJvZHk6IHByb2Nlc3NlZEJvZHksDQogICAgICAgIHRpbWVvdXQ6IDMwDQogICAgfTsNCg0KDQogICAgY29uc3QgcHJveHlSZXNwb25zZSA9IGF3YWl0IHN5cG5leEFQSS5wcm94eUhUVFAocHJveHlSZXF1ZXN0KTsNCg0KICAgIGlmICghcHJveHlSZXNwb25zZSB8fCBwcm94eVJlc3BvbnNlLnN0YXR1cyA8IDIwMCB8fCBwcm94eVJlc3BvbnNlLnN0YXR1cyA+PSAzMDApIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQcm94eSByZXF1ZXN0IGZhaWxlZDogJHtwcm94eVJlc3BvbnNlPy5zdGF0dXMgfHwgJ1Vua25vd24gZXJyb3InfWApOw0KICAgIH0NCg0KICAgIGNvbnN0IHByb3h5RGF0YSA9IHByb3h5UmVzcG9uc2U7DQoNCiAgICBpZiAocHJveHlEYXRhLmVycm9yKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCByZXF1ZXN0IGZhaWxlZDogJHtwcm94eURhdGEuZXJyb3J9YCk7DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgaWYgcmVzcG9uc2UgaXMgYmluYXJ5IChhdWRpbywgaW1hZ2UsIGV0Yy4pDQogICAgaWYgKHByb3h5RGF0YS5pc19iaW5hcnkpIHsNCg0KICAgICAgICAvLyBDb252ZXJ0IGJhc2U2NCBjb250ZW50IHRvIGJsb2IgZm9yIGJpbmFyeSBkYXRhDQogICAgICAgIGNvbnN0IGJpbmFyeURhdGEgPSBhdG9iKHByb3h5RGF0YS5jb250ZW50KTsNCiAgICAgICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShiaW5hcnlEYXRhLmxlbmd0aCk7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmluYXJ5RGF0YS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlEYXRhLmNoYXJDb2RlQXQoaSk7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSBwcm94eURhdGEuaGVhZGVyc1snY29udGVudC10eXBlJ10gfHwgcHJveHlEYXRhLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddIHx8ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOw0KICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2J5dGVzXSwgeyB0eXBlOiBjb250ZW50VHlwZSB9KTsNCg0KICAgICAgICAvLyBSZXR1cm4gc3RydWN0dXJlZCBvdXRwdXQgZm9yIGJpbmFyeSByZXNwb25zZXMgd2l0aCBhbGwgcG9ydHMNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGE6IGJsb2IsDQogICAgICAgICAgICBwcm9jZXNzZWRfZGF0YTogYmxvYiwNCiAgICAgICAgICAgIHJlc3BvbnNlOiBibG9iLA0KICAgICAgICAgICAgc3RhdHVzX2NvZGU6IHByb3h5RGF0YS5zdGF0dXMgfHwgMjAwLA0KICAgICAgICAgICAgaGVhZGVyczogcHJveHlEYXRhLmhlYWRlcnMgfHwge30sDQogICAgICAgICAgICBwYXJzZWRfanNvbjogbnVsbCwNCiAgICAgICAgICAgIC8vIEFsc28gcHJvdmlkZSB0aGUgcmF3IHJlc3BvbnNlIGFzICdkYXRhJyBmb3IgY29tcGF0aWJpbGl0eQ0KICAgICAgICAgICAgZGF0YTogYmxvYiwNCiAgICAgICAgICAgIC8vIEFkZCB0aGUgbWlzc2luZyBvdXRwdXQgcG9ydHMgZnJvbSBub2RlIGRlZmluaXRpb24NCiAgICAgICAgICAgIHRleHQ6IG51bGwsDQogICAgICAgICAgICBqc29uOiBudWxsLA0KICAgICAgICAgICAgdXJsOiB1cmwsDQogICAgICAgICAgICBiaW5hcnk6IGJ5dGVzLCAgLy8gUmF3IGJpbmFyeSBkYXRhIGFzIFVpbnQ4QXJyYXkNCiAgICAgICAgICAgIGJsb2I6IGJsb2IgICAgICAvLyBCbG9iIG9iamVjdCBmb3IgY29tcGF0aWJpbGl0eQ0KICAgICAgICB9Ow0KICAgIH0NCg0KICAgIC8vIEZvciB0ZXh0IHJlc3BvbnNlcywgdHJ5IHRvIHBhcnNlIGFzIEpTT04gYW5kIHJldHVybiBzdHJ1Y3R1cmVkIG91dHB1dA0KDQogICAgbGV0IHBhcnNlZEpzb24gPSBudWxsOw0KICAgIHRyeSB7DQogICAgICAgIC8vIFRyeSB0byBwYXJzZSBhcyBKU09ODQogICAgICAgIHBhcnNlZEpzb24gPSBKU09OLnBhcnNlKHByb3h5RGF0YS5jb250ZW50KTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgfQ0KDQogICAgLy8gUmV0dXJuIHN0cnVjdHVyZWQgb3V0cHV0IGZvciB0ZXh0IHJlc3BvbnNlcyBtYXRjaGluZyBuZXcgbm9kZSBhcmNoaXRlY3R1cmUNCiAgICByZXR1cm4gew0KICAgICAgICBvcmlnaW5hbF9kYXRhOiBwcm94eURhdGEuY29udGVudCwNCiAgICAgICAgcHJvY2Vzc2VkX2RhdGE6IHBhcnNlZEpzb24gfHwgcHJveHlEYXRhLmNvbnRlbnQsDQogICAgICAgIHJlc3BvbnNlOiBwcm94eURhdGEuY29udGVudCwNCiAgICAgICAgc3RhdHVzX2NvZGU6IHByb3h5RGF0YS5zdGF0dXMgfHwgMjAwLA0KICAgICAgICBoZWFkZXJzOiBwcm94eURhdGEuaGVhZGVycyB8fCB7fSwNCiAgICAgICAgcGFyc2VkX2pzb246IHBhcnNlZEpzb24sDQogICAgICAgIC8vIEFsc28gcHJvdmlkZSB0aGUgcmF3IHJlc3BvbnNlIGFzICdkYXRhJyBmb3IgY29tcGF0aWJpbGl0eQ0KICAgICAgICBkYXRhOiBwcm94eURhdGEuY29udGVudCwNCiAgICAgICAgLy8gQWRkIHRoZSBtaXNzaW5nIG91dHB1dCBwb3J0cyBmcm9tIG5vZGUgZGVmaW5pdGlvbg0KICAgICAgICB0ZXh0OiBwcm94eURhdGEuY29udGVudCwNCiAgICAgICAganNvbjogcGFyc2VkSnNvbiwNCiAgICAgICAgdXJsOiB1cmwNCiAgICB9Ow0KfQ0KDQovLyBWRlMgTG9hZCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlVmZzTG9hZE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgbGV0IGZpbGVQYXRoID0gbm9kZS5jb25maWcuZmlsZV9wYXRoLnZhbHVlOw0KICAgIGNvbnN0IGZvcm1hdCA9IG5vZGUuY29uZmlnLmZvcm1hdC52YWx1ZTsNCg0KICAgIC8vIFByb2Nlc3MgdGVtcGxhdGUgdmFyaWFibGVzIGluIGZpbGUgcGF0aA0KICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTsNCiAgICBjb25zdCBkYXRlVGVtcGxhdGVzID0gew0KICAgICAgICAne3tEQVRFfX0nOiBjdXJyZW50RGF0ZS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sIC8vIFlZWVktTU0tREQNCiAgICAgICAgJ3t7WVlZWX19JzogY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpLA0KICAgICAgICAne3tNTX19JzogKGN1cnJlbnREYXRlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyksDQogICAgICAgICd7e0REfX0nOiBjdXJyZW50RGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpLA0KICAgICAgICAne3tUSU1FU1RBTVB9fSc6IGN1cnJlbnREYXRlLmdldFRpbWUoKS50b1N0cmluZygpLA0KICAgICAgICAne3tJU09fREFURX19JzogY3VycmVudERhdGUudG9JU09TdHJpbmcoKQ0KICAgIH07DQoNCiAgICAvLyBSZXBsYWNlIGFsbCB0ZW1wbGF0ZSB2YXJpYWJsZXMgdXNpbmcgc2ltcGxlIHN0cmluZyByZXBsYWNlbWVudA0KICAgIGZvciAoY29uc3QgW3RlbXBsYXRlLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZGF0ZVRlbXBsYXRlcykpIHsNCiAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aC5yZXBsYWNlQWxsKHRlbXBsYXRlLCB2YWx1ZSk7DQogICAgfQ0KDQoNCiAgICB0cnkgew0KICAgICAgICBsZXQgZGF0YSA9IG51bGw7DQoNCg0KICAgICAgICBpZiAoZm9ybWF0ID09PSAnanNvbicpIHsNCiAgICAgICAgICAgIGRhdGEgPSBhd2FpdCBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlSlNPTihmaWxlUGF0aCk7DQogICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAndGV4dCcpIHsNCiAgICAgICAgICAgIGRhdGEgPSBhd2FpdCBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlVGV4dChmaWxlUGF0aCk7DQogICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAnYmxvYicpIHsNCiAgICAgICAgICAgIC8vIEZvciBibG9iIGZvcm1hdCwgcmVhZCBhcyB0ZXh0IChkYXRhIFVSTHMgYXJlIHN0b3JlZCBhcyB0ZXh0KQ0KICAgICAgICAgICAgZGF0YSA9IGF3YWl0IHN5cG5leEFQSS5yZWFkVmlydHVhbEZpbGVUZXh0KGZpbGVQYXRoKTsNCiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09ICdiaW5hcnknKSB7DQogICAgICAgICAgICAvLyBGb3IgYmluYXJ5IGZpbGVzLCB1c2UgdGhlIGRpcmVjdCBVUkwgbWV0aG9kIHRvIGdldCBCbG9iDQogICAgICAgICAgICBjb25zdCBmaWxlVXJsID0gc3lwbmV4QVBJLmdldFZpcnR1YWxGaWxlVXJsKGZpbGVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZVVybCk7DQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggYmluYXJ5IGZpbGU6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGZvcm1hdDogJyArIGZvcm1hdCArICcuIFN1cHBvcnRlZCBmb3JtYXRzIGFyZToganNvbiwgdGV4dCwgYmxvYiwgYmluYXJ5Jyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTdG9yZSB0aGUgbG9hZGVkIGRhdGEgZm9yIGRpc3BsYXkgaW4gY29uZmlnIHBhbmVsDQogICAgICAgIG5vZGUubGFzdExvYWRlZEZpbGUgPSBmaWxlUGF0aDsNCiAgICAgICAgbm9kZS5sYXN0TG9hZGVkRGF0YSA9IGRhdGE7DQoNCg0KICAgICAgICAvLyBSZXR1cm4gc3RydWN0dXJlZCBvdXRwdXQgd2l0aCBhcHByb3ByaWF0ZSBwb3J0IG5hbWVzDQogICAgICAgIGNvbnN0IHJlc3VsdCA9IHsNCiAgICAgICAgICAgIGRhdGE6IGRhdGEsDQogICAgICAgICAgICBmaWxlX3BhdGg6IGZpbGVQYXRoLCAgLy8gUmV0dXJuIHRoZSBhY3R1YWwgcHJvY2Vzc2VkIGZpbGUgcGF0aCBzdHJpbmcNCiAgICAgICAgICAgIGpzb25fZGF0YTogZm9ybWF0ID09PSAnanNvbicgPyBkYXRhIDogbnVsbA0KICAgICAgICB9Ow0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1ZGUyBMb2FkIGVycm9yOicsIHsNCiAgICAgICAgICAgIG9yaWdpbmFsUGF0aDogbm9kZS5jb25maWcuZmlsZV9wYXRoLnZhbHVlLA0KICAgICAgICAgICAgcHJvY2Vzc2VkUGF0aDogZmlsZVBhdGgsDQogICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCwNCiAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLA0KICAgICAgICAgICAgZXJyb3JTdGFjazogZXJyb3Iuc3RhY2sNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiB7IGRhdGE6IG51bGwsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07DQogICAgfQ0KfQ0KDQoNCi8vIFZGUyBTYXZlIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVWZnNTYXZlTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBmaWxlUGF0aCA9IG5vZGUuY29uZmlnLmZpbGVfcGF0aC52YWx1ZTsNCiAgICBjb25zdCBmb3JtYXQgPSBub2RlLmNvbmZpZy5mb3JtYXQudmFsdWU7DQogICAgY29uc3Qgb3ZlcndyaXRlID0gbm9kZS5jb25maWcub3ZlcndyaXRlLnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3QgYXBwZW5kID0gbm9kZS5jb25maWcuYXBwZW5kLnZhbHVlID09PSAndHJ1ZSc7DQoNCiAgICB0cnkgew0KICAgICAgICBsZXQgZGF0YSA9IGlucHV0RGF0YS5kYXRhOw0KICAgICAgICBsZXQgc3VjY2VzcyA9IGZhbHNlOw0KDQogICAgICAgIGNvbnNvbGUubG9nKCdWRlMgU2F2ZSBEZWJ1ZzonLCB7DQogICAgICAgICAgICBmaWxlUGF0aDogZmlsZVBhdGgsDQogICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCwNCiAgICAgICAgICAgIG92ZXJ3cml0ZTogb3ZlcndyaXRlLA0KICAgICAgICAgICAgYXBwZW5kOiBhcHBlbmQsDQogICAgICAgICAgICBkYXRhVHlwZTogdHlwZW9mIGRhdGEsDQogICAgICAgICAgICBkYXRhOiBkYXRhDQogICAgICAgIH0pOw0KDQogICAgICAgIGlmIChmb3JtYXQgPT09ICdqc29uJykgew0KICAgICAgICAgICAgLy8gRm9yIEpTT04gZm9ybWF0IHdpdGggYXBwZW5kIG1vZGUsIHdlIG5lZWQgdG8gaGFuZGxlIGl0IHNwZWNpYWxseQ0KICAgICAgICAgICAgaWYgKGFwcGVuZCAmJiAhb3ZlcndyaXRlKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIHJlYWQgZXhpc3RpbmcgZmlsZSBmaXJzdA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0RhdGEgPSBhd2FpdCBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlSlNPTihmaWxlUGF0aCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4aXN0aW5nRGF0YSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGV4aXN0aW5nIGRhdGEgaXMgYW4gYXJyYXksIGFwcGVuZCB0byBpdA0KICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdEYXRhLnB1c2goZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gZXhpc3RpbmdEYXRhOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgZXhpc3RpbmcgZGF0YSBpcyBub3QgYW4gYXJyYXksIGNyZWF0ZSBhIG5ldyBhcnJheQ0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFtleGlzdGluZ0RhdGEsIGRhdGFdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRmlsZSBkb2Vzbid0IGV4aXN0IG9yIGNhbid0IGJlIHJlYWQsIGNyZWF0ZSBuZXcgYXJyYXkNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFtkYXRhXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdWNjZXNzID0gYXdhaXQgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGVKU09OKGZpbGVQYXRoLCBkYXRhKTsNCiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09ICd0ZXh0Jykgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgIC8vIEZvciB0ZXh0IGZvcm1hdCB3aXRoIGFwcGVuZCBtb2RlDQogICAgICAgICAgICAgICAgaWYgKGFwcGVuZCAmJiAhb3ZlcndyaXRlKSB7DQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcmVhZCBleGlzdGluZyBmaWxlIGZpcnN0DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1RleHQgPSBhd2FpdCBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlVGV4dChmaWxlUGF0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gZXhpc3RpbmdUZXh0ICsgJ1xuJyArIGRhdGE7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBGaWxlIGRvZXNuJ3QgZXhpc3QsIHVzZSBkYXRhIGFzLWlzDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IGF3YWl0IHN5cG5leEFQSS53cml0ZVZpcnR1YWxGaWxlKGZpbGVQYXRoLCBkYXRhKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZXh0IGZvcm1hdCByZXF1aXJlcyBzdHJpbmcgZGF0YSwgcmVjZWl2ZWQ6ICcgKyB0eXBlb2YgZGF0YSArICcuIFVzZSBKU09OIGZvcm1hdCBmb3Igb2JqZWN0cy4nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09ICdiaW5hcnknKSB7DQogICAgICAgICAgICAvLyBIYW5kbGUgYmluYXJ5IGRhdGEgcHJvcGVybHkgdXNpbmcgdGhlIGJpbmFyeSB1cGxvYWQgZW5kcG9pbnQNCiAgICAgICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgVWludDhBcnJheSkgew0KICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgYmluYXJ5IHVwbG9hZCBtZXRob2QgZm9yIHJhdyBiaW5hcnkgZGF0YQ0KICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZUJpbmFyeShmaWxlUGF0aCwgZGF0YSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEJpbmFyeSBmb3JtYXQgb25seSBzdXBwb3J0cyBVaW50OEFycmF5IGZvciByYXcgYmluYXJ5IGRhdGENCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JpbmFyeSBmb3JtYXQgcmVxdWlyZXMgVWludDhBcnJheSBkYXRhIGZvciByYXcgYmluYXJ5LCByZWNlaXZlZDogJyArIHR5cGVvZiBkYXRhICsgJy4gVXNlIGJsb2IgZm9ybWF0IGZvciBCbG9iIGRhdGEuJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAnYmxvYicpIHsNCiAgICAgICAgICAgIC8vIEhhbmRsZSBCbG9iIHRvIGRhdGEgVVJMIGNvbnZlcnNpb24NCiAgICAgICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgQmxvYikgew0KICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgQmxvYiB0byBkYXRhIFVSTA0KICAgICAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgZGF0YVVybCA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCk7DQogICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0Ow0KICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChkYXRhKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBzdWNjZXNzID0gYXdhaXQgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGUoZmlsZVBhdGgsIGRhdGFVcmwpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Jsb2IgZm9ybWF0IHJlcXVpcmVzIEJsb2IgZGF0YSwgcmVjZWl2ZWQ6ICcgKyB0eXBlb2YgZGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBVbmtub3duIGZvcm1hdA0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGZvcm1hdDogJyArIGZvcm1hdCArICcuIFN1cHBvcnRlZCBmb3JtYXRzIGFyZToganNvbiwgdGV4dCwgYmluYXJ5LCBibG9iJyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBzdWNjZXNzIH07DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignVkZTIFNhdmUgZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTsNCiAgICB9DQp9DQoNCi8vIFZGUyBEaXJlY3RvcnkgTGlzdCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlVmZzRGlyZWN0b3J5TGlzdE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgbGV0IGRpcmVjdG9yeVBhdGggPSBub2RlLmNvbmZpZy5kaXJlY3RvcnlfcGF0aC52YWx1ZTsNCiAgICBjb25zdCBmaWx0ZXJFeHRlbnNpb25zID0gbm9kZS5jb25maWcuZmlsdGVyX2V4dGVuc2lvbnMudmFsdWU7DQogICAgY29uc3QgaW5jbHVkZURpcmVjdG9yaWVzID0gbm9kZS5jb25maWcuaW5jbHVkZV9kaXJlY3Rvcmllcy52YWx1ZSA9PT0gJ3RydWUnOw0KICAgIGNvbnN0IHJlY3Vyc2l2ZSA9IG5vZGUuY29uZmlnLnJlY3Vyc2l2ZS52YWx1ZSA9PT0gJ3RydWUnOw0KDQogICAgLy8gRGVidWcgbG9nZ2luZw0KICAgIGNvbnNvbGUubG9nKCdWRlMgRGlyZWN0b3J5IExpc3QgRGVidWc6Jywgew0KICAgICAgICBjb25maWdWYWx1ZTogbm9kZS5jb25maWcuZGlyZWN0b3J5X3BhdGgudmFsdWUsDQogICAgICAgIGlucHV0RGF0YTogaW5wdXREYXRhLA0KICAgICAgICBpbml0aWFsRGlyZWN0b3J5UGF0aDogZGlyZWN0b3J5UGF0aA0KICAgIH0pOw0KDQogICAgLy8gVXNlIGlucHV0IHBhdGggaWYgcHJvdmlkZWQsIG90aGVyd2lzZSB1c2UgY29uZmlnDQogICAgaWYgKGlucHV0RGF0YSAmJiBpbnB1dERhdGEuZGlyZWN0b3J5X3BhdGgpIHsNCiAgICAgICAgZGlyZWN0b3J5UGF0aCA9IGlucHV0RGF0YS5kaXJlY3RvcnlfcGF0aDsNCiAgICAgICAgY29uc29sZS5sb2coJ1VzaW5nIGlucHV0IGRpcmVjdG9yeSBwYXRoOicsIGRpcmVjdG9yeVBhdGgpOw0KICAgIH0NCg0KICAgIC8vIEVuc3VyZSBkaXJlY3RvcnlQYXRoIGlzIGEgc3RyaW5nIGFuZCBub3QgZW1wdHkNCiAgICBpZiAodHlwZW9mIGRpcmVjdG9yeVBhdGggIT09ICdzdHJpbmcnIHx8ICFkaXJlY3RvcnlQYXRoKSB7DQogICAgICAgIGRpcmVjdG9yeVBhdGggPSAnLyc7DQogICAgICAgIGNvbnNvbGUubG9nKCdSZXNldCBkaXJlY3RvcnkgcGF0aCB0byByb290OicsIGRpcmVjdG9yeVBhdGgpOw0KICAgIH0NCg0KICAgIC8vIFByb2Nlc3MgdGVtcGxhdGUgdmFyaWFibGVzIGluIGRpcmVjdG9yeSBwYXRoDQogICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpOw0KICAgIGNvbnN0IGRhdGVUZW1wbGF0ZXMgPSB7DQogICAgICAgICd7e0RBVEV9fSc6IGN1cnJlbnREYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSwNCiAgICAgICAgJ3t7WVlZWX19JzogY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpLA0KICAgICAgICAne3tNTX19JzogKGN1cnJlbnREYXRlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyksDQogICAgICAgICd7e0REfX0nOiBjdXJyZW50RGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpLA0KICAgICAgICAne3tUSU1FU1RBTVB9fSc6IGN1cnJlbnREYXRlLmdldFRpbWUoKS50b1N0cmluZygpLA0KICAgICAgICAne3tJU09fREFURX19JzogY3VycmVudERhdGUudG9JU09TdHJpbmcoKQ0KICAgIH07DQoNCiAgICBmb3IgKGNvbnN0IFt0ZW1wbGF0ZSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGVUZW1wbGF0ZXMpKSB7DQogICAgICAgIGRpcmVjdG9yeVBhdGggPSBkaXJlY3RvcnlQYXRoLnJlcGxhY2VBbGwodGVtcGxhdGUsIHZhbHVlKTsNCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZygnRmluYWwgZGlyZWN0b3J5IHBhdGggYmVmb3JlIEFQSSBjYWxsOicsIGRpcmVjdG9yeVBhdGgpOw0KDQogICAgdHJ5IHsNCiAgICAgICAgLy8gVXNlIHRoZSBleGlzdGluZyBzeXBuZXhBUEkubGlzdFZpcnR1YWxGaWxlcyBtZXRob2QNCiAgICAgICAgY29uc3QgZmlsZUxpc3REYXRhID0gYXdhaXQgc3lwbmV4QVBJLmxpc3RWaXJ0dWFsRmlsZXMoZGlyZWN0b3J5UGF0aCk7DQogICAgICAgIA0KICAgICAgICBpZiAoIWZpbGVMaXN0RGF0YSB8fCAhZmlsZUxpc3REYXRhLml0ZW1zKSB7DQogICAgICAgICAgICByZXR1cm4geyANCiAgICAgICAgICAgICAgICBlcnJvcjogYERpcmVjdG9yeSBub3QgZm91bmQgb3IgZW1wdHk6ICR7ZGlyZWN0b3J5UGF0aH1gLA0KICAgICAgICAgICAgICAgIGZpbGVfbGlzdDogW10sDQogICAgICAgICAgICAgICAgZmlsZV9wYXRoczogW10sDQogICAgICAgICAgICAgICAgZmlsZV9uYW1lczogW10sDQogICAgICAgICAgICAgICAgY291bnQ6IDAsDQogICAgICAgICAgICAgICAgZGlyZWN0b3JpZXM6IFtdLA0KICAgICAgICAgICAgICAgIGZpbGVzX29ubHk6IFtdDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IGFsbEl0ZW1zID0gZmlsZUxpc3REYXRhLml0ZW1zOw0KICAgICAgICANCiAgICAgICAgLy8gSGFuZGxlIHJlY3Vyc2l2ZSBsaXN0aW5nIGlmIGVuYWJsZWQNCiAgICAgICAgaWYgKHJlY3Vyc2l2ZSkgew0KICAgICAgICAgICAgY29uc3QgZ2V0QWxsRmlsZXNSZWN1cnNpdmUgPSBhc3luYyAoaXRlbXMsIGJhc2VQYXRoKSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGFsbEZpbGVzID0gW107DQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzX2RpcmVjdG9yeSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViUGF0aCA9IGJhc2VQYXRoICsgKGJhc2VQYXRoLmVuZHNXaXRoKCcvJykgPyAnJyA6ICcvJykgKyBpdGVtLm5hbWU7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1YkRpckRhdGEgPSBhd2FpdCBzeXBuZXhBUEkubGlzdFZpcnR1YWxGaWxlcyhzdWJQYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViRGlyRGF0YSAmJiBzdWJEaXJEYXRhLml0ZW1zKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1YkZpbGVzID0gYXdhaXQgZ2V0QWxsRmlsZXNSZWN1cnNpdmUoc3ViRGlyRGF0YS5pdGVtcywgc3ViUGF0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbEZpbGVzID0gYWxsRmlsZXMuY29uY2F0KHN1YkZpbGVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYENvdWxkIG5vdCByZWFkIHN1YmRpcmVjdG9yeSAke3N1YlBhdGh9OmAsIGVycik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYWxsRmlsZXMucHVzaCh7Li4uaXRlbSwgZnVsbFBhdGg6IGJhc2VQYXRoICsgKGJhc2VQYXRoLmVuZHNXaXRoKCcvJykgPyAnJyA6ICcvJykgKyBpdGVtLm5hbWV9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGFsbEZpbGVzOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYWxsSXRlbXMgPSBhd2FpdCBnZXRBbGxGaWxlc1JlY3Vyc2l2ZShhbGxJdGVtcywgZGlyZWN0b3J5UGF0aCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBZGQgZnVsbCBwYXRoIGZvciBub24tcmVjdXJzaXZlDQogICAgICAgICAgICBhbGxJdGVtcyA9IGFsbEl0ZW1zLm1hcChpdGVtID0+ICh7DQogICAgICAgICAgICAgICAgLi4uaXRlbSwgDQogICAgICAgICAgICAgICAgZnVsbFBhdGg6IGRpcmVjdG9yeVBhdGggKyAoZGlyZWN0b3J5UGF0aC5lbmRzV2l0aCgnLycpID8gJycgOiAnLycpICsgaXRlbS5uYW1lDQogICAgICAgICAgICB9KSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBGaWx0ZXIgYnkgZmlsZSBleHRlbnNpb25zIGlmIHNwZWNpZmllZA0KICAgICAgICBsZXQgZmlsdGVyZWRJdGVtcyA9IGFsbEl0ZW1zOw0KICAgICAgICBpZiAoZmlsdGVyRXh0ZW5zaW9ucyAmJiBmaWx0ZXJFeHRlbnNpb25zLnRyaW0oKSkgew0KICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9ucyA9IGZpbHRlckV4dGVuc2lvbnMuc3BsaXQoJywnKS5tYXAoZXh0ID0+IGV4dC50cmltKCkudG9Mb3dlckNhc2UoKSk7DQogICAgICAgICAgICBmaWx0ZXJlZEl0ZW1zID0gYWxsSXRlbXMuZmlsdGVyKGl0ZW0gPT4gew0KICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBpbmNsdWRlIGRpcmVjdG9yaWVzIGlmIGluY2x1ZGVEaXJlY3RvcmllcyBpcyB0cnVlDQogICAgICAgICAgICAgICAgaWYgKGl0ZW0uaXNfZGlyZWN0b3J5KSByZXR1cm4gaW5jbHVkZURpcmVjdG9yaWVzOw0KICAgICAgICAgICAgICAgIC8vIEZvciBmaWxlcywgY2hlY2sgdGhlIGV4dGVuc2lvbg0KICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1FeHQgPSBpdGVtLm5hbWUuc3BsaXQoJy4nKS5wb3AoKT8udG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9ucy5pbmNsdWRlcyhpdGVtRXh0KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0V4dGVuc2lvbiBmaWx0ZXJpbmcgYXBwbGllZDonLCB7DQogICAgICAgICAgICAgICAgZXh0ZW5zaW9uczogZXh0ZW5zaW9ucywNCiAgICAgICAgICAgICAgICBiZWZvcmVGaWx0ZXI6IGFsbEl0ZW1zLmxlbmd0aCwNCiAgICAgICAgICAgICAgICBhZnRlckZpbHRlcjogZmlsdGVyZWRJdGVtcy5sZW5ndGgNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ05vIGV4dGVuc2lvbiBmaWx0ZXJpbmcgLSByZXR1cm5pbmcgYWxsIGl0ZW1zJyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBTZXBhcmF0ZSBmaWxlcyBhbmQgZGlyZWN0b3JpZXMNCiAgICAgICAgY29uc3QgZmlsZXMgPSBmaWx0ZXJlZEl0ZW1zLmZpbHRlcihpdGVtID0+ICFpdGVtLmlzX2RpcmVjdG9yeSk7DQogICAgICAgIGNvbnN0IGRpcmVjdG9yaWVzID0gZmlsdGVyZWRJdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmlzX2RpcmVjdG9yeSk7DQogICAgICAgIA0KICAgICAgICAvLyBDcmVhdGUgb3V0cHV0IGFycmF5cw0KICAgICAgICBjb25zdCBmaWxlUGF0aHMgPSBmaWxlcy5tYXAoZmlsZSA9PiBmaWxlLmZ1bGxQYXRoKTsNCiAgICAgICAgY29uc3QgZmlsZU5hbWVzID0gZmlsZXMubWFwKGZpbGUgPT4gZmlsZS5uYW1lKTsNCiAgICAgICAgY29uc3QgZGlyZWN0b3J5UGF0aHMgPSBkaXJlY3Rvcmllcy5tYXAoZGlyID0+IGRpci5mdWxsUGF0aCk7DQoNCiAgICAgICAgLy8gRmluYWwgZmlsZSBsaXN0IGJhc2VkIG9uIGluY2x1ZGVEaXJlY3RvcmllcyBzZXR0aW5nDQogICAgICAgIC8vIElmIGluY2x1ZGVEaXJlY3RvcmllcyBpcyB0cnVlLCByZXR1cm4gYWxsIGZpbHRlcmVkIGl0ZW1zIChmaWxlcyArIGRpcmVjdG9yaWVzKQ0KICAgICAgICAvLyBJZiBpbmNsdWRlRGlyZWN0b3JpZXMgaXMgZmFsc2UsIHJldHVybiBvbmx5IGZpbGVzDQogICAgICAgIGNvbnN0IGZpbmFsRmlsZUxpc3QgPSBpbmNsdWRlRGlyZWN0b3JpZXMgPyBmaWx0ZXJlZEl0ZW1zIDogZmlsZXM7DQoNCiAgICAgICAgY29uc29sZS5sb2coJ1Byb2Nlc3NpbmcgcmVzdWx0czonLCB7DQogICAgICAgICAgICB0b3RhbEZpbHRlcmVkSXRlbXM6IGZpbHRlcmVkSXRlbXMubGVuZ3RoLA0KICAgICAgICAgICAgZmlsZXNDb3VudDogZmlsZXMubGVuZ3RoLA0KICAgICAgICAgICAgZGlyZWN0b3JpZXNDb3VudDogZGlyZWN0b3JpZXMubGVuZ3RoLA0KICAgICAgICAgICAgaW5jbHVkZURpcmVjdG9yaWVzOiBpbmNsdWRlRGlyZWN0b3JpZXMsDQogICAgICAgICAgICBmaW5hbEZpbGVMaXN0Q291bnQ6IGZpbmFsRmlsZUxpc3QubGVuZ3RoDQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIFN0b3JlIHJlc3VsdHMgZm9yIGNvbmZpZyBwYW5lbCBkaXNwbGF5DQogICAgICAgIG5vZGUubGFzdERpcmVjdG9yeVBhdGggPSBkaXJlY3RvcnlQYXRoOw0KICAgICAgICBub2RlLmxhc3RGaWxlQ291bnQgPSBmaW5hbEZpbGVMaXN0Lmxlbmd0aDsNCiAgICAgICAgbm9kZS5sYXN0RmlsZUxpc3QgPSBmaW5hbEZpbGVMaXN0Ow0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBmaWxlX2xpc3Q6IGZpbmFsRmlsZUxpc3QsDQogICAgICAgICAgICBmaWxlX3BhdGhzOiBmaWxlUGF0aHMsDQogICAgICAgICAgICBmaWxlX25hbWVzOiBmaWxlTmFtZXMsDQogICAgICAgICAgICBjb3VudDogZmluYWxGaWxlTGlzdC5sZW5ndGgsDQogICAgICAgICAgICBkaXJlY3RvcmllczogZGlyZWN0b3J5UGF0aHMsDQogICAgICAgICAgICBmaWxlc19vbmx5OiBmaWxlcw0KICAgICAgICB9Ow0KICAgICAgICANCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdWRlMgRGlyZWN0b3J5IExpc3QgZXJyb3I6Jywgew0KICAgICAgICAgICAgZGlyZWN0b3J5UGF0aDogZGlyZWN0b3J5UGF0aCwNCiAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLA0KICAgICAgICAgICAgZXJyb3JTdGFjazogZXJyb3Iuc3RhY2sNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiB7IA0KICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsDQogICAgICAgICAgICBmaWxlX2xpc3Q6IFtdLA0KICAgICAgICAgICAgZmlsZV9wYXRoczogW10sDQogICAgICAgICAgICBmaWxlX25hbWVzOiBbXSwNCiAgICAgICAgICAgIGNvdW50OiAwLA0KICAgICAgICAgICAgZGlyZWN0b3JpZXM6IFtdLA0KICAgICAgICAgICAgZmlsZXNfb25seTogW10NCiAgICAgICAgfTsNCiAgICB9DQp9DQoNCi8vIEV4cG9ydCB0byBnbG9iYWwgc2NvcGUNCndpbmRvdy5odHRwRXhlY3V0b3JzID0gew0KICAgIGV4ZWN1dGVIdHRwTm9kZSwNCiAgICBleGVjdXRlVmZzTG9hZE5vZGUsDQogICAgZXhlY3V0ZVZmc1NhdmVOb2RlLA0KICAgIGV4ZWN1dGVWZnNEaXJlY3RvcnlMaXN0Tm9kZQ0KfTsNCg0KLy8gSW1hZ2UgTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUltYWdlTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBtYXhQcmV2aWV3U2l6ZSA9IG5vZGUuY29uZmlnLm1heF9wcmV2aWV3X3NpemUudmFsdWU7DQogICAgY29uc3Qgc2hvd0luZm8gPSBub2RlLmNvbmZpZy5zaG93X2luZm8udmFsdWUgPT09ICd0cnVlJzsNCg0KICAgIGxldCBpbWFnZURhdGEgPSBpbnB1dERhdGEuaW1hZ2VfZGF0YTsNCiAgICBsZXQgaW1hZ2VVcmwgPSBudWxsOw0KICAgIGxldCBpbWFnZUluZm8gPSBudWxsOw0KDQogICAgLy8gSGFuZGxlIGRpZmZlcmVudCB0eXBlcyBvZiBpbWFnZSBkYXRhDQogICAgaWYgKGltYWdlRGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgLy8gQ3JlYXRlIG9iamVjdCBVUkwgZm9yIEJsb2IgZGF0YQ0KICAgICAgICBpbWFnZVVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoaW1hZ2VEYXRhKTsNCiAgICAgICAgaW1hZ2VJbmZvID0gew0KICAgICAgICAgICAgdHlwZTogaW1hZ2VEYXRhLnR5cGUgfHwgJ2ltYWdlJywNCiAgICAgICAgICAgIHNpemU6IGltYWdlRGF0YS5zaXplDQogICAgICAgIH07DQogICAgfSBlbHNlIGlmICh0eXBlb2YgaW1hZ2VEYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGJhc2U2NCBkYXRhDQogICAgICAgIGlmIChpbWFnZURhdGEuc3RhcnRzV2l0aCgnZGF0YTppbWFnZS8nKSB8fCBpbWFnZURhdGEuc3RhcnRzV2l0aCgnZGF0YTphcHBsaWNhdGlvbi8nKSkgew0KICAgICAgICAgICAgLy8gQWxyZWFkeSBhIGRhdGEgVVJMDQogICAgICAgICAgICBpbWFnZVVybCA9IGltYWdlRGF0YTsNCiAgICAgICAgfSBlbHNlIGlmIChpbWFnZURhdGEubWF0Y2goL15bQS1aYS16MC05Ky9dKj17MCwyfSQvKSkgew0KICAgICAgICAgICAgLy8gTG9va3MgbGlrZSBiYXNlNjQgZGF0YSwgY29udmVydCB0byBkYXRhIFVSTA0KICAgICAgICAgICAgLy8gVHJ5IHRvIGRldGVjdCBpbWFnZSB0eXBlIGZyb20gdGhlIGRhdGENCiAgICAgICAgICAgIGNvbnN0IGltYWdlVHlwZSA9IHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZGV0ZWN0SW1hZ2VUeXBlRnJvbUJhc2U2NChpbWFnZURhdGEpOw0KICAgICAgICAgICAgaW1hZ2VVcmwgPSBgZGF0YToke2ltYWdlVHlwZX07YmFzZTY0LCR7aW1hZ2VEYXRhfWA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBc3N1bWUgaXQncyBhIHJlZ3VsYXIgVVJMDQogICAgICAgICAgICBpbWFnZVVybCA9IGltYWdlRGF0YTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoaW1hZ2VEYXRhICYmIHR5cGVvZiBpbWFnZURhdGEgPT09ICdvYmplY3QnKSB7DQogICAgICAgIC8vIEhhbmRsZSBvYmplY3Qgd2l0aCBpbWFnZSBkYXRhDQogICAgICAgIGlmIChpbWFnZURhdGEudXJsKSB7DQogICAgICAgICAgICBpbWFnZVVybCA9IGltYWdlRGF0YS51cmw7DQogICAgICAgIH0gZWxzZSBpZiAoaW1hZ2VEYXRhLmRhdGEpIHsNCiAgICAgICAgICAgIGltYWdlVXJsID0gaW1hZ2VEYXRhLmRhdGE7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoaW1hZ2VEYXRhLmluZm8pIHsNCiAgICAgICAgICAgIGltYWdlSW5mbyA9IGltYWdlRGF0YS5pbmZvOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gTm90ZTogUmVtb3ZlZCBpbWFnZSBkaW1lbnNpb24gZGV0ZWN0aW9uIGFzIGl0J3Mgbm90IG5lZWRlZA0KDQogICAgLy8gU3RvcmUgaW1hZ2UgZGF0YSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICBub2RlLmxhc3RJbWFnZURhdGEgPSBpbWFnZURhdGE7DQogICAgbm9kZS5sYXN0SW1hZ2VVcmwgPSBpbWFnZVVybDsNCiAgICBub2RlLmxhc3RJbWFnZUluZm8gPSBpbWFnZUluZm87DQoNCiAgICByZXR1cm4gew0KICAgICAgICBpbWFnZV9kYXRhOiBpbWFnZURhdGEsDQogICAgICAgIGltYWdlX3VybDogaW1hZ2VVcmwsDQogICAgICAgIGltYWdlX2luZm86IGltYWdlSW5mbywNCiAgICAgICAgZGF0YTogaW1hZ2VEYXRhDQogICAgfTsNCn0NCg0KLy8gQXVkaW8gTm9kZSBFeGVjdXRvcg0KYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUF1ZGlvTm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBhdXRvUGxheSA9IG5vZGUuY29uZmlnLmF1dG9QbGF5LnZhbHVlID09PSAndHJ1ZSc7DQogICAgY29uc3Qgdm9sdW1lID0gcGFyc2VGbG9hdChub2RlLmNvbmZpZy52b2x1bWUudmFsdWUpOw0KDQogICAgbGV0IGF1ZGlvRGF0YSA9IGlucHV0RGF0YS5hdWRpb19kYXRhOw0KDQoNCiAgICBpZiAoIWF1ZGlvRGF0YSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGF1ZGlvIGRhdGEgcHJvdmlkZWQnKTsNCiAgICB9DQoNCiAgICAvLyBTdG9yZSBhdWRpbyBkYXRhIGZvciBtYW51YWwgcGxheSBidXR0b24gc3lzdGVtIChsaWtlIG9sZCBzeXN0ZW0pDQogICAgbm9kZS5hdWRpb0RhdGEgPSBhdWRpb0RhdGE7DQogICAgbm9kZS52b2x1bWUgPSB2b2x1bWU7DQoNCiAgICAvLyBDcmVhdGUgYXVkaW8gZWxlbWVudCBpZiBpdCBkb2Vzbid0IGV4aXN0IChsaWtlIG9sZCBzeXN0ZW0pDQogICAgaWYgKCFub2RlLmF1ZGlvRWxlbWVudCkgew0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudCA9IG5ldyBBdWRpbygpOw0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5jb250cm9scyA9IHRydWU7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnN0eWxlLndpZHRoID0gJzEwMCUnOw0KICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7DQogICAgfQ0KDQogICAgLy8gU2V0IGF1ZGlvIHNvdXJjZSAobGlrZSBvbGQgc3lzdGVtKQ0KICAgIGlmIChhdWRpb0RhdGEgaW5zdGFuY2VvZiBCbG9iKSB7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYXVkaW9EYXRhKTsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhdWRpb0RhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIGlmIChhdWRpb0RhdGEuc3RhcnRzV2l0aCgnZGF0YTphdWRpby8nKSB8fCBhdWRpb0RhdGEuc3RhcnRzV2l0aCgnZGF0YTphcHBsaWNhdGlvbi8nKSkgew0KICAgICAgICAgICAgLy8gQWxyZWFkeSBhIGRhdGEgVVJMDQogICAgICAgICAgICBub2RlLmF1ZGlvRWxlbWVudC5zcmMgPSBhdWRpb0RhdGE7DQogICAgICAgIH0gZWxzZSBpZiAoYXVkaW9EYXRhLm1hdGNoKC9eW0EtWmEtejAtOSsvXSo9ezAsMn0kLykpIHsNCiAgICAgICAgICAgIC8vIExvb2tzIGxpa2UgYmFzZTY0IGRhdGEsIGNvbnZlcnQgdG8gZGF0YSBVUkwNCiAgICAgICAgICAgIGNvbnN0IGF1ZGlvVHlwZSA9ICdhdWRpby9tcGVnJzsgLy8gRGVmYXVsdCB0byBNUDMsIGNvdWxkIGJlIGVuaGFuY2VkIHRvIGRldGVjdCB0eXBlDQogICAgICAgICAgICBjb25zdCBkYXRhVXJsID0gYGRhdGE6JHthdWRpb1R5cGV9O2Jhc2U2NCwke2F1ZGlvRGF0YX1gOw0KICAgICAgICAgICAgbm9kZS5hdWRpb0VsZW1lbnQuc3JjID0gZGF0YVVybDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIEFzc3VtZSBpdCdzIGEgcmVndWxhciBVUkwNCiAgICAgICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnNyYyA9IGF1ZGlvRGF0YTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIG5vZGUuYXVkaW9FbGVtZW50LnNyYyA9IGF1ZGlvRGF0YTsNCiAgICB9DQoNCiAgICAvLyBTZXQgdm9sdW1lDQogICAgbm9kZS5hdWRpb0VsZW1lbnQudm9sdW1lID0gdm9sdW1lOw0KDQogICAgLy8gU3RvcmUgZm9yIGNvbmZpZyBwYW5lbCBjb21wYXRpYmlsaXR5DQogICAgbm9kZS5sYXN0QXVkaW9EYXRhID0gYXVkaW9EYXRhOw0KICAgIG5vZGUubGFzdEF1ZGlvVXJsID0gbm9kZS5hdWRpb0VsZW1lbnQuc3JjOw0KDQogICAgLy8gQXV0by1wbGF5IGlmIGNvbmZpZ3VyZWQNCiAgICBpZiAoYXV0b1BsYXkpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGF3YWl0IG5vZGUuYXVkaW9FbGVtZW50LnBsYXkoKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dG8tcGxheSBmYWlsZWQ6JywgZXJyb3IpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gQ29udmVydCBhdWRpbyBkYXRhIHRvIHByb3BlciBkYXRhIFVSTCBmb3IgVkZTIFNhdmUNCiAgICBsZXQgZGF0YVVybEZvclNhdmUgPSBudWxsOw0KDQogICAgaWYgKGF1ZGlvRGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgLy8gQ29udmVydCBCbG9iIHRvIGRhdGEgVVJMDQogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCk7DQogICAgICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDsNCiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGF1ZGlvRGF0YSk7DQogICAgICAgIH0pOw0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGF1ZGlvRGF0YSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgaWYgKGF1ZGlvRGF0YS5zdGFydHNXaXRoKCdkYXRhOmF1ZGlvLycpIHx8IGF1ZGlvRGF0YS5zdGFydHNXaXRoKCdkYXRhOmFwcGxpY2F0aW9uLycpKSB7DQogICAgICAgICAgICAvLyBBbHJlYWR5IGEgZGF0YSBVUkwNCiAgICAgICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYXVkaW9EYXRhOw0KICAgICAgICB9IGVsc2UgaWYgKGF1ZGlvRGF0YS5tYXRjaCgvXltBLVphLXowLTkrL10qPXswLDJ9JC8pKSB7DQogICAgICAgICAgICAvLyBCYXNlNjQgZGF0YSwgY29udmVydCB0byBkYXRhIFVSTA0KICAgICAgICAgICAgY29uc3QgYXVkaW9UeXBlID0gJ2F1ZGlvL21wZWcnOyAvLyBEZWZhdWx0IHRvIE1QMywgY291bGQgYmUgZW5oYW5jZWQgdG8gZGV0ZWN0IHR5cGUNCiAgICAgICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYGRhdGE6JHthdWRpb1R5cGV9O2Jhc2U2NCwke2F1ZGlvRGF0YX1gOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gUmVndWxhciBVUkwsIGtlZXAgYXMgaXMNCiAgICAgICAgICAgIGRhdGFVcmxGb3JTYXZlID0gYXVkaW9EYXRhOw0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gRmFsbGJhY2sNCiAgICAgICAgZGF0YVVybEZvclNhdmUgPSBhdWRpb0RhdGE7DQogICAgfQ0KDQogICAgcmV0dXJuIHsNCiAgICAgICAgYXVkaW9fZGF0YTogYXVkaW9EYXRhLA0KICAgICAgICBhdWRpb191cmw6IG5vZGUuYXVkaW9FbGVtZW50LnNyYywNCiAgICAgICAgZGF0YTogZGF0YVVybEZvclNhdmUgIC8vIFJldHVybiB0aGUgYWN0dWFsIGF1ZGlvIGRhdGEgYXMgZGF0YSBVUkwNCiAgICB9Ow0KfQ0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cubWVkaWFFeGVjdXRvcnMgPSB7DQogICAgZXhlY3V0ZUltYWdlTm9kZSwNCiAgICBleGVjdXRlQXVkaW9Ob2RlDQp9Ow0KDQoNCi8vIFRpbWVyIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVUaW1lck5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgaW50ZXJ2YWwgPSBub2RlLmNvbmZpZy5pbnRlcnZhbC52YWx1ZTsNCiAgICBjb25zdCBjb3VudCA9IG5vZGUuY29uZmlnLmNvdW50LnZhbHVlOw0KDQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTsNCiAgICAgICAgICAgIHJlc29sdmUoew0KICAgICAgICAgICAgICAgIHRyaWdnZXI6IHRpbWVzdGFtcCwNCiAgICAgICAgICAgICAgICBvcmlnaW5hbF9kYXRhOiB0aW1lc3RhbXAsDQogICAgICAgICAgICAgICAgcHJvY2Vzc2VkX2RhdGE6IHRpbWVzdGFtcCwNCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcCwNCiAgICAgICAgICAgICAgICBlbGFwc2VkOiBpbnRlcnZhbA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sIGludGVydmFsKTsNCiAgICB9KTsNCn0NCg0KLy8gRGlzcGxheSBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlRGlzcGxheU5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgZm9ybWF0ID0gbm9kZS5jb25maWcuZm9ybWF0LnZhbHVlOw0KICAgIGNvbnN0IG1heExlbmd0aCA9IG5vZGUuY29uZmlnLm1heExlbmd0aC52YWx1ZTsNCiAgICBjb25zdCBpbnB1dFBvcnQgPSBub2RlLmNvbmZpZy5pbnB1dF9wb3J0Py52YWx1ZSB8fCAnYXV0byc7DQoNCiAgICAvLyBUcnkgdG8gZmluZCBjb250ZW50IGJhc2VkIG9uIGNvbmZpZ3VyZWQgaW5wdXQgcG9ydCBvciBhdXRvLWRldGVjdA0KICAgIGxldCBjb250ZW50ID0gbnVsbDsNCg0KICAgIGlmIChpbnB1dFBvcnQgIT09ICdhdXRvJykgew0KICAgICAgICAvLyBVc2UgdGhlIHNwZWNpZmllZCBpbnB1dCBwb3J0DQogICAgICAgIGNvbnRlbnQgPSBpbnB1dERhdGFbaW5wdXRQb3J0XTsNCiAgICB9IGVsc2Ugew0KICAgICAgICAvLyBBdXRvLWRldGVjdDogUHJpb3JpdHkgb3JkZXI6IHRleHQsIGpzb24sIGRhdGEsIGJpbmFyeQ0KICAgICAgICBpZiAoaW5wdXREYXRhLnRleHQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgY29udGVudCA9IGlucHV0RGF0YS50ZXh0Ow0KICAgICAgICB9IGVsc2UgaWYgKGlucHV0RGF0YS5qc29uICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGNvbnRlbnQgPSBpbnB1dERhdGEuanNvbjsNCiAgICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEuZGF0YSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjb250ZW50ID0gaW5wdXREYXRhLmRhdGE7DQogICAgICAgIH0gZWxzZSBpZiAoaW5wdXREYXRhLmJpbmFyeSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjb250ZW50ID0gaW5wdXREYXRhLmJpbmFyeTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIFVzZSB0aGUgZmlyc3QgYXZhaWxhYmxlIGlucHV0DQogICAgICAgICAgICBjb25zdCBmaXJzdElucHV0ID0gT2JqZWN0LnZhbHVlcyhpbnB1dERhdGEpWzBdOw0KICAgICAgICAgICAgY29udGVudCA9IGZpcnN0SW5wdXQ7DQogICAgICAgIH0NCiAgICB9DQoNCg0KICAgIC8vIE9ubHkgY29udmVydCB0byBKU09OIHN0cmluZyBpZiBmb3JtYXQgaXMgJ2pzb24nIG9yIGlmIGl0J3MgYW4gb2JqZWN0IGFuZCBmb3JtYXQgaXMgbm90IHNwZWNpZmllZA0KICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ29iamVjdCcgJiYgZm9ybWF0ID09PSAnanNvbicpIHsNCiAgICAgICAgY29udGVudCA9IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsIDIpOw0KICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdvYmplY3QnICYmIGZvcm1hdCA9PT0gJ3RleHQnKSB7DQogICAgICAgIC8vIEZvciB0ZXh0IGZvcm1hdCwgZXh0cmFjdCB0aGUgYWN0dWFsIHZhbHVlIGZyb20gY29tbW9uIGZpZWxkcw0KICAgICAgICBpZiAoY29udGVudCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgY29udGVudCA9ICdudWxsJzsNCiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGNvbnRlbnQpKSB7DQogICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5qb2luKCcsICcpOw0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnb2JqZWN0Jykgew0KICAgICAgICAgICAgLy8gTG9vayBmb3IgdGhlIGFjdHVhbCB2YWx1ZSBpbiBjb21tb24gZmllbGRzDQogICAgICAgICAgICBpZiAoY29udGVudC5leHRyYWN0ZWRfdmFsdWUgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoY29udGVudC5leHRyYWN0ZWRfdmFsdWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZW50LnZhbHVlICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU3RyaW5nKGNvbnRlbnQudmFsdWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZW50LnRleHQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoY29udGVudC50ZXh0KTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVudC5kYXRhICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU3RyaW5nKGNvbnRlbnQuZGF0YSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIElmIG5vIGNvbW1vbiBmaWVsZHMgZm91bmQsIGp1c3Qgc2hvdyB0aGUgZmlyc3QgdmFsdWUNCiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFZhbHVlID0gT2JqZWN0LnZhbHVlcyhjb250ZW50KVswXTsNCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU3RyaW5nKGZpcnN0VmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgaWYgKGNvbnRlbnQgJiYgY29udGVudC5sZW5ndGggPiBtYXhMZW5ndGgpIHsNCiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKDAsIG1heExlbmd0aCkgKyAnLi4uJzsNCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgZGlzcGxheSBub2RlIGNvbnRlbnQNCiAgICB1cGRhdGVEaXNwbGF5Tm9kZUNvbnRlbnQobm9kZS5pZCwgY29udGVudCwgZm9ybWF0KTsNCg0KICAgIHJldHVybiB7DQogICAgICAgIG9yaWdpbmFsX2RhdGE6IGNvbnRlbnQsDQogICAgICAgIGRpc3BsYXllZDogY29udGVudCwNCiAgICAgICAgcHJvY2Vzc2VkX2RhdGE6IGNvbnRlbnQNCiAgICB9Ow0KfQ0KDQoNCi8vIFJlcGVhdGVyIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVSZXBlYXRlck5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgaW50ZXJ2YWwgPSBwYXJzZUludChub2RlLmNvbmZpZy5pbnRlcnZhbC52YWx1ZSk7DQogICAgY29uc3QgY291bnQgPSBwYXJzZUludChub2RlLmNvbmZpZy5jb3VudC52YWx1ZSk7DQoNCiAgICAvLyBJbml0aWFsaXplIHJlcGVhdGVyIHN0YXRlIGlmIG5vdCBleGlzdHMNCiAgICBpZiAoIW5vZGUucmVwZWF0ZXJTdGF0ZSkgew0KICAgICAgICBub2RlLnJlcGVhdGVyU3RhdGUgPSB7DQogICAgICAgICAgICBjb3VudDogMCwNCiAgICAgICAgICAgIGludGVydmFsOiBudWxsLA0KICAgICAgICAgICAgaXNSdW5uaW5nOiBmYWxzZQ0KICAgICAgICB9Ow0KICAgIH0NCg0KICAgIC8vIElmIHRoaXMgaXMgYSBtYW51YWwgdHJpZ2dlciAobm90IGZyb20gaW50ZXJ2YWwpLCBzdGFydCB0aGUgcmVwZWF0ZXINCiAgICBpZiAoIW5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmcpIHsNCiAgICAgICAgbm9kZS5yZXBlYXRlclN0YXRlLmlzUnVubmluZyA9IHRydWU7DQogICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCA9IDA7DQoNCiAgICAgICAgLy8gU3RhcnQgdGhlIGludGVydmFsDQogICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5pbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCsrOw0KDQogICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBjb25uZWN0ZWQgd29ya2Zsb3cNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29ubmVjdGVkTm9kZXMgPSBmaW5kQ29ubmVjdGVkTm9kZXMobm9kZS5pZCk7DQogICAgICAgICAgICAgICAgY29uc3QgZXhlY3V0ZWQgPSBuZXcgU2V0KCk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbm5lY3RlZE5vZGUgb2YgY29ubmVjdGVkTm9kZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZXhlY3V0ZU5vZGUoY29ubmVjdGVkTm9kZS5ub2RlLCB7IHRyaWdnZXI6IERhdGUubm93KCkgfSwgZXhlY3V0ZWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZXhlY3V0aW5nIHJlcGVhdGVyIHdvcmtmbG93OicsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gU3RvcCBpZiBjb3VudCBsaW1pdCByZWFjaGVkDQogICAgICAgICAgICBpZiAoY291bnQgPiAwICYmIG5vZGUucmVwZWF0ZXJTdGF0ZS5jb3VudCA+PSBjb3VudCkgew0KICAgICAgICAgICAgICAgIGVuZ2luZS5zdG9wUmVwZWF0ZXIobm9kZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sIGludGVydmFsKTsNCiAgICB9DQoNCiAgICByZXR1cm4geyB0cmlnZ2VyOiBEYXRlLm5vdygpLCBjb3VudDogbm9kZS5yZXBlYXRlclN0YXRlLmNvdW50LCBpc1J1bm5pbmc6IG5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmcgfTsNCn0NCg0KLy8gQ29uZGl0aW9uIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVDb25kaXRpb25Ob2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IG9wZXJhdG9yID0gbm9kZS5jb25maWcub3BlcmF0b3IudmFsdWU7DQogICAgY29uc3QgY29tcGFyZVZhbHVlID0gbm9kZS5jb25maWcuY29tcGFyZV92YWx1ZS52YWx1ZTsNCiAgICBjb25zdCBjYXNlU2Vuc2l0aXZlID0gbm9kZS5jb25maWcuY2FzZV9zZW5zaXRpdmUudmFsdWUgPT09ICd0cnVlJzsNCg0KICAgIGxldCBpbnB1dFZhbHVlID0gaW5wdXREYXRhLnZhbHVlOw0KICAgIGxldCByZXN1bHQgPSBmYWxzZTsNCg0KICAgIC8vIENvbnZlcnQgaW5wdXQgdG8gc3RyaW5nIGZvciBjb21wYXJpc29uIGlmIG5lZWRlZA0KICAgIGxldCBpbnB1dFN0ciA9IFN0cmluZyhpbnB1dFZhbHVlKTsNCiAgICBsZXQgY29tcGFyZVN0ciA9IFN0cmluZyhjb21wYXJlVmFsdWUpOw0KDQogICAgLy8gRGVidWcgbG9nZ2luZyBmb3Igc3RyaW5nIGNvbXBhcmlzb25zDQoNCiAgICAvLyBIYW5kbGUgY2FzZSBzZW5zaXRpdml0eQ0KICAgIGlmICghY2FzZVNlbnNpdGl2ZSkgew0KICAgICAgICBpbnB1dFN0ciA9IGlucHV0U3RyLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIGNvbXBhcmVTdHIgPSBjb21wYXJlU3RyLnRvTG93ZXJDYXNlKCk7DQogICAgfQ0KDQogICAgLy8gUGVyZm9ybSBjb21wYXJpc29uIGJhc2VkIG9uIG9wZXJhdG9yDQogICAgc3dpdGNoIChvcGVyYXRvcikgew0KICAgICAgICBjYXNlICdlcXVhbHMnOg0KICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXRTdHIgPT09IGNvbXBhcmVTdHI7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnbm90X2VxdWFscyc6DQogICAgICAgICAgICByZXN1bHQgPSBpbnB1dFN0ciAhPT0gY29tcGFyZVN0cjsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdncmVhdGVyX3RoYW4nOg0KICAgICAgICAgICAgcmVzdWx0ID0gTnVtYmVyKGlucHV0VmFsdWUpID4gTnVtYmVyKGNvbXBhcmVWYWx1ZSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnbGVzc190aGFuJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IE51bWJlcihpbnB1dFZhbHVlKSA8IE51bWJlcihjb21wYXJlVmFsdWUpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2dyZWF0ZXJfdGhhbl9vcl9lcXVhbCc6DQogICAgICAgICAgICByZXN1bHQgPSBOdW1iZXIoaW5wdXRWYWx1ZSkgPj0gTnVtYmVyKGNvbXBhcmVWYWx1ZSk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnbGVzc190aGFuX29yX2VxdWFsJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IE51bWJlcihpbnB1dFZhbHVlKSA8PSBOdW1iZXIoY29tcGFyZVZhbHVlKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdjb250YWlucyc6DQogICAgICAgICAgICByZXN1bHQgPSBpbnB1dFN0ci5pbmNsdWRlcyhjb21wYXJlU3RyKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICdub3RfY29udGFpbnMnOg0KICAgICAgICAgICAgcmVzdWx0ID0gIWlucHV0U3RyLmluY2x1ZGVzKGNvbXBhcmVTdHIpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ3N0YXJ0c193aXRoJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLnN0YXJ0c1dpdGgoY29tcGFyZVN0cik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnZW5kc193aXRoJzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLmVuZHNXaXRoKGNvbXBhcmVTdHIpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2lzX2VtcHR5JzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLnRyaW0oKSA9PT0gJyc7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAnaXNfbm90X2VtcHR5JzoNCiAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0U3RyLnRyaW0oKSAhPT0gJyc7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOw0KICAgIH0NCg0KICAgIC8vIFN0b3JlIGZvciBkaXNwbGF5IGluIGNvbmZpZyBwYW5lbA0KICAgIG5vZGUubGFzdElucHV0VmFsdWUgPSBpbnB1dFZhbHVlOw0KICAgIG5vZGUubGFzdENvbXBhcmVWYWx1ZSA9IGNvbXBhcmVWYWx1ZTsNCiAgICBub2RlLmxhc3RSZXN1bHQgPSByZXN1bHQ7DQogICAgbm9kZS5sYXN0T3BlcmF0b3IgPSBvcGVyYXRvcjsNCg0KICAgIHJldHVybiB7IHJlc3VsdDogcmVzdWx0IH07DQp9DQoNCi8vIExvZ2ljYWwgR2F0ZSBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlTG9naWNhbEdhdGVOb2RlKGVuZ2luZSwgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgIGNvbnN0IGludmVydCA9IG5vZGUuY29uZmlnLmludmVydC52YWx1ZSA9PT0gJ3RydWUnOw0KICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gbm9kZS5jb25maWcuZGVzY3JpcHRpb24udmFsdWU7DQoNCiAgICBsZXQgY29uZGl0aW9uID0gaW5wdXREYXRhLmNvbmRpdGlvbjsNCg0KICAgIC8vIENvbnZlcnQgdG8gYm9vbGVhbiBpZiBuZWVkZWQNCiAgICBpZiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgY29uZGl0aW9uID0gY29uZGl0aW9uLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJzsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25kaXRpb24gPT09ICdudW1iZXInKSB7DQogICAgICAgIGNvbmRpdGlvbiA9IGNvbmRpdGlvbiAhPT0gMDsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25kaXRpb24gPT09ICdvYmplY3QnKSB7DQogICAgICAgIC8vIElmIGl0J3MgYW4gb2JqZWN0IHdpdGggYSByZXN1bHQgZmllbGQgKGZyb20gY29uZGl0aW9uIG5vZGUpDQogICAgICAgIGNvbmRpdGlvbiA9IGNvbmRpdGlvbi5yZXN1bHQgPT09IHRydWU7DQogICAgfQ0KDQogICAgLy8gQXBwbHkgaW52ZXJzaW9uIGlmIGNvbmZpZ3VyZWQNCiAgICBpZiAoaW52ZXJ0KSB7DQogICAgICAgIGNvbmRpdGlvbiA9ICFjb25kaXRpb247DQogICAgfQ0KDQogICAgLy8gU3RvcmUgZm9yIGRpc3BsYXkgaW4gY29uZmlnIHBhbmVsDQogICAgbm9kZS5sYXN0Q29uZGl0aW9uID0gY29uZGl0aW9uOw0KICAgIG5vZGUubGFzdEludmVydGVkID0gaW52ZXJ0Ow0KICAgIG5vZGUubGFzdERlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247DQoNCiAgICAvLyBPbmx5IHJldHVybiB0cmlnZ2VyIGlmIGNvbmRpdGlvbiBpcyB0cnVlDQogICAgaWYgKGNvbmRpdGlvbikgew0KICAgICAgICByZXR1cm4geyB0cmlnZ2VyOiBEYXRlLm5vdygpIH07DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gUmV0dXJuIHNwZWNpYWwgb2JqZWN0IHRvIGluZGljYXRlIGV4ZWN1dGlvbiBzaG91bGQgc3RvcA0KICAgICAgICByZXR1cm4geyBfX3N0b3BfZXhlY3V0aW9uOiB0cnVlIH07DQogICAgfQ0KfQ0KDQovLyBGb3IgRWFjaCBOb2RlIEV4ZWN1dG9yDQphc3luYyBmdW5jdGlvbiBleGVjdXRlRm9yRWFjaE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3Qgc3RvcE9uRXJyb3IgPSBub2RlLmNvbmZpZy5zdG9wX29uX2Vycm9yLnZhbHVlID09PSAndHJ1ZSc7DQogICAgDQogICAgLy8gR2V0IHRoZSBpdGVyYXRpb24gZGVsYXkgZnJvbSBjb25maWcgKGluIG1pbGxpc2Vjb25kcykNCiAgICBjb25zdCBpdGVyYXRpb25EZWxheSA9IG5vZGUuY29uZmlnLml0ZXJhdGlvbl9kZWxheT8udmFsdWUgfHwgMDsNCiAgICANCiAgICAvLyBHZXQgdGhlIGFycmF5IGZyb20gaW5wdXQNCiAgICBsZXQgYXJyYXkgPSBpbnB1dERhdGEuYXJyYXk7DQogICAgDQogICAgLy8gSWYgYXJyYXkgaXMgbm90IHByb3ZpZGVkLCB0cnkgb3RoZXIgY29tbW9uIGlucHV0IG5hbWVzDQogICAgaWYgKCFBcnJheS5pc0FycmF5KGFycmF5KSkgew0KICAgICAgICBhcnJheSA9IGlucHV0RGF0YS5kYXRhIHx8IGlucHV0RGF0YS5maWxlX25hbWVzIHx8IGlucHV0RGF0YS5pdGVtczsNCiAgICB9DQogICAgDQogICAgLy8gRW5zdXJlIHdlIGhhdmUgYSB2YWxpZCBhcnJheQ0KICAgIGlmICghQXJyYXkuaXNBcnJheShhcnJheSkpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3IgRWFjaCBub2RlIHJlcXVpcmVzIGFuIGFycmF5IGlucHV0Jyk7DQogICAgfQ0KDQogICAgY29uc29sZS5sb2coJ0ZvciBFYWNoIERlYnVnOicsIHsNCiAgICAgICAgYXJyYXlMZW5ndGg6IGFycmF5Lmxlbmd0aCwNCiAgICAgICAgYXJyYXlQcmV2aWV3OiBhcnJheS5zbGljZSgwLCAzKSwNCiAgICAgICAgc3RvcE9uRXJyb3I6IHN0b3BPbkVycm9yLA0KICAgICAgICBpdGVyYXRpb25EZWxheTogaXRlcmF0aW9uRGVsYXkNCiAgICB9KTsNCg0KICAgIC8vIEluaXRpYWxpemUgaXRlcmF0aW9uIHN0YXRlIGlmIG5vdCBleGlzdHMNCiAgICBpZiAoIW5vZGUuZm9yRWFjaFN0YXRlKSB7DQogICAgICAgIG5vZGUuZm9yRWFjaFN0YXRlID0gew0KICAgICAgICAgICAgY3VycmVudEluZGV4OiAwLA0KICAgICAgICAgICAgYXJyYXk6IGFycmF5LA0KICAgICAgICAgICAgaXNJdGVyYXRpbmc6IGZhbHNlLA0KICAgICAgICAgICAgaXNFeGVjdXRpbmdJdGVyYXRpb246IGZhbHNlLA0KICAgICAgICAgICAgaW50ZXJ2YWw6IG51bGwNCiAgICAgICAgfTsNCiAgICB9DQoNCiAgICAvLyBJZiB0aGlzIGlzIGEgbWFudWFsIHRyaWdnZXIgKG5vdCBmcm9tIGludGVydmFsKSwgc3RhcnQgdGhlIGl0ZXJhdG9yDQogICAgaWYgKCFub2RlLmZvckVhY2hTdGF0ZS5pc0l0ZXJhdGluZykgew0KICAgICAgICBub2RlLmZvckVhY2hTdGF0ZS5pc0l0ZXJhdGluZyA9IHRydWU7DQogICAgICAgIG5vZGUuZm9yRWFjaFN0YXRlLmN1cnJlbnRJbmRleCA9IDA7DQogICAgICAgIG5vZGUuZm9yRWFjaFN0YXRlLmFycmF5ID0gYXJyYXk7DQoNCiAgICAgICAgLy8gU3RhcnQgdGhlIGl0ZXJhdGlvbiBwcm9jZXNzaW5nIHdpdGggcHJvcGVyIHRpbWluZw0KICAgICAgICBub2RlLmZvckVhY2hTdGF0ZS5pbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIC8vIFNraXAgaWYgcHJldmlvdXMgaXRlcmF0aW9uIGlzIHN0aWxsIHJ1bm5pbmcNCiAgICAgICAgICAgIGlmIChub2RlLmZvckVhY2hTdGF0ZS5pc0V4ZWN1dGluZ0l0ZXJhdGlvbikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3IgRWFjaDogU2tpcHBpbmcgaXRlcmF0aW9uIC0gcHJldmlvdXMgc3RpbGwgcnVubmluZycpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKG5vZGUuZm9yRWFjaFN0YXRlLmN1cnJlbnRJbmRleCA8IG5vZGUuZm9yRWFjaFN0YXRlLmFycmF5Lmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIG5vZGUuZm9yRWFjaFN0YXRlLmlzRXhlY3V0aW5nSXRlcmF0aW9uID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SXRlbSA9IG5vZGUuZm9yRWFjaFN0YXRlLmFycmF5W25vZGUuZm9yRWFjaFN0YXRlLmN1cnJlbnRJbmRleF07DQogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gbm9kZS5mb3JFYWNoU3RhdGUuY3VycmVudEluZGV4Ow0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGb3IgRWFjaCBpdGVyYXRpb24gJHtjdXJyZW50SW5kZXggKyAxfS8ke25vZGUuZm9yRWFjaFN0YXRlLmFycmF5Lmxlbmd0aH06YCwgY3VycmVudEl0ZW0pOw0KDQogICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgY29ubmVjdGVkIHdvcmtmbG93IC0gdXNlIHRoZSBleGVjdXRpb24gZW5naW5lIGRpcmVjdGx5DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gRmluZCBub2RlcyBjb25uZWN0ZWQgdG8gdGhlIGN1cnJlbnRfaXRlbSBvdXRwdXQgcG9ydA0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0ZWROb2RlcyA9IFtdOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb24gb2YgZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgPT09IG5vZGUuaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubmVjdGlvbi50by5ub2RlSWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXROb2RlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3RlZE5vZGVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogdGFyZ2V0Tm9kZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0UG9ydDogY29ubmVjdGlvbi50by5wb3J0TmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFBvcnQ6IGNvbm5lY3Rpb24uZnJvbS5wb3J0TmFtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAvLyBTZXQgYWxsIGNvbm5lY3RlZCBub2RlcyB0byBydW5uaW5nIHN0YXRlIGJlZm9yZSBleGVjdXRpb24NCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb25uZWN0ZWROb2RlSW5mbyBvZiBjb25uZWN0ZWROb2Rlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25uZWN0ZWROb2RlSW5mby5ub2RlLmlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlZCcsICdlcnJvcicsICd3YWl0aW5nLWlucHV0cycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3J1bm5pbmcnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgZWFjaCBjb25uZWN0ZWQgbm9kZSB3aXRoIHRoZSBhcHByb3ByaWF0ZSBkYXRhDQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29ubmVjdGVkTm9kZUluZm8gb2YgY29ubmVjdGVkTm9kZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBNYXAgdGhlIEZvciBFYWNoIG91dHB1dHMgdG8gdGhlIGNvbm5lY3RlZCBub2RlJ3MgaW5wdXQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25uZWN0ZWROb2RlSW5mby5vdXRwdXRQb3J0ID09PSAnY3VycmVudF9pdGVtJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUgPSBjdXJyZW50SXRlbTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29ubmVjdGVkTm9kZUluZm8ub3V0cHV0UG9ydCA9PT0gJ2N1cnJlbnRfaW5kZXgnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCBpbmRleCB0byBzdHJpbmcgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCB0ZXh0LWJhc2VkIG5vZGVzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IFN0cmluZyhjdXJyZW50SW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gY3VycmVudEl0ZW07IC8vIERlZmF1bHQgdG8gY3VycmVudCBpdGVtDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBpbnB1dCBkYXRhIGZvciB0aGUgY29ubmVjdGVkIG5vZGUNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVJbnB1dERhdGEgPSB7fTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVJbnB1dERhdGFbY29ubmVjdGVkTm9kZUluZm8uaW5wdXRQb3J0XSA9IGlucHV0VmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSB3b3JrZmxvdyBleGVjdXRpb24gc3lzdGVtIHRvIGVuc3VyZSBkb3duc3RyZWFtIG5vZGVzIGV4ZWN1dGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHdpbGwgdHJpZ2dlciB0aGUgY29tcGxldGUgZXhlY3V0aW9uIGNoYWluIChsbG0g4oaSIGh0dHAg4oaSIGV0Yy4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlIGZyZXNoIGV4ZWN1dGVkIHNldCBmb3IgZWFjaCBpdGVyYXRpb24sIGJ1dCBjb3B5IHJlbGV2YW50IGJ1ZmZlciBkYXRhDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlcmF0aW9uRXhlY3V0ZWQgPSBuZXcgU2V0KCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlcmF0aW9uSW5wdXRCdWZmZXIgPSBuZXcgTWFwKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29weSBhbnkgZXhpc3RpbmcgYnVmZmVyIGRhdGEgZnJvbSBnbG9iYWwgYnVmZmVyIHRoYXQgbWlnaHQgYmUgbmVlZGVkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5nbG9iYWxOb2RlSW5wdXRCdWZmZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbbm9kZUlkLCBidWZmZXJEYXRhXSBvZiB3aW5kb3cuZ2xvYmFsTm9kZUlucHV0QnVmZmVyLmVudHJpZXMoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlcmF0aW9uSW5wdXRCdWZmZXIuc2V0KG5vZGVJZCwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkSW5wdXRzOiB7IC4uLmJ1ZmZlckRhdGEucmVjZWl2ZWRJbnB1dHMgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0ZWRQb3J0czogWy4uLmJ1ZmZlckRhdGEuY29ubmVjdGVkUG9ydHNdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBleGVjdXRlTm9kZVNtYXJ0KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0ZWROb2RlSW5mby5ub2RlLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGVkTm9kZUluZm8uaW5wdXRQb3J0LCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZXJhdGlvbkV4ZWN1dGVkLCAvLyBVc2UgZnJlc2ggZXhlY3V0ZWQgc2V0IGZvciBlYWNoIGl0ZXJhdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVyYXRpb25JbnB1dEJ1ZmZlciAgLy8gVXNlIGJ1ZmZlciB3aXRoIHByZS1leGlzdGluZyBkYXRhIGZyb20gbWFpbiB3b3JrZmxvdw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBub2RlIGFzIGNvbXBsZXRlZCBhZnRlciBzdWNjZXNzZnVsIGV4ZWN1dGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29ubmVjdGVkTm9kZUluZm8ubm9kZS5pZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY29tcGxldGVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobm9kZUVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBub2RlIGFzIGVycm9yIGlmIGV4ZWN1dGlvbiBmYWlscw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29ubmVjdGVkTm9kZUluZm8ubm9kZS5pZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZXJyb3InKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmUtdGhyb3cgdGhlIGVycm9yIHRvIGJlIGhhbmRsZWQgYnkgdGhlIG91dGVyIGNhdGNoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbm9kZUVycm9yOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIHRoaXMgaXRlcmF0aW9uIGFzIGNvbXBsZXRlDQogICAgICAgICAgICAgICAgICAgIG5vZGUuZm9yRWFjaFN0YXRlLmlzRXhlY3V0aW5nSXRlcmF0aW9uID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV4ZWN1dGluZyBmb3IgZWFjaCBpdGVyYXRpb246JywgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gTWFyayB0aGlzIGl0ZXJhdGlvbiBhcyBjb21wbGV0ZSBldmVuIG9uIGVycm9yDQogICAgICAgICAgICAgICAgICAgIG5vZGUuZm9yRWFjaFN0YXRlLmlzRXhlY3V0aW5nSXRlcmF0aW9uID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIGFueSBzdGlsbC1ydW5uaW5nIGNvbm5lY3RlZCBub2RlcyBhcyBlcnJvcg0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0ZWROb2RlcyA9IFtdOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbm5lY3Rpb24gb2YgZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgPT09IG5vZGUuaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQoY29ubmVjdGlvbi50by5ub2RlSWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXROb2RlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3RlZE5vZGVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogdGFyZ2V0Tm9kZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0UG9ydDogY29ubmVjdGlvbi50by5wb3J0TmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFBvcnQ6IGNvbm5lY3Rpb24uZnJvbS5wb3J0TmFtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29ubmVjdGVkTm9kZUluZm8gb2YgY29ubmVjdGVkTm9kZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29ubmVjdGVkTm9kZUluZm8ubm9kZS5pZCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQgJiYgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdydW5uaW5nJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZXJyb3InKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3BPbkVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIHRoZSBpdGVyYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobm9kZS5mb3JFYWNoU3RhdGUuaW50ZXJ2YWwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5mb3JFYWNoU3RhdGUuaXNJdGVyYXRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZm9yRWFjaFN0YXRlLmludGVydmFsID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIE1vdmUgdG8gbmV4dCBpdGVtDQogICAgICAgICAgICAgICAgbm9kZS5mb3JFYWNoU3RhdGUuY3VycmVudEluZGV4Kys7DQoNCiAgICAgICAgICAgICAgICAvLyBTdG9wIGlmIHdlJ3ZlIHByb2Nlc3NlZCBhbGwgaXRlbXMNCiAgICAgICAgICAgICAgICBpZiAobm9kZS5mb3JFYWNoU3RhdGUuY3VycmVudEluZGV4ID49IG5vZGUuZm9yRWFjaFN0YXRlLmFycmF5Lmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKG5vZGUuZm9yRWFjaFN0YXRlLmludGVydmFsKTsNCiAgICAgICAgICAgICAgICAgICAgbm9kZS5mb3JFYWNoU3RhdGUuaXNJdGVyYXRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgbm9kZS5mb3JFYWNoU3RhdGUuaW50ZXJ2YWwgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRm9yIEVhY2ggY29tcGxldGVkIGFsbCBpdGVtcycpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gRW5zdXJlIGFsbCBjb25uZWN0ZWQgbm9kZXMgc2hvdyBmaW5hbCBjb21wbGV0ZWQgc3RhdHVzDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3RlZE5vZGVzID0gW107DQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29ubmVjdGlvbiBvZiBmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGlvbi5mcm9tLm5vZGVJZCA9PT0gbm9kZS5pZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChjb25uZWN0aW9uLnRvLm5vZGVJZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldE5vZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGVkTm9kZXMucHVzaCh0YXJnZXROb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29ubmVjdGVkTm9kZSBvZiBjb25uZWN0ZWROb2Rlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb25uZWN0ZWROb2RlLmlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlRWxlbWVudCAmJiAhbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlcnJvcicpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgncnVubmluZycsICd3YWl0aW5nLWlucHV0cycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCBpdGVyYXRpb25EZWxheSk7IC8vIFVzZSBjb25maWd1cmFibGUgaXRlcmF0aW9uIGRlbGF5DQogICAgICAgIA0KICAgICAgICAvLyBEb24ndCByZXR1cm4gYW55IGRhdGEgaW1tZWRpYXRlbHkgLSBsZXQgdGhlIGludGVydmFsIGhhbmRsZSBhbGwgZXhlY3V0aW9ucw0KICAgICAgICAvLyBVc2UgYSBzcGVjaWFsIGZsYWcgdG8gcHJldmVudCBtYWluIHdvcmtmbG93IGZyb20gZXhlY3V0aW5nIGRvd25zdHJlYW0gbm9kZXMNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIHN0YXJ0ZWQ6IHRydWUsDQogICAgICAgICAgICB0b3RhbF9pdGVtczogYXJyYXkubGVuZ3RoLA0KICAgICAgICAgICAgaXRlcmF0aW9uX2RlbGF5OiBpdGVyYXRpb25EZWxheSwNCiAgICAgICAgICAgIG1lc3NhZ2U6IGBGb3IgRWFjaCBpdGVyYXRpb24gc3RhcnRlZCB3aXRoICR7aXRlcmF0aW9uRGVsYXl9bXMgZGVsYXlgLA0KICAgICAgICAgICAgX19mb3JfZWFjaF9jb250cm9sOiB0cnVlICAvLyBTcGVjaWFsIGZsYWcgdG8gcHJldmVudCBkb3duc3RyZWFtIGV4ZWN1dGlvbiBieSBtYWluIHdvcmtmbG93DQogICAgICAgIH07DQogICAgfQ0KDQogICAgLy8gSWYgYWxyZWFkeSBpdGVyYXRpbmcsIHJldHVybiBjdXJyZW50IHN0YXRlDQogICAgcmV0dXJuIHsNCiAgICAgICAgaXNJdGVyYXRpbmc6IG5vZGUuZm9yRWFjaFN0YXRlLmlzSXRlcmF0aW5nLA0KICAgICAgICBjdXJyZW50X2luZGV4OiBub2RlLmZvckVhY2hTdGF0ZS5jdXJyZW50SW5kZXgsDQogICAgICAgIHRvdGFsX2l0ZW1zOiBub2RlLmZvckVhY2hTdGF0ZS5hcnJheS5sZW5ndGgNCiAgICB9Ow0KfQ0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cuZmxvd0V4ZWN1dG9ycyA9IHsNCiAgICBleGVjdXRlVGltZXJOb2RlLA0KICAgIGV4ZWN1dGVEaXNwbGF5Tm9kZSwNCiAgICBleGVjdXRlUmVwZWF0ZXJOb2RlLA0KICAgIGV4ZWN1dGVDb25kaXRpb25Ob2RlLA0KICAgIGV4ZWN1dGVMb2dpY2FsR2F0ZU5vZGUsDQogICAgZXhlY3V0ZUZvckVhY2hOb2RlDQp9Ow0KDQoNCi8vIExMTSBDaGF0IE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVMbG1DaGF0Tm9kZShlbmdpbmUsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpIHsNCiAgICBjb25zdCBlbmRwb2ludCA9IG5vZGUuY29uZmlnLmVuZHBvaW50LnZhbHVlOw0KICAgIGNvbnN0IG1vZGVsID0gbm9kZS5jb25maWcubW9kZWwudmFsdWU7DQogICAgY29uc3QgdGVtcGVyYXR1cmUgPSBwYXJzZUZsb2F0KG5vZGUuY29uZmlnLnRlbXBlcmF0dXJlLnZhbHVlKTsNCiAgICBjb25zdCBtYXhUb2tlbnMgPSBwYXJzZUludChub2RlLmNvbmZpZy5tYXhfdG9rZW5zLnZhbHVlKTsNCiAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBub2RlLmNvbmZpZy5zeXN0ZW1fcHJvbXB0LnZhbHVlOw0KICAgIGNvbnN0IGluY2x1ZGVDb250ZXh0ID0gbm9kZS5jb25maWcuaW5jbHVkZV9jb250ZXh0LnZhbHVlID09PSAndHJ1ZSc7DQoNCiAgICAvLyBBY2NlcHQgcHJvbXB0IGZyb20gZWl0aGVyICdwcm9tcHQnIG9yICd0ZXh0JyBpbnB1dA0KICAgIGxldCBwcm9tcHQgPSBpbnB1dERhdGEucHJvbXB0Ow0KICAgIGlmICghcHJvbXB0ICYmIGlucHV0RGF0YS50ZXh0KSB7DQogICAgICAgIHByb21wdCA9IGlucHV0RGF0YS50ZXh0Ow0KICAgIH0NCiAgICBpZiAoIXByb21wdCAmJiBpbnB1dERhdGEuY29udGV4dCkgew0KICAgICAgICAvLyBJZiBjb250ZXh0IGlzIGEgc3RyaW5nLCB1c2UgaXQgYXMgcHJvbXB0DQogICAgICAgIGlmICh0eXBlb2YgaW5wdXREYXRhLmNvbnRleHQgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICBwcm9tcHQgPSBpbnB1dERhdGEuY29udGV4dDsNCiAgICAgICAgfSBlbHNlIGlmIChpbnB1dERhdGEuY29udGV4dCAmJiB0eXBlb2YgaW5wdXREYXRhLmNvbnRleHQgPT09ICdvYmplY3QnICYmIGlucHV0RGF0YS5jb250ZXh0LnRleHQpIHsNCiAgICAgICAgICAgIC8vIElmIGNvbnRleHQgaXMgYW4gb2JqZWN0IHdpdGggdGV4dCBmaWVsZCwgdXNlIHRoYXQNCiAgICAgICAgICAgIHByb21wdCA9IGlucHV0RGF0YS5jb250ZXh0LnRleHQ7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCFwcm9tcHQpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdMTE0gQ2hhdCByZXF1aXJlcyBhIHByb21wdCBpbnB1dC4gQ29ubmVjdCBhIFRleHQgbm9kZSB0byBwcm92aWRlIHRoZSBwcm9tcHQuJyk7DQogICAgfQ0KDQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgbWVzc2FnZXMgPSBbXTsNCg0KICAgICAgICBpZiAoc3lzdGVtUHJvbXB0KSB7DQogICAgICAgICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbVByb21wdCB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpbmNsdWRlQ29udGV4dCAmJiBpbnB1dERhdGEuY29udGV4dCkgew0KICAgICAgICAgICAgbWVzc2FnZXMucHVzaCh7IHJvbGU6ICd1c2VyJywgY29udGVudDogYENvbnRleHQ6ICR7SlNPTi5zdHJpbmdpZnkoaW5wdXREYXRhLmNvbnRleHQpfVxuXG5Qcm9tcHQ6ICR7cHJvbXB0fWAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiBwcm9tcHQgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2VuZHBvaW50fS9jaGF0L2NvbXBsZXRpb25zYCwgew0KICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsDQogICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsNCiAgICAgICAgICAgICAgICBtb2RlbDogbW9kZWwsDQogICAgICAgICAgICAgICAgbWVzc2FnZXM6IG1lc3NhZ2VzLA0KICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiB0ZW1wZXJhdHVyZSwNCiAgICAgICAgICAgICAgICBtYXhfdG9rZW5zOiBtYXhUb2tlbnMNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7DQoNCiAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLmVycm9yLm1lc3NhZ2UgfHwgJ0xMTSBBUEkgZXJyb3InKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRhdGEuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudCB8fCAnJzsNCg0KICAgICAgICAvLyBTdG9yZSBmb3IgZGlzcGxheSBpbiBjb25maWcgcGFuZWwNCiAgICAgICAgbm9kZS5sYXN0UmVzcG9uc2UgPSByZXNwb25zZVRleHQ7DQogICAgICAgIG5vZGUubGFzdFVzYWdlID0gZGF0YS51c2FnZTsNCiAgICAgICAgbm9kZS5sYXN0TW9kZWwgPSBtb2RlbDsNCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlVGV4dCwNCiAgICAgICAgICAgIHRva2Vuc191c2VkOiBkYXRhLnVzYWdlPy50b3RhbF90b2tlbnMgfHwgMCwNCiAgICAgICAgICAgIG1vZGVsX3VzZWQ6IG1vZGVsLA0KICAgICAgICAgICAgZnVsbF9yZXNwb25zZTogZGF0YQ0KICAgICAgICB9Ow0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0xMTSBDaGF0IGVycm9yOicsIGVycm9yKTsNCiAgICAgICAgcmV0dXJuIHsgcmVzcG9uc2U6IG51bGwsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07DQogICAgfQ0KfQ0KDQoNCi8vIFRlcm1pbmFsIE5vZGUgRXhlY3V0b3INCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVUZXJtaW5hbE5vZGUoZW5naW5lLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSB7DQogICAgY29uc3QgY29tbWFuZCA9IG5vZGUuY29uZmlnLmNvbW1hbmQudmFsdWU7DQogICAgY29uc3QgdXNlSW5wdXRDb21tYW5kID0gbm9kZS5jb25maWcudXNlX2lucHV0X2NvbW1hbmQudmFsdWUgPT09ICd0cnVlJzsNCiAgICBjb25zdCB3b3JraW5nRGlyZWN0b3J5ID0gbm9kZS5jb25maWcud29ya2luZ19kaXJlY3RvcnkudmFsdWU7DQogICAgY29uc3QgdGltZW91dCA9IHBhcnNlSW50KG5vZGUuY29uZmlnLnRpbWVvdXQudmFsdWUpOw0KDQogICAgbGV0IGZpbmFsQ29tbWFuZCA9IGNvbW1hbmQ7DQogICAgaWYgKHVzZUlucHV0Q29tbWFuZCAmJiBpbnB1dERhdGEuY29tbWFuZCkgew0KICAgICAgICBmaW5hbENvbW1hbmQgPSBpbnB1dERhdGEuY29tbWFuZDsNCiAgICB9DQoNCiAgICB0cnkgew0KICAgICAgICAvLyBUaGlzIHdvdWxkIG5lZWQgdG8gYmUgaW1wbGVtZW50ZWQgd2l0aCBhY3R1YWwgdGVybWluYWwgZXhlY3V0aW9uDQogICAgICAgIC8vIEZvciBub3csIHdlJ2xsIHJldHVybiBhIHBsYWNlaG9sZGVyDQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIG91dHB1dDogYENvbW1hbmQgZXhlY3V0ZWQ6ICR7ZmluYWxDb21tYW5kfWAsDQogICAgICAgICAgICBzdWNjZXNzOiB0cnVlLA0KICAgICAgICAgICAgZXJyb3I6IG51bGwsDQogICAgICAgICAgICBleGl0X2NvZGU6IDANCiAgICAgICAgfTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdUZXJtaW5hbCBleGVjdXRpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgb3V0cHV0OiBudWxsLA0KICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsDQogICAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSwNCiAgICAgICAgICAgIGV4aXRfY29kZTogMQ0KICAgICAgICB9Ow0KICAgIH0NCn0NCg0KLy8gRXhwb3J0IHRvIGdsb2JhbCBzY29wZQ0Kd2luZG93LmFpRXhlY3V0b3JzID0gew0KICAgIGV4ZWN1dGVMbG1DaGF0Tm9kZSwNCiAgICBleGVjdXRlVGVybWluYWxOb2RlDQp9Ow0KDQovLyBleGVjdXRpb24tZW5naW5lLmpzIC0gRHluYW1pYyBleGVjdXRpb24gZW5naW5lIGZvciBGbG93IEVkaXRvcg0KDQpjbGFzcyBFeGVjdXRpb25FbmdpbmUgew0KICAgIGNvbnN0cnVjdG9yKHJlZ2lzdHJ5KSB7DQogICAgICAgIHRoaXMucmVnaXN0cnkgPSByZWdpc3RyeTsNCiAgICAgICAgdGhpcy5zZXR1cEV4ZWN1dG9ycygpOw0KICAgIH0NCg0KICAgIHNldHVwRXhlY3V0b3JzKCkgew0KICAgICAgICAvLyBSZWdpc3RlciBleGVjdXRvcnMgZnJvbSBleHRlcm5hbCBmaWxlcyB3aXRoIGVuZ2luZSBpbnN0YW5jZSBwYXNzZWQgYXMgZmlyc3QgcGFyYW1ldGVyDQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignaHR0cF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5odHRwRXhlY3V0b3JzLmV4ZWN1dGVIdHRwTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcigndmZzX3NhdmVfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuaHR0cEV4ZWN1dG9ycy5leGVjdXRlVmZzU2F2ZU5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3Zmc19sb2FkX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93Lmh0dHBFeGVjdXRvcnMuZXhlY3V0ZVZmc0xvYWROb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCd2ZnNfZGlyZWN0b3J5X2xpc3RfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuaHR0cEV4ZWN1dG9ycy5leGVjdXRlVmZzRGlyZWN0b3J5TGlzdE5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICAgICAgDQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcigndGltZXJfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZmxvd0V4ZWN1dG9ycy5leGVjdXRlVGltZXJOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdkaXNwbGF5X2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmZsb3dFeGVjdXRvcnMuZXhlY3V0ZURpc3BsYXlOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdyZXBlYXRlcl9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5mbG93RXhlY3V0b3JzLmV4ZWN1dGVSZXBlYXRlck5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ2NvbmRpdGlvbl9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5mbG93RXhlY3V0b3JzLmV4ZWN1dGVDb25kaXRpb25Ob2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdsb2dpY2FsX2dhdGVfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZmxvd0V4ZWN1dG9ycy5leGVjdXRlTG9naWNhbEdhdGVOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdmb3JfZWFjaF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5mbG93RXhlY3V0b3JzLmV4ZWN1dGVGb3JFYWNoTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgICAgICANCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdhdWRpb19leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5tZWRpYUV4ZWN1dG9ycy5leGVjdXRlQXVkaW9Ob2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdpbWFnZV9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5tZWRpYUV4ZWN1dG9ycy5leGVjdXRlSW1hZ2VOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgICAgIA0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ2pzb25fZXh0cmFjdF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5kYXRhRXhlY3V0b3JzLmV4ZWN1dGVKc29uRXh0cmFjdE5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3JhbmRvbV9saW5lX2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmRhdGFFeGVjdXRvcnMuZXhlY3V0ZVJhbmRvbVF1b3RlTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcigndGV4dF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5kYXRhRXhlY3V0b3JzLmV4ZWN1dGVUZXh0Tm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignbWF0aF9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5kYXRhRXhlY3V0b3JzLmV4ZWN1dGVNYXRoTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignYXJyYXlfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZGF0YUV4ZWN1dG9ycy5leGVjdXRlQXJyYXlOb2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgdGhpcy5yZWdpc3RyeS5yZWdpc3RlckV4ZWN1dG9yKCdzdHJpbmdfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZGF0YUV4ZWN1dG9ycy5leGVjdXRlU3RyaW5nTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcignbm9kZV9yZWZlcmVuY2VfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuZGF0YUV4ZWN1dG9ycy5leGVjdXRlTm9kZVJlZmVyZW5jZU5vZGUodGhpcywgbm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkpOw0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ3JhbmRvbV9leGVjdXRvcicsIChub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSA9PiANCiAgICAgICAgICAgIHdpbmRvdy5kYXRhRXhlY3V0b3JzLmV4ZWN1dGVSYW5kb21Ob2RlKHRoaXMsIG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpKTsNCiAgICAgICAgICAgIA0KICAgICAgICB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVyRXhlY3V0b3IoJ2xsbV9jaGF0X2V4ZWN1dG9yJywgKG5vZGUsIGlucHV0RGF0YSwgZXhlY3V0ZWQpID0+IA0KICAgICAgICAgICAgd2luZG93LmFpRXhlY3V0b3JzLmV4ZWN1dGVMbG1DaGF0Tm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgICAgIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJFeGVjdXRvcigndGVybWluYWxfZXhlY3V0b3InLCAobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgPT4gDQogICAgICAgICAgICB3aW5kb3cuYWlFeGVjdXRvcnMuZXhlY3V0ZVRlcm1pbmFsTm9kZSh0aGlzLCBub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKSk7DQogICAgfQ0KDQogICAgYXN5bmMgZXhlY3V0ZU5vZGUobm9kZSwgaW5wdXREYXRhLCBleGVjdXRlZCkgew0KICAgICAgICBjb25zdCBub2RlRGVmID0gdGhpcy5yZWdpc3RyeS5nZXROb2RlVHlwZShub2RlLnR5cGUpOw0KICAgICAgICBpZiAoIW5vZGVEZWYpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gbm9kZSBkZWZpbml0aW9uIGZvdW5kIGZvciB0eXBlOiAke25vZGUudHlwZX1gKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IGV4ZWN1dG9yTmFtZSA9IG5vZGVEZWYuZXhlY3V0b3I7DQogICAgICAgIGNvbnN0IGV4ZWN1dG9yID0gdGhpcy5yZWdpc3RyeS5nZXRFeGVjdXRvcihleGVjdXRvck5hbWUpOw0KDQogICAgICAgIGlmICghZXhlY3V0b3IpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gZXhlY3V0b3IgZm91bmQgZm9yOiAke2V4ZWN1dG9yTmFtZX1gKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBhd2FpdCBleGVjdXRvcihub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKTsNCiAgICB9DQoNCg0KDQogICAgLy8gU3RvcCByZXBlYXRlciBtZXRob2QNCiAgICBzdG9wUmVwZWF0ZXIobm9kZSkgew0KICAgICAgICBpZiAobm9kZS5yZXBlYXRlclN0YXRlICYmIG5vZGUucmVwZWF0ZXJTdGF0ZS5pbnRlcnZhbCkgew0KICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChub2RlLnJlcGVhdGVyU3RhdGUuaW50ZXJ2YWwpOw0KICAgICAgICAgICAgbm9kZS5yZXBlYXRlclN0YXRlLmludGVydmFsID0gbnVsbDsNCiAgICAgICAgICAgIG5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmcgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIFN0b3AgZm9yIGVhY2ggbWV0aG9kDQogICAgc3RvcEZvckVhY2gobm9kZSkgew0KICAgICAgICBpZiAobm9kZS5mb3JFYWNoU3RhdGUgJiYgbm9kZS5mb3JFYWNoU3RhdGUuaW50ZXJ2YWwpIHsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobm9kZS5mb3JFYWNoU3RhdGUuaW50ZXJ2YWwpOw0KICAgICAgICAgICAgbm9kZS5mb3JFYWNoU3RhdGUuaW50ZXJ2YWwgPSBudWxsOw0KICAgICAgICAgICAgbm9kZS5mb3JFYWNoU3RhdGUuaXNJdGVyYXRpbmcgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KDQoNCg0KfQ0KDQovLyBHbG9iYWwgZXhlY3V0aW9uIGVuZ2luZSBpbnN0YW5jZQ0KY29uc3QgZXhlY3V0aW9uRW5naW5lID0gbmV3IEV4ZWN1dGlvbkVuZ2luZShub2RlUmVnaXN0cnkpOw0KDQoNCi8vIHdvcmtmbG93LmpzIC0gV29ya2Zsb3cgZXhlY3V0aW9uIGxvZ2ljIGZvciBGbG93IEVkaXRvcg0KDQovLyBSdW4gdGhlIHdvcmtmbG93DQphc3luYyBmdW5jdGlvbiBydW5Xb3JrZmxvdygpIHsNCiAgICBpZiAoZmxvd0VkaXRvci5pc1J1bm5pbmcpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBmbG93RWRpdG9yLmlzUnVubmluZyA9IHRydWU7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3J1bi13b3JrZmxvdycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3Atd29ya2Zsb3cnKS5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1mbGV4JzsNCiAgICANCiAgICAvLyBDbGVhciBhbGwgdmlzdWFsIHN0YXRlcyBmcm9tIHByZXZpb3VzIHJ1bnMNCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmxvdy1ub2RlJykuZm9yRWFjaChub2RlID0+IHsNCiAgICAgICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJywgJ3dhaXRpbmctaW5wdXRzJywgJ2NvbXBsZXRlZCcsICdlcnJvcicpOw0KICAgIH0pOw0KICAgIA0KICAgIC8vIENsZWFyIG91dHB1dA0KICAgIGNvbnN0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGVjdXRpb24tb3V0cHV0Jyk7DQogICAgb3V0cHV0LmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJsb2ctZW50cnkgaW5mbyI+U3RhcnRpbmcgd29ya2Zsb3cgZXhlY3V0aW9uLi4uPC9kaXY+JzsNCiAgICANCiAgICB0cnkgew0KICAgICAgICAvLyBGaW5kIHN0YXJ0IG5vZGVzIChub2RlcyB3aXRoIG5vIGlucHV0cyB0aGF0IGFyZSBwYXJ0IG9mIGEgY29ubmVjdGVkIHdvcmtmbG93KQ0KICAgICAgICBjb25zdCBzdGFydE5vZGVzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKS5maWx0ZXIobm9kZSA9PiB7DQogICAgICAgICAgICBjb25zdCBub2RlRGVmID0gbm9kZVJlZ2lzdHJ5LmdldE5vZGVUeXBlKG5vZGUudHlwZSk7DQogICAgICAgICAgICBpZiAoIW5vZGVEZWYpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYE5vIG5vZGUgZGVmaW5pdGlvbiBmb3VuZCBmb3IgdHlwZTogJHtub2RlLnR5cGV9YCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFRpbWVyIGFuZCBSZXBlYXRlciBub2RlcyBhcmUgc3RhcnQgbm9kZXMgKGNhbiB0cmlnZ2VyIHRoZW1zZWx2ZXMpDQogICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAndGltZXInIHx8IG5vZGUudHlwZSA9PT0gJ3JlcGVhdGVyJykgew0KICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdyZXBlYXRlcicpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNSdW5uaW5nID0gbm9kZS5yZXBlYXRlclN0YXRlICYmIG5vZGUucmVwZWF0ZXJTdGF0ZS5pc1J1bm5pbmc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIFRpbWVyL1JlcGVhdGVyIGlzIGEgc3RhcnQgbm9kZSBpZiBpdCBoYXMgY29ubmVjdGVkIG91dHB1dHMNCiAgICAgICAgICAgICAgICBjb25zdCBoYXNDb25uZWN0ZWRPdXRwdXRzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5zb21lKGNvbm4gPT4gDQogICAgICAgICAgICAgICAgICAgIGNvbm4uZnJvbS5ub2RlSWQgPT09IG5vZGUuaWQNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIHJldHVybiBoYXNDb25uZWN0ZWRPdXRwdXRzOyAvLyBUaW1lci9SZXBlYXRlciBpcyBhIHN0YXJ0IG5vZGUgaWYgY29ubmVjdGVkDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIElmIG5vZGUgaGFzIG5vIGlucHV0cywgY2hlY2sgaWYgaXQncyBwYXJ0IG9mIGEgY29ubmVjdGVkIHdvcmtmbG93DQogICAgICAgICAgICBpZiAobm9kZURlZi5pbnB1dHMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBub2RlIGhhcyBhbnkgb3V0cHV0cyB0aGF0IGFyZSBjb25uZWN0ZWQgdG8gb3RoZXIgbm9kZXMNCiAgICAgICAgICAgICAgICBjb25zdCBoYXNDb25uZWN0ZWRPdXRwdXRzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLmNvbm5lY3Rpb25zLnZhbHVlcygpKS5zb21lKGNvbm4gPT4gDQogICAgICAgICAgICAgICAgICAgIGNvbm4uZnJvbS5ub2RlSWQgPT09IG5vZGUuaWQNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIE9ubHkgaW5jbHVkZSBpZiBpdCdzIGNvbm5lY3RlZCB0byB0aGUgd29ya2Zsb3cNCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzQ29ubmVjdGVkT3V0cHV0czsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3Igbm9kZXMgd2l0aCBvcHRpb25hbCBpbnB1dHMNCiAgICAgICAgICAgIGNvbnN0IG9wdGlvbmFsSW5wdXRzID0gbm9kZURlZi5pbnB1dHMuZmlsdGVyKGlucHV0ID0+IGlucHV0Lm9wdGlvbmFsKTsNCiAgICAgICAgICAgIGlmIChvcHRpb25hbElucHV0cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBub2RlIGhhcyBjb25uZWN0ZWQgb3V0cHV0cw0KICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Nvbm5lY3RlZE91dHB1dHMgPSBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLnNvbWUoY29ubiA9PiANCiAgICAgICAgICAgICAgICAgICAgY29ubi5mcm9tLm5vZGVJZCA9PT0gbm9kZS5pZA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc0Nvbm5lY3RlZE91dHB1dHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIE5vZGVzIHdpdGggcmVxdWlyZWQgaW5wdXRzIGFyZSBub3Qgc3RhcnQgbm9kZXMgLSB0aGV5IHNob3VsZCBiZSB0cmlnZ2VyZWQgYnkgb3RoZXIgbm9kZXMNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICBpZiAoc3RhcnROb2Rlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gc3RhcnQgbm9kZXMgZm91bmQuIEFkZCBub2RlcyB3aXRoIG5vIGlucHV0cyAoVGltZXIpIG9yIG5vZGVzIHdpdGggb3B0aW9uYWwgaW5wdXRzIHRoYXQgYXJlblwndCBjb25uZWN0ZWQgKEhUVFAgUmVxdWVzdCknKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gRXhlY3V0ZSB3b3JrZmxvdw0KICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgZXhlY3V0ZVdvcmtmbG93KHN0YXJ0Tm9kZXMpOw0KICAgICAgICANCiAgICAgICAgLy8gRGlzcGxheSByZXN1bHRzDQogICAgICAgIG91dHB1dC5pbm5lckhUTUwgKz0gJzxkaXYgY2xhc3M9ImxvZy1lbnRyeSBzdWNjZXNzIj5Xb3JrZmxvdyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5ITwvZGl2Pic7DQogICAgICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHJlc3VsdHMpIHsNCiAgICAgICAgICAgIG91dHB1dC5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9ImxvZy1lbnRyeSBpbmZvIj4ke3Jlc3VsdC5ub2RlSWR9OiAke3Jlc3VsdC5vdXRwdXR9PC9kaXY+YDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gU2VuZCBjb21wbGV0aW9uIHZpYSBXZWJTb2NrZXQNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2VuZE1lc3NhZ2UpIHsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zZW5kTWVzc2FnZSgnd29ya2Zsb3dfY29tcGxldGVkJywgew0KICAgICAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsDQogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpDQogICAgICAgICAgICB9LCAnZmxvdy1lZGl0b3InKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdXb3JrZmxvdyBleGVjdXRpb24gZXJyb3I6JywgZXJyb3IpOw0KICAgICAgICBvdXRwdXQuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJsb2ctZW50cnkgZXJyb3IiPkVycm9yOiAke2Vycm9yLm1lc3NhZ2V9PC9kaXY+YDsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgICBmbG93RWRpdG9yLmlzUnVubmluZyA9IGZhbHNlOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtZmxleCc7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICB9DQp9DQoNCi8vIEV4ZWN1dGUgd29ya2Zsb3cNCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVXb3JrZmxvdyhzdGFydE5vZGVzKSB7DQogICAgY29uc3QgcmVzdWx0cyA9IFtdOw0KICAgIGNvbnN0IGV4ZWN1dGVkID0gbmV3IFNldCgpOw0KICAgIGNvbnN0IG5vZGVJbnB1dEJ1ZmZlciA9IG5ldyBNYXAoKTsgLy8gVHJhY2sgaW5wdXRzIGZvciBtdWx0aS1pbnB1dCBub2Rlcw0KICAgIA0KICAgIC8vIFN0b3JlIGdsb2JhbGx5IHNvIEZvciBFYWNoIGNhbiBhY2Nlc3MgaXQNCiAgICB3aW5kb3cuZ2xvYmFsTm9kZUlucHV0QnVmZmVyID0gbm9kZUlucHV0QnVmZmVyOw0KICAgIA0KICAgIGZvciAoY29uc3Qgc3RhcnROb2RlIG9mIHN0YXJ0Tm9kZXMpIHsNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZU5vZGUoc3RhcnROb2RlLCB7fSwgZXhlY3V0ZWQsIG5vZGVJbnB1dEJ1ZmZlcik7DQogICAgICAgIGlmIChyZXN1bHQpIHJlc3VsdHMucHVzaChyZXN1bHQpOw0KICAgIH0NCiAgICANCiAgICByZXR1cm4gcmVzdWx0czsNCn0NCg0KLy8gRXhlY3V0ZSBhIHNpbmdsZSBub2RlIChkeW5hbWljIHZlcnNpb24pDQphc3luYyBmdW5jdGlvbiBleGVjdXRlTm9kZShub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkLCBub2RlSW5wdXRCdWZmZXIpIHsNCiAgICBpZiAoZXhlY3V0ZWQuaGFzKG5vZGUuaWQpKSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICBleGVjdXRlZC5hZGQobm9kZS5pZCk7DQogICAgDQogICAgLy8gTWFyayBub2RlIGFzIHJ1bm5pbmcNCiAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGUuaWQpOw0KICAgIGlmIChub2RlRWxlbWVudCkgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncnVubmluZycpOw0KICAgIA0KICAgIHRyeSB7DQogICAgICAgIC8vIFVzZSB0aGUgZHluYW1pYyBleGVjdXRpb24gZW5naW5lDQogICAgICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IGV4ZWN1dGlvbkVuZ2luZS5leGVjdXRlTm9kZShub2RlLCBpbnB1dERhdGEsIGV4ZWN1dGVkKTsNCiAgICAgICAgDQogICAgICAgIC8vIFN0b3JlIG91dHB1dCBkYXRhIGZvciBjb25maWcgcGFuZWwgZGlzcGxheQ0KICAgICAgICBub2RlLmxhc3RPdXRwdXREYXRhID0gb3V0cHV0Ow0KICAgICAgICBub2RlLmxhc3RFeGVjdXRpb25UaW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOw0KICAgICAgICANCiAgICAgICAgLy8gQ2hlY2sgaWYgb3V0cHV0IGluZGljYXRlcyBleGVjdXRpb24gc2hvdWxkIHN0b3AgKGxvZ2ljYWwgZ2F0ZSBzcGVjaWZpYykNCiAgICAgICAgaWYgKG91dHB1dCAmJiB0eXBlb2Ygb3V0cHV0ID09PSAnb2JqZWN0JyAmJiBvdXRwdXQuX19zdG9wX2V4ZWN1dGlvbiA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBNYXJrIG5vZGUgYXMgY29tcGxldGVkDQogICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJyk7DQogICAgICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY29tcGxldGVkJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiB7IG5vZGVJZDogbm9kZS5pZCwgb3V0cHV0OiBudWxsIH07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIENoZWNrIGZvciBmb3JfZWFjaCBjb250cm9sIGZsYWcgLSBza2lwIGRvd25zdHJlYW0gZXhlY3V0aW9uLCBsZXQgaW50ZXJ2YWwgaGFuZGxlIGl0DQogICAgICAgIGlmIChvdXRwdXQgJiYgdHlwZW9mIG91dHB1dCA9PT0gJ29iamVjdCcgJiYgb3V0cHV0Ll9fZm9yX2VhY2hfY29udHJvbCA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBNYXJrIG5vZGUgYXMgY29tcGxldGVkIGJ1dCBkb24ndCBleGVjdXRlIGRvd25zdHJlYW0gbm9kZXMNCiAgICAgICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHsgbm9kZUlkOiBub2RlLmlkLCBvdXRwdXQ6IG91dHB1dCB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBGaW5kIGNvbm5lY3RlZCBub2RlcyBhbmQgZXhlY3V0ZSB0aGVtDQogICAgICAgIGNvbnN0IGNvbm5lY3RlZE5vZGVzID0gZmluZENvbm5lY3RlZE5vZGVzKG5vZGUuaWQpOw0KICAgICAgICANCiAgICAgICAgZm9yIChjb25zdCBjb25uZWN0ZWROb2RlIG9mIGNvbm5lY3RlZE5vZGVzKSB7DQogICAgICAgICAgICAvLyBDaGVjayBmb3IgY3ljbGVzIGJlZm9yZSBleGVjdXRpbmcNCiAgICAgICAgICAgIGlmIChleGVjdXRlZC5oYXMoY29ubmVjdGVkTm9kZS5ub2RlLmlkKSkgew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEhhbmRsZSBvdXRwdXQgbWFwcGluZyB0byBpbnB1dCBwb3J0cyAtIERJUkVDVCBNQVBQSU5HDQogICAgICAgICAgICBsZXQgaW5wdXRWYWx1ZSA9IG91dHB1dDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKG91dHB1dCBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgICAgICAgICAvLyBCbG9iIG91dHB1dCAtIHBhc3MgZGlyZWN0bHkgdG8gdGhlIGlucHV0IHBvcnQNCiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gb3V0cHV0Ow0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb3V0cHV0ID09PSAnb2JqZWN0JyAmJiBvdXRwdXQgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAvLyBPYmplY3Qgb3V0cHV0IC0gZXh0cmFjdCB0aGUgRVhBQ1Qgb3V0cHV0IHBvcnQgZmllbGQNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGVkTm9kZS5vdXRwdXRQb3J0IGluIG91dHB1dCkgew0KICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gb3V0cHV0W2Nvbm5lY3RlZE5vZGUub3V0cHV0UG9ydF07DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgTm9kZSAke25vZGUuaWR9IC0+ICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTogRVJST1IgLSBPdXRwdXQgcG9ydCAnJHtjb25uZWN0ZWROb2RlLm91dHB1dFBvcnR9JyBub3QgZm91bmQgaW4gb3V0cHV0IWApOw0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBBdmFpbGFibGUgZmllbGRzOmAsIE9iamVjdC5rZXlzKG91dHB1dCkpOw0KICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIHRoaXMgY29ubmVjdGlvbiBpbnN0ZWFkIG9mIHBhc3NpbmcgbnVsbA0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIFNpbXBsZSB2YWx1ZSBvdXRwdXQgLSBwYXNzIGRpcmVjdGx5DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAvLyBVc2Ugc21hcnQgZXhlY3V0aW9uIHRoYXQgaGFuZGxlcyBtdWx0aS1pbnB1dCBzeW5jaHJvbml6YXRpb24NCiAgICAgICAgICAgICAgICBhd2FpdCBleGVjdXRlTm9kZVNtYXJ0KGNvbm5lY3RlZE5vZGUubm9kZSwgY29ubmVjdGVkTm9kZS5pbnB1dFBvcnQsIGlucHV0VmFsdWUsIGV4ZWN1dGVkLCBub2RlSW5wdXRCdWZmZXIpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBleGVjdXRpbmcgY29ubmVjdGVkIG5vZGUgJHtjb25uZWN0ZWROb2RlLm5vZGUuaWR9OmAsIGVycm9yKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGVjdXRpb24tb3V0cHV0Jyk7DQogICAgICAgICAgICAgICAgb3V0cHV0UGFuZWwuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJsb2ctZW50cnkgZXJyb3IiPkVycm9yIGluIGNvbm5lY3RlZCBub2RlICR7Y29ubmVjdGVkTm9kZS5ub2RlLmlkfTogJHtlcnJvci5tZXNzYWdlfTwvZGl2PmA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIE1hcmsgbm9kZSBhcyBjb21wbGV0ZWQNCiAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJyk7DQogICAgICAgICAgICBub2RlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHsgbm9kZUlkOiBub2RlLmlkLCBvdXRwdXQ6IG91dHB1dCB9Ow0KICAgICAgICANCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBleGVjdXRpbmcgbm9kZSAke25vZGUuaWR9OmAsIGVycm9yKTsNCiAgICAgICAgDQogICAgICAgIC8vIE1hcmsgbm9kZSBhcyBlcnJvcg0KICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Vycm9yJyk7DQogICAgfQ0KICAgIA0KICAgICAgICB0aHJvdyBlcnJvcjsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgICAvLyBSZW1vdmUgcnVubmluZyBzdGF0ZQ0KICAgICAgICBpZiAobm9kZUVsZW1lbnQpIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3J1bm5pbmcnKTsNCiAgICB9DQp9DQoNCi8vIFNtYXJ0IGV4ZWN1dGlvbiBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgbXVsdGktaW5wdXQgc3luY2hyb25pemF0aW9uDQphc3luYyBmdW5jdGlvbiBleGVjdXRlTm9kZVNtYXJ0KG5vZGUsIGlucHV0UG9ydCwgaW5wdXRWYWx1ZSwgZXhlY3V0ZWQsIG5vZGVJbnB1dEJ1ZmZlcikgew0KICAgIGNvbnN0IG5vZGVJZCA9IG5vZGUuaWQ7DQogICAgDQogICAgLy8gR2V0IGFsbCBjb25uZWN0ZWQgaW5wdXQgcG9ydHMgZm9yIHRoaXMgbm9kZQ0KICAgIGNvbnN0IGNvbm5lY3RlZElucHV0UG9ydHMgPSBnZXRDb25uZWN0ZWRJbnB1dFBvcnRzKG5vZGVJZCk7DQogICAgDQogICAgDQogICAgLy8gSWYgbm9kZSBoYXMgMCBvciAxIGlucHV0IGNvbm5lY3Rpb25zLCBleGVjdXRlIGltbWVkaWF0ZWx5DQogICAgaWYgKGNvbm5lY3RlZElucHV0UG9ydHMubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGVOb2RlKG5vZGUsIHsgW2lucHV0UG9ydF06IGlucHV0VmFsdWUgfSwgZXhlY3V0ZWQsIG5vZGVJbnB1dEJ1ZmZlcik7DQogICAgfQ0KICAgIA0KICAgIC8vIE11bHRpLWlucHV0IG5vZGUgLSBuZWVkIHRvIGNvbGxlY3QgYWxsIGlucHV0cyBiZWZvcmUgZXhlY3V0aW5nDQogICAgaWYgKCFub2RlSW5wdXRCdWZmZXIuaGFzKG5vZGVJZCkpIHsNCiAgICAgICAgbm9kZUlucHV0QnVmZmVyLnNldChub2RlSWQsIHsNCiAgICAgICAgICAgIHJlY2VpdmVkSW5wdXRzOiB7fSwNCiAgICAgICAgICAgIGNvbm5lY3RlZFBvcnRzOiBjb25uZWN0ZWRJbnB1dFBvcnRzDQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgLy8gTWFyayBub2RlIGFzIHdhaXRpbmcgZm9yIGlucHV0cyAodmlzdWFsIGZlZWRiYWNrKQ0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGVJZCk7DQogICAgICAgIGlmIChub2RlRWxlbWVudCkgew0KICAgICAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnd2FpdGluZy1pbnB1dHMnKTsNCiAgICAgICAgICAgIG5vZGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlZCcsICdlcnJvcicpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGNvbnN0IGJ1ZmZlciA9IG5vZGVJbnB1dEJ1ZmZlci5nZXQobm9kZUlkKTsNCiAgICANCiAgICAvLyBTdG9yZSB0aGlzIGlucHV0DQogICAgYnVmZmVyLnJlY2VpdmVkSW5wdXRzW2lucHV0UG9ydF0gPSBpbnB1dFZhbHVlOw0KICAgIA0KICAgIA0KICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYWxsIHJlcXVpcmVkIGlucHV0cw0KICAgIGNvbnN0IGhhc0FsbElucHV0cyA9IGJ1ZmZlci5jb25uZWN0ZWRQb3J0cy5ldmVyeShwb3J0ID0+IHBvcnQgaW4gYnVmZmVyLnJlY2VpdmVkSW5wdXRzKTsNCiAgICANCiAgICBpZiAoIWhhc0FsbElucHV0cykgew0KICAgICAgICAvLyBTdGlsbCB3YWl0aW5nIGZvciBtb3JlIGlucHV0cw0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgDQogICAgLy8gQWxsIGlucHV0cyByZWFkeSAtIHJlbW92ZSB3YWl0aW5nIHN0YXRlIGFuZCBleGVjdXRlIQ0KICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnd2FpdGluZy1pbnB1dHMnKTsNCiAgICB9DQogICAgDQogICAgDQogICAgLy8gQ2xlYXIgYnVmZmVyIGZvciBuZXh0IGV4ZWN1dGlvbg0KICAgIG5vZGVJbnB1dEJ1ZmZlci5kZWxldGUobm9kZUlkKTsNCiAgICANCiAgICAvLyBFeGVjdXRlIHdpdGggYWxsIGFnZ3JlZ2F0ZWQgaW5wdXRzDQogICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGVOb2RlKG5vZGUsIGJ1ZmZlci5yZWNlaXZlZElucHV0cywgZXhlY3V0ZWQsIG5vZGVJbnB1dEJ1ZmZlcik7DQp9DQoNCi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgY29ubmVjdGVkIGlucHV0IHBvcnRzIGZvciBhIG5vZGUNCmZ1bmN0aW9uIGdldENvbm5lY3RlZElucHV0UG9ydHMobm9kZUlkKSB7DQogICAgbGV0IGNvbm5lY3Rpb25zID0gbnVsbDsNCiAgICANCiAgICAvLyBEZWJ1ZzogTG9nIHdoYXQncyBhdmFpbGFibGUgb24gZmxvd0VkaXRvciAodHJ5IGJvdGggd2luZG93LmZsb3dFZGl0b3IgYW5kIGZsb3dFZGl0b3IpDQogICAgDQogICAgLy8gVHJ5IHRvIGFjY2VzcyBmbG93RWRpdG9yIGRpcmVjdGx5IChub3QgdmlhIHdpbmRvdykNCiAgICBsZXQgZWRpdG9yID0gbnVsbDsNCiAgICBpZiAodHlwZW9mIGZsb3dFZGl0b3IgIT09ICd1bmRlZmluZWQnICYmIGZsb3dFZGl0b3IpIHsNCiAgICAgICAgZWRpdG9yID0gZmxvd0VkaXRvcjsNCiAgICB9IGVsc2UgaWYgKHdpbmRvdy5mbG93RWRpdG9yKSB7DQogICAgICAgIGVkaXRvciA9IHdpbmRvdy5mbG93RWRpdG9yOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgDQogICAgDQogICAgLy8gVHJ5IG11bHRpcGxlIHdheXMgdG8gYWNjZXNzIGNvbm5lY3Rpb25zIGRhdGENCiAgICBpZiAoZWRpdG9yLmNvbm5lY3Rpb25zKSB7DQogICAgICAgIGNvbm5lY3Rpb25zID0gZWRpdG9yLmNvbm5lY3Rpb25zOw0KICAgIH0gZWxzZSBpZiAoZWRpdG9yLndvcmtmbG93ICYmIGVkaXRvci53b3JrZmxvdy5jb25uZWN0aW9ucykgew0KICAgICAgICBjb25uZWN0aW9ucyA9IG5ldyBNYXAoZWRpdG9yLndvcmtmbG93LmNvbm5lY3Rpb25zLm1hcChjb25uID0+IFtjb25uLmlkLCBjb25uXSkpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgDQogICAgY29uc3QgYWxsQ29ubmVjdGlvbnMgPSBBcnJheS5mcm9tKGNvbm5lY3Rpb25zLnZhbHVlcygpKTsNCiAgICANCiAgICAvLyBMb2cgYWxsIGNvbm5lY3Rpb25zIGZvciBkZWJ1Z2dpbmcNCiAgICBhbGxDb25uZWN0aW9ucy5mb3JFYWNoKChjb25uLCBpbmRleCkgPT4gew0KICAgIH0pOw0KICAgIA0KICAgIGNvbnN0IGNvbm5lY3RlZFBvcnRzID0gYWxsQ29ubmVjdGlvbnMNCiAgICAgICAgLmZpbHRlcihjb25uID0+IHsNCiAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBjb25uLnRvLm5vZGVJZCA9PT0gbm9kZUlkOw0KICAgICAgICAgICAgaWYgKG1hdGNoZXMpIHsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOw0KICAgICAgICB9KQ0KICAgICAgICAubWFwKGNvbm4gPT4gY29ubi50by5wb3J0TmFtZSk7DQogICAgICAgIA0KICAgIHJldHVybiBjb25uZWN0ZWRQb3J0czsNCn0NCiAgICANCi8vIEhlbHBlciBmdW5jdGlvbiB0byB1cGRhdGUgZGlzcGxheSBub2RlIGNvbnRlbnQgKHVzZWQgYnkgZXhlY3V0aW9uIGVuZ2luZSkNCmZ1bmN0aW9uIHVwZGF0ZURpc3BsYXlOb2RlQ29udGVudChub2RlSWQsIGNvbnRlbnQsIGZvcm1hdCkgew0KICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZUlkKTsNCiAgICBpZiAoIW5vZGVFbGVtZW50KSByZXR1cm47DQogICAgDQogICAgY29uc3QgZGlzcGxheVRleHQgPSBub2RlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZGlzcGxheS10ZXh0Jyk7DQogICAgY29uc3QgZm9ybWF0RWxlbWVudCA9IG5vZGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kaXNwbGF5LWZvcm1hdCBzcGFuJyk7DQogICAgDQogICAgaWYgKGRpc3BsYXlUZXh0KSB7DQogICAgICAgIGxldCBmb3JtYXR0ZWRDb250ZW50ID0gY29udGVudDsNCiAgICAgICAgDQogICAgc3dpdGNoIChmb3JtYXQpIHsNCiAgICAgICAgY2FzZSAnanNvbic6DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSB0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGNvbnRlbnQpIDogY29udGVudDsNCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KHBhcnNlZCwgbnVsbCwgMik7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ2h0bWwnOg0KICAgICAgICAgICAgICAgIGZvcm1hdHRlZENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ3RleHQnOg0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIGZvcm1hdHRlZENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIA0KICAgICAgICBkaXNwbGF5VGV4dC5pbm5lckhUTUwgPSBgPHByZSBjbGFzcz0iY29udGVudC10ZXh0Ij4ke2VzY2FwZUh0bWwoZm9ybWF0dGVkQ29udGVudCl9PC9wcmU+YDsNCiAgICB9DQogICAgDQogICAgaWYgKGZvcm1hdEVsZW1lbnQpIHsNCiAgICAgICAgZm9ybWF0RWxlbWVudC50ZXh0Q29udGVudCA9IGZvcm1hdDsNCiAgICB9DQogICAgDQogICAgLy8gU3RvcmUgZm9yIGNvbmZpZyBwYW5lbCBkaXNwbGF5DQogICAgY29uc3Qgbm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KG5vZGVJZCk7DQogICAgaWYgKG5vZGUpIHsNCiAgICAgICAgbm9kZS5sYXN0Q29udGVudCA9IGNvbnRlbnQ7DQogICAgICAgIG5vZGUubGFzdEZvcm1hdCA9IGZvcm1hdDsNCiAgICB9DQp9DQoNCi8vIEhlbHBlciBmdW5jdGlvbiB0byBlc2NhcGUgSFRNTA0KZnVuY3Rpb24gZXNjYXBlSHRtbCh0ZXh0KSB7DQogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgZGl2LnRleHRDb250ZW50ID0gdGV4dDsNCiAgICByZXR1cm4gZGl2LmlubmVySFRNTDsNCn0NCg0KLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHJlcGxhY2UgdGVtcGxhdGUgcGxhY2Vob2xkZXJzDQpmdW5jdGlvbiByZXBsYWNlVGVtcGxhdGVQbGFjZWhvbGRlcnModGVtcGxhdGUsIGRhdGEpIHsNCiAgICBpZiAodHlwZW9mIHRlbXBsYXRlICE9PSAnb2JqZWN0JyB8fCB0ZW1wbGF0ZSA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdGVtcGxhdGU7DQogICAgfQ0KICAgIA0KICAgIGlmIChBcnJheS5pc0FycmF5KHRlbXBsYXRlKSkgew0KICAgICAgICByZXR1cm4gdGVtcGxhdGUubWFwKGl0ZW0gPT4gcmVwbGFjZVRlbXBsYXRlUGxhY2Vob2xkZXJzKGl0ZW0sIGRhdGEpKTsNCiAgICB9DQogICAgDQogICAgY29uc3QgcmVzdWx0ID0ge307DQogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXModGVtcGxhdGUpKSB7DQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICBsZXQgcmVwbGFjZWRWYWx1ZSA9IHZhbHVlOw0KICAgIA0KICAgICAgICAgICAgLy8gUmVwbGFjZSB7e1ZBTFVFfX0gd2l0aCB0aGUgZnVsbCBkYXRhIG9iamVjdA0KICAgICAgICAgICAgaWYgKHZhbHVlLmluY2x1ZGVzKCd7e1ZBTFVFfX0nKSkgew0KICAgICAgICAgICAgICAgIHJlcGxhY2VkVmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCd7e1ZBTFVFfX0nLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7DQp9DQoNCiAgICAgICAgICAgIC8vIFJlcGxhY2Uge3tKU09OOmZpZWxkfX0gd2l0aCBzcGVjaWZpYyBmaWVsZA0KICAgICAgICAgICAgY29uc3QganNvbk1hdGNoZXMgPSB2YWx1ZS5tYXRjaCgvXHtce0pTT046KFtefV0rKVx9XH0vZyk7DQogICAgICAgICAgICBpZiAoanNvbk1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIGpzb25NYXRjaGVzKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gbWF0Y2gubWF0Y2goL1x7XHtKU09OOihbXn1dKylcfVx9LylbMV07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSBnZXROZXN0ZWRWYWx1ZShkYXRhLCBmaWVsZCk7DQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VkVmFsdWUgPSByZXBsYWNlZFZhbHVlLnJlcGxhY2UobWF0Y2gsIEpTT04uc3RyaW5naWZ5KGZpZWxkVmFsdWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgICAgICAgICAgLy8gUmVwbGFjZSB7e2ZpZWxkfX0gd2l0aCBzcGVjaWZpYyBmaWVsZCB2YWx1ZQ0KICAgICAgICAgICAgY29uc3QgZmllbGRNYXRjaGVzID0gdmFsdWUubWF0Y2goL1x7XHsoW159XSspXH1cfS9nKTsNCiAgICAgICAgICAgIGlmIChmaWVsZE1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIGZpZWxkTWF0Y2hlcykgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IG1hdGNoLm1hdGNoKC9ce1x7KFtefV0rKVx9XH0vKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkICE9PSAnVkFMVUUnICYmICFmaWVsZC5zdGFydHNXaXRoKCdKU09OOicpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZFZhbHVlID0gZ2V0TmVzdGVkVmFsdWUoZGF0YSwgZmllbGQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZWRWYWx1ZSA9IHJlcGxhY2VkVmFsdWUucmVwbGFjZShtYXRjaCwgZmllbGRWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gcmVwbGFjZWRWYWx1ZTsNCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7DQogICAgICAgICAgICByZXN1bHRba2V5XSA9IHJlcGxhY2VUZW1wbGF0ZVBsYWNlaG9sZGVycyh2YWx1ZSwgZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIHJldHVybiByZXN1bHQ7DQp9DQoNCi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgbmVzdGVkIG9iamVjdCB2YWx1ZXMNCmZ1bmN0aW9uIGdldE5lc3RlZFZhbHVlKG9iaiwgcGF0aCkgew0KICAgIGNvbnN0IGtleXMgPSBwYXRoLnNwbGl0KCcuJyk7DQogICAgbGV0IGN1cnJlbnQgPSBvYmo7DQogICAgDQogICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykgew0KICAgICAgICBpZiAoY3VycmVudCA9PT0gbnVsbCB8fCBjdXJyZW50ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBIYW5kbGUgYXJyYXkgYWNjZXNzIGxpa2UgIml0ZW1zWzBdLm5hbWUiDQogICAgICAgIGNvbnN0IGFycmF5TWF0Y2ggPSBrZXkubWF0Y2goL14oLispXFsoXGQrKVxdJC8pOw0KICAgICAgICBpZiAoYXJyYXlNYXRjaCkgew0KICAgICAgICAgICAgY29uc3QgYXJyYXlLZXkgPSBhcnJheU1hdGNoWzFdOw0KICAgICAgICAgICAgY29uc3QgYXJyYXlJbmRleCA9IHBhcnNlSW50KGFycmF5TWF0Y2hbMl0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoY3VycmVudFthcnJheUtleV0gJiYgQXJyYXkuaXNBcnJheShjdXJyZW50W2FycmF5S2V5XSkpIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudFthcnJheUtleV1bYXJyYXlJbmRleF07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudFtrZXldOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBjdXJyZW50Ow0KfQ0KDQovLyBTdG9wIHdvcmtmbG93IGV4ZWN1dGlvbg0KZnVuY3Rpb24gc3RvcFdvcmtmbG93KCkgew0KICAgICAgICBmbG93RWRpdG9yLmlzUnVubmluZyA9IGZhbHNlOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncnVuLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtZmxleCc7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wLXdvcmtmbG93Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgDQogICAgLy8gQ2xlYXIgcnVubmluZyBzdGF0ZXMgZnJvbSBhbGwgbm9kZXMNCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZsb3ctbm9kZS5ydW5uaW5nLCAuZmxvdy1ub2RlLndhaXRpbmctaW5wdXRzJykuZm9yRWFjaChub2RlID0+IHsNCiAgICAgICAgICAgIG5vZGUuY2xhc3NMaXN0LnJlbW92ZSgncnVubmluZycsICd3YWl0aW5nLWlucHV0cycpOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgY29uc3Qgb3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4ZWN1dGlvbi1vdXRwdXQnKTsNCiAgICBvdXRwdXQuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPSJsb2ctZW50cnkgd2FybmluZyI+V29ya2Zsb3cgZXhlY3V0aW9uIHN0b3BwZWQgYnkgdXNlcjwvZGl2Pic7DQogICAgDQp9DQoNCi8vIEZpbmQgbm9kZXMgY29ubmVjdGVkIHRvIGEgc3BlY2lmaWMgbm9kZQ0KZnVuY3Rpb24gZmluZENvbm5lY3RlZE5vZGVzKG5vZGVJZCkgew0KICAgIGNvbnN0IGNvbm5lY3RlZE5vZGVzID0gW107DQogICAgDQogICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpIHsNCiAgICAgICAgaWYgKGNvbm5lY3Rpb24uZnJvbS5ub2RlSWQgPT09IG5vZGVJZCkgew0KICAgICAgICAgICAgY29uc3QgdGFyZ2V0Tm9kZSA9IGZsb3dFZGl0b3Iubm9kZXMuZ2V0KGNvbm5lY3Rpb24udG8ubm9kZUlkKTsNCiAgICAgICAgICAgIGlmICh0YXJnZXROb2RlKSB7DQogICAgICAgICAgICAgICAgY29ubmVjdGVkTm9kZXMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIG5vZGU6IHRhcmdldE5vZGUsDQogICAgICAgICAgICAgICAgICAgIGlucHV0UG9ydDogY29ubmVjdGlvbi50by5wb3J0TmFtZSwNCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0UG9ydDogY29ubmVjdGlvbi5mcm9tLnBvcnROYW1lDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcmV0dXJuIGNvbm5lY3RlZE5vZGVzOw0KfQ0KDQovLyBGb3JtYXQgZGF0YSBmb3IgcHJldmlldyBpbiBjb25maWcgcGFuZWwNCmZ1bmN0aW9uIGZvcm1hdERhdGFQcmV2aWV3KGRhdGEsIG1heExlbmd0aCA9IDIwMCkgew0KICAgIGlmIChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICByZXR1cm4geyB0eXBlOiAnbnVsbCcsIHByZXZpZXc6ICdudWxsJyB9Ow0KICAgIH0NCiAgICANCiAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgY29uc3Qgc2l6ZUtCID0gKGRhdGEuc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMik7DQogICAgICAgIGNvbnN0IHNpemVNQiA9IGRhdGEuc2l6ZSA+IDEwMjQgKiAxMDI0ID8gYCAoJHsoZGF0YS5zaXplIC8gKDEwMjQgKiAxMDI0KSkudG9GaXhlZCgyKX0gTUIpYCA6ICcnOw0KICAgICAgICByZXR1cm4geyANCiAgICAgICAgICAgIHR5cGU6ICdCbG9iJywgDQogICAgICAgICAgICBwcmV2aWV3OiBgJHtkYXRhLnR5cGUgfHwgJ3Vua25vd24nfSAtICR7c2l6ZUtCfSBLQiR7c2l6ZU1CfWAsDQogICAgICAgICAgICBzaXplOiBkYXRhLnNpemUNCiAgICAgICAgfTsNCiAgICB9DQogICAgDQogICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgew0KICAgICAgICBjb25zdCBzaXplS0IgPSAoZGF0YS5ieXRlTGVuZ3RoIC8gMTAyNCkudG9GaXhlZCgyKTsNCiAgICAgICAgcmV0dXJuIHsgDQogICAgICAgICAgICB0eXBlOiAnQXJyYXlCdWZmZXInLCANCiAgICAgICAgICAgIHByZXZpZXc6IGBCaW5hcnkgZGF0YSAtICR7c2l6ZUtCfSBLQmAsDQogICAgICAgICAgICBzaXplOiBkYXRhLmJ5dGVMZW5ndGgNCiAgICAgICAgfTsNCiAgICB9DQogICAgDQogICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5IHx8IGRhdGEgaW5zdGFuY2VvZiBJbnQ4QXJyYXkgfHwgDQogICAgICAgIGRhdGEgaW5zdGFuY2VvZiBVaW50MTZBcnJheSB8fCBkYXRhIGluc3RhbmNlb2YgSW50MTZBcnJheSB8fA0KICAgICAgICBkYXRhIGluc3RhbmNlb2YgVWludDMyQXJyYXkgfHwgZGF0YSBpbnN0YW5jZW9mIEludDMyQXJyYXkgfHwNCiAgICAgICAgZGF0YSBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSB8fCBkYXRhIGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSB7DQogICAgICAgIGNvbnN0IHNpemVLQiA9IChkYXRhLmJ5dGVMZW5ndGggLyAxMDI0KS50b0ZpeGVkKDIpOw0KICAgICAgICByZXR1cm4geyANCiAgICAgICAgICAgIHR5cGU6IGRhdGEuY29uc3RydWN0b3IubmFtZSwgDQogICAgICAgICAgICBwcmV2aWV3OiBgQmluYXJ5IGFycmF5IC0gJHtzaXplS0J9IEtCYCwNCiAgICAgICAgICAgIHNpemU6IGRhdGEuYnl0ZUxlbmd0aA0KICAgICAgICB9Ow0KICAgIH0NCiAgICANCiAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgew0KICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGxpa2VseSBiaW5hcnkgZGF0YSAoYXJyYXkgb2YgbnVtYmVycyAwLTI1NSkNCiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCAmJiBkYXRhLmV2ZXJ5KGl0ZW0gPT4gdHlwZW9mIGl0ZW0gPT09ICdudW1iZXInICYmIGl0ZW0gPj0gMCAmJiBpdGVtIDw9IDI1NSkpIHsNCiAgICAgICAgICAgIGNvbnN0IHNpemVLQiA9IChkYXRhLmxlbmd0aCAvIDEwMjQpLnRvRml4ZWQoMik7DQogICAgICAgICAgICByZXR1cm4geyANCiAgICAgICAgICAgICAgICB0eXBlOiAnQmluYXJ5IEFycmF5JywgDQogICAgICAgICAgICAgICAgcHJldmlldzogYEJpbmFyeSBkYXRhIGFycmF5IC0gJHtzaXplS0J9IEtCYCwNCiAgICAgICAgICAgICAgICBsZW5ndGg6IGRhdGEubGVuZ3RoDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCBwcmV2aWV3ID0gZGF0YS5sZW5ndGggPiAzIA0KICAgICAgICAgICAgPyBgWyR7ZGF0YS5zbGljZSgwLCAzKS5tYXAoaXRlbSA9PiBKU09OLnN0cmluZ2lmeShpdGVtKSkuam9pbignLCAnKX0sIC4uLl1gDQogICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICBjb25zdCB0cnVuY2F0ZWQgPSBwcmV2aWV3Lmxlbmd0aCA+IG1heExlbmd0aCA/IHByZXZpZXcuc3Vic3RyaW5nKDAsIG1heExlbmd0aCkgKyAnLi4uJyA6IHByZXZpZXc7DQogICAgICAgIHJldHVybiB7IA0KICAgICAgICAgICAgdHlwZTogJ0FycmF5JywgDQogICAgICAgICAgICBwcmV2aWV3OiB0cnVuY2F0ZWQsDQogICAgICAgICAgICBsZW5ndGg6IGRhdGEubGVuZ3RoDQogICAgICAgIH07DQogICAgfQ0KICAgIA0KICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpOw0KICAgICAgICANCiAgICAgICAgLy8gQ2hlY2sgaWYgaXQgbG9va3MgbGlrZSBhIGxhcmdlIGRhdGEgb2JqZWN0IChoYXMgY29tbW9uIGxhcmdlIGRhdGEgaW5kaWNhdG9ycykNCiAgICAgICAgY29uc3QgaGFzTGFyZ2VEYXRhSW5kaWNhdG9ycyA9IGtleXMuc29tZShrZXkgPT4gDQogICAgICAgICAgICBrZXkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnZGF0YScpIHx8IA0KICAgICAgICAgICAga2V5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2J1ZmZlcicpIHx8DQogICAgICAgICAgICBrZXkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYmFzZTY0JykgfHwNCiAgICAgICAgICAgIGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdiaW5hcnknKQ0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgaWYgKGhhc0xhcmdlRGF0YUluZGljYXRvcnMpIHsNCiAgICAgICAgICAgIC8vIENoZWNrIHNpemVzIG9mIHZhbHVlcyB0aGF0IG1pZ2h0IGJlIGxhcmdlDQogICAgICAgICAgICBsZXQgdG90YWxTaXplID0gMDsNCiAgICAgICAgICAgIGxldCBoYXNMYXJnZVZhbHVlcyA9IGZhbHNlOw0KICAgICAgICAgICAgY29uc3Qgc3VtbWFyeSA9IHt9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW2tleV07DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUubGVuZ3RoID4gMTAwMCkgew0KICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5W2tleV0gPSBgU3RyaW5nICgkeyh2YWx1ZS5sZW5ndGggLyAxMDI0KS50b0ZpeGVkKDIpfSBLQilgOw0KICAgICAgICAgICAgICAgICAgICB0b3RhbFNpemUgKz0gdmFsdWUubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICBoYXNMYXJnZVZhbHVlcyA9IHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7DQogICAgICAgICAgICAgICAgICAgIHN1bW1hcnlba2V5XSA9IGBBcnJheUJ1ZmZlciAoJHsodmFsdWUuYnl0ZUxlbmd0aCAvIDEwMjQpLnRvRml4ZWQoMil9IEtCKWA7DQogICAgICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSArPSB2YWx1ZS5ieXRlTGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICBoYXNMYXJnZVZhbHVlcyA9IHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPiAxMDAwKSB7DQogICAgICAgICAgICAgICAgICAgIHN1bW1hcnlba2V5XSA9IGBBcnJheVske3ZhbHVlLmxlbmd0aH1dICgkeyh2YWx1ZS5sZW5ndGggLyAxMDI0KS50b0ZpeGVkKDIpfSBLQiBlc3QuKWA7DQogICAgICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSArPSB2YWx1ZS5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgIGhhc0xhcmdlVmFsdWVzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5W2tleV0gPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gYCIke3ZhbHVlLnN1YnN0cmluZygwLCAzMCl9Li4uImAgOiB0eXBlb2YgdmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoaGFzTGFyZ2VWYWx1ZXMpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4geyANCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0xhcmdlIE9iamVjdCcsIA0KICAgICAgICAgICAgICAgICAgICBwcmV2aWV3OiBKU09OLnN0cmluZ2lmeShzdW1tYXJ5LCBudWxsLCAyKSwNCiAgICAgICAgICAgICAgICAgICAga2V5czoga2V5cy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZFNpemU6IHRvdGFsU2l6ZQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFJlZ3VsYXIgb2JqZWN0IGhhbmRsaW5nDQogICAgICAgIGNvbnN0IHByZXZpZXcgPSBrZXlzLmxlbmd0aCA+IDMNCiAgICAgICAgICAgID8gYHske2tleXMuc2xpY2UoMCwgMykuam9pbignLCAnKX0sIC4uLn1gDQogICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICBjb25zdCB0cnVuY2F0ZWQgPSBwcmV2aWV3Lmxlbmd0aCA+IG1heExlbmd0aCA/IHByZXZpZXcuc3Vic3RyaW5nKDAsIG1heExlbmd0aCkgKyAnLi4uJyA6IHByZXZpZXc7DQogICAgICAgIHJldHVybiB7IA0KICAgICAgICAgICAgdHlwZTogJ09iamVjdCcsIA0KICAgICAgICAgICAgcHJldmlldzogdHJ1bmNhdGVkLA0KICAgICAgICAgICAga2V5czoga2V5cy5sZW5ndGgNCiAgICAgICAgfTsNCiAgICB9DQogICAgDQogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGJhc2U2NCBkYXRhDQogICAgICAgIGNvbnN0IGlzQmFzZTY0ID0gL15bQS1aYS16MC05Ky9dKj17MCwyfSQvLnRlc3QoZGF0YSkgJiYgZGF0YS5sZW5ndGggPiAxMDAgJiYgZGF0YS5sZW5ndGggJSA0ID09PSAwOw0KICAgICAgICBpZiAoaXNCYXNlNjQpIHsNCiAgICAgICAgICAgIGNvbnN0IHNpemVLQiA9IChkYXRhLmxlbmd0aCAqIDAuNzUgLyAxMDI0KS50b0ZpeGVkKDIpOyAvLyBCYXNlNjQgaXMgfjMzJSBsYXJnZXIgdGhhbiBiaW5hcnkNCiAgICAgICAgICAgIHJldHVybiB7IA0KICAgICAgICAgICAgICAgIHR5cGU6ICdCYXNlNjQgRGF0YScsIA0KICAgICAgICAgICAgICAgIHByZXZpZXc6IGBCYXNlNjQgZW5jb2RlZCBkYXRhIC0gJHtzaXplS0J9IEtCYCwNCiAgICAgICAgICAgICAgICBsZW5ndGg6IGRhdGEubGVuZ3RoDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgZGF0YSBVUkwNCiAgICAgICAgaWYgKGRhdGEuc3RhcnRzV2l0aCgnZGF0YTonKSkgew0KICAgICAgICAgICAgY29uc3QgY29tbWFJbmRleCA9IGRhdGEuaW5kZXhPZignLCcpOw0KICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gY29tbWFJbmRleCA+IDAgPyBkYXRhLnN1YnN0cmluZygwLCBjb21tYUluZGV4KSA6IGRhdGEuc3Vic3RyaW5nKDAsIDUwKTsNCiAgICAgICAgICAgIGNvbnN0IGRhdGFTaXplID0gY29tbWFJbmRleCA+IDAgPyBkYXRhLmxlbmd0aCAtIGNvbW1hSW5kZXggLSAxIDogZGF0YS5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCBzaXplS0IgPSAoZGF0YVNpemUgKiAwLjc1IC8gMTAyNCkudG9GaXhlZCgyKTsNCiAgICAgICAgICAgIHJldHVybiB7IA0KICAgICAgICAgICAgICAgIHR5cGU6ICdEYXRhIFVSTCcsIA0KICAgICAgICAgICAgICAgIHByZXZpZXc6IGAke2hlYWRlcn0uLi4gLSAke3NpemVLQn0gS0JgLA0KICAgICAgICAgICAgICAgIGxlbmd0aDogZGF0YS5sZW5ndGgNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFJlZ3VsYXIgc3RyaW5nIGhhbmRsaW5nDQogICAgICAgIGNvbnN0IHRydW5jYXRlZCA9IGRhdGEubGVuZ3RoID4gbWF4TGVuZ3RoID8gZGF0YS5zdWJzdHJpbmcoMCwgbWF4TGVuZ3RoKSArICcuLi4nIDogZGF0YTsNCiAgICAgICAgcmV0dXJuIHsgDQogICAgICAgICAgICB0eXBlOiAnU3RyaW5nJywgDQogICAgICAgICAgICBwcmV2aWV3OiB0cnVuY2F0ZWQsDQogICAgICAgICAgICBsZW5ndGg6IGRhdGEubGVuZ3RoDQogICAgICAgIH07DQogICAgfQ0KICAgIA0KICAgIHJldHVybiB7IA0KICAgICAgICB0eXBlOiB0eXBlb2YgZGF0YSwgDQogICAgICAgIHByZXZpZXc6IFN0cmluZyhkYXRhKSANCiAgICB9Ow0KfQ0KDQovLyBHZXQgb3V0cHV0IHBvcnQgZGF0YSBmb3IgYSBzcGVjaWZpYyBub2RlIGFuZCBwb3J0DQpmdW5jdGlvbiBnZXRPdXRwdXRQb3J0RGF0YShub2RlSWQsIHBvcnRJZCkgew0KICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChub2RlSWQpOw0KICAgIGlmICghbm9kZSB8fCAhbm9kZS5sYXN0T3V0cHV0RGF0YSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgDQogICAgLy8gSWYgdGhlIG91dHB1dCBkYXRhIGlzIGFuIG9iamVjdCB3aXRoIG5hbWVkIHBvcnRzLCBleHRyYWN0IHRoZSBzcGVjaWZpYyBwb3J0DQogICAgaWYgKHR5cGVvZiBub2RlLmxhc3RPdXRwdXREYXRhID09PSAnb2JqZWN0JyAmJiBub2RlLmxhc3RPdXRwdXREYXRhICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KG5vZGUubGFzdE91dHB1dERhdGEpICYmICEobm9kZS5sYXN0T3V0cHV0RGF0YSBpbnN0YW5jZW9mIEJsb2IpICYmICEobm9kZS5sYXN0T3V0cHV0RGF0YSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSkgew0KICAgICAgICBpZiAocG9ydElkIGluIG5vZGUubGFzdE91dHB1dERhdGEpIHsNCiAgICAgICAgICAgIHJldHVybiBub2RlLmxhc3RPdXRwdXREYXRhW3BvcnRJZF07DQogICAgICAgIH0NCiAgICAgICAgLy8gUG9ydCBub3QgZm91bmQgaW4gb3V0cHV0IG9iamVjdA0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgDQogICAgLy8gRm9yIHNpbmdsZSBvdXRwdXQgbm9kZXMgb3Igbm9uLW9iamVjdCBvdXRwdXRzIChCbG9iLCBBcnJheUJ1ZmZlciwgcHJpbWl0aXZlcyksIA0KICAgIC8vIG9ubHkgcmV0dXJuIGRhdGEgZm9yIHRoZSBmaXJzdC9wcmltYXJ5IG91dHB1dCBwb3J0DQogICAgY29uc3Qgbm9kZURlZiA9IG5vZGVSZWdpc3RyeS5nZXROb2RlVHlwZShub2RlLnR5cGUpOw0KICAgIGlmIChub2RlRGVmICYmIG5vZGVEZWYub3V0cHV0cyAmJiBub2RlRGVmLm91dHB1dHMubGVuZ3RoID4gMCkgew0KICAgICAgICAvLyBPbmx5IHJldHVybiBkYXRhIGZvciB0aGUgZmlyc3Qgb3V0cHV0IHBvcnQsIG90aGVycyBnZXQgbnVsbA0KICAgICAgICBpZiAocG9ydElkID09PSBub2RlRGVmLm91dHB1dHNbMF0uaWQpIHsNCiAgICAgICAgICAgIHJldHVybiBub2RlLmxhc3RPdXRwdXREYXRhOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICANCiAgICAvLyBGYWxsYmFjazogcmV0dXJuIHRoZSBkYXRhIChzaG91bGRuJ3Qgbm9ybWFsbHkgcmVhY2ggaGVyZSkNCiAgICByZXR1cm4gbm9kZS5sYXN0T3V0cHV0RGF0YTsNCn0gDQoNCi8vIFVwZGF0ZSBjYW52YXMgdHJhbnNmb3JtIGZvciBwYW5uaW5nIGFuZCB6b29taW5nDQpmdW5jdGlvbiB1cGRhdGVDYW52YXNUcmFuc2Zvcm0oKSB7DQogICAgaWYgKGZsb3dFZGl0b3IuY2FudmFzKSB7DQogICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHtmbG93RWRpdG9yLnBhbk9mZnNldC54fXB4LCAke2Zsb3dFZGl0b3IucGFuT2Zmc2V0Lnl9cHgpIHNjYWxlKCR7Zmxvd0VkaXRvci56b29tTGV2ZWx9KWA7DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsNCiAgICAgICAgDQogICAgICAgIC8vIFVwZGF0ZSB6b29tIGxldmVsIGRpc3BsYXkNCiAgICAgICAgY29uc3Qgem9vbURpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbS1sZXZlbCcpOw0KICAgICAgICBpZiAoem9vbURpc3BsYXkpIHsNCiAgICAgICAgICAgIHpvb21EaXNwbGF5LnRleHRDb250ZW50ID0gTWF0aC5yb3VuZChmbG93RWRpdG9yLnpvb21MZXZlbCAqIDEwMCkgKyAnJSc7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFN0YXJ0IGNhbnZhcyBwYW5uaW5nDQpmdW5jdGlvbiBzdGFydENhbnZhc1BhbihlKSB7DQogICAgLy8gT25seSBzdGFydCBwYW5uaW5nIGlmIGNsaWNraW5nIGRpcmVjdGx5IG9uIGNhbnZhcyAobm90IG9uIG5vZGVzIG9yIG90aGVyIGVsZW1lbnRzKQ0KICAgIC8vIGFuZCBub3QgYWxyZWFkeSBkcmFnZ2luZyBhIG5vZGUNCiAgICBpZiAoZS50YXJnZXQgPT09IGZsb3dFZGl0b3IuY2FudmFzICYmICFmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSkgew0KICAgICAgICBmbG93RWRpdG9yLmlzUGFubmluZyA9IHRydWU7DQogICAgICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gKHR5cGVvZiBzeXBuZXhBUEkgIT09ICd1bmRlZmluZWQnICYmIHN5cG5leEFQSS5nZXRTY2FsZWRNb3VzZUNvb3JkcykgPw0KICAgICAgICAgICAgc3lwbmV4QVBJLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDoNCiAgICAgICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICAgICAgZmxvd0VkaXRvci5wYW5TdGFydCA9IHsgeDogbW91c2VDb29yZHMueCwgeTogbW91c2VDb29yZHMueSB9Ow0KICAgICAgICBmbG93RWRpdG9yLmxhc3RQYW5PZmZzZXQgPSB7IC4uLmZsb3dFZGl0b3IucGFuT2Zmc2V0IH07DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLmN1cnNvciA9ICdncmFiYmluZyc7DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLmNsYXNzTGlzdC5hZGQoJ3Bhbm5pbmcnKTsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgIH0NCn0NCg0KLy8gVXBkYXRlIGNhbnZhcyBwYW5uaW5nDQpmdW5jdGlvbiB1cGRhdGVDYW52YXNQYW4oZSkgew0KICAgIGlmIChmbG93RWRpdG9yLmlzUGFubmluZykgew0KICAgICAgICBjb25zdCBtb3VzZUNvb3JkcyA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkTW91c2VDb29yZHMpID8NCiAgICAgICAgICAgIHN5cG5leEFQSS5nZXRTY2FsZWRNb3VzZUNvb3JkcyhlKSA6DQogICAgICAgICAgICB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07DQogICAgICAgIGNvbnN0IGRlbHRhWCA9IG1vdXNlQ29vcmRzLnggLSBmbG93RWRpdG9yLnBhblN0YXJ0Lng7DQogICAgICAgIGNvbnN0IGRlbHRhWSA9IG1vdXNlQ29vcmRzLnkgLSBmbG93RWRpdG9yLnBhblN0YXJ0Lnk7DQoNCiAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueCA9IGZsb3dFZGl0b3IubGFzdFBhbk9mZnNldC54ICsgZGVsdGFYOw0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gZmxvd0VkaXRvci5sYXN0UGFuT2Zmc2V0LnkgKyBkZWx0YVk7DQoNCiAgICAgICAgdXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICB9DQp9DQoNCi8vIFN0b3AgY2FudmFzIHBhbm5pbmcNCmZ1bmN0aW9uIHN0b3BDYW52YXNQYW4oKSB7DQogICAgaWYgKGZsb3dFZGl0b3IuaXNQYW5uaW5nKSB7DQogICAgICAgIGZsb3dFZGl0b3IuaXNQYW5uaW5nID0gZmFsc2U7DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLmN1cnNvciA9ICdncmFiJzsNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXMuY2xhc3NMaXN0LnJlbW92ZSgncGFubmluZycpOw0KICAgIH0NCn0NCg0KLy8gUmVzZXQgY2FudmFzIHBhbiB0byBjZW50ZXINCmZ1bmN0aW9uIHJlc2V0Q2FudmFzUGFuKCkgew0KICAgIC8vIEFkZCBzbW9vdGggdHJhbnNpdGlvbiBmb3IgcmVzZXQNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAwLjNzIGVhc2Utb3V0JzsNCg0KICAgIC8vIENhbGN1bGF0ZSBjZW50ZXIgb2YgYWxsIG5vZGVzIGlmIGFueSBleGlzdA0KICAgIGlmIChmbG93RWRpdG9yLm5vZGVzLnNpemUgPiAwKSB7DQogICAgICAgIGNvbnN0IG5vZGVzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKTsNCiAgICAgICAgY29uc3QgbWluWCA9IE1hdGgubWluKC4uLm5vZGVzLm1hcChuID0+IG4ueCkpOw0KICAgICAgICBjb25zdCBtYXhYID0gTWF0aC5tYXgoLi4ubm9kZXMubWFwKG4gPT4gbi54KSk7DQogICAgICAgIGNvbnN0IG1pblkgPSBNYXRoLm1pbiguLi5ub2Rlcy5tYXAobiA9PiBuLnkpKTsNCiAgICAgICAgY29uc3QgbWF4WSA9IE1hdGgubWF4KC4uLm5vZGVzLm1hcChuID0+IG4ueSkpOw0KDQogICAgICAgIGNvbnN0IGNlbnRlclggPSAobWluWCArIG1heFgpIC8gMjsNCiAgICAgICAgY29uc3QgY2VudGVyWSA9IChtaW5ZICsgbWF4WSkgLyAyOw0KDQogICAgICAgIC8vIEdldCBjYW52YXMgY29udGFpbmVyIGRpbWVuc2lvbnMgKHNjYWxlZCkNCiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KSA/DQogICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOg0KICAgICAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KDQogICAgICAgIC8vIENhbGN1bGF0ZSBwYW4gb2Zmc2V0IHRvIGNlbnRlciB0aGUgbm9kZXMgaW4gdGhlIHZpZXdwb3J0DQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSAtY2VudGVyWCArIGNvbnRhaW5lclJlY3Qud2lkdGggLyAyOw0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gLWNlbnRlclkgKyBjb250YWluZXJSZWN0LmhlaWdodCAvIDI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gSWYgbm8gbm9kZXMsIHJlc2V0IHRvIGNlbnRlciBvZiB0aGUgbGFyZ2UgY2FudmFzDQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0ID0geyB4OiAtNTAwMCwgeTogLTUwMDAgfTsNCiAgICB9DQoNCiAgICAvLyBSZXNldCB6b29tIHRvIDEwMCUNCiAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IDEuMDsNCg0KICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KDQogICAgLy8gUmVtb3ZlIHRyYW5zaXRpb24gYWZ0ZXIgYW5pbWF0aW9uIGNvbXBsZXRlcw0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS50cmFuc2l0aW9uID0gJyc7DQogICAgfSwgMzAwKTsNCn0NCg0KLy8gWm9vbSBmdW5jdGlvbnMNCmZ1bmN0aW9uIHpvb21JbigpIHsNCiAgICBjb25zdCBuZXdab29tID0gTWF0aC5taW4oZmxvd0VkaXRvci56b29tTGV2ZWwgKyBmbG93RWRpdG9yLnpvb21TdGVwLCBmbG93RWRpdG9yLm1heFpvb20pOw0KICAgIHNldFpvb21MZXZlbChuZXdab29tKTsNCn0NCg0KZnVuY3Rpb24gem9vbU91dCgpIHsNCiAgICBjb25zdCBuZXdab29tID0gTWF0aC5tYXgoZmxvd0VkaXRvci56b29tTGV2ZWwgLSBmbG93RWRpdG9yLnpvb21TdGVwLCBmbG93RWRpdG9yLm1pblpvb20pOw0KICAgIHNldFpvb21MZXZlbChuZXdab29tKTsNCn0NCg0KZnVuY3Rpb24gc2V0Wm9vbUxldmVsKHpvb21MZXZlbCkgew0KICAgIC8vIEdldCB0aGUgY2VudGVyIG9mIHRoZSBjYW52YXMgY29udGFpbmVyIGZvciB6b29tIG9yaWdpbg0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KSA/DQogICAgICAgIHN5cG5leEFQSS5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QoY29udGFpbmVyKSA6DQogICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICANCiAgICBjb25zdCBjZW50ZXJYID0gY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgY29uc3QgY2VudGVyWSA9IGNvbnRhaW5lclJlY3QuaGVpZ2h0IC8gMjsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgdGhlIHBvaW50IGluIGNhbnZhcyBjb29yZGluYXRlcyB0aGF0IHNob3VsZCByZW1haW4gZml4ZWQNCiAgICBjb25zdCBjYW52YXNYID0gKGNlbnRlclggLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIGNvbnN0IGNhbnZhc1kgPSAoY2VudGVyWSAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgDQogICAgLy8gVXBkYXRlIHpvb20gbGV2ZWwNCiAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IE1hdGgubWF4KGZsb3dFZGl0b3IubWluWm9vbSwgTWF0aC5taW4oZmxvd0VkaXRvci5tYXhab29tLCB6b29tTGV2ZWwpKTsNCiAgICANCiAgICAvLyBBZGp1c3QgcGFuIG9mZnNldCB0byBrZWVwIHRoZSBjZW50ZXIgcG9pbnQgZml4ZWQNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gY2VudGVyWCAtIGNhbnZhc1ggKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gY2VudGVyWSAtIGNhbnZhc1kgKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICANCiAgICB1cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICANCiAgICAvLyBSZWRyYXcgY29ubmVjdGlvbnMgYWZ0ZXIgem9vbQ0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICByZWRyYXdBbGxDb25uZWN0aW9ucygpOw0KICAgIH0sIDE2KTsNCn0NCg0KZnVuY3Rpb24gem9vbVRvRml0KCkgew0KICAgIGlmIChmbG93RWRpdG9yLm5vZGVzLnNpemUgPT09IDApIHsNCiAgICAgICAgLy8gSWYgbm8gbm9kZXMsIHJlc2V0IHRvIDEwMCUgem9vbSBhbmQgY2VudGVyDQogICAgICAgIGZsb3dFZGl0b3Iuem9vbUxldmVsID0gMS4wOw0KICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldCA9IHsgeDogLTUwMDAsIHk6IC01MDAwIH07DQogICAgICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIEZpbmQgYm91bmRzIG9mIGFsbCBub2Rlcw0KICAgIGNvbnN0IG5vZGVzID0gQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKTsNCiAgICBjb25zdCBwYWRkaW5nID0gMTAwOyAvLyBFeHRyYSBwYWRkaW5nIGFyb3VuZCBub2Rlcw0KICAgIA0KICAgIGxldCBtaW5YID0gSW5maW5pdHksIG1heFggPSAtSW5maW5pdHk7DQogICAgbGV0IG1pblkgPSBJbmZpbml0eSwgbWF4WSA9IC1JbmZpbml0eTsNCiAgICANCiAgICBub2Rlcy5mb3JFYWNoKG5vZGUgPT4gew0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5vZGUuaWQpOw0KICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgIGNvbnN0IHJlY3QgPSBub2RlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBub2RlLngpOw0KICAgICAgICAgICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIG5vZGUueCArIHJlY3Qud2lkdGgpOw0KICAgICAgICAgICAgbWluWSA9IE1hdGgubWluKG1pblksIG5vZGUueSk7DQogICAgICAgICAgICBtYXhZID0gTWF0aC5tYXgobWF4WSwgbm9kZS55ICsgcmVjdC5oZWlnaHQpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQogICAgLy8gQWRkIHBhZGRpbmcNCiAgICBtaW5YIC09IHBhZGRpbmc7DQogICAgbWF4WCArPSBwYWRkaW5nOw0KICAgIG1pblkgLT0gcGFkZGluZzsNCiAgICBtYXhZICs9IHBhZGRpbmc7DQogICAgDQogICAgY29uc3QgY29udGVudFdpZHRoID0gbWF4WCAtIG1pblg7DQogICAgY29uc3QgY29udGVudEhlaWdodCA9IG1heFkgLSBtaW5ZOw0KICAgIA0KICAgIC8vIEdldCBjb250YWluZXIgZGltZW5zaW9ucw0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KSA/DQogICAgICAgIHN5cG5leEFQSS5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QoY29udGFpbmVyKSA6DQogICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgem9vbSB0byBmaXQNCiAgICBjb25zdCB6b29tWCA9IGNvbnRhaW5lclJlY3Qud2lkdGggLyBjb250ZW50V2lkdGg7DQogICAgY29uc3Qgem9vbVkgPSBjb250YWluZXJSZWN0LmhlaWdodCAvIGNvbnRlbnRIZWlnaHQ7DQogICAgY29uc3QgbmV3Wm9vbSA9IE1hdGgubWluKHpvb21YLCB6b29tWSwgZmxvd0VkaXRvci5tYXhab29tKTsNCiAgICANCiAgICAvLyBTZXQgem9vbSBsZXZlbA0KICAgIGZsb3dFZGl0b3Iuem9vbUxldmVsID0gTWF0aC5tYXgoZmxvd0VkaXRvci5taW5ab29tLCBuZXdab29tKTsNCiAgICANCiAgICAvLyBDZW50ZXIgdGhlIGNvbnRlbnQNCiAgICBjb25zdCBjZW50ZXJYID0gKG1pblggKyBtYXhYKSAvIDI7DQogICAgY29uc3QgY2VudGVyWSA9IChtaW5ZICsgbWF4WSkgLyAyOw0KICAgIA0KICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSBjb250YWluZXJSZWN0LndpZHRoIC8gMiAtIGNlbnRlclggKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICBmbG93RWRpdG9yLnBhbk9mZnNldC55ID0gY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyIC0gY2VudGVyWSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgIA0KICAgIC8vIEFkZCBzbW9vdGggdHJhbnNpdGlvbg0KICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLnRyYW5zaXRpb24gPSAndHJhbnNmb3JtIDAuM3MgZWFzZS1vdXQnOw0KICAgIHVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgIA0KICAgIC8vIFJlbW92ZSB0cmFuc2l0aW9uIGFmdGVyIGFuaW1hdGlvbg0KICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5zdHlsZS50cmFuc2l0aW9uID0gJyc7DQogICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgfSwgMzAwKTsNCn0NCg0KLy8gSGFuZGxlIG1vdXNlIHdoZWVsIHpvb20NCmZ1bmN0aW9uIGhhbmRsZU1vdXNlV2hlZWwoZSkgew0KICAgIGlmIChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSB7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgDQogICAgICAgIC8vIEdldCBtb3VzZSBwb3NpdGlvbiByZWxhdGl2ZSB0byBjb250YWluZXINCiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KSA/DQogICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOg0KICAgICAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICANCiAgICAgICAgY29uc3QgbW91c2VDb29yZHMgPSAodHlwZW9mIHN5cG5leEFQSSAhPT0gJ3VuZGVmaW5lZCcgJiYgc3lwbmV4QVBJLmdldFNjYWxlZE1vdXNlQ29vcmRzKSA/DQogICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOg0KICAgICAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgICAgICANCiAgICAgICAgY29uc3QgbW91c2VYID0gbW91c2VDb29yZHMueCAtIGNvbnRhaW5lclJlY3QubGVmdDsNCiAgICAgICAgY29uc3QgbW91c2VZID0gbW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wOw0KICAgICAgICANCiAgICAgICAgLy8gQ2FsY3VsYXRlIHpvb20gZGVsdGENCiAgICAgICAgY29uc3Qgem9vbURlbHRhID0gZS5kZWx0YVkgPiAwID8gLWZsb3dFZGl0b3Iuem9vbVN0ZXAgOiBmbG93RWRpdG9yLnpvb21TdGVwOw0KICAgICAgICBjb25zdCBuZXdab29tID0gTWF0aC5tYXgoZmxvd0VkaXRvci5taW5ab29tLCBNYXRoLm1pbihmbG93RWRpdG9yLm1heFpvb20sIGZsb3dFZGl0b3Iuem9vbUxldmVsICsgem9vbURlbHRhKSk7DQogICAgICAgIA0KICAgICAgICBpZiAobmV3Wm9vbSAhPT0gZmxvd0VkaXRvci56b29tTGV2ZWwpIHsNCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgcG9pbnQgaW4gY2FudmFzIGNvb3JkaW5hdGVzIHRoYXQgc2hvdWxkIHJlbWFpbiBmaXhlZCAodW5kZXIgbW91c2UpDQogICAgICAgICAgICBjb25zdCBjYW52YXNYID0gKG1vdXNlWCAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LngpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICBjb25zdCBjYW52YXNZID0gKG1vdXNlWSAtIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkpIC8gZmxvd0VkaXRvci56b29tTGV2ZWw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFVwZGF0ZSB6b29tIGxldmVsDQogICAgICAgICAgICBmbG93RWRpdG9yLnpvb21MZXZlbCA9IG5ld1pvb207DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEFkanVzdCBwYW4gb2Zmc2V0IHRvIGtlZXAgdGhlIG1vdXNlIHBvaW50IGZpeGVkDQogICAgICAgICAgICBmbG93RWRpdG9yLnBhbk9mZnNldC54ID0gbW91c2VYIC0gY2FudmFzWCAqIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IG1vdXNlWSAtIGNhbnZhc1kgKiBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFJlZHJhdyBjb25uZWN0aW9ucyBhZnRlciB6b29tDQogICAgICAgICAgICBjbGVhclRpbWVvdXQoZmxvd0VkaXRvci56b29tUmVkcmF3VGltZW91dCk7DQogICAgICAgICAgICBmbG93RWRpdG9yLnpvb21SZWRyYXdUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgcmVkcmF3QWxsQ29ubmVjdGlvbnMoKTsNCiAgICAgICAgICAgIH0sIDUwKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gSGFuZGxlIGNhbnZhcyBjbGljayBldmVudHMNCmZ1bmN0aW9uIGhhbmRsZUNhbnZhc0NsaWNrKGUpIHsNCiAgICBpZiAoZS50YXJnZXQgPT09IGZsb3dFZGl0b3IuY2FudmFzKSB7DQogICAgICAgIC8vIERlc2VsZWN0IG5vZGUNCiAgICAgICAgaWYgKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlKSB7DQogICAgICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlKTsNCiAgICAgICAgICAgIGlmIChub2RlRWxlbWVudCkgbm9kZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTsNCiAgICAgICAgICAgIGZsb3dFZGl0b3Iuc2VsZWN0ZWROb2RlID0gbnVsbDsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub2RlLWNvbmZpZycpLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1tdXRlZCI+U2VsZWN0IGEgbm9kZSB0byBjb25maWd1cmUgaXQ8L3A+JzsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gSGFuZGxlIGRvY3VtZW50IG1vdXNlIGV2ZW50cyBmb3Igc21vb3RoIGRyYWdnaW5nDQpmdW5jdGlvbiBoYW5kbGVEb2N1bWVudE1vdXNlRG93bihlKSB7DQogICAgLy8gRG9uJ3Qgc3RhcnQgZHJhZ2dpbmcgaWYgY2xpY2tpbmcgb24gVUkgZWxlbWVudHMNCiAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLmZsb3ctdG9vbGJhcicpIHx8IA0KICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcuZmxvdy1jb25maWctcGFuZWwnKSB8fCANCiAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnLmZsb3ctb3V0cHV0LXBhbmVsJykgfHwNCiAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnLm5vZGUtZGVsZXRlLWJ0bicpKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gRG9uJ3Qgc3RhcnQgZHJhZ2dpbmcgaWYgd2UncmUgcGFubmluZw0KICAgIGlmIChmbG93RWRpdG9yLmlzUGFubmluZykgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIE9ubHkgYWxsb3cgZHJhZ2dpbmcgZnJvbSB0aGUgbm9kZSBoZWFkZXINCiAgICBjb25zdCBoZWFkZXJFbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnLmZsb3ctbm9kZS1oZWFkZXInKTsNCiAgICBpZiAoIWhlYWRlckVsZW1lbnQpIHJldHVybjsNCiAgICBjb25zdCBub2RlRWxlbWVudCA9IGhlYWRlckVsZW1lbnQuY2xvc2VzdCgnLmZsb3ctbm9kZScpOw0KICAgIGlmICghbm9kZUVsZW1lbnQpIHJldHVybjsNCiAgICANCiAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICBjb25zdCBub2RlSWQgPSBub2RlRWxlbWVudC5pZDsNCiAgICBjb25zdCBub2RlID0gZmxvd0VkaXRvci5ub2Rlcy5nZXQobm9kZUlkKTsNCiAgICANCiAgICBpZiAobm9kZSkgew0KICAgICAgICBmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSA9IG5vZGVJZDsNCiAgICAgICAgDQogICAgICAgIC8vIENhbGN1bGF0ZSBvZmZzZXQgZnJvbSBtb3VzZSB0byBub2RlIGNvcm5lciwgYWNjb3VudGluZyBmb3Igem9vbQ0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gKHR5cGVvZiBzeXBuZXhBUEkgIT09ICd1bmRlZmluZWQnICYmIHN5cG5leEFQSS5nZXRTY2FsZWRCb3VuZGluZ0NsaWVudFJlY3QpID8gDQogICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOiANCiAgICAgICAgICAgIGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gKHR5cGVvZiBzeXBuZXhBUEkgIT09ICd1bmRlZmluZWQnICYmIHN5cG5leEFQSS5nZXRTY2FsZWRNb3VzZUNvb3JkcykgPyANCiAgICAgICAgICAgIHN5cG5leEFQSS5nZXRTY2FsZWRNb3VzZUNvb3JkcyhlKSA6IA0KICAgICAgICAgICAgeyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9Ow0KICAgICAgICANCiAgICAgICAgLy8gQ29udmVydCBtb3VzZSBwb3NpdGlvbiB0byBjYW52YXMgY29vcmRpbmF0ZXMNCiAgICAgICAgY29uc3QgY2FudmFzTW91c2VYID0gKG1vdXNlQ29vcmRzLnggLSBjb250YWluZXJSZWN0LmxlZnQgLSBmbG93RWRpdG9yLnBhbk9mZnNldC54KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICBjb25zdCBjYW52YXNNb3VzZVkgPSAobW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgDQogICAgICAgIC8vIENhbGN1bGF0ZSBvZmZzZXQgaW4gY2FudmFzIGNvb3JkaW5hdGVzDQogICAgICAgIGZsb3dFZGl0b3IuZHJhZ09mZnNldCA9IHsNCiAgICAgICAgICAgIHg6IChjYW52YXNNb3VzZVggLSBub2RlLngpICogZmxvd0VkaXRvci56b29tTGV2ZWwsDQogICAgICAgICAgICB5OiAoY2FudmFzTW91c2VZIC0gbm9kZS55KSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsDQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBub2RlRWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZ3JhYmJpbmcnOw0KICAgICAgICBub2RlRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMTAwMCc7IC8vIEJyaW5nIHRvIGZyb250IHdoaWxlIGRyYWdnaW5nDQogICAgICAgIA0KICAgICAgICAvLyBDYWNoZSBjb250YWluZXIgcmVjdCBmb3IgcGVyZm9ybWFuY2UNCiAgICAgICAgZmxvd0VkaXRvci5jYW52YXNSZWN0ID0gY29udGFpbmVyUmVjdDsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGhhbmRsZURvY3VtZW50TW91c2VNb3ZlKGUpIHsNCiAgICAvLyBIYW5kbGUgY2FudmFzIHBhbm5pbmcNCiAgICBpZiAoZmxvd0VkaXRvci5pc1Bhbm5pbmcpIHsNCiAgICAgICAgdXBkYXRlQ2FudmFzUGFuKGUpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIC8vIEdldCBzY2FsZWQgY29vcmRpbmF0ZXMNCiAgICBjb25zdCBtb3VzZUNvb3JkcyA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkTW91c2VDb29yZHMpID8gDQogICAgICAgIHN5cG5leEFQSS5nZXRTY2FsZWRNb3VzZUNvb3JkcyhlKSA6IA0KICAgICAgICB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07DQogICAgDQogICAgLy8gSGFuZGxlIHRhZyBkcmFnZ2luZw0KICAgIGlmIChmbG93RWRpdG9yLmRyYWdnaW5nVGFnICYmIGZsb3dFZGl0b3IudGFnRHJhZ09mZnNldCkgew0KICAgICAgICBjb25zdCB0YWcgPSBmbG93RWRpdG9yLnRhZ3MuZ2V0KGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcpOw0KICAgICAgICBpZiAodGFnKSB7DQogICAgICAgICAgICAvLyBHZXQgY29udGFpbmVyIGRpbWVuc2lvbnMgZm9yIGNvb3JkaW5hdGUgY29udmVyc2lvbg0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSAodHlwZW9mIHN5cG5leEFQSSAhPT0gJ3VuZGVmaW5lZCcgJiYgc3lwbmV4QVBJLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdCkgPyANCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOiANCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENvbnZlcnQgbW91c2UgY29vcmRpbmF0ZXMgdG8gY2FudmFzIGNvb3JkaW5hdGVzLCBhY2NvdW50aW5nIGZvciBwYW4gYW5kIHpvb20NCiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01vdXNlWCA9IChtb3VzZUNvb3Jkcy54IC0gY29udGFpbmVyUmVjdC5sZWZ0IC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueCkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01vdXNlWSA9IChtb3VzZUNvb3Jkcy55IC0gY29udGFpbmVyUmVjdC50b3AgLSBmbG93RWRpdG9yLnBhbk9mZnNldC55KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHBvc2l0aW9uIHdpdGggb2Zmc2V0IChkcmFnIG9mZnNldCBpcyBhbHNvIGluIHNjcmVlbiBjb29yZGluYXRlcywgc28gY29udmVydCBpdCkNCiAgICAgICAgICAgIGNvbnN0IGRyYWdPZmZzZXRYID0gZmxvd0VkaXRvci50YWdEcmFnT2Zmc2V0LnggLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIGNvbnN0IGRyYWdPZmZzZXRZID0gZmxvd0VkaXRvci50YWdEcmFnT2Zmc2V0LnkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdGFnLnggPSBjYW52YXNNb3VzZVggLSBkcmFnT2Zmc2V0WDsNCiAgICAgICAgICAgIHRhZy55ID0gY2FudmFzTW91c2VZIC0gZHJhZ09mZnNldFk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IHRhZ0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbG93RWRpdG9yLmRyYWdnaW5nVGFnKTsNCiAgICAgICAgICAgIGlmICh0YWdFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgLy8gVXNlIGxlZnQvdG9wIGZvciBwb3NpdGlvbmluZw0KICAgICAgICAgICAgICAgIHRhZ0VsZW1lbnQuc3R5bGUubGVmdCA9IHRhZy54ICsgJ3B4JzsNCiAgICAgICAgICAgICAgICB0YWdFbGVtZW50LnN0eWxlLnRvcCA9IHRhZy55ICsgJ3B4JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gVGhyb3R0bGUgdXBkYXRlcyBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlDQogICAgICAgICAgICBpZiAoIWZsb3dFZGl0b3IudGFnVXBkYXRlVGltZW91dCkgew0KICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IudGFnVXBkYXRlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnRhZ1VwZGF0ZVRpbWVvdXQgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0sIDE2KTsgLy8gfjYwZnBzDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICBpZiAoZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUgJiYgZmxvd0VkaXRvci5kcmFnT2Zmc2V0KSB7DQogICAgICAgIGNvbnN0IG5vZGUgPSBmbG93RWRpdG9yLm5vZGVzLmdldChmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSk7DQogICAgICAgIGlmIChub2RlKSB7DQogICAgICAgICAgICAvLyBHZXQgY29udGFpbmVyIGRpbWVuc2lvbnMgZm9yIGNvb3JkaW5hdGUgY29udmVyc2lvbg0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSAodHlwZW9mIHN5cG5leEFQSSAhPT0gJ3VuZGVmaW5lZCcgJiYgc3lwbmV4QVBJLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdCkgPyANCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOiANCiAgICAgICAgICAgICAgICBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENvbnZlcnQgbW91c2UgY29vcmRpbmF0ZXMgdG8gY2FudmFzIGNvb3JkaW5hdGVzLCBhY2NvdW50aW5nIGZvciBwYW4gYW5kIHpvb20NCiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01vdXNlWCA9IChtb3VzZUNvb3Jkcy54IC0gY29udGFpbmVyUmVjdC5sZWZ0IC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueCkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01vdXNlWSA9IChtb3VzZUNvb3Jkcy55IC0gY29udGFpbmVyUmVjdC50b3AgLSBmbG93RWRpdG9yLnBhbk9mZnNldC55KSAvIGZsb3dFZGl0b3Iuem9vbUxldmVsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHBvc2l0aW9uIHdpdGggb2Zmc2V0IChkcmFnIG9mZnNldCBpcyBhbHNvIGluIHNjcmVlbiBjb29yZGluYXRlcywgc28gY29udmVydCBpdCkNCiAgICAgICAgICAgIGNvbnN0IGRyYWdPZmZzZXRYID0gZmxvd0VkaXRvci5kcmFnT2Zmc2V0LnggLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIGNvbnN0IGRyYWdPZmZzZXRZID0gZmxvd0VkaXRvci5kcmFnT2Zmc2V0LnkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbm9kZS54ID0gY2FudmFzTW91c2VYIC0gZHJhZ09mZnNldFg7DQogICAgICAgICAgICBub2RlLnkgPSBjYW52YXNNb3VzZVkgLSBkcmFnT2Zmc2V0WTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSk7DQogICAgICAgICAgICBpZiAobm9kZUVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS5sZWZ0ID0gbm9kZS54ICsgJ3B4JzsNCiAgICAgICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS50b3AgPSBub2RlLnkgKyAncHgnOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBhbGwgY29ubmVjdGlvbnMgZm9yIHRoaXMgbm9kZSAodGhyb3R0bGVkIGZvciBwZXJmb3JtYW5jZSkNCiAgICAgICAgICAgICAgICBpZiAoIWZsb3dFZGl0b3IudXBkYXRlVGltZW91dCkgew0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNvbm5lY3Rpb25zRm9yTm9kZShub2RlLmlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IudXBkYXRlVGltZW91dCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0sIDE2KTsgLy8gfjYwZnBzDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBoYW5kbGVEb2N1bWVudE1vdXNlVXAoZSkgew0KICAgIC8vIEhhbmRsZSBjYW52YXMgcGFubmluZyBzdG9wDQogICAgaWYgKGZsb3dFZGl0b3IuaXNQYW5uaW5nKSB7DQogICAgICAgIHN0b3BDYW52YXNQYW4oKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICANCiAgICAvLyBIYW5kbGUgdGFnIGRyYWdnaW5nIHN0b3ANCiAgICBpZiAoZmxvd0VkaXRvci5kcmFnZ2luZ1RhZykgew0KICAgICAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmxvd0VkaXRvci5kcmFnZ2luZ1RhZyk7DQogICAgICAgIGlmICh0YWdFbGVtZW50KSB7DQogICAgICAgICAgICB0YWdFbGVtZW50LnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJzsNCiAgICAgICAgICAgIHRhZ0VsZW1lbnQuc3R5bGUuekluZGV4ID0gJzEwMCc7DQogICAgICAgICAgICB0YWdFbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAnYm94LXNoYWRvdyAwLjJzIGVhc2UsIHRyYW5zZm9ybSAwLjJzIGVhc2UnOyAvLyBSZXN0b3JlIHRyYW5zaXRpb25zDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZsb3dFZGl0b3IuZHJhZ2dpbmdUYWcgPSBudWxsOw0KICAgICAgICBmbG93RWRpdG9yLnRhZ0RyYWdPZmZzZXQgPSBudWxsOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGlmIChmbG93RWRpdG9yLmRyYWdnaW5nTm9kZSkgew0KICAgICAgICBjb25zdCBub2RlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZsb3dFZGl0b3IuZHJhZ2dpbmdOb2RlKTsNCiAgICAgICAgaWYgKG5vZGVFbGVtZW50KSB7DQogICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZ3JhYic7DQogICAgICAgICAgICBub2RlRWxlbWVudC5zdHlsZS56SW5kZXggPSAnJzsgLy8gUmVzZXQgei1pbmRleA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBDbGVhciBhbnkgcGVuZGluZyBjb25uZWN0aW9uIHVwZGF0ZXMNCiAgICAgICAgaWYgKGZsb3dFZGl0b3IudXBkYXRlVGltZW91dCkgew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGZsb3dFZGl0b3IudXBkYXRlVGltZW91dCk7DQogICAgICAgICAgICBmbG93RWRpdG9yLnVwZGF0ZVRpbWVvdXQgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBGaW5hbCBjb25uZWN0aW9uIHVwZGF0ZQ0KICAgICAgICB1cGRhdGVDb25uZWN0aW9uc0Zvck5vZGUoZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUpOw0KICAgICAgICANCiAgICAgICAgZmxvd0VkaXRvci5kcmFnZ2luZ05vZGUgPSBudWxsOw0KICAgICAgICBmbG93RWRpdG9yLmRyYWdPZmZzZXQgPSBudWxsOw0KICAgICAgICBmbG93RWRpdG9yLmNhbnZhc1JlY3QgPSBudWxsOw0KICAgIH0NCn0NCg0KDQovLyBFeGFtcGxlOiBjYW52YXMtbWFuYWdlci5qcw0Kd2luZG93LmNhbnZhc01hbmFnZXIgPSB7DQogICAgdXBkYXRlQ2FudmFzVHJhbnNmb3JtLA0KICAgIHN0YXJ0Q2FudmFzUGFuLA0KICAgIHVwZGF0ZUNhbnZhc1BhbiwNCiAgICBzdG9wQ2FudmFzUGFuLA0KICAgIHJlc2V0Q2FudmFzUGFuLA0KICAgIGhhbmRsZUNhbnZhc0NsaWNrLA0KICAgIGhhbmRsZURvY3VtZW50TW91c2VEb3duLA0KICAgIGhhbmRsZURvY3VtZW50TW91c2VNb3ZlLA0KICAgIGhhbmRsZURvY3VtZW50TW91c2VVcCwNCiAgICB6b29tSW4sDQogICAgem9vbU91dCwNCiAgICBzZXRab29tTGV2ZWwsDQogICAgem9vbVRvRml0LA0KICAgIGhhbmRsZU1vdXNlV2hlZWwNCn07DQoNCg0KLy8gQWRkIGEgbmV3IHRhZyBhdCBjdXJyZW50IHZpZXdwb3J0IGNlbnRlcg0KYXN5bmMgZnVuY3Rpb24gYWRkVGFnKCkgew0KICAgIGNvbnN0IHRhZ05hbWUgPSBhd2FpdCBzeXBuZXhBUEkuc2hvd0lucHV0TW9kYWwoDQogICAgICAgICdDcmVhdGUgTmV3IFRhZycsDQogICAgICAgICdUYWcgTmFtZTonLA0KICAgICAgICB7DQogICAgICAgICAgICBwbGFjZWhvbGRlcjogJ0VudGVyIHRhZyBuYW1lJywNCiAgICAgICAgICAgIGNvbmZpcm1UZXh0OiAnQ3JlYXRlIFRhZycsDQogICAgICAgICAgICBjYW5jZWxUZXh0OiAnQ2FuY2VsJywNCiAgICAgICAgICAgIGljb246ICdmYXMgZmEtdGFnJw0KICAgICAgICB9DQogICAgKTsNCiAgICANCiAgICBpZiAoIXRhZ05hbWUgfHwgdGFnTmFtZS50cmltKCkgPT09ICcnKSByZXR1cm47DQoNCiAgICBjb25zdCB0YWdJZCA9IGB0YWdfJHsrK2Zsb3dFZGl0b3IudGFnQ291bnRlcn1gOw0KDQogICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIGF0IGN1cnJlbnQgdmlld3BvcnQgY2VudGVyDQogICAgLy8gR2V0IGNlbnRlciBwb3NpdGlvbiBpbiBjYW52YXMgY29vcmRpbmF0ZXMNCiAgICBjb25zdCBjZW50ZXIgPSB3aW5kb3cuZmxvd0VkaXRvclV0aWxzID8gDQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuZ2V0Vmlld3BvcnRDZW50ZXJJbkNhbnZhcygpIDoNCiAgICAgICAgeyB4OiA1MDAwLCB5OiA1MDAwIH07IC8vIEZhbGxiYWNrIHRvIGNhbnZhcyBjZW50ZXINCg0KICAgIGNvbnN0IHRhZyA9IHsNCiAgICAgICAgaWQ6IHRhZ0lkLA0KICAgICAgICBuYW1lOiB0YWdOYW1lLnRyaW0oKSwNCiAgICAgICAgZGVzY3JpcHRpb246ICcnLA0KICAgICAgICB4OiBjZW50ZXIueCwNCiAgICAgICAgeTogY2VudGVyLnksDQogICAgICAgIGNvbG9yOiAnIzRDQUY1MCcgLy8gR3JlZW4gY29sb3INCiAgICB9Ow0KDQogICAgZmxvd0VkaXRvci50YWdzLnNldCh0YWdJZCwgdGFnKTsNCiAgICBjcmVhdGVUYWdFbGVtZW50KHRhZyk7DQogICAgdXBkYXRlVGFnUGFuZWwoKTsNCg0KfQ0KDQovLyBDcmVhdGUgdGFnIGVsZW1lbnQgb24gY2FudmFzDQpmdW5jdGlvbiBjcmVhdGVUYWdFbGVtZW50KHRhZykgew0KICAgIGNvbnN0IHRhZ0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICB0YWdFbGVtZW50LmlkID0gdGFnLmlkOw0KICAgIHRhZ0VsZW1lbnQuY2xhc3NOYW1lID0gJ2NhbnZhcy10YWcnOw0KICAgIHRhZ0VsZW1lbnQuc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgICBsZWZ0OiAke3RhZy54fXB4Ow0KICAgICAgICB0b3A6ICR7dGFnLnl9cHg7DQogICAgICAgIGJhY2tncm91bmQ6ICR7dGFnLmNvbG9yfTsNCiAgICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgICBwYWRkaW5nOiA0cHggOHB4Ow0KICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4Ow0KICAgICAgICBmb250LXNpemU6IDEycHg7DQogICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgIHotaW5kZXg6IDEwMDsNCiAgICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwwLDAsMC4yKTsNCiAgICAgICAgdHJhbnNpdGlvbjogYm94LXNoYWRvdyAwLjJzIGVhc2UsIHRyYW5zZm9ybSAwLjJzIGVhc2U7DQogICAgYDsNCiAgICB0YWdFbGVtZW50LnRleHRDb250ZW50ID0gdGFnLm5hbWU7DQoNCiAgICAvLyBNYWtlIHRhZyBkcmFnZ2FibGUNCiAgICB0YWdFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiB7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgc3RhcnREcmFnZ2luZ1RhZyh0YWcuaWQsIGUpOw0KICAgIH0pOw0KDQogICAgLy8gQ2xpY2sgdG8ganVtcCB0byB0YWcNCiAgICB0YWdFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgaWYgKCFmbG93RWRpdG9yLmRyYWdnaW5nVGFnKSB7DQogICAgICAgICAgICBqdW1wVG9UYWcodGFnLmlkKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLy8gSG92ZXIgZWZmZWN0cw0KICAgIHRhZ0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHsNCiAgICAgICAgdGFnRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMS4wNSknOw0KICAgICAgICB0YWdFbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9ICcwIDRweCA4cHggcmdiYSgwLDAsMCwwLjMpJzsNCiAgICB9KTsNCg0KICAgIHRhZ0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHsNCiAgICAgICAgdGFnRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMSknOw0KICAgICAgICB0YWdFbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9ICcwIDJweCA0cHggcmdiYSgwLDAsMCwwLjIpJzsNCiAgICB9KTsNCg0KICAgIGZsb3dFZGl0b3IuY2FudmFzLmFwcGVuZENoaWxkKHRhZ0VsZW1lbnQpOw0KfQ0KDQovLyBTdGFydCBkcmFnZ2luZyBhIHRhZw0KZnVuY3Rpb24gc3RhcnREcmFnZ2luZ1RhZyh0YWdJZCwgZSkgew0KICAgIGNvbnN0IHRhZyA9IGZsb3dFZGl0b3IudGFncy5nZXQodGFnSWQpOw0KICAgIGlmICghdGFnKSByZXR1cm47DQoNCiAgICBmbG93RWRpdG9yLmRyYWdnaW5nVGFnID0gdGFnSWQ7DQoNCiAgICAvLyBDYWxjdWxhdGUgb2Zmc2V0IGZyb20gbW91c2UgdG8gdGFnIGNvcm5lciwgYWNjb3VudGluZyBmb3Igem9vbQ0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGZsb3dFZGl0b3IuY2FudmFzLnBhcmVudEVsZW1lbnQ7DQogICAgY29uc3QgY29udGFpbmVyUmVjdCA9ICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KSA/IA0KICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOiANCiAgICAgICAgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIA0KICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gKHR5cGVvZiBzeXBuZXhBUEkgIT09ICd1bmRlZmluZWQnICYmIHN5cG5leEFQSS5nZXRTY2FsZWRNb3VzZUNvb3JkcykgPyANCiAgICAgICAgc3lwbmV4QVBJLmdldFNjYWxlZE1vdXNlQ29vcmRzKGUpIDogDQogICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICANCiAgICAvLyBDb252ZXJ0IG1vdXNlIHBvc2l0aW9uIHRvIGNhbnZhcyBjb29yZGluYXRlcw0KICAgIGNvbnN0IGNhbnZhc01vdXNlWCA9IChtb3VzZUNvb3Jkcy54IC0gY29udGFpbmVyUmVjdC5sZWZ0IC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueCkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICBjb25zdCBjYW52YXNNb3VzZVkgPSAobW91c2VDb29yZHMueSAtIGNvbnRhaW5lclJlY3QudG9wIC0gZmxvd0VkaXRvci5wYW5PZmZzZXQueSkgLyBmbG93RWRpdG9yLnpvb21MZXZlbDsNCiAgICANCiAgICAvLyBDYWxjdWxhdGUgb2Zmc2V0IGluIGNhbnZhcyBjb29yZGluYXRlcw0KICAgIGZsb3dFZGl0b3IudGFnRHJhZ09mZnNldCA9IHsNCiAgICAgICAgeDogKGNhbnZhc01vdXNlWCAtIHRhZy54KSAqIGZsb3dFZGl0b3Iuem9vbUxldmVsLA0KICAgICAgICB5OiAoY2FudmFzTW91c2VZIC0gdGFnLnkpICogZmxvd0VkaXRvci56b29tTGV2ZWwNCiAgICB9Ow0KDQogICAgY29uc3QgdGFnRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhZ0lkKTsNCiAgICB0YWdFbGVtZW50LnN0eWxlLmN1cnNvciA9ICdncmFiYmluZyc7DQogICAgdGFnRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMTAwMSc7DQogICAgdGFnRWxlbWVudC5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnOyAvLyBEaXNhYmxlIHRyYW5zaXRpb25zIGR1cmluZyBkcmFnDQp9DQoNCi8vIEp1bXAgdG8gdGFnIGxvY2F0aW9uDQpmdW5jdGlvbiBqdW1wVG9UYWcodGFnSWQpIHsNCiAgICBjb25zdCB0YWcgPSBmbG93RWRpdG9yLnRhZ3MuZ2V0KHRhZ0lkKTsNCiAgICBpZiAoIXRhZykgcmV0dXJuOw0KDQogICAgLy8gQWRkIHNtb290aCB0cmFuc2l0aW9uDQogICAgZmxvd0VkaXRvci5jYW52YXMuc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC41cyBlYXNlLW91dCc7DQoNCiAgICAvLyBVc2UgdXRpbGl0eSBmdW5jdGlvbiB0byBjZW50ZXIgdmlld3BvcnQgb24gdGFnIGNvb3JkaW5hdGVzDQogICAgaWYgKHdpbmRvdy5mbG93RWRpdG9yVXRpbHMgJiYgd2luZG93LmZsb3dFZGl0b3JVdGlscy5jZW50ZXJWaWV3cG9ydE9uQ2FudmFzKSB7DQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVXRpbHMuY2VudGVyVmlld3BvcnRPbkNhbnZhcyh0YWcueCwgdGFnLnkpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIEZhbGxiYWNrIG1ldGhvZA0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBmbG93RWRpdG9yLmNhbnZhcy5wYXJlbnRFbGVtZW50Ow0KICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICANCiAgICAgICAgY29uc3Qgdmlld3BvcnRDZW50ZXJYID0gY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgICAgIGNvbnN0IHZpZXdwb3J0Q2VudGVyWSA9IGNvbnRhaW5lclJlY3QuaGVpZ2h0IC8gMjsNCiAgICAgICAgDQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnggPSB2aWV3cG9ydENlbnRlclggLSAodGFnLnggKiBmbG93RWRpdG9yLnpvb21MZXZlbCk7DQogICAgICAgIGZsb3dFZGl0b3IucGFuT2Zmc2V0LnkgPSB2aWV3cG9ydENlbnRlclkgLSAodGFnLnkgKiBmbG93RWRpdG9yLnpvb21MZXZlbCk7DQogICAgICAgIA0KICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci51cGRhdGVDYW52YXNUcmFuc2Zvcm0oKTsNCiAgICB9DQoNCiAgICAvLyBSZW1vdmUgdHJhbnNpdGlvbiBhZnRlciBhbmltYXRpb24gY29tcGxldGVzDQogICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGZsb3dFZGl0b3IuY2FudmFzLnN0eWxlLnRyYW5zaXRpb24gPSAnJzsNCiAgICB9LCA1MDApOw0KfQ0KDQovLyBVcGRhdGUgdGFnIHBhbmVsDQpmdW5jdGlvbiB1cGRhdGVUYWdQYW5lbCgpIHsNCiAgICBjb25zdCB0YWdQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWctcGFuZWwnKTsNCiAgICBpZiAoIXRhZ1BhbmVsKSByZXR1cm47DQoNCiAgICBpZiAoZmxvd0VkaXRvci50YWdzLnNpemUgPT09IDApIHsNCiAgICAgICAgdGFnUGFuZWwuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LW11dGVkIj5ObyB0YWdzIHlldDwvcD4nOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IHRhZ0h0bWwgPSAnJzsNCiAgICBmbG93RWRpdG9yLnRhZ3MuZm9yRWFjaCh0YWcgPT4gew0KICAgICAgICB0YWdIdG1sICs9IGANCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhZy1pdGVtIiBkYXRhLXRhZy1pZD0iJHt0YWcuaWR9Ij4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWctY29sb3IiIHN0eWxlPSJiYWNrZ3JvdW5kOiAke3RhZy5jb2xvcn0iPjwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhZy1pbmZvIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFnLW5hbWUiPiR7dGFnLm5hbWV9PC9kaXY+DQogICAgICAgICAgICAgICAgICAgICR7dGFnLmRlc2NyaXB0aW9uID8gYDxkaXYgY2xhc3M9InRhZy1kZXNjcmlwdGlvbiI+JHt0YWcuZGVzY3JpcHRpb259PC9kaXY+YCA6ICcnfQ0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhZy1kZWxldGUiIGRhdGEtdGFnLWlkPSIke3RhZy5pZH0iPg0KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+DQogICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgYDsNCiAgICB9KTsNCg0KICAgIHRhZ1BhbmVsLmlubmVySFRNTCA9IHRhZ0h0bWw7DQoNCiAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzDQogICAgdGFnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLnRhZy1pdGVtJykuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy50YWctZGVsZXRlJykpIHsNCiAgICAgICAgICAgICAgICBjb25zdCB0YWdJZCA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXRhZy1pZCcpOw0KICAgICAgICAgICAgICAgIGp1bXBUb1RhZyh0YWdJZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0pOw0KDQogICAgdGFnUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLnRhZy1kZWxldGUnKS5mb3JFYWNoKGJ0biA9PiB7DQogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgY29uc3QgdGFnSWQgPSBidG4uZ2V0QXR0cmlidXRlKCdkYXRhLXRhZy1pZCcpOw0KICAgICAgICAgICAgZGVsZXRlVGFnKHRhZ0lkKTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQoNCi8vIERlbGV0ZSBhIHRhZw0KYXN5bmMgZnVuY3Rpb24gZGVsZXRlVGFnKHRhZ0lkKSB7DQogICAgY29uc3QgY29uZmlybWVkID0gYXdhaXQgc3lwbmV4QVBJLnNob3dDb25maXJtYXRpb24oDQogICAgICAgICdEZWxldGUgVGFnJywNCiAgICAgICAgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyB0YWc/JywNCiAgICAgICAgew0KICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsDQogICAgICAgICAgICBjb25maXJtVGV4dDogJ0RlbGV0ZScsDQogICAgICAgICAgICBjYW5jZWxUZXh0OiAnQ2FuY2VsJywNCiAgICAgICAgICAgIGljb246ICdmYXMgZmEtdGFnJw0KICAgICAgICB9DQogICAgKTsNCiAgICANCiAgICBpZiAoY29uZmlybWVkKSB7DQogICAgICAgIGNvbnN0IHRhZ0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWdJZCk7DQogICAgICAgIGlmICh0YWdFbGVtZW50KSB7DQogICAgICAgICAgICB0YWdFbGVtZW50LnJlbW92ZSgpOw0KICAgICAgICB9DQogICAgICAgIGZsb3dFZGl0b3IudGFncy5kZWxldGUodGFnSWQpOw0KICAgICAgICB1cGRhdGVUYWdQYW5lbCgpOw0KICAgIH0NCn0NCg0KLy8gRXhhbXBsZTogdGFnLW1hbmFnZXIuanMNCndpbmRvdy50YWdNYW5hZ2VyID0gew0KICAgIGFkZFRhZywNCiAgICBjcmVhdGVUYWdFbGVtZW50LA0KICAgIHN0YXJ0RHJhZ2dpbmdUYWcsDQogICAganVtcFRvVGFnLA0KICAgIHVwZGF0ZVRhZ1BhbmVsLA0KICAgIGRlbGV0ZVRhZw0KfTsNCg0KLy8gU2F2ZSBmbG93IHRvIHZpcnR1YWwgZmlsZSBzeXN0ZW0NCmFzeW5jIGZ1bmN0aW9uIHNhdmVGbG93KCkgew0KICAgIGNvbnN0IGZsb3dEYXRhID0gew0KICAgICAgICBub2RlczogQXJyYXkuZnJvbShmbG93RWRpdG9yLm5vZGVzLnZhbHVlcygpKS5tYXAobm9kZSA9PiAoew0KICAgICAgICAgICAgaWQ6IG5vZGUuaWQsDQogICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsDQogICAgICAgICAgICB4OiBub2RlLngsDQogICAgICAgICAgICB5OiBub2RlLnksDQogICAgICAgICAgICBjb25maWc6IG5vZGUuY29uZmlnDQogICAgICAgIH0pKSwNCiAgICAgICAgY29ubmVjdGlvbnM6IEFycmF5LmZyb20oZmxvd0VkaXRvci5jb25uZWN0aW9ucy52YWx1ZXMoKSkubWFwKGNvbm4gPT4gKHsNCiAgICAgICAgICAgIGlkOiBjb25uLmlkLA0KICAgICAgICAgICAgZnJvbTogY29ubi5mcm9tLA0KICAgICAgICAgICAgdG86IGNvbm4udG8NCiAgICAgICAgfSkpLA0KICAgICAgICB0YWdzOiBBcnJheS5mcm9tKGZsb3dFZGl0b3IudGFncy52YWx1ZXMoKSksDQogICAgICAgIG1ldGFkYXRhOiB7DQogICAgICAgICAgICBzYXZlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksDQogICAgICAgICAgICBub2RlQ291bnQ6IGZsb3dFZGl0b3Iubm9kZXMuc2l6ZSwNCiAgICAgICAgICAgIGNvbm5lY3Rpb25Db3VudDogZmxvd0VkaXRvci5jb25uZWN0aW9ucy5zaXplLA0KICAgICAgICAgICAgdGFnQ291bnQ6IGZsb3dFZGl0b3IudGFncy5zaXplDQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdHJ5IHsNCiAgICAgICAgbGV0IGZpbGVQYXRoID0gZmxvd0VkaXRvci5jdXJyZW50RmlsZVBhdGg7DQogICAgICAgIA0KICAgICAgICAvLyBJZiBubyBjdXJyZW50IGZpbGUgcGF0aCwgc2hvdyBmaWxlIGV4cGxvcmVyDQogICAgICAgIGlmICghZmlsZVBhdGgpIHsNCiAgICAgICAgICAgIGZpbGVQYXRoID0gYXdhaXQgc3lwbmV4QVBJLnNob3dGaWxlRXhwbG9yZXIoew0KICAgICAgICAgICAgICAgIG1vZGU6ICdzYXZlJywNCiAgICAgICAgICAgICAgICB0aXRsZTogJ1NhdmUgRmxvdyBGaWxlJywNCiAgICAgICAgICAgICAgICBpbml0aWFsUGF0aDogJy8nLA0KICAgICAgICAgICAgICAgIGZpbGVOYW1lOiAnZmxvd193b3JrZmxvdy5qc29uJywNCiAgICAgICAgICAgICAgICBmaWxlRXh0ZW5zaW9uOiAnLmpzb24nLA0KICAgICAgICAgICAgICAgIG9uU2VsZWN0OiAoc2VsZWN0ZWRQYXRoKSA9PiB7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4gew0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBpZiAoIWZpbGVQYXRoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBVc2VyIGNhbmNlbGxlZA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU2F2ZSB0byB2aXJ0dWFsIGZpbGUgc3lzdGVtDQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGVKU09OKSB7DQogICAgICAgICAgICBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZUpTT04oZmlsZVBhdGgsIGZsb3dEYXRhKTsNCiAgICAgICAgICAgIGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoID0gZmlsZVBhdGg7DQogICAgICAgICAgICB1cGRhdGVGaWxlbmFtZURpc3BsYXkoKTsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKGBGbG93IHNhdmVkIHRvOiAke2ZpbGVQYXRofWAsICdzdWNjZXNzJyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBGYWxsYmFjayB0byBsb2NhbFN0b3JhZ2UNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdmbG93X2VkaXRvcl9zYXZlZF9mbG93JywgSlNPTi5zdHJpbmdpZnkoZmxvd0RhdGEpKTsNCiAgICAgICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbignRmxvdyBzYXZlZCB0byBsb2NhbCBzdG9yYWdlIScsICdzdWNjZXNzJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBmbG93OicsIGVycm9yKTsNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oJ0ZhaWxlZCB0byBzYXZlIGZsb3c6ICcgKyBlcnJvci5tZXNzYWdlLCAnZXJyb3InKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gU2F2ZSBmbG93IGFzIChhbHdheXMgc2hvdyBmaWxlIGV4cGxvcmVyKQ0KYXN5bmMgZnVuY3Rpb24gc2F2ZUZsb3dBcygpIHsNCiAgICBjb25zdCBmbG93RGF0YSA9IHsNCiAgICAgICAgbm9kZXM6IEFycmF5LmZyb20oZmxvd0VkaXRvci5ub2Rlcy52YWx1ZXMoKSkubWFwKG5vZGUgPT4gKHsNCiAgICAgICAgICAgIGlkOiBub2RlLmlkLA0KICAgICAgICAgICAgdHlwZTogbm9kZS50eXBlLA0KICAgICAgICAgICAgeDogbm9kZS54LA0KICAgICAgICAgICAgeTogbm9kZS55LA0KICAgICAgICAgICAgY29uZmlnOiBub2RlLmNvbmZpZw0KICAgICAgICB9KSksDQogICAgICAgIGNvbm5lY3Rpb25zOiBBcnJheS5mcm9tKGZsb3dFZGl0b3IuY29ubmVjdGlvbnMudmFsdWVzKCkpLm1hcChjb25uID0+ICh7DQogICAgICAgICAgICBpZDogY29ubi5pZCwNCiAgICAgICAgICAgIGZyb206IGNvbm4uZnJvbSwNCiAgICAgICAgICAgIHRvOiBjb25uLnRvDQogICAgICAgIH0pKSwNCiAgICAgICAgdGFnczogQXJyYXkuZnJvbShmbG93RWRpdG9yLnRhZ3MudmFsdWVzKCkpLA0KICAgICAgICBtZXRhZGF0YTogew0KICAgICAgICAgICAgc2F2ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgICAgICAgICAgbm9kZUNvdW50OiBmbG93RWRpdG9yLm5vZGVzLnNpemUsDQogICAgICAgICAgICBjb25uZWN0aW9uQ291bnQ6IGZsb3dFZGl0b3IuY29ubmVjdGlvbnMuc2l6ZSwNCiAgICAgICAgICAgIHRhZ0NvdW50OiBmbG93RWRpdG9yLnRhZ3Muc2l6ZQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHRyeSB7DQogICAgICAgIC8vIFNob3cgZmlsZSBleHBsb3JlciBmb3Igc2F2aW5nDQogICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYXdhaXQgc3lwbmV4QVBJLnNob3dGaWxlRXhwbG9yZXIoew0KICAgICAgICAgICAgbW9kZTogJ3NhdmUnLA0KICAgICAgICAgICAgdGl0bGU6ICdTYXZlIEZsb3cgRmlsZSBBcycsDQogICAgICAgICAgICBpbml0aWFsUGF0aDogJy8nLA0KICAgICAgICAgICAgZmlsZU5hbWU6ICdmbG93X3dvcmtmbG93Lmpzb24nLA0KICAgICAgICAgICAgZmlsZUV4dGVuc2lvbjogJy5qc29uJywNCiAgICAgICAgICAgIG9uU2VsZWN0OiAoc2VsZWN0ZWRQYXRoKSA9PiB7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgb25DYW5jZWw6ICgpID0+IHsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgaWYgKCFmaWxlUGF0aCkgew0KICAgICAgICAgICAgcmV0dXJuOyAvLyBVc2VyIGNhbmNlbGxlZA0KICAgICAgICB9DQoNCiAgICAgICAgLy8gU2F2ZSB0byB2aXJ0dWFsIGZpbGUgc3lzdGVtDQogICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLndyaXRlVmlydHVhbEZpbGVKU09OKSB7DQogICAgICAgICAgICBhd2FpdCBzeXBuZXhBUEkud3JpdGVWaXJ0dWFsRmlsZUpTT04oZmlsZVBhdGgsIGZsb3dEYXRhKTsNCiAgICAgICAgICAgIGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoID0gZmlsZVBhdGg7DQogICAgICAgICAgICB1cGRhdGVGaWxlbmFtZURpc3BsYXkoKTsNCiAgICAgICAgICAgIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKGBGbG93IHNhdmVkIGFzOiAke2ZpbGVQYXRofWAsICdzdWNjZXNzJyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBGYWxsYmFjayB0byBsb2NhbFN0b3JhZ2UNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdmbG93X2VkaXRvcl9zYXZlZF9mbG93JywgSlNPTi5zdHJpbmdpZnkoZmxvd0RhdGEpKTsNCiAgICAgICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbignRmxvdyBzYXZlZCB0byBsb2NhbCBzdG9yYWdlIScsICdzdWNjZXNzJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBmbG93IGFzOicsIGVycm9yKTsNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oJ0ZhaWxlZCB0byBzYXZlIGZsb3cgYXM6ICcgKyBlcnJvci5tZXNzYWdlLCAnZXJyb3InKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gTG9hZCBmbG93IGZyb20gdmlydHVhbCBmaWxlIHN5c3RlbQ0KYXN5bmMgZnVuY3Rpb24gbG9hZEZsb3coKSB7DQogICAgdHJ5IHsNCiAgICAgICAgLy8gU2hvdyBmaWxlIGV4cGxvcmVyIGZvciBsb2FkaW5nDQogICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYXdhaXQgc3lwbmV4QVBJLnNob3dGaWxlRXhwbG9yZXIoew0KICAgICAgICAgICAgbW9kZTogJ29wZW4nLA0KICAgICAgICAgICAgdGl0bGU6ICdMb2FkIEZsb3cgRmlsZScsDQogICAgICAgICAgICBpbml0aWFsUGF0aDogJy8nLA0KICAgICAgICAgICAgb25TZWxlY3Q6IChzZWxlY3RlZFBhdGgpID0+IHsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4gew0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBpZiAoIWZpbGVQYXRoKSB7DQogICAgICAgICAgICByZXR1cm47IC8vIFVzZXIgY2FuY2VsbGVkDQogICAgICAgIH0NCg0KICAgICAgICBsZXQgZmxvd0RhdGEgPSBudWxsOw0KICAgICAgICANCiAgICAgICAgLy8gVHJ5IHZpcnR1YWwgZmlsZSBzeXN0ZW0gZmlyc3QNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkucmVhZFZpcnR1YWxGaWxlSlNPTikgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YSA9IGF3YWl0IHN5cG5leEFQSS5yZWFkVmlydHVhbEZpbGVKU09OKGZpbGVQYXRoKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKHZmc0Vycm9yKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgdmZzRXJyb3I7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsU3RvcmFnZSAoZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpDQogICAgICAgIGlmICghZmxvd0RhdGEpIHsNCiAgICAgICAgICAgIGNvbnN0IGxvY2FsRGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdmbG93X2VkaXRvcl9zYXZlZF9mbG93Jyk7DQogICAgICAgICAgICBpZiAobG9jYWxEYXRhKSB7DQogICAgICAgICAgICAgICAgZmxvd0RhdGEgPSBKU09OLnBhcnNlKGxvY2FsRGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIChmbG93RGF0YSkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDbGVhciBjdXJyZW50IGNhbnZhcyAod2l0aG91dCBjb25maXJtYXRpb24gc2luY2Ugd2UncmUgbG9hZGluZyBhIGZpbGUpDQogICAgICAgICAgICBjbGVhckNhbnZhc1NpbGVudCgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBSZXNldCBwYW4gb2Zmc2V0IHRvIGNlbnRlciBvZiBsYXJnZSBjYW52YXMgZm9yIG5ldyB3b3JrZmxvdw0KICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQgPSB7IHg6IC01MDAwLCB5OiAtNTAwMCB9Ow0KICAgICAgICAgICAgd2luZG93LmNhbnZhc01hbmFnZXIudXBkYXRlQ2FudmFzVHJhbnNmb3JtKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFJlc2V0IG5vZGUgY291bnRlciB0byBhdm9pZCBJRCBjb25mbGljdHMNCiAgICAgICAgICAgIGZsb3dFZGl0b3Iubm9kZUNvdW50ZXIgPSAwOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBMb2FkIG5vZGVzDQogICAgICAgICAgICBpZiAoZmxvd0RhdGEubm9kZXMpIHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YS5ub2Rlcy5mb3JFYWNoKG5vZGVEYXRhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG5vZGUgd2l0aCBwcm9wZXIgSUQNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZUlkID0gbm9kZURhdGEuaWQ7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZDogbm9kZUlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbm9kZURhdGEudHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IG5vZGVEYXRhLngsDQogICAgICAgICAgICAgICAgICAgICAgICB5OiBub2RlRGF0YS55LA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBub2RlRGF0YS5jb25maWcsDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7fQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIG5vZGUgY291bnRlcg0KICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlTnVtID0gcGFyc2VJbnQobm9kZUlkLnJlcGxhY2UoJ25vZGVfJywgJycpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVOdW0gPiBmbG93RWRpdG9yLm5vZGVDb3VudGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLm5vZGVDb3VudGVyID0gbm9kZU51bTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZmxvd0VkaXRvci5ub2Rlcy5zZXQobm9kZUlkLCBub2RlKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBub2RlIGVsZW1lbnQgdXNpbmcgdGhlIHJlbmRlcmVyIGFuZCBhZGQgdG8gY2FudmFzDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVFbGVtZW50ID0gbm9kZVJlbmRlcmVyLmNyZWF0ZU5vZGVFbGVtZW50KG5vZGUpOw0KICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLmNhbnZhcy5hcHBlbmRDaGlsZChub2RlRWxlbWVudCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIExvYWQgY29ubmVjdGlvbnMgYWZ0ZXIgbm9kZXMgYXJlIGZ1bGx5IGNyZWF0ZWQgYW5kIHBvc2l0aW9uZWQNCiAgICAgICAgICAgIGlmIChmbG93RGF0YS5jb25uZWN0aW9ucykgew0KICAgICAgICAgICAgICAgIGZsb3dEYXRhLmNvbm5lY3Rpb25zLmZvckVhY2goY29ubkRhdGEgPT4gew0KICAgICAgICAgICAgICAgICAgICBjcmVhdGVDb25uZWN0aW9uKGNvbm5EYXRhLmZyb20ubm9kZUlkLCBjb25uRGF0YS5mcm9tLnBvcnROYW1lLCBjb25uRGF0YS50by5ub2RlSWQsIGNvbm5EYXRhLnRvLnBvcnROYW1lKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBJbW1lZGlhdGVseSByZWRyYXcgY29ubmVjdGlvbnMgbm93IHRoYXQgYWxsIFNWRyBlbGVtZW50cyBleGlzdA0KICAgICAgICAgICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIExvYWQgdGFncw0KICAgICAgICAgICAgaWYgKGZsb3dEYXRhLnRhZ3MpIHsNCiAgICAgICAgICAgICAgICBmbG93RGF0YS50YWdzLmZvckVhY2godGFnRGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhZyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0YWdEYXRhLmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGFnRGF0YS5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRhZ0RhdGEuZGVzY3JpcHRpb24gfHwgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4OiB0YWdEYXRhLngsDQogICAgICAgICAgICAgICAgICAgICAgICB5OiB0YWdEYXRhLnksDQogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGFnRGF0YS5jb2xvciB8fCAnIzRDQUY1MCcNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWcgY291bnRlcg0KICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdOdW0gPSBwYXJzZUludCh0YWdEYXRhLmlkLnJlcGxhY2UoJ3RhZ18nLCAnJykpOw0KICAgICAgICAgICAgICAgICAgICBpZiAodGFnTnVtID4gZmxvd0VkaXRvci50YWdDb3VudGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmbG93RWRpdG9yLnRhZ0NvdW50ZXIgPSB0YWdOdW07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZsb3dFZGl0b3IudGFncy5zZXQodGFnRGF0YS5pZCwgdGFnKTsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LnRhZ01hbmFnZXIuY3JlYXRlVGFnRWxlbWVudCh0YWcpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgY2VudGVyIG9mIGxvYWRlZCBub2RlcyBhbmQgYWRqdXN0IHBhbiB0byBjZW50ZXIgdGhlbQ0KICAgICAgICAgICAgaWYgKGZsb3dEYXRhLm5vZGVzICYmIGZsb3dEYXRhLm5vZGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBjb25zdCBtaW5YID0gTWF0aC5taW4oLi4uZmxvd0RhdGEubm9kZXMubWFwKG4gPT4gbi54KSk7DQogICAgICAgICAgICAgICAgY29uc3QgbWF4WCA9IE1hdGgubWF4KC4uLmZsb3dEYXRhLm5vZGVzLm1hcChuID0+IG4ueCkpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG1pblkgPSBNYXRoLm1pbiguLi5mbG93RGF0YS5ub2Rlcy5tYXAobiA9PiBuLnkpKTsNCiAgICAgICAgICAgICAgICBjb25zdCBtYXhZID0gTWF0aC5tYXgoLi4uZmxvd0RhdGEubm9kZXMubWFwKG4gPT4gbi55KSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgY29uc3QgY2VudGVyWCA9IChtaW5YICsgbWF4WCkgLyAyOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNlbnRlclkgPSAobWluWSArIG1heFkpIC8gMjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBHZXQgY2FudmFzIGNvbnRhaW5lciBkaW1lbnNpb25zDQogICAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZmxvd0VkaXRvci5jYW52YXMucGFyZW50RWxlbWVudDsNCiAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBwYW4gb2Zmc2V0IHRvIGNlbnRlciB0aGUgbm9kZXMgaW4gdGhlIHZpZXdwb3J0DQogICAgICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueCA9IC1jZW50ZXJYICsgY29udGFpbmVyUmVjdC53aWR0aCAvIDI7DQogICAgICAgICAgICAgICAgZmxvd0VkaXRvci5wYW5PZmZzZXQueSA9IC1jZW50ZXJZICsgY29udGFpbmVyUmVjdC5oZWlnaHQgLyAyOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBGaW5hbCBjb25uZWN0aW9uIHJlZHJhdyBhZnRlciBhbGwgcG9zaXRpb25pbmcgaXMgY29tcGxldGUNCiAgICAgICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWcgcGFuZWwNCiAgICAgICAgICAgIHdpbmRvdy50YWdNYW5hZ2VyLnVwZGF0ZVRhZ1BhbmVsKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFVwZGF0ZSBjdXJyZW50IGZpbGUgcGF0aA0KICAgICAgICAgICAgZmxvd0VkaXRvci5jdXJyZW50RmlsZVBhdGggPSBmaWxlUGF0aDsNCiAgICAgICAgICAgIHVwZGF0ZUZpbGVuYW1lRGlzcGxheSgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS5zaG93Tm90aWZpY2F0aW9uKSB7DQogICAgICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oYEZsb3cgbG9hZGVkIGZyb206ICR7ZmlsZVBhdGh9YCwgJ3N1Y2Nlc3MnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChzeXBuZXhBUEkgJiYgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbignTm8gdmFsaWQgZmxvdyBkYXRhIGZvdW5kIGluIHRoZSBzZWxlY3RlZCBmaWxlLicsICd3YXJuaW5nJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBmbG93OicsIGVycm9yKTsNCiAgICAgICAgaWYgKHN5cG5leEFQSSAmJiBzeXBuZXhBUEkuc2hvd05vdGlmaWNhdGlvbikgew0KICAgICAgICAgICAgc3lwbmV4QVBJLnNob3dOb3RpZmljYXRpb24oJ0ZhaWxlZCB0byBsb2FkIGZsb3c6ICcgKyBlcnJvci5tZXNzYWdlLCAnZXJyb3InKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gVXBkYXRlIGZpbGVuYW1lIGRpc3BsYXkNCmZ1bmN0aW9uIHVwZGF0ZUZpbGVuYW1lRGlzcGxheSgpIHsNCiAgICBjb25zdCBmaWxlbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VycmVudC1maWxlbmFtZScpOw0KICAgIGlmIChmaWxlbmFtZUVsZW1lbnQpIHsNCiAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBmbG93RWRpdG9yLmN1cnJlbnRGaWxlUGF0aCA/IGZsb3dFZGl0b3IuY3VycmVudEZpbGVQYXRoLnNwbGl0KCcvJykucG9wKCkgOiAndW50aXRsZWQuZmxvdyc7DQogICAgICAgIGZpbGVuYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGZpbGVuYW1lOw0KICAgIH0NCn0NCg0KDQovLyBFeHBvcnQgdG8gZ2xvYmFsIHNjb3BlDQp3aW5kb3cuZmlsZU1hbmFnZXIgPSB7DQogICAgc2F2ZUZsb3csDQogICAgc2F2ZUZsb3dBcywNCiAgICBsb2FkRmxvdywNCiAgICB1cGRhdGVGaWxlbmFtZURpc3BsYXkNCn07DQoNCg0KLy8gUG9wdWxhdGUgdG9vbGJveCB3aXRoIGxvYWRlZCBub2Rlcw0KZnVuY3Rpb24gcG9wdWxhdGVUb29sYm94KCkgew0KICAgIGNvbnN0IHRvb2xib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmxvdy10b29sYm94Jyk7DQogICAgaWYgKCF0b29sYm94KSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Rvb2xib3ggbm90IGZvdW5kJyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gQ2xlYXIgZXhpc3RpbmcgdG9vbGJveCBjb250ZW50DQogICAgY29uc3QgdG9vbGJveENvbnRlbnQgPSB0b29sYm94LnF1ZXJ5U2VsZWN0b3IoJy50b29sYm94LWNvbnRlbnQnKTsNCiAgICBpZiAodG9vbGJveENvbnRlbnQpIHsNCiAgICAgICAgdG9vbGJveENvbnRlbnQuaW5uZXJIVE1MID0gJyc7DQogICAgfQ0KICAgIA0KICAgIC8vIEdyb3VwIG5vZGVzIGJ5IGNhdGVnb3J5DQogICAgY29uc3QgY2F0ZWdvcmllcyA9IHt9Ow0KICAgIGNvbnN0IGFsbE5vZGVzID0gbm9kZVJlZ2lzdHJ5LmdldEFsbE5vZGVUeXBlcygpOw0KICAgIA0KICAgIA0KICAgIGFsbE5vZGVzLmZvckVhY2gobm9kZURlZiA9PiB7DQogICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gbm9kZURlZi5jYXRlZ29yeSB8fCAnb3RoZXInOw0KICAgICAgICBpZiAoIWNhdGVnb3JpZXNbY2F0ZWdvcnldKSB7DQogICAgICAgICAgICBjYXRlZ29yaWVzW2NhdGVnb3J5XSA9IFtdOw0KICAgICAgICB9DQogICAgICAgIGNhdGVnb3JpZXNbY2F0ZWdvcnldLnB1c2gobm9kZURlZik7DQogICAgfSk7DQogICAgDQogICAgDQogICAgLy8gQ3JlYXRlIHRvb2xib3ggc2VjdGlvbnMgZm9yIGVhY2ggY2F0ZWdvcnkNCiAgICBPYmplY3QuZW50cmllcyhjYXRlZ29yaWVzKS5mb3JFYWNoKChbY2F0ZWdvcnksIG5vZGVzXSkgPT4gew0KICAgICAgICBjb25zdCBjYXRlZ29yeVNlY3Rpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICAgICAgY2F0ZWdvcnlTZWN0aW9uLmNsYXNzTmFtZSA9ICdub2RlLWNhdGVnb3J5JzsNCiAgICAgICAgY2F0ZWdvcnlTZWN0aW9uLmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDxoNT4ke2NhdGVnb3J5LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgY2F0ZWdvcnkuc2xpY2UoMSl9PC9oNT4NCiAgICAgICAgICAgICR7bm9kZXMubWFwKG5vZGVEZWYgPT4gYA0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRvb2xib3gtbm9kZS1idG4iIGRhdGEtbm9kZS10eXBlPSIke25vZGVEZWYuaWR9IiB0aXRsZT0iJHtub2RlRGVmLmRlc2NyaXB0aW9ufSI+DQogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSIke25vZGVEZWYuaWNvbn0iPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtub2RlRGVmLm5hbWV9PC9zcGFuPg0KICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgYCkuam9pbignJyl9DQogICAgICAgIGA7DQogICAgICAgIA0KICAgICAgICBpZiAodG9vbGJveENvbnRlbnQpIHsNCiAgICAgICAgICAgIHRvb2xib3hDb250ZW50LmFwcGVuZENoaWxkKGNhdGVnb3J5U2VjdGlvbik7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICANCiAgICAvLyBSZS1hdHRhY2ggZXZlbnQgbGlzdGVuZXJzDQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvb2xib3gtbm9kZS1idG4nKS5mb3JFYWNoKGJ0biA9PiB7DQogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBjb25zdCBub2RlVHlwZSA9IGJ0bi5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9kZS10eXBlJyk7DQogICAgICAgICAgICBpZiAobm9kZVR5cGUpIHsNCiAgICAgICAgICAgICAgICBhZGROb2RlKG5vZGVUeXBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSk7DQogICAgDQp9DQoNCi8vIFNldCB1cCBldmVudCBoYW5kbGVycw0KZnVuY3Rpb24gc2V0dXBFdmVudEhhbmRsZXJzKCkgew0KICAgIC8vIE5vdGU6IFRvb2xib3ggbm9kZSBidXR0b24gZXZlbnQgbGlzdGVuZXJzIGFyZSBzZXQgdXAgaW4gcG9wdWxhdGVUb29sYm94KCkNCiAgICAvLyB0byBhdm9pZCBkdXBsaWNhdGVzIHdoZW4gdGhlIHRvb2xib3ggaXMgcmVwb3B1bGF0ZWQNCiAgICANCiAgICAvLyBXb3JrZmxvdyBhY3Rpb25zDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3J1bi13b3JrZmxvdycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJ1bldvcmtmbG93KTsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcC13b3JrZmxvdycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN0b3BXb3JrZmxvdyk7DQogICAgLy8gTm90ZTogZGVsZXRlLXNlbGVjdGVkLCBjbGVhci1jYW52YXMsIHJlc2V0LXZpZXcsIGFuZCBhZGQtdGFnIGFyZSBub3cgaGFuZGxlZCBieSBoYW1idXJnZXIgbWVudQ0KICAgIA0KICAgIC8vIFpvb20gY29udHJvbHMNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbS1pbicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnpvb21Jbik7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb20tb3V0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmNhbnZhc01hbmFnZXIuem9vbU91dCk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb20tZml0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd2luZG93LmNhbnZhc01hbmFnZXIuem9vbVRvRml0KTsNCiAgICANCiAgICAvLyBOb3RlOiBGaWxlIG9wZXJhdGlvbnMgKHNhdmUsIHNhdmUtYXMsIGxvYWQpIGFyZSBub3cgaGFuZGxlZCBieSBoYW1idXJnZXIgbWVudQ0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhci1vdXRwdXQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhck91dHB1dCk7DQogICAgDQogICAgLy8gSGFtYnVyZ2VyIG1lbnUNCiAgICBzZXR1cEhhbWJ1cmdlck1lbnUoKTsNCiAgICANCiAgICAvLyBDb25maWcgcGFuZWwgdG9nZ2xlDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS1jb25maWcnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVDb25maWdQYW5lbCk7DQogICAgDQogICAgLy8gSW5pdGlhbGl6ZSBjb25maWcgcGFuZWwgc3RhdGUgKHdpdGhvdXQgb3ZlcnJpZGluZyBpY29ucykNCiAgICBjb25zdCBjb25maWdQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmbG93LWNvbmZpZy1wYW5lbCcpOw0KICAgIGlmIChjb25maWdQYW5lbCkgew0KICAgICAgICAvLyBEZWZhdWx0IGV4cGFuZGVkIChub3QgY29sbGFwc2VkKQ0KICAgICAgICBjb25maWdQYW5lbC5jbGFzc0xpc3QucmVtb3ZlKCdjb2xsYXBzZWQnKTsNCiAgICB9DQogICAgDQogICAgLy8gVG9vbGJveCB0b2dnbGUNCiAgICBjb25zdCB0b29sYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zsb3ctdG9vbGJveCcpOw0KICAgIGNvbnN0IHRvb2xib3hDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rvb2xib3gtY29udGVudCcpOw0KICAgIGNvbnN0IHRvZ2dsZVRvb2xib3hCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXRvb2xib3gnKTsNCiAgICBpZiAodG9vbGJveCAmJiB0b29sYm94Q29udGVudCAmJiB0b2dnbGVUb29sYm94QnRuKSB7DQogICAgICAgIC8vIERlZmF1bHQgZXhwYW5kZWQgKG5vdCBjb2xsYXBzZWQpDQogICAgICAgIHRvb2xib3guY2xhc3NMaXN0LnJlbW92ZSgnY29sbGFwc2VkJyk7DQogICAgICAgIHRvb2xib3hDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnJzsNCg0KICAgICAgICB0b2dnbGVUb29sYm94QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICB0b2dnbGVUb29sYm94KCk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICANCiAgICAvLyBPdXRwdXQgcGFuZWwgdG9nZ2xlDQogICAgY29uc3Qgb3V0cHV0UGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvdy1vdXRwdXQtcGFuZWwnKTsNCiAgICBjb25zdCBvdXRwdXRDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ291dHB1dC1jb250ZW50Jyk7DQogICAgY29uc3QgdG9nZ2xlT3V0cHV0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS1vdXRwdXQnKTsNCiAgICBpZiAob3V0cHV0UGFuZWwgJiYgb3V0cHV0Q29udGVudCAmJiB0b2dnbGVPdXRwdXRCdG4pIHsNCiAgICAgICAgLy8gRGVmYXVsdCBjb2xsYXBzZWQNCiAgICAgICAgb3V0cHV0UGFuZWwuY2xhc3NMaXN0LmFkZCgnY29sbGFwc2VkJyk7DQogICAgICAgIG91dHB1dENvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgdG9nZ2xlT3V0cHV0QnRuLnF1ZXJ5U2VsZWN0b3IoJ2knKS5jbGFzc05hbWUgPSAnZmFzIGZhLWNoZXZyb24tZG93bic7DQoNCiAgICAgICAgdG9nZ2xlT3V0cHV0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICBjb25zdCBpc0NvbGxhcHNlZCA9IG91dHB1dFBhbmVsLmNsYXNzTGlzdC5jb250YWlucygnY29sbGFwc2VkJyk7DQogICAgICAgICAgICBpZiAoaXNDb2xsYXBzZWQpIHsNCiAgICAgICAgICAgICAgICBvdXRwdXRQYW5lbC5jbGFzc0xpc3QucmVtb3ZlKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgICAgICAgICBvdXRwdXRDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnJzsNCiAgICAgICAgICAgICAgICB0b2dnbGVPdXRwdXRCdG4ucXVlcnlTZWxlY3RvcignaScpLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi11cCc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG91dHB1dFBhbmVsLmNsYXNzTGlzdC5hZGQoJ2NvbGxhcHNlZCcpOw0KICAgICAgICAgICAgICAgIG91dHB1dENvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgICB0b2dnbGVPdXRwdXRCdG4ucXVlcnlTZWxlY3RvcignaScpLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1kb3duJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIA0KICAgIC8vIENhbnZhcyBldmVudHMNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLmhhbmRsZUNhbnZhc0NsaWNrKTsNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB3aW5kb3cuY2FudmFzTWFuYWdlci5zdGFydENhbnZhc1Bhbik7DQogICAgZmxvd0VkaXRvci5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignd2hlZWwnLCB3aW5kb3cuY2FudmFzTWFuYWdlci5oYW5kbGVNb3VzZVdoZWVsLCB7IHBhc3NpdmU6IGZhbHNlIH0pOw0KICAgIA0KICAgIC8vIERvY3VtZW50LWxldmVsIG1vdXNlIGV2ZW50cyBmb3Igc21vb3RoIGRyYWdnaW5nIGFuZCBwYW5uaW5nDQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgd2luZG93LmNhbnZhc01hbmFnZXIuaGFuZGxlRG9jdW1lbnRNb3VzZURvd24pOw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHdpbmRvdy5jYW52YXNNYW5hZ2VyLmhhbmRsZURvY3VtZW50TW91c2VNb3ZlKTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgd2luZG93LmNhbnZhc01hbmFnZXIuaGFuZGxlRG9jdW1lbnRNb3VzZVVwKTsNCiAgICANCiAgICAvLyBLZXlib2FyZCBzaG9ydGN1dHMNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlS2V5RG93bik7DQp9DQoNCi8vIFRvZ2dsZSBjb25maWcgcGFuZWwNCmZ1bmN0aW9uIHRvZ2dsZUNvbmZpZ1BhbmVsKCkgew0KICAgIGNvbnN0IGNvbmZpZ1BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zsb3ctY29uZmlnLXBhbmVsJyk7DQogICAgY29uc3QgdG9nZ2xlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS1jb25maWcnKTsNCiAgICBjb25zdCBpY29uID0gdG9nZ2xlQnRuLnF1ZXJ5U2VsZWN0b3IoJ2knKTsNCiAgICANCiAgICBpZiAoY29uZmlnUGFuZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2xsYXBzZWQnKSkgew0KICAgICAgICAvLyBFeHBhbmQNCiAgICAgICAgY29uZmlnUGFuZWwuY2xhc3NMaXN0LnJlbW92ZSgnY29sbGFwc2VkJyk7DQogICAgICAgIGljb24uY2xhc3NOYW1lID0gJ2ZhcyBmYS1jaGV2cm9uLXJpZ2h0JzsNCiAgICAgICAgdG9nZ2xlQnRuLnRpdGxlID0gJ0NvbGxhcHNlIENvbmZpZ3VyYXRpb24gUGFuZWwnOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIENvbGxhcHNlDQogICAgICAgIGNvbmZpZ1BhbmVsLmNsYXNzTGlzdC5hZGQoJ2NvbGxhcHNlZCcpOw0KICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1sZWZ0JzsNCiAgICAgICAgdG9nZ2xlQnRuLnRpdGxlID0gJ0V4cGFuZCBDb25maWd1cmF0aW9uIFBhbmVsJzsNCiAgICB9DQp9DQoNCi8vIFRvZ2dsZSB0b29sYm94DQpmdW5jdGlvbiB0b2dnbGVUb29sYm94KCkgew0KICAgIGNvbnN0IHRvb2xib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvdy10b29sYm94Jyk7DQogICAgY29uc3QgdG9vbGJveENvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9vbGJveC1jb250ZW50Jyk7DQogICAgY29uc3QgdG9nZ2xlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZS10b29sYm94Jyk7DQogICAgY29uc3QgaWNvbiA9IHRvZ2dsZUJ0bi5xdWVyeVNlbGVjdG9yKCdpJyk7DQogICAgDQogICAgaWYgKHRvb2xib3guY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2xsYXBzZWQnKSkgew0KICAgICAgICAvLyBFeHBhbmQNCiAgICAgICAgdG9vbGJveC5jbGFzc0xpc3QucmVtb3ZlKCdjb2xsYXBzZWQnKTsNCiAgICAgICAgdG9vbGJveENvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICcnOw0KICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmYXMgZmEtY2hldnJvbi1sZWZ0JzsNCiAgICAgICAgdG9nZ2xlQnRuLnRpdGxlID0gJ0NvbGxhcHNlIFRvb2xib3gnOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIENvbGxhcHNlDQogICAgICAgIHRvb2xib3guY2xhc3NMaXN0LmFkZCgnY29sbGFwc2VkJyk7DQogICAgICAgIHRvb2xib3hDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIGljb24uY2xhc3NOYW1lID0gJ2ZhcyBmYS1jaGV2cm9uLXJpZ2h0JzsNCiAgICAgICAgdG9nZ2xlQnRuLnRpdGxlID0gJ0V4cGFuZCBUb29sYm94JzsNCiAgICB9DQp9DQoNCi8vIFNldHVwIGhhbWJ1cmdlciBtZW51IGZ1bmN0aW9uYWxpdHkNCmZ1bmN0aW9uIHNldHVwSGFtYnVyZ2VyTWVudSgpIHsNCiAgICBjb25zdCBoYW1idXJnZXJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFtYnVyZ2VyLW1lbnUnKTsNCiAgICBjb25zdCBkcm9wZG93bk1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd24tbWVudScpOw0KICAgIA0KICAgIGlmICghaGFtYnVyZ2VyQnRuIHx8ICFkcm9wZG93bk1lbnUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignSGFtYnVyZ2VyIG1lbnUgZWxlbWVudHMgbm90IGZvdW5kJyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gVG9nZ2xlIG1lbnUgb24gaGFtYnVyZ2VyIGNsaWNrDQogICAgaGFtYnVyZ2VyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsNCiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgDQogICAgICAgIC8vIFBvc2l0aW9uIHRoZSBkcm9wZG93biByZWxhdGl2ZSB0byB0aGUgaGFtYnVyZ2VyIGJ1dHRvbg0KICAgICAgICBpZiAoIWRyb3Bkb3duTWVudS5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSkgew0KICAgICAgICAgICAgLy8gVXNlIHNjYWxlZCBtb3VzZSBjb29yZGluYXRlcyBmb3IgbW9yZSBpbnR1aXRpdmUgcG9zaXRpb25pbmcNCiAgICAgICAgICAgIGNvbnN0IG1vdXNlQ29vcmRzID0gKHR5cGVvZiBzeXBuZXhBUEkgIT09ICd1bmRlZmluZWQnICYmIHN5cG5leEFQSS5nZXRTY2FsZWRNb3VzZUNvb3JkcykgPyANCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkTW91c2VDb29yZHMoZSkgOg0KICAgICAgICAgICAgICAgIHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gaGFtYnVyZ2VyQnRuLmNsb3Nlc3QoJy5mbG93LWVkaXRvciwgLmFwcC1jb250YWluZXInKTsNCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSAodHlwZW9mIHN5cG5leEFQSSAhPT0gJ3VuZGVmaW5lZCcgJiYgc3lwbmV4QVBJLmdldFNjYWxlZEJvdW5kaW5nQ2xpZW50UmVjdCAmJiBjb250YWluZXIpID8NCiAgICAgICAgICAgICAgICBzeXBuZXhBUEkuZ2V0U2NhbGVkQm91bmRpbmdDbGllbnRSZWN0KGNvbnRhaW5lcikgOg0KICAgICAgICAgICAgICAgIChjb250YWluZXIgPyBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiB7IHRvcDogMCwgbGVmdDogMCB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gUG9zaXRpb24gcmVsYXRpdmUgdG8gbW91c2UgY2xpY2ssIG9mZnNldCBzbGlnaHRseSB0byBhdm9pZCBjb3ZlcmluZyB0aGUgYnV0dG9uDQogICAgICAgICAgICBjb25zdCByZWxhdGl2ZVRvcCA9IG1vdXNlQ29vcmRzLnkgLSBjb250YWluZXJSZWN0LnRvcCArIDU7DQogICAgICAgICAgICBjb25zdCByZWxhdGl2ZUxlZnQgPSBtb3VzZUNvb3Jkcy54IC0gY29udGFpbmVyUmVjdC5sZWZ0IC0gMTgwIC0gMTAgKyAyMDsgLy8gTWVudSB3aWR0aCArIHNtYWxsIGdhcCwgdGhlbiAyMHB4IG1vcmUgdG8gdGhlIHJpZ2h0DQogICAgICAgICAgICANCiAgICAgICAgICAgIGRyb3Bkb3duTWVudS5zdHlsZS50b3AgPSByZWxhdGl2ZVRvcCArICdweCc7DQogICAgICAgICAgICBkcm9wZG93bk1lbnUuc3R5bGUubGVmdCA9IHJlbGF0aXZlTGVmdCArICdweCc7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGRyb3Bkb3duTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7DQogICAgfSk7DQogICAgDQogICAgLy8gQ2xvc2UgbWVudSB3aGVuIGNsaWNraW5nIG91dHNpZGUNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7DQogICAgICAgIGlmICghZHJvcGRvd25NZW51LmNvbnRhaW5zKGUudGFyZ2V0KSAmJiAhaGFtYnVyZ2VyQnRuLmNvbnRhaW5zKGUudGFyZ2V0KSkgew0KICAgICAgICAgICAgZHJvcGRvd25NZW51LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIA0KICAgIC8vIEhhbmRsZSBtZW51IGl0ZW0gY2xpY2tzIC0gT05MWSB0aGUgc3BlY2lmaWMgYWN0aW9ucyByZXF1ZXN0ZWQNCiAgICBkcm9wZG93bk1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gew0KICAgICAgICBjb25zdCBtZW51SXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5tZW51LWl0ZW0nKTsNCiAgICAgICAgaWYgKCFtZW51SXRlbSkgcmV0dXJuOw0KICAgICAgICANCiAgICAgICAgY29uc3QgYWN0aW9uID0gbWVudUl0ZW0uZGF0YXNldC5hY3Rpb247DQogICAgICAgIGlmICghYWN0aW9uKSByZXR1cm47DQogICAgICAgIA0KICAgICAgICAvLyBDbG9zZSB0aGUgbWVudQ0KICAgICAgICBkcm9wZG93bk1lbnUuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOw0KICAgICAgICANCiAgICAgICAgLy8gRXhlY3V0ZSBPTkxZIHRoZSByZXF1ZXN0ZWQgYWN0aW9uczogc2F2ZSwgc2F2ZS1hcywgbG9hZCwgZGVsZXRlLCBjbGVhci1hbGwsIHJlc2V0LXZpZXcsIGFkZC10YWcNCiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsNCiAgICAgICAgICAgIGNhc2UgJ3NhdmUtZmxvdyc6DQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5maWxlTWFuYWdlciAmJiB3aW5kb3cuZmlsZU1hbmFnZXIuc2F2ZUZsb3cpIHsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZpbGVNYW5hZ2VyLnNhdmVGbG93KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnc2F2ZS1mbG93LWFzJzoNCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZpbGVNYW5hZ2VyICYmIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvd0FzKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5maWxlTWFuYWdlci5zYXZlRmxvd0FzKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnbG9hZC1mbG93JzoNCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZpbGVNYW5hZ2VyICYmIHdpbmRvdy5maWxlTWFuYWdlci5sb2FkRmxvdykgew0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmlsZU1hbmFnZXIubG9hZEZsb3coKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhZGQtdGFnJzoNCiAgICAgICAgICAgICAgICBpZiAod2luZG93LnRhZ01hbmFnZXIgJiYgd2luZG93LnRhZ01hbmFnZXIuYWRkVGFnKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy50YWdNYW5hZ2VyLmFkZFRhZygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3Jlc2V0LXZpZXcnOg0KICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuY2FudmFzTWFuYWdlciAmJiB3aW5kb3cuY2FudmFzTWFuYWdlci5yZXNldENhbnZhc1Bhbikgew0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2FudmFzTWFuYWdlci5yZXNldENhbnZhc1BhbigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZS1zZWxlY3RlZCc6DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkZWxldGVTZWxlY3RlZE5vZGUgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlU2VsZWN0ZWROb2RlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnY2xlYXItY2FudmFzJzoNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNsZWFyQ2FudmFzID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgICAgIGNsZWFyQ2FudmFzKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCi8vIEV4YW1wbGU6IHVpLW1hbmFnZXIuanMNCndpbmRvdy51aU1hbmFnZXIgPSB7DQogICAgcG9wdWxhdGVUb29sYm94LA0KICAgIHNldHVwRXZlbnRIYW5kbGVycywNCiAgICB0b2dnbGVDb25maWdQYW5lbCwNCiAgICB0b2dnbGVUb29sYm94DQp9Ow0KDQovLyBtYWluLmpzIC0gRW50cnkgcG9pbnQgZm9yIEZsb3cgRWRpdG9yDQoNCi8vIEdsb2JhbCB2YXJpYWJsZXMgKHNjb3BlZCB0byBhdm9pZCBnbG9iYWwgcG9sbHV0aW9uKQ0KbGV0IGZsb3dFZGl0b3IgPSB7DQogICAgbm9kZXM6IG5ldyBNYXAoKSwNCiAgICBjb25uZWN0aW9uczogbmV3IE1hcCgpLA0KICAgIHNlbGVjdGVkTm9kZTogbnVsbCwNCiAgICBkcmFnZ2luZ05vZGU6IG51bGwsDQogICAgY29ubmVjdGluZ0Zyb206IG51bGwsDQogICAgY2FudmFzOiBudWxsLA0KICAgIG5vZGVDb3VudGVyOiAwLA0KICAgIGlzUnVubmluZzogZmFsc2UsDQogICAgY3VycmVudEZpbGVQYXRoOiBudWxsLA0KICAgIGlzQWN0aXZlOiB0cnVlLA0KICAgIC8vIENhbnZhcyBwYW5uaW5nIHN0YXRlDQogICAgaXNQYW5uaW5nOiBmYWxzZSwNCiAgICBwYW5TdGFydDogeyB4OiAwLCB5OiAwIH0sDQogICAgcGFuT2Zmc2V0OiB7IHg6IC01MDAwLCB5OiAtNTAwMCB9LCAvLyBDZW50ZXIgdGhlIGxhcmdlIGNhbnZhcyBpbml0aWFsbHkNCiAgICBsYXN0UGFuT2Zmc2V0OiB7IHg6IC01MDAwLCB5OiAtNTAwMCB9LA0KICAgIC8vIFpvb20gc3RhdGUNCiAgICB6b29tTGV2ZWw6IDEuMCwNCiAgICBtaW5ab29tOiAwLjEsDQogICAgbWF4Wm9vbTogMy4wLA0KICAgIHpvb21TdGVwOiAwLjEsDQogICAgLy8gVGFnIHN5c3RlbQ0KICAgIHRhZ3M6IG5ldyBNYXAoKSwNCiAgICB0YWdDb3VudGVyOiAwLA0KICAgIGRyYWdnaW5nVGFnOiBudWxsLA0KICAgIHRhZ0RyYWdPZmZzZXQ6IG51bGwsDQogICAgdGFnVXBkYXRlVGltZW91dDogbnVsbA0KfTsNCg0KLy8gSW5pdGlhbGl6ZSB3aGVuIERPTSBpcyByZWFkeQ0KYXN5bmMgZnVuY3Rpb24gaW5pdEZsb3dFZGl0b3IoKSB7DQogICAgDQogICAgLy8gQ2hlY2sgaWYgU3lwbmV4QVBJIGlzIGF2YWlsYWJsZSAobG9jYWwgdmFyaWFibGUgaW4gc2FuZGJveGVkIGVudmlyb25tZW50KQ0KICAgIGlmICh0eXBlb2Ygc3lwbmV4QVBJID09PSAndW5kZWZpbmVkJyB8fCAhc3lwbmV4QVBJKSB7DQogICAgICAgIGNvbnNvbGUud2FybignU3lwbmV4QVBJIG5vdCBhdmFpbGFibGUgLSBydW5uaW5nIGluIHN0YW5kYWxvbmUgbW9kZScpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgDQogICAgLy8gSW5pdGlhbGl6ZSBzY2FsZSBkZXRlY3Rpb24gZm9yIGFwcCBzY2FsaW5nIGNvbXBlbnNhdGlvbg0KICAgIGlmICh0eXBlb2Ygc3lwbmV4QVBJICE9PSAndW5kZWZpbmVkJyAmJiBzeXBuZXhBUEkuaW5pdFNjYWxlRGV0ZWN0aW9uKSB7DQogICAgICAgIHN5cG5leEFQSS5pbml0U2NhbGVEZXRlY3Rpb24oKG5ld1NjYWxlLCBvbGRTY2FsZSkgPT4gew0KICAgICAgICAgICAgLy8gUmVkcmF3IGNvbm5lY3Rpb25zIHdoZW4gc2NhbGUgY2hhbmdlcw0KICAgICAgICAgICAgaWYgKHR5cGVvZiByZWRyYXdBbGxDb25uZWN0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgICAgICAgIHJlZHJhd0FsbENvbm5lY3Rpb25zKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICANCiAgICAvLyBUZXN0IFZGUyBBUEkNCiAgICB0cnkgew0KICAgICAgICBjb25zdCB0ZXN0UmVzdWx0ID0gYXdhaXQgc3lwbmV4QVBJLmxpc3RWaXJ0dWFsRmlsZXMoJy8nKTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdWRlMgQVBJIHRlc3QgZmFpbGVkOicsIGVycm9yKTsNCiAgICB9DQogICAgDQogICAgLy8gSW5pdGlhbGl6ZSBjYW52YXMNCiAgICBmbG93RWRpdG9yLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmbG93LWNhbnZhcycpOw0KICAgIGlmICghZmxvd0VkaXRvci5jYW52YXMpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignRmxvdyBjYW52YXMgbm90IGZvdW5kJyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgLy8gQ3JlYXRlIFNWRyBtYXJrZXIgZGVmaW5pdGlvbnMgZm9yIGNvbm5lY3Rpb24gYXJyb3dzDQogICAgY29uc3QgZGVmcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnZGVmcycpOw0KICAgIGNvbnN0IG1hcmtlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbWFya2VyJyk7DQogICAgbWFya2VyLnNldEF0dHJpYnV0ZSgnaWQnLCAnYXJyb3doZWFkJyk7DQogICAgbWFya2VyLnNldEF0dHJpYnV0ZSgnbWFya2VyV2lkdGgnLCAnMTAnKTsNCiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKCdtYXJrZXJIZWlnaHQnLCAnNycpOw0KICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoJ3JlZlgnLCAnOScpOw0KICAgIG1hcmtlci5zZXRBdHRyaWJ1dGUoJ3JlZlknLCAnMy41Jyk7DQogICAgbWFya2VyLnNldEF0dHJpYnV0ZSgnb3JpZW50JywgJ2F1dG8nKTsNCiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKCdtYXJrZXJVbml0cycsICdzdHJva2VXaWR0aCcpOw0KICAgIA0KICAgIGNvbnN0IHBvbHlnb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BvbHlnb24nKTsNCiAgICBwb2x5Z29uLnNldEF0dHJpYnV0ZSgncG9pbnRzJywgJzAgMCwgMTAgMy41LCAwIDcnKTsNCiAgICBwb2x5Z29uLnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjNENBRjUwJyk7DQogICAgDQogICAgbWFya2VyLmFwcGVuZENoaWxkKHBvbHlnb24pOw0KICAgIGRlZnMuYXBwZW5kQ2hpbGQobWFya2VyKTsNCiAgICANCiAgICAvLyBDcmVhdGUgYSB0ZW1wb3JhcnkgU1ZHIGNvbnRhaW5lciBmb3IgdGhlIG1hcmtlciBkZWZpbml0aW9uDQogICAgY29uc3QgbWFya2VyU3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTsNCiAgICBtYXJrZXJTdmcuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOw0KICAgIG1hcmtlclN2Zy5zdHlsZS53aWR0aCA9ICcwJzsNCiAgICBtYXJrZXJTdmcuc3R5bGUuaGVpZ2h0ID0gJzAnOw0KICAgIG1hcmtlclN2Zy5hcHBlbmRDaGlsZChkZWZzKTsNCiAgICBmbG93RWRpdG9yLmNhbnZhcy5hcHBlbmRDaGlsZChtYXJrZXJTdmcpOw0KICAgIA0KICAgIC8vIEluaXRpYWxpemUgY2FudmFzIHRyYW5zZm9ybSBmb3IgcGFubmluZw0KICAgIHdpbmRvdy5jYW52YXNNYW5hZ2VyLnVwZGF0ZUNhbnZhc1RyYW5zZm9ybSgpOw0KICAgIA0KICAgIC8vIExvYWQgbm9kZXMgZnJvbSBWRlMNCiAgICBhd2FpdCBub2RlUmVnaXN0cnkubG9hZE5vZGVzRnJvbVZGUygpOw0KICAgIA0KICAgIC8vIFBvcHVsYXRlIHRvb2xib3ggd2l0aCBsb2FkZWQgbm9kZXMNCiAgICB3aW5kb3cudWlNYW5hZ2VyLnBvcHVsYXRlVG9vbGJveCgpOw0KICAgIA0KICAgIC8vIFNldCB1cCBldmVudCBoYW5kbGVycw0KICAgIHdpbmRvdy51aU1hbmFnZXIuc2V0dXBFdmVudEhhbmRsZXJzKCk7DQogICAgDQogICAgLy8gQ29ubmVjdCB0byBXZWJTb2NrZXQgZm9yIHJlYWwtdGltZSB1cGRhdGVzDQogICAgY29ubmVjdFdlYlNvY2tldCgpOw0KICAgIA0KICAgIC8vIEhhbmRsZSB3aW5kb3cgcmVzaXplIHRvIHVwZGF0ZSBjb25uZWN0aW9ucw0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7DQogICAgICAgIHNldFRpbWVvdXQocmVkcmF3QWxsQ29ubmVjdGlvbnMsIDEwMCk7DQogICAgfSk7DQogICAgDQogICAgLy8gSGFuZGxlIGFwcCBjbGVhbnVwIHdoZW4gd2luZG93IGlzIHVubG9hZGVkDQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGNsZWFudXBGbG93RWRpdG9yKTsNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncGFnZWhpZGUnLCBjbGVhbnVwRmxvd0VkaXRvcik7DQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3VubG9hZCcsIGNsZWFudXBGbG93RWRpdG9yKTsNCiAgICANCiAgICAvLyBGbG93IEVkaXRvciBsb2FkZWQgc3VjY2Vzc2Z1bGx5IChubyBub3RpZmljYXRpb24gbmVlZGVkKQ0KICAgIA0KICAgIC8vIFVwZGF0ZSBmaWxlbmFtZSBkaXNwbGF5DQogICAgd2luZG93LmZpbGVNYW5hZ2VyLnVwZGF0ZUZpbGVuYW1lRGlzcGxheSgpOw0KICAgIA0KfQ0KDQovLyBDbGVhbnVwIGZ1bmN0aW9uIHRvIHJlbW92ZSB0b29sdGlwcyBhbmQgZXZlbnQgbGlzdGVuZXJzDQpmdW5jdGlvbiBjbGVhbnVwRmxvd0VkaXRvcigpIHsNCiAgICAvLyBNYXJrIGFwcCBhcyBpbmFjdGl2ZSB0byBwcmV2ZW50IG5ldyB0b29sdGlwcw0KICAgIGZsb3dFZGl0b3IuaXNBY3RpdmUgPSBmYWxzZTsNCiAgICANCiAgICAvLyBSZW1vdmUgYW55IGxpbmdlcmluZyB0b29sdGlwcyAoY2hlY2sgbXVsdGlwbGUgcG9zc2libGUgbG9jYXRpb25zKQ0KICAgIGNvbnN0IHRvb2x0aXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbm5lY3Rpb24tdG9vbHRpcCwgI2Nvbm5lY3Rpb24tdG9vbHRpcCcpOw0KICAgIHRvb2x0aXBzLmZvckVhY2godG9vbHRpcCA9PiB7DQogICAgICAgIGlmICh0b29sdGlwLnBhcmVudE5vZGUpIHsNCiAgICAgICAgICAgIHRvb2x0aXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0b29sdGlwKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIA0KICAgIC8vIFJlbW92ZSBnbG9iYWwgZXZlbnQgbGlzdGVuZXJzDQogICAgaWYgKHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIpIHsNCiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcik7DQogICAgICAgIHdpbmRvdy5mbG93RWRpdG9yVG9vbHRpcEhhbmRsZXIgPSBudWxsOw0KICAgIH0NCiAgICANCiAgICAvLyBDbGVhciBhbnkgb3RoZXIgZ2xvYmFsIHJlZmVyZW5jZXMNCiAgICBpZiAod2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcikgew0KICAgICAgICBkZWxldGUgd2luZG93LmZsb3dFZGl0b3JUb29sdGlwSGFuZGxlcjsNCiAgICB9DQogICAgDQogICAgLy8gQWxzbyByZW1vdmUgYW55IHRvb2x0aXBzIHRoYXQgbWlnaHQgYmUgaW4gdGhlIGJvZHkNCiAgICBjb25zdCBib2R5VG9vbHRpcHMgPSBkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb25uZWN0aW9uLXRvb2x0aXAnKTsNCiAgICBib2R5VG9vbHRpcHMuZm9yRWFjaCh0b29sdGlwID0+IHsNCiAgICAgICAgaWYgKHRvb2x0aXAucGFyZW50Tm9kZSkgew0KICAgICAgICAgICAgdG9vbHRpcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRvb2x0aXApOw0KICAgICAgICB9DQogICAgfSk7DQogICAgDQp9DQoNCi8vIENvbm5lY3QgdG8gV2ViU29ja2V0IHNlcnZlcg0KYXN5bmMgZnVuY3Rpb24gY29ubmVjdFdlYlNvY2tldCgpIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBjb25uZWN0ZWQgPSBhd2FpdCBzeXBuZXhBUEkuY29ubmVjdFNvY2tldCgpOw0KICAgICAgICBpZiAoY29ubmVjdGVkKSB7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEpvaW4gZmxvdyBlZGl0b3Igcm9vbQ0KICAgICAgICAgICAgc3lwbmV4QVBJLmpvaW5Sb29tKCdmbG93LWVkaXRvcicpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIG1lc3NhZ2VzDQogICAgICAgICAgICBzeXBuZXhBUEkub24oJ2Zsb3dfdXBkYXRlJywgKGRhdGEpID0+IHsNCiAgICAgICAgICAgICAgICBoYW5kbGVGbG93VXBkYXRlKGRhdGEpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFNlbmQgaW5pdGlhbCBjb25uZWN0aW9uIG1lc3NhZ2UNCiAgICAgICAgICAgIHN5cG5leEFQSS5zZW5kTWVzc2FnZSgnZmxvd19jb25uZWN0ZWQnLCB7DQogICAgICAgICAgICAgICAgYXBwSWQ6IHN5cG5leEFQSS5nZXRBcHBJZCgpLA0KICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQ0KICAgICAgICAgICAgfSwgJ2Zsb3ctZWRpdG9yJyk7DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIFdlYlNvY2tldCBzZXJ2ZXInKTsNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBjb25uZWN0aW9uIGVycm9yOicsIGVycm9yKTsNCiAgICB9DQp9DQoNCi8vIEFkZCBhIG5ldyBub2RlIHRvIHRoZSBjYW52YXMgKGR5bmFtaWMgdmVyc2lvbikNCmZ1bmN0aW9uIGFkZE5vZGUodHlwZSkgew0KICAgIGNvbnN0IG5vZGVEZWYgPSBub2RlUmVnaXN0cnkuZ2V0Tm9kZVR5cGUodHlwZSk7DQogICAgaWYgKCFub2RlRGVmKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Vua25vd24gbm9kZSB0eXBlOicsIHR5cGUpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIA0KICAgIGNvbnN0IG5vZGVJZCA9IGBub2RlXyR7KytmbG93RWRpdG9yLm5vZGVDb3VudGVyfWA7DQogICAgDQogICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIHJlbGF0aXZlIHRvIGN1cnJlbnQgdmlld3BvcnQgY2VudGVyDQogICAgY29uc3QgY2VudGVyID0gd2luZG93LmZsb3dFZGl0b3JVdGlscyA/IA0KICAgICAgICB3aW5kb3cuZmxvd0VkaXRvclV0aWxzLmdldFZpZXdwb3J0Q2VudGVySW5DYW52YXMoKSA6DQogICAgICAgIHsgeDogNTAwMCwgeTogNTAwMCB9OyAvLyBGYWxsYmFjayB0byBjYW52YXMgY2VudGVyDQogICAgDQogICAgLy8gQWRkIHNvbWUgcmFuZG9tIG9mZnNldCBhcm91bmQgdGhlIGNlbnRlcg0KICAgIGNvbnN0IG9mZnNldFggPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMDA7IC8vIC0xMDAgdG8gKzEwMA0KICAgIGNvbnN0IG9mZnNldFkgPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMDA7IC8vIC0xMDAgdG8gKzEwMA0KICAgIA0KICAgIGNvbnN0IG5vZGUgPSB7DQogICAgICAgIGlkOiBub2RlSWQsDQogICAgICAgIHR5cGU6IHR5cGUsDQogICAgICAgIHg6IGNlbnRlci54ICsgb2Zmc2V0WCwNCiAgICAgICAgeTogY2VudGVyLnkgKyBvZmZzZXRZLA0KICAgICAgICBjb25maWc6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobm9kZURlZi5jb25maWcpKSwgLy8gRGVlcCBjb3B5DQogICAgICAgIGRhdGE6IHt9DQogICAgfTsNCiAgICANCiAgICAvLyBJbml0aWFsaXplIHNwZWNpYWwgbm9kZSBzdGF0ZXMNCiAgICBpZiAodHlwZSA9PT0gJ3JlcGVhdGVyJykgew0KICAgICAgICBub2RlLnJlcGVhdGVyU3RhdGUgPSB7DQogICAgICAgICAgICBjb3VudDogMCwNCiAgICAgICAgICAgIGludGVydmFsOiBudWxsLA0KICAgICAgICAgICAgaXNSdW5uaW5nOiBmYWxzZQ0KICAgICAgICB9Ow0KICAgIH0NCiAgICANCiAgICBmbG93RWRpdG9yLm5vZGVzLnNldChub2RlSWQsIG5vZGUpOw0KICAgIA0KICAgIC8vIENyZWF0ZSBub2RlIGVsZW1lbnQgdXNpbmcgdGhlIHJlbmRlcmVyDQogICAgY29uc3Qgbm9kZUVsZW1lbnQgPSBub2RlUmVuZGVyZXIuY3JlYXRlTm9kZUVsZW1lbnQobm9kZSk7DQogICAgZmxvd0VkaXRvci5jYW52YXMuYXBwZW5kQ2hpbGQobm9kZUVsZW1lbnQpOw0KICAgIA0KICAgIC8vIFNlbmQgdXBkYXRlIHZpYSBXZWJTb2NrZXQNCiAgICBpZiAoc3lwbmV4QVBJICYmIHN5cG5leEFQSS5zZW5kTWVzc2FnZSkgew0KICAgICAgICBzeXBuZXhBUEkuc2VuZE1lc3NhZ2UoJ25vZGVfYWRkZWQnLCB7DQogICAgICAgICAgICBub2RlSWQ6IG5vZGVJZCwNCiAgICAgICAgICAgIHR5cGU6IHR5cGUsDQogICAgICAgICAgICBwb3NpdGlvbjogeyB4OiBub2RlLngsIHk6IG5vZGUueSB9DQogICAgICAgIH0sICdmbG93LWVkaXRvcicpOw0KICAgIH0NCiAgICANCn0NCg0KLy8gSGFuZGxlIGZsb3cgdXBkYXRlcyBmcm9tIFdlYlNvY2tldA0KZnVuY3Rpb24gaGFuZGxlRmxvd1VwZGF0ZShkYXRhKSB7DQogICAgLy8gSGFuZGxlIHJlYWwtdGltZSB1cGRhdGVzIGZyb20gb3RoZXIgaW5zdGFuY2VzDQp9DQoNCi8vIEluaXRpYWxpemUgd2hlbiBET00gaXMgcmVhZHkNCmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnbG9hZGluZycpIHsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaW5pdEZsb3dFZGl0b3IpOw0KfSBlbHNlIHsNCiAgICAvLyBET00gaXMgYWxyZWFkeSBsb2FkZWQNCiAgICBpbml0Rmxvd0VkaXRvcigpOw0KfQ0KDQoNCjwvc2NyaXB0Pg=="
  },
  "package_info": {
    "format_version": "1.0",
    "created_at": "2025-07-27T03:31:59.409284",
    "packaged_by": "Sypnex OS App Packager",
    "source_directory": ".\\flow_editor"
  },
  "additional_files": [
    {
      "vfs_path": "/nodes/nodes-pack.json",
      "filename": "nodes-pack.json",
      "data": "ew0KICAidmVyc2lvbiI6ICIxLjAuMCIsDQogICJwYWNrZWRfYXQiOiAiMjAyNS0wNy0yNlQxMjowODo0Ny43MjI4MzEiLA0KICAidG90YWxfbm9kZXMiOiAyMCwNCiAgIm5vZGVzIjogew0KICAgICJhcnJheSI6IHsNCiAgICAgICJpZCI6ICJhcnJheSIsDQogICAgICAibmFtZSI6ICJBcnJheSBPcGVyYXRpb25zIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQcm9jZXNzIGFycmF5cyBhbmQgbGlzdHMgd2l0aCBtYXAsIGZpbHRlciwgYW5kIG90aGVyIG9wZXJhdGlvbnMiLA0KICAgICAgImljb24iOiAiZmFzIGZhLWxpc3QiLA0KICAgICAgImNvbG9yIjogInByaW1hcnkiLA0KICAgICAgImNhdGVnb3J5IjogImRhdGEiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJhcnJheSIsDQogICAgICAgICAgIm5hbWUiOiAiQXJyYXkiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInJlc3VsdCIsDQogICAgICAgICAgIm5hbWUiOiAiUmVzdWx0IiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJsZW5ndGgiLA0KICAgICAgICAgICJuYW1lIjogIkxlbmd0aCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZpcnN0IiwNCiAgICAgICAgICAibmFtZSI6ICJGaXJzdCBJdGVtIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImxhc3QiLA0KICAgICAgICAgICJuYW1lIjogIkxhc3QgSXRlbSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJvcGVyYXRpb24iOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiT3BlcmF0aW9uIiwNCiAgICAgICAgICAidmFsdWUiOiAibWFwIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJtYXAiLA0KICAgICAgICAgICAgImZpbHRlciIsDQogICAgICAgICAgICAibGVuZ3RoIiwNCiAgICAgICAgICAgICJqb2luIiwNCiAgICAgICAgICAgICJmaXJzdCIsDQogICAgICAgICAgICAibGFzdCIsDQogICAgICAgICAgICAic2xpY2UiLA0KICAgICAgICAgICAgInJldmVyc2UiLA0KICAgICAgICAgICAgInNvcnQiLA0KICAgICAgICAgICAgInVuaXF1ZSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJmaWVsZF9wYXRoIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJGaWVsZCBQYXRoIChmb3IgbWFwL2ZpbHRlcikiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJlLmcuLCBuYW1lLCB1c2VyLmVtYWlsLCBpZCINCiAgICAgICAgfSwNCiAgICAgICAgImZpbHRlcl92YWx1ZSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiRmlsdGVyIFZhbHVlIiwNCiAgICAgICAgICAidmFsdWUiOiAiIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiVmFsdWUgdG8gZmlsdGVyIGJ5Ig0KICAgICAgICB9LA0KICAgICAgICAiZmlsdGVyX29wZXJhdG9yIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkZpbHRlciBPcGVyYXRvciIsDQogICAgICAgICAgInZhbHVlIjogImVxdWFscyIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAiZXF1YWxzIiwNCiAgICAgICAgICAgICJub3RfZXF1YWxzIiwNCiAgICAgICAgICAgICJjb250YWlucyIsDQogICAgICAgICAgICAiZ3JlYXRlcl90aGFuIiwNCiAgICAgICAgICAgICJsZXNzX3RoYW4iLA0KICAgICAgICAgICAgInN0YXJ0c193aXRoIiwNCiAgICAgICAgICAgICJlbmRzX3dpdGgiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiam9pbl9zZXBhcmF0b3IiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIkpvaW4gU2VwYXJhdG9yIiwNCiAgICAgICAgICAidmFsdWUiOiAiLCAiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJTZXBhcmF0b3IgZm9yIGpvaW4gb3BlcmF0aW9uIg0KICAgICAgICB9LA0KICAgICAgICAic2xpY2Vfc3RhcnQiOiB7DQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICAgICAibGFiZWwiOiAiU2xpY2UgU3RhcnQiLA0KICAgICAgICAgICJ2YWx1ZSI6IDAsDQogICAgICAgICAgIm1pbiI6IDANCiAgICAgICAgfSwNCiAgICAgICAgInNsaWNlX2VuZCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJTbGljZSBFbmQgKDAgPSBlbmQpIiwNCiAgICAgICAgICAidmFsdWUiOiAwLA0KICAgICAgICAgICJtaW4iOiAwDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAiYXJyYXlfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgImF1ZGlvIjogew0KICAgICAgImlkIjogImF1ZGlvIiwNCiAgICAgICJuYW1lIjogIkF1ZGlvIFBsYXllciIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheSBhdWRpbyBmaWxlcyBhbmQgY29udHJvbCBwbGF5YmFjayIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtdm9sdW1lLXVwIiwNCiAgICAgICJjb2xvciI6ICJ3YXJuaW5nIiwNCiAgICAgICJjYXRlZ29yeSI6ICJtZWRpYSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiZnJvbnRlbmRfb25seSIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYmluYXJ5IiwNCiAgICAgICAgICAibmFtZSI6ICJCaW5hcnkiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJhdWRpb19kYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJBdWRpbyBEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidXJsIiwNCiAgICAgICAgICAibmFtZSI6ICJVUkwiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJpbmFyeSIsDQogICAgICAgICAgIm5hbWUiOiAiQmluYXJ5IiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYXVkaW9fZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiQXVkaW8gRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImF1ZGlvX3VybCIsDQogICAgICAgICAgIm5hbWUiOiAiQXVkaW8gVVJMIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImR1cmF0aW9uIiwNCiAgICAgICAgICAibmFtZSI6ICJEdXJhdGlvbiIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogIm9yaWdpbmFsIiwNCiAgICAgICAgICAibmFtZSI6ICJPcmlnaW5hbCIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImF1dG9QbGF5Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkF1dG8gUGxheSIsDQogICAgICAgICAgInZhbHVlIjogImZhbHNlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJ2b2x1bWUiOiB7DQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICAgICAibGFiZWwiOiAiVm9sdW1lICgwLTEpIiwNCiAgICAgICAgICAidmFsdWUiOiAxLA0KICAgICAgICAgICJtaW4iOiAwLA0KICAgICAgICAgICJtYXgiOiAxLA0KICAgICAgICAgICJzdGVwIjogMC4xDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAiYXVkaW9fZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgImNvbmRpdGlvbiI6IHsNCiAgICAgICJpZCI6ICJjb25kaXRpb24iLA0KICAgICAgIm5hbWUiOiAiQ29uZGl0aW9uIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDb21wYXJlIGlucHV0IHZhbHVlIHRvIGEgY29uZGl0aW9uIGFuZCBvdXRwdXQgdHJ1ZS9mYWxzZSIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtcXVlc3Rpb24tY2lyY2xlIiwNCiAgICAgICJjb2xvciI6ICJ3YXJuaW5nIiwNCiAgICAgICJjYXRlZ29yeSI6ICJsb2dpYyIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInZhbHVlIiwNCiAgICAgICAgICAibmFtZSI6ICJWYWx1ZSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInJlc3VsdCIsDQogICAgICAgICAgIm5hbWUiOiAiUmVzdWx0IiwNCiAgICAgICAgICAidHlwZSI6ICJib29sZWFuIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgIm9wZXJhdG9yIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIk9wZXJhdG9yIiwNCiAgICAgICAgICAidmFsdWUiOiAiZXF1YWxzIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJlcXVhbHMiLA0KICAgICAgICAgICAgIm5vdF9lcXVhbHMiLA0KICAgICAgICAgICAgImdyZWF0ZXJfdGhhbiIsDQogICAgICAgICAgICAibGVzc190aGFuIiwNCiAgICAgICAgICAgICJncmVhdGVyX3RoYW5fb3JfZXF1YWwiLA0KICAgICAgICAgICAgImxlc3NfdGhhbl9vcl9lcXVhbCIsDQogICAgICAgICAgICAiY29udGFpbnMiLA0KICAgICAgICAgICAgIm5vdF9jb250YWlucyIsDQogICAgICAgICAgICAic3RhcnRzX3dpdGgiLA0KICAgICAgICAgICAgImVuZHNfd2l0aCIsDQogICAgICAgICAgICAiaXNfZW1wdHkiLA0KICAgICAgICAgICAgImlzX25vdF9lbXB0eSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJjb21wYXJlX3ZhbHVlIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJDb21wYXJlIFRvIiwNCiAgICAgICAgICAidmFsdWUiOiAiIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiVmFsdWUgdG8gY29tcGFyZSBhZ2FpbnN0Ig0KICAgICAgICB9LA0KICAgICAgICAiY2FzZV9zZW5zaXRpdmUiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiQ2FzZSBTZW5zaXRpdmUiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ0cnVlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAiY29uZGl0aW9uX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJkaXNwbGF5Ijogew0KICAgICAgImlkIjogImRpc3BsYXkiLA0KICAgICAgIm5hbWUiOiAiRGlzcGxheSBUZXh0IiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEaXNwbGF5IHRleHQgZGF0YSBpbiB2YXJpb3VzIGZvcm1hdHMiLA0KICAgICAgImljb24iOiAiZmFzIGZhLWV5ZSIsDQogICAgICAiY29sb3IiOiAic3VjY2VzcyIsDQogICAgICAiY2F0ZWdvcnkiOiAib3V0cHV0IiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJmcm9udGVuZF9vbmx5IiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJUZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImpzb24iLA0KICAgICAgICAgICJuYW1lIjogIkpTT04iLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYmluYXJ5IiwNCiAgICAgICAgICAibmFtZSI6ICJCaW5hcnkiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkaXNwbGF5ZWQiLA0KICAgICAgICAgICJuYW1lIjogIkRpc3BsYXllZCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJpbnB1dF9wb3J0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIklucHV0IFBvcnQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJhdXRvIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJhdXRvIiwNCiAgICAgICAgICAgICJ0ZXh0IiwNCiAgICAgICAgICAgICJqc29uIiwNCiAgICAgICAgICAgICJkYXRhIiwNCiAgICAgICAgICAgICJiaW5hcnkiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiZm9ybWF0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkZvcm1hdCIsDQogICAgICAgICAgInZhbHVlIjogInRleHQiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRleHQiLA0KICAgICAgICAgICAgImpzb24iLA0KICAgICAgICAgICAgImh0bWwiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAibWF4TGVuZ3RoIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIk1heCBMZW5ndGgiLA0KICAgICAgICAgICJ2YWx1ZSI6IDEwMDAsDQogICAgICAgICAgIm1pbiI6IDEsDQogICAgICAgICAgIm1heCI6IDEwMDAwLA0KICAgICAgICAgICJzdGVwIjogMTAwDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAiZGlzcGxheV9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAiZm9yX2VhY2giOiB7DQogICAgICAiaWQiOiAiZm9yX2VhY2giLA0KICAgICAgIm5hbWUiOiAiRm9yIEVhY2giLA0KICAgICAgImRlc2NyaXB0aW9uIjogIkl0ZXJhdGUgdGhyb3VnaCBhbiBhcnJheSBhbmQgZXhlY3V0ZSBjb25uZWN0ZWQgbm9kZXMgZm9yIGVhY2ggaXRlbSIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtcmVwZWF0IiwNCiAgICAgICJjb2xvciI6ICJ3YXJuaW5nIiwNCiAgICAgICJjYXRlZ29yeSI6ICJmbG93IiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJhcnJheSIsDQogICAgICAgICAgIm5hbWUiOiAiQXJyYXkiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJjdXJyZW50X2l0ZW0iLA0KICAgICAgICAgICJuYW1lIjogIkN1cnJlbnQgSXRlbSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJjdXJyZW50X2luZGV4IiwNCiAgICAgICAgICAibmFtZSI6ICJDdXJyZW50IEluZGV4IiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiY29tcGxldGVkIiwNCiAgICAgICAgICAibmFtZSI6ICJDb21wbGV0ZWQiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAic3RvcF9vbl9lcnJvciI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJTdG9wIG9uIEVycm9yIiwNCiAgICAgICAgICAidmFsdWUiOiAidHJ1ZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiaXRlcmF0aW9uX2RlbGF5Ijogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkl0ZXJhdGlvbiBEZWxheSAobXMpIiwNCiAgICAgICAgICAidmFsdWUiOiAwLA0KICAgICAgICAgICJtaW4iOiAwLA0KICAgICAgICAgICJtYXgiOiA2MDAwMCwNCiAgICAgICAgICAic3RlcCI6IDEwMCwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiRGVsYXkgYmV0d2VlbiBpdGVyYXRpb25zIGluIG1pbGxpc2Vjb25kcyINCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJmb3JfZWFjaF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAiaHR0cCI6IHsNCiAgICAgICJpZCI6ICJodHRwIiwNCiAgICAgICJuYW1lIjogIkhUVFAgUmVxdWVzdCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiTWFrZSBIVFRQIHJlcXVlc3RzIHRvIGV4dGVybmFsIEFQSXMgYW5kIHNlcnZpY2VzIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1nbG9iZSIsDQogICAgICAiY29sb3IiOiAicHJpbWFyeSIsDQogICAgICAiY2F0ZWdvcnkiOiAibmV0d29yayIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJqc29uIiwNCiAgICAgICAgICAibmFtZSI6ICJKU09OIiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJpbmFyeSIsDQogICAgICAgICAgIm5hbWUiOiAiQmluYXJ5IiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAic3RhdHVzX2NvZGUiLA0KICAgICAgICAgICJuYW1lIjogIlN0YXR1cyBDb2RlIiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiaGVhZGVycyIsDQogICAgICAgICAgIm5hbWUiOiAiSGVhZGVycyIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ1cmwiLA0KICAgICAgICAgICJuYW1lIjogIlVSTCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJ1cmwiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIlVSTCIsDQogICAgICAgICAgInZhbHVlIjogImh0dHBzOi8vanNvbnBsYWNlaG9sZGVyLnR5cGljb2RlLmNvbS9wb3N0cy8xIg0KICAgICAgICB9LA0KICAgICAgICAibWV0aG9kIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIk1ldGhvZCIsDQogICAgICAgICAgInZhbHVlIjogIkdFVCIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAiR0VUIiwNCiAgICAgICAgICAgICJQT1NUIiwNCiAgICAgICAgICAgICJQVVQiLA0KICAgICAgICAgICAgIkRFTEVURSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJoZWFkZXJzIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHRhcmVhIiwNCiAgICAgICAgICAibGFiZWwiOiAiSGVhZGVycyAoSlNPTikiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ7XCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJ9Ig0KICAgICAgICB9LA0KICAgICAgICAiYm9keSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0YXJlYSIsDQogICAgICAgICAgImxhYmVsIjogIkJvZHkgKEpTT04pIiwNCiAgICAgICAgICAidmFsdWUiOiAie1wibWVzc2FnZVwiOiBcInt7VkFMVUV9fVwiLCBcInRpbWVzdGFtcFwiOiBcInt7SlNPTjp0aW1lc3RhbXB9fVwifSINCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJodHRwX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJpbWFnZSI6IHsNCiAgICAgICJpZCI6ICJpbWFnZSIsDQogICAgICAibmFtZSI6ICJJbWFnZSBEaXNwbGF5IiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEaXNwbGF5IGltYWdlcyBhbmQgY29udHJvbCB2aXN1YWxpemF0aW9uIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1pbWFnZSIsDQogICAgICAiY29sb3IiOiAiaW5mbyIsDQogICAgICAiY2F0ZWdvcnkiOiAibWVkaWEiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImZyb250ZW5kX29ubHkiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJpbmFyeSIsDQogICAgICAgICAgIm5hbWUiOiAiQmluYXJ5IiwNCiAgICAgICAgICAidHlwZSI6ICJiaW5hcnkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiaW1hZ2VfZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiSW1hZ2UgRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInVybCIsDQogICAgICAgICAgIm5hbWUiOiAiVVJMIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJiaW5hcnkiLA0KICAgICAgICAgICJuYW1lIjogIkJpbmFyeSIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImltYWdlX2RhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkltYWdlIERhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJpbWFnZV91cmwiLA0KICAgICAgICAgICJuYW1lIjogIkltYWdlIFVSTCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkaW1lbnNpb25zIiwNCiAgICAgICAgICAibmFtZSI6ICJEaW1lbnNpb25zIiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogIm9yaWdpbmFsIiwNCiAgICAgICAgICAibmFtZSI6ICJPcmlnaW5hbCIsDQogICAgICAgICAgInR5cGUiOiAiYmluYXJ5Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgIm1heF9wcmV2aWV3X3NpemUiOiB7DQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICAgICAibGFiZWwiOiAiTWF4IFByZXZpZXcgU2l6ZSIsDQogICAgICAgICAgInZhbHVlIjogMzAwLA0KICAgICAgICAgICJtaW4iOiA1MCwNCiAgICAgICAgICAibWF4IjogODAwLA0KICAgICAgICAgICJzdGVwIjogNTANCiAgICAgICAgfSwNCiAgICAgICAgInNob3dfaW5mbyI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJTaG93IEluZm8iLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ0cnVlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAiaW1hZ2VfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgImpzb25fZXh0cmFjdCI6IHsNCiAgICAgICJpZCI6ICJqc29uX2V4dHJhY3QiLA0KICAgICAgIm5hbWUiOiAiSlNPTiBFeHRyYWN0IiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJFeHRyYWN0IHZhbHVlcyBmcm9tIEpTT04gZGF0YSB1c2luZyBkb3Qgbm90YXRpb24iLA0KICAgICAgImljb24iOiAiZmFzIGZhLWNvZGUtYnJhbmNoIiwNCiAgICAgICJjb2xvciI6ICJpbmZvIiwNCiAgICAgICJjYXRlZ29yeSI6ICJkYXRhIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJqc29uIiwNCiAgICAgICAgICAibmFtZSI6ICJKU09OIiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAianNvbiIsDQogICAgICAgICAgIm5hbWUiOiAiSlNPTiIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJleHRyYWN0ZWRfdmFsdWUiLA0KICAgICAgICAgICJuYW1lIjogIkV4dHJhY3RlZCBWYWx1ZSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJmaWVsZF9wYXRoIiwNCiAgICAgICAgICAibmFtZSI6ICJGaWVsZCBQYXRoIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogIm9yaWdpbmFsIiwNCiAgICAgICAgICAibmFtZSI6ICJPcmlnaW5hbCIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJmaWVsZF9wYXRoIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJGaWVsZCBQYXRoIiwNCiAgICAgICAgICAidmFsdWUiOiAiZGF0YS5pdGVtcyIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlVzZSBkb3Qgbm90YXRpb24gKGUuZy4sIGRhdGEuaXRlbXMuMC5uYW1lKSINCiAgICAgICAgfSwNCiAgICAgICAgImRpc3BsYXlfZm9ybWF0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkRpc3BsYXkgRm9ybWF0IiwNCiAgICAgICAgICAidmFsdWUiOiAidGV4dCIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidGV4dCIsDQogICAgICAgICAgICAianNvbiINCiAgICAgICAgICBdDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAianNvbl9leHRyYWN0X2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJsbG1fY2hhdCI6IHsNCiAgICAgICJpZCI6ICJsbG1fY2hhdCIsDQogICAgICAibmFtZSI6ICJMTE0gQ2hhdCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiQ2hhdCB3aXRoIExhcmdlIExhbmd1YWdlIE1vZGVscyB1c2luZyBPbGxhbWEiLA0KICAgICAgImljb24iOiAiZmFzIGZhLXJvYm90IiwNCiAgICAgICJjb2xvciI6ICJpbmZvIiwNCiAgICAgICJjYXRlZ29yeSI6ICJhaSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInByb21wdCIsDQogICAgICAgICAgIm5hbWUiOiAiUHJvbXB0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInN5c3RlbV9tZXNzYWdlIiwNCiAgICAgICAgICAibmFtZSI6ICJTeXN0ZW0gTWVzc2FnZSIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJjb250ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJDb250ZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAicmVzcG9uc2UiLA0KICAgICAgICAgICJuYW1lIjogIlJlc3BvbnNlIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRva2Vuc191c2VkIiwNCiAgICAgICAgICAibmFtZSI6ICJUb2tlbnMgVXNlZCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogIm1vZGVsX3VzZWQiLA0KICAgICAgICAgICJuYW1lIjogIk1vZGVsIFVzZWQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZnVsbF9yZXNwb25zZSIsDQogICAgICAgICAgIm5hbWUiOiAiRnVsbCBSZXNwb25zZSIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJlbmRwb2ludCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiT2xsYW1hIEVuZHBvaW50IiwNCiAgICAgICAgICAidmFsdWUiOiAiaHR0cDovLzEyNy4wLjAuMToxMTQzNC92MSIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogImh0dHA6Ly8xMjcuMC4wLjE6MTE0MzQvdjEiDQogICAgICAgIH0sDQogICAgICAgICJtb2RlbCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiTW9kZWwgTmFtZSIsDQogICAgICAgICAgInZhbHVlIjogIkhhbW1lckFJL21uLW1hZy1tZWxsLXIxOmxhdGVzdCIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogImxsYW1hMiwgY29kZWxsYW1hLCBldGMuIg0KICAgICAgICB9LA0KICAgICAgICAidGVtcGVyYXR1cmUiOiB7DQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICAgICAibGFiZWwiOiAiVGVtcGVyYXR1cmUiLA0KICAgICAgICAgICJ2YWx1ZSI6IDAuNywNCiAgICAgICAgICAibWluIjogMCwNCiAgICAgICAgICAibWF4IjogMiwNCiAgICAgICAgICAic3RlcCI6IDAuMQ0KICAgICAgICB9LA0KICAgICAgICAibWF4X3Rva2VucyI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJNYXggVG9rZW5zIiwNCiAgICAgICAgICAidmFsdWUiOiAyMDQ4LA0KICAgICAgICAgICJtaW4iOiAxLA0KICAgICAgICAgICJtYXgiOiA4MTkyLA0KICAgICAgICAgICJzdGVwIjogMQ0KICAgICAgICB9LA0KICAgICAgICAic3lzdGVtX3Byb21wdCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0YXJlYSIsDQogICAgICAgICAgImxhYmVsIjogIlN5c3RlbSBQcm9tcHQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJZb3UgYXJlIGEgaGVscGZ1bCBBSSBhc3Npc3RhbnQuIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiRGVmaW5lIHRoZSBBSSdzIHJvbGUgYW5kIGJlaGF2aW9yIg0KICAgICAgICB9LA0KICAgICAgICAiaW5jbHVkZV9jb250ZXh0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkluY2x1ZGUgQ29udGV4dCIsDQogICAgICAgICAgInZhbHVlIjogInRydWUiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRydWUiLA0KICAgICAgICAgICAgImZhbHNlIg0KICAgICAgICAgIF0NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJsbG1fY2hhdF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAibG9naWNhbF9nYXRlIjogew0KICAgICAgImlkIjogImxvZ2ljYWxfZ2F0ZSIsDQogICAgICAibmFtZSI6ICJMb2dpY2FsIEdhdGUiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIk9ubHkgY29udGludWUgZXhlY3V0aW9uIGlmIGlucHV0IGlzIHRydWUiLA0KICAgICAgImljb24iOiAiZmFzIGZhLWZpbHRlciIsDQogICAgICAiY29sb3IiOiAiaW5mbyIsDQogICAgICAiY2F0ZWdvcnkiOiAibG9naWMiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJjb25kaXRpb24iLA0KICAgICAgICAgICJuYW1lIjogIkNvbmRpdGlvbiIsDQogICAgICAgICAgInR5cGUiOiAiYm9vbGVhbiINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiaW52ZXJ0Ijogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIkludmVydCBMb2dpYyIsDQogICAgICAgICAgInZhbHVlIjogImZhbHNlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJkZXNjcmlwdGlvbiI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiRGVzY3JpcHRpb24iLA0KICAgICAgICAgICJ2YWx1ZSI6ICIiLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJPcHRpb25hbCBkZXNjcmlwdGlvbiBvZiB3aGF0IHRoaXMgZ2F0ZSBkb2VzIg0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogImxvZ2ljYWxfZ2F0ZV9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAibWF0aCI6IHsNCiAgICAgICJpZCI6ICJtYXRoIiwNCiAgICAgICJuYW1lIjogIk1hdGggT3BlcmF0aW9ucyIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiUGVyZm9ybSBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvbiBudW1lcmljIHZhbHVlcyIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtY2FsY3VsYXRvciIsDQogICAgICAiY29sb3IiOiAiaW5mbyIsDQogICAgICAiY2F0ZWdvcnkiOiAiZGF0YSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInZhbHVlX2EiLA0KICAgICAgICAgICJuYW1lIjogIlZhbHVlIEEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidmFsdWVfYiIsDQogICAgICAgICAgIm5hbWUiOiAiVmFsdWUgQiIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJudW1iZXJfYSIsDQogICAgICAgICAgIm5hbWUiOiAiTnVtYmVyIEEiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJudW1iZXJfYiIsDQogICAgICAgICAgIm5hbWUiOiAiTnVtYmVyIEIiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInJlc3VsdCIsDQogICAgICAgICAgIm5hbWUiOiAiUmVzdWx0IiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJUZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZvcm1hdHRlZCIsDQogICAgICAgICAgIm5hbWUiOiAiRm9ybWF0dGVkIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgIm9wZXJhdGlvbiI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJPcGVyYXRpb24iLA0KICAgICAgICAgICJ2YWx1ZSI6ICJhZGQiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgImFkZCIsDQogICAgICAgICAgICAic3VidHJhY3QiLA0KICAgICAgICAgICAgIm11bHRpcGx5IiwNCiAgICAgICAgICAgICJkaXZpZGUiLA0KICAgICAgICAgICAgIm1vZHVsbyIsDQogICAgICAgICAgICAicG93ZXIiLA0KICAgICAgICAgICAgIm1pbiIsDQogICAgICAgICAgICAibWF4IiwNCiAgICAgICAgICAgICJhYnMiLA0KICAgICAgICAgICAgInJvdW5kIiwNCiAgICAgICAgICAgICJmbG9vciIsDQogICAgICAgICAgICAiY2VpbCINCiAgICAgICAgICBdDQogICAgICAgIH0sDQogICAgICAgICJ2YWx1ZV9hIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIlZhbHVlIEEgKGlmIG5vdCBjb25uZWN0ZWQpIiwNCiAgICAgICAgICAidmFsdWUiOiAwLA0KICAgICAgICAgICJzdGVwIjogMC4wMQ0KICAgICAgICB9LA0KICAgICAgICAidmFsdWVfYiI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJWYWx1ZSBCIChpZiBub3QgY29ubmVjdGVkKSIsDQogICAgICAgICAgInZhbHVlIjogMCwNCiAgICAgICAgICAic3RlcCI6IDAuMDENCiAgICAgICAgfSwNCiAgICAgICAgImRlY2ltYWxfcGxhY2VzIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkRlY2ltYWwgUGxhY2VzIiwNCiAgICAgICAgICAidmFsdWUiOiAwLA0KICAgICAgICAgICJtaW4iOiAwLA0KICAgICAgICAgICJtYXgiOiAxMCwNCiAgICAgICAgICAic3RlcCI6IDENCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJtYXRoX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJub2RlX3JlZmVyZW5jZSI6IHsNCiAgICAgICJpZCI6ICJub2RlX3JlZmVyZW5jZSIsDQogICAgICAibmFtZSI6ICJOb2RlIFJlZmVyZW5jZSIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiQWNjZXNzIG91dHB1dCBkYXRhIGZyb20gYW55IHByZXZpb3VzbHkgZXhlY3V0ZWQgbm9kZSBpbiB0aGUgd29ya2Zsb3ciLA0KICAgICAgImljb24iOiAiZmFzIGZhLWxpbmsiLA0KICAgICAgImNvbG9yIjogImluZm8iLA0KICAgICAgImNhdGVnb3J5IjogImRhdGEiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIiwNCiAgICAgICAgICAib3B0aW9uYWwiOiB0cnVlDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRleHQiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAianNvbiIsDQogICAgICAgICAgIm5hbWUiOiAiSlNPTiIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJudW1iZXIiLA0KICAgICAgICAgICJuYW1lIjogIk51bWJlciIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImJvb2xlYW4iLA0KICAgICAgICAgICJuYW1lIjogIkJvb2xlYW4iLA0KICAgICAgICAgICJ0eXBlIjogImJvb2xlYW4iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiYmluYXJ5IiwNCiAgICAgICAgICAibmFtZSI6ICJCaW5hcnkiLA0KICAgICAgICAgICJ0eXBlIjogImJpbmFyeSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJvcmlnaW5hbCIsDQogICAgICAgICAgIm5hbWUiOiAiT3JpZ2luYWwiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAic291cmNlX25vZGVfaWQiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiU291cmNlIE5vZGUiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIiLA0KICAgICAgICAgICJvcHRpb25zIjogW10sDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlNlbGVjdCBhIG5vZGUgdG8gcmVmZXJlbmNlIg0KICAgICAgICB9LA0KICAgICAgICAib3V0cHV0X3BvcnRfaWQiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiT3V0cHV0IFBvcnQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIiLA0KICAgICAgICAgICJvcHRpb25zIjogW10sDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlNlbGVjdCBhbiBvdXRwdXQgcG9ydCINCiAgICAgICAgfSwNCiAgICAgICAgImZhbGxiYWNrX3ZhbHVlIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJGYWxsYmFjayBWYWx1ZSIsDQogICAgICAgICAgInZhbHVlIjogIiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlZhbHVlIHRvIHVzZSBpZiByZWZlcmVuY2UgZmFpbHMiDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAibm9kZV9yZWZlcmVuY2VfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgInJhbmRvbSI6IHsNCiAgICAgICJpZCI6ICJyYW5kb20iLA0KICAgICAgIm5hbWUiOiAiUmFuZG9tIE51bWJlciIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiR2VuZXJhdGUgcmFuZG9tIG51bWJlcnMgd2l0aGluIGEgc3BlY2lmaWVkIHJhbmdlIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1kaWNlIiwNCiAgICAgICJjb2xvciI6ICJ3YXJuaW5nIiwNCiAgICAgICJjYXRlZ29yeSI6ICJkYXRhIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSIsDQogICAgICAgICAgIm9wdGlvbmFsIjogdHJ1ZQ0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAibnVtYmVyIiwNCiAgICAgICAgICAibmFtZSI6ICJOdW1iZXIiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0IiwNCiAgICAgICAgICAibmFtZSI6ICJUZXh0IiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiaW50ZWdlciIsDQogICAgICAgICAgIm5hbWUiOiAiSW50ZWdlciIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZsb2F0IiwNCiAgICAgICAgICAibmFtZSI6ICJGbG9hdCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgIm1pbl92YWx1ZSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJNaW5pbXVtIFZhbHVlIiwNCiAgICAgICAgICAidmFsdWUiOiAwLA0KICAgICAgICAgICJzdGVwIjogMC4wMQ0KICAgICAgICB9LA0KICAgICAgICAibWF4X3ZhbHVlIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIk1heGltdW0gVmFsdWUiLA0KICAgICAgICAgICJ2YWx1ZSI6IDEwMCwNCiAgICAgICAgICAic3RlcCI6IDAuMDENCiAgICAgICAgfSwNCiAgICAgICAgImRlY2ltYWxfcGxhY2VzIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkRlY2ltYWwgUGxhY2VzIiwNCiAgICAgICAgICAidmFsdWUiOiAwLA0KICAgICAgICAgICJtaW4iOiAwLA0KICAgICAgICAgICJtYXgiOiAxMCwNCiAgICAgICAgICAic3RlcCI6IDENCiAgICAgICAgfSwNCiAgICAgICAgIm91dHB1dF90eXBlIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIk91dHB1dCBUeXBlIiwNCiAgICAgICAgICAidmFsdWUiOiAiaW50ZWdlciIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAiaW50ZWdlciIsDQogICAgICAgICAgICAiZmxvYXQiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInJhbmRvbV9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAicmVwZWF0ZXIiOiB7DQogICAgICAiaWQiOiAicmVwZWF0ZXIiLA0KICAgICAgIm5hbWUiOiAiUmVwZWF0ZXIiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIlJlcGVhdCBjb25uZWN0ZWQgd29ya2Zsb3cgYXQgaW50ZXJ2YWxzIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1yZWRvIiwNCiAgICAgICJjb2xvciI6ICJ3YXJuaW5nIiwNCiAgICAgICJjYXRlZ29yeSI6ICJ0cmlnZ2VyIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiY291bnQiLA0KICAgICAgICAgICJuYW1lIjogIkNvdW50IiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAiaW50ZXJ2YWwiOiB7DQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIiwNCiAgICAgICAgICAibGFiZWwiOiAiSW50ZXJ2YWwgKG1zKSIsDQogICAgICAgICAgInZhbHVlIjogMTAwMCwNCiAgICAgICAgICAibWluIjogMTAwLA0KICAgICAgICAgICJtYXgiOiAzMDAwMDAsDQogICAgICAgICAgInN0ZXAiOiAxMDANCiAgICAgICAgfSwNCiAgICAgICAgImNvdW50Ijogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkNvdW50ICgwID0gaW5maW5pdGUpIiwNCiAgICAgICAgICAidmFsdWUiOiAwLA0KICAgICAgICAgICJtaW4iOiAwLA0KICAgICAgICAgICJzdGVwIjogMQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInJlcGVhdGVyX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJzdHJpbmciOiB7DQogICAgICAiaWQiOiAic3RyaW5nIiwNCiAgICAgICJuYW1lIjogIlN0cmluZyBPcGVyYXRpb25zIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJNYW5pcHVsYXRlIGFuZCBwcm9jZXNzIHRleHQgc3RyaW5ncyB3aXRoIHZhcmlvdXMgb3BlcmF0aW9ucyIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtdGV4dC13aWR0aCIsDQogICAgICAiY29sb3IiOiAic2Vjb25kYXJ5IiwNCiAgICAgICJjYXRlZ29yeSI6ICJkYXRhIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0ZXh0X2IiLA0KICAgICAgICAgICJuYW1lIjogIlRleHQgQiIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAicmVzdWx0IiwNCiAgICAgICAgICAibmFtZSI6ICJSZXN1bHQiLA0KICAgICAgICAgICJ0eXBlIjogInRleHQiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJhcnJheSIsDQogICAgICAgICAgIm5hbWUiOiAiQXJyYXkiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAibGVuZ3RoIiwNCiAgICAgICAgICAibmFtZSI6ICJMZW5ndGgiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ3b3JkX2NvdW50IiwNCiAgICAgICAgICAibmFtZSI6ICJXb3JkIENvdW50IiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAiY29uZmlnIjogew0KICAgICAgICAib3BlcmF0aW9uIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIk9wZXJhdGlvbiIsDQogICAgICAgICAgInZhbHVlIjogImNvbmNhdGVuYXRlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJjb25jYXRlbmF0ZSIsDQogICAgICAgICAgICAic3BsaXQiLA0KICAgICAgICAgICAgInJlcGxhY2UiLA0KICAgICAgICAgICAgInRyaW0iLA0KICAgICAgICAgICAgInVwcGVyY2FzZSIsDQogICAgICAgICAgICAibG93ZXJjYXNlIiwNCiAgICAgICAgICAgICJzdWJzdHJpbmciLA0KICAgICAgICAgICAgInJlZ2V4X21hdGNoIiwNCiAgICAgICAgICAgICJyZWdleF9yZXBsYWNlIiwNCiAgICAgICAgICAgICJzdGFydHNfd2l0aCIsDQogICAgICAgICAgICAiZW5kc193aXRoIiwNCiAgICAgICAgICAgICJjb250YWlucyIsDQogICAgICAgICAgICAicmVwZWF0IiwNCiAgICAgICAgICAgICJsYXN0X2xpbmUiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAidGV4dF9iIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJUZXh0IEIgKGlmIG5vdCBjb25uZWN0ZWQpIiwNCiAgICAgICAgICAidmFsdWUiOiAiIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiU2Vjb25kIHRleHQgaW5wdXQiDQogICAgICAgIH0sDQogICAgICAgICJzZXBhcmF0b3IiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIlNlcGFyYXRvci9EZWxpbWl0ZXIiLA0KICAgICAgICAgICJ2YWx1ZSI6ICIsIiwNCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiRm9yIHNwbGl0L2pvaW4gb3BlcmF0aW9ucyINCiAgICAgICAgfSwNCiAgICAgICAgInNlYXJjaF90ZXh0Ijogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJTZWFyY2ggVGV4dCIsDQogICAgICAgICAgInZhbHVlIjogIiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlRleHQgdG8gc2VhcmNoL3JlcGxhY2UiDQogICAgICAgIH0sDQogICAgICAgICJyZXBsYWNlX3RleHQiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dCIsDQogICAgICAgICAgImxhYmVsIjogIlJlcGxhY2UgV2l0aCIsDQogICAgICAgICAgInZhbHVlIjogIiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlJlcGxhY2VtZW50IHRleHQiDQogICAgICAgIH0sDQogICAgICAgICJzdGFydF9pbmRleCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJTdGFydCBJbmRleCIsDQogICAgICAgICAgInZhbHVlIjogMCwNCiAgICAgICAgICAibWluIjogMA0KICAgICAgICB9LA0KICAgICAgICAiZW5kX2luZGV4Ijogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkVuZCBJbmRleCAoMCA9IGVuZCkiLA0KICAgICAgICAgICJ2YWx1ZSI6IDAsDQogICAgICAgICAgIm1pbiI6IDANCiAgICAgICAgfSwNCiAgICAgICAgInJlcGVhdF9jb3VudCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiLA0KICAgICAgICAgICJsYWJlbCI6ICJSZXBlYXQgQ291bnQiLA0KICAgICAgICAgICJ2YWx1ZSI6IDEsDQogICAgICAgICAgIm1pbiI6IDEsDQogICAgICAgICAgIm1heCI6IDEwMA0KICAgICAgICB9LA0KICAgICAgICAiY2FzZV9zZW5zaXRpdmUiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiQ2FzZSBTZW5zaXRpdmUiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJ0cnVlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAic3RyaW5nX2V4ZWN1dG9yIiwNCiAgICAgICJ0ZW1wbGF0ZSI6ICJzdGFuZGFyZCINCiAgICB9LA0KICAgICJ0ZXh0Ijogew0KICAgICAgImlkIjogInRleHQiLA0KICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAiZGVzY3JpcHRpb24iOiAiT3V0cHV0IHN0YXRpYyB0ZXh0IGNvbnRlbnQiLA0KICAgICAgImljb24iOiAiZmFzIGZhLWZvbnQiLA0KICAgICAgImNvbG9yIjogInNlY29uZGFyeSIsDQogICAgICAiY2F0ZWdvcnkiOiAiZGF0YSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidHJpZ2dlciIsDQogICAgICAgICAgIm5hbWUiOiAiVHJpZ2dlciIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAidGV4dCIsDQogICAgICAgICAgIm5hbWUiOiAiVGV4dCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ1cHBlcmNhc2UiLA0KICAgICAgICAgICJuYW1lIjogIlVwcGVyY2FzZSIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJsb3dlcmNhc2UiLA0KICAgICAgICAgICJuYW1lIjogIkxvd2VyY2FzZSIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ3b3JkX2NvdW50IiwNCiAgICAgICAgICAibmFtZSI6ICJXb3JkIENvdW50IiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAibGVuZ3RoIiwNCiAgICAgICAgICAibmFtZSI6ICJMZW5ndGgiLA0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJjb25maWciOiB7DQogICAgICAgICJ0ZXh0X2NvbnRlbnQiOiB7DQogICAgICAgICAgInR5cGUiOiAidGV4dGFyZWEiLA0KICAgICAgICAgICJsYWJlbCI6ICJUZXh0IENvbnRlbnQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJIZWxsbywgV29ybGQhIg0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInRleHRfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgInRpbWVyIjogew0KICAgICAgImlkIjogInRpbWVyIiwNCiAgICAgICJuYW1lIjogIlRpbWVyIiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEZWxheSBleGVjdXRpb24gZm9yIHNwZWNpZmllZCBtaWxsaXNlY29uZHMiLA0KICAgICAgImljb24iOiAiZmFzIGZhLWNsb2NrIiwNCiAgICAgICJjb2xvciI6ICJ3YXJuaW5nIiwNCiAgICAgICJjYXRlZ29yeSI6ICJ0cmlnZ2VyIiwNCiAgICAgICJleGVjdXRpb25fbW9kZSI6ICJib3RoIiwNCiAgICAgICJpbnB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgIm91dHB1dHMiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZGF0YSIsDQogICAgICAgICAgIm5hbWUiOiAiRGF0YSIsDQogICAgICAgICAgInR5cGUiOiAiZGF0YSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRpbWVzdGFtcCIsDQogICAgICAgICAgIm5hbWUiOiAiVGltZXN0YW1wIiwNCiAgICAgICAgICAidHlwZSI6ICJudW1iZXIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZWxhcHNlZCIsDQogICAgICAgICAgIm5hbWUiOiAiRWxhcHNlZCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImludGVydmFsIjogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkludGVydmFsIChtcykiLA0KICAgICAgICAgICJ2YWx1ZSI6IDEwMDAsDQogICAgICAgICAgIm1pbiI6IDEwMCwNCiAgICAgICAgICAibWF4IjogNjAwMDAsDQogICAgICAgICAgInN0ZXAiOiAxMDANCiAgICAgICAgfSwNCiAgICAgICAgImNvdW50Ijogew0KICAgICAgICAgICJ0eXBlIjogIm51bWJlciIsDQogICAgICAgICAgImxhYmVsIjogIkNvdW50IiwNCiAgICAgICAgICAidmFsdWUiOiAxLA0KICAgICAgICAgICJtaW4iOiAxLA0KICAgICAgICAgICJtYXgiOiAxMDAsDQogICAgICAgICAgInN0ZXAiOiAxDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAidGltZXJfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0sDQogICAgInZmc19kaXJlY3RvcnlfbGlzdCI6IHsNCiAgICAgICJpZCI6ICJ2ZnNfZGlyZWN0b3J5X2xpc3QiLA0KICAgICAgIm5hbWUiOiAiVkZTIERpcmVjdG9yeSBMaXN0IiwNCiAgICAgICJkZXNjcmlwdGlvbiI6ICJMaXN0IGFsbCBmaWxlcyBhbmQgZGlyZWN0b3JpZXMgaW4gYSBWRlMgcGF0aCIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtZm9sZGVyLXRyZWUiLA0KICAgICAgImNvbG9yIjogInByaW1hcnkiLA0KICAgICAgImNhdGVnb3J5IjogInN0b3JhZ2UiLA0KICAgICAgImV4ZWN1dGlvbl9tb2RlIjogImJvdGgiLA0KICAgICAgImlucHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJ0cmlnZ2VyIiwNCiAgICAgICAgICAibmFtZSI6ICJUcmlnZ2VyIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRpcmVjdG9yeV9wYXRoIiwNCiAgICAgICAgICAibmFtZSI6ICJEaXJlY3RvcnkgUGF0aCIsDQogICAgICAgICAgInR5cGUiOiAidGV4dCINCiAgICAgICAgfQ0KICAgICAgXSwNCiAgICAgICJvdXRwdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZpbGVfbGlzdCIsDQogICAgICAgICAgIm5hbWUiOiAiRmlsZSBMaXN0IiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZpbGVfcGF0aHMiLA0KICAgICAgICAgICJuYW1lIjogIkZpbGUgUGF0aHMiLA0KICAgICAgICAgICJ0eXBlIjogImpzb24iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiaWQiOiAiZmlsZV9uYW1lcyIsDQogICAgICAgICAgIm5hbWUiOiAiRmlsZSBOYW1lcyIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJjb3VudCIsDQogICAgICAgICAgIm5hbWUiOiAiRmlsZSBDb3VudCIsDQogICAgICAgICAgInR5cGUiOiAibnVtYmVyIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRpcmVjdG9yaWVzIiwNCiAgICAgICAgICAibmFtZSI6ICJEaXJlY3RvcmllcyIsDQogICAgICAgICAgInR5cGUiOiAianNvbiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJmaWxlc19vbmx5IiwNCiAgICAgICAgICAibmFtZSI6ICJGaWxlcyBPbmx5IiwNCiAgICAgICAgICAidHlwZSI6ICJqc29uIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImRpcmVjdG9yeV9wYXRoIjogew0KICAgICAgICAgICJ0eXBlIjogInRleHQiLA0KICAgICAgICAgICJsYWJlbCI6ICJEaXJlY3RvcnkgUGF0aCIsDQogICAgICAgICAgInZhbHVlIjogIi8iLA0KICAgICAgICAgICJwbGFjZWhvbGRlciI6ICIvYWJzb2x1dGUvcGF0aC9pbi92ZnMiDQogICAgICAgIH0sDQogICAgICAgICJmaWx0ZXJfZXh0ZW5zaW9ucyI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiRmlsZSBFeHRlbnNpb25zIEZpbHRlciIsDQogICAgICAgICAgInZhbHVlIjogIiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogInR4dCxqc29uLG1kIChsZWF2ZSBlbXB0eSBmb3IgYWxsKSINCiAgICAgICAgfSwNCiAgICAgICAgImluY2x1ZGVfZGlyZWN0b3JpZXMiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiSW5jbHVkZSBEaXJlY3RvcmllcyIsDQogICAgICAgICAgInZhbHVlIjogInRydWUiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRydWUiLA0KICAgICAgICAgICAgImZhbHNlIg0KICAgICAgICAgIF0NCiAgICAgICAgfSwNCiAgICAgICAgInJlY3Vyc2l2ZSI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJSZWN1cnNpdmUiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJmYWxzZSIsDQogICAgICAgICAgIm9wdGlvbnMiOiBbDQogICAgICAgICAgICAidHJ1ZSIsDQogICAgICAgICAgICAiZmFsc2UiDQogICAgICAgICAgXQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgImV4ZWN1dG9yIjogInZmc19kaXJlY3RvcnlfbGlzdF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAidmZzX2xvYWQiOiB7DQogICAgICAiaWQiOiAidmZzX2xvYWQiLA0KICAgICAgIm5hbWUiOiAiVkZTIExvYWQiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIkxvYWQgZGF0YSBmcm9tIHRoZSBWaXJ0dWFsIEZpbGUgU3lzdGVtIiwNCiAgICAgICJpY29uIjogImZhcyBmYS1mb2xkZXItb3BlbiIsDQogICAgICAiY29sb3IiOiAicHJpbWFyeSIsDQogICAgICAiY2F0ZWdvcnkiOiAic3RvcmFnZSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogInRyaWdnZXIiLA0KICAgICAgICAgICJuYW1lIjogIlRyaWdnZXIiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJkYXRhIiwNCiAgICAgICAgICAibmFtZSI6ICJEYXRhIiwNCiAgICAgICAgICAidHlwZSI6ICJkYXRhIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImZpbGVfcGF0aCIsDQogICAgICAgICAgIm5hbWUiOiAiRmlsZSBQYXRoIiwNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0Ig0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImZpbGVfcGF0aCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiRmlsZSBQYXRoIiwNCiAgICAgICAgICAidmFsdWUiOiAiL215X2RhdGEuanNvbiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIi9hYnNvbHV0ZS9wYXRoL2luL3ZmcyINCiAgICAgICAgfSwNCiAgICAgICAgImZvcm1hdCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJGb3JtYXQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJqc29uIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJqc29uIiwNCiAgICAgICAgICAgICJ0ZXh0IiwNCiAgICAgICAgICAgICJiaW5hcnkiLA0KICAgICAgICAgICAgImJsb2IiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAiYXV0b19yZWxvYWQiOiB7DQogICAgICAgICAgInR5cGUiOiAic2VsZWN0IiwNCiAgICAgICAgICAibGFiZWwiOiAiQXV0byBSZWxvYWQgb24gQ2hhbmdlIiwNCiAgICAgICAgICAidmFsdWUiOiAiZmFsc2UiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRydWUiLA0KICAgICAgICAgICAgImZhbHNlIg0KICAgICAgICAgIF0NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgICJleGVjdXRvciI6ICJ2ZnNfbG9hZF9leGVjdXRvciIsDQogICAgICAidGVtcGxhdGUiOiAic3RhbmRhcmQiDQogICAgfSwNCiAgICAidmZzX3NhdmUiOiB7DQogICAgICAiaWQiOiAidmZzX3NhdmUiLA0KICAgICAgIm5hbWUiOiAiVkZTIFNhdmUiLA0KICAgICAgImRlc2NyaXB0aW9uIjogIlNhdmUgZGF0YSB0byB0aGUgVmlydHVhbCBGaWxlIFN5c3RlbSIsDQogICAgICAiaWNvbiI6ICJmYXMgZmEtc2F2ZSIsDQogICAgICAiY29sb3IiOiAicHJpbWFyeSIsDQogICAgICAiY2F0ZWdvcnkiOiAic3RvcmFnZSIsDQogICAgICAiZXhlY3V0aW9uX21vZGUiOiAiYm90aCIsDQogICAgICAiaW5wdXRzIjogWw0KICAgICAgICB7DQogICAgICAgICAgImlkIjogImRhdGEiLA0KICAgICAgICAgICJuYW1lIjogIkRhdGEiLA0KICAgICAgICAgICJ0eXBlIjogImRhdGEiDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICAib3V0cHV0cyI6IFsNCiAgICAgICAgew0KICAgICAgICAgICJpZCI6ICJzdWNjZXNzIiwNCiAgICAgICAgICAibmFtZSI6ICJTdWNjZXNzIiwNCiAgICAgICAgICAidHlwZSI6ICJib29sZWFuIg0KICAgICAgICB9DQogICAgICBdLA0KICAgICAgImNvbmZpZyI6IHsNCiAgICAgICAgImZpbGVfcGF0aCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwNCiAgICAgICAgICAibGFiZWwiOiAiRmlsZSBQYXRoIiwNCiAgICAgICAgICAidmFsdWUiOiAiL215X2RhdGEuanNvbiIsDQogICAgICAgICAgInBsYWNlaG9sZGVyIjogIi9hYnNvbHV0ZS9wYXRoL2luL3ZmcyINCiAgICAgICAgfSwNCiAgICAgICAgImZvcm1hdCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJGb3JtYXQiLA0KICAgICAgICAgICJ2YWx1ZSI6ICJqc29uIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJqc29uIiwNCiAgICAgICAgICAgICJ0ZXh0IiwNCiAgICAgICAgICAgICJiaW5hcnkiLA0KICAgICAgICAgICAgImJsb2IiDQogICAgICAgICAgXQ0KICAgICAgICB9LA0KICAgICAgICAib3ZlcndyaXRlIjogew0KICAgICAgICAgICJ0eXBlIjogInNlbGVjdCIsDQogICAgICAgICAgImxhYmVsIjogIk92ZXJ3cml0ZSIsDQogICAgICAgICAgInZhbHVlIjogInRydWUiLA0KICAgICAgICAgICJvcHRpb25zIjogWw0KICAgICAgICAgICAgInRydWUiLA0KICAgICAgICAgICAgImZhbHNlIg0KICAgICAgICAgIF0NCiAgICAgICAgfSwNCiAgICAgICAgImFwcGVuZCI6IHsNCiAgICAgICAgICAidHlwZSI6ICJzZWxlY3QiLA0KICAgICAgICAgICJsYWJlbCI6ICJBcHBlbmQgTW9kZSIsDQogICAgICAgICAgInZhbHVlIjogImZhbHNlIiwNCiAgICAgICAgICAib3B0aW9ucyI6IFsNCiAgICAgICAgICAgICJ0cnVlIiwNCiAgICAgICAgICAgICJmYWxzZSINCiAgICAgICAgICBdDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAiZXhlY3V0b3IiOiAidmZzX3NhdmVfZXhlY3V0b3IiLA0KICAgICAgInRlbXBsYXRlIjogInN0YW5kYXJkIg0KICAgIH0NCiAgfQ0KfQ==",
      "size": 37186
    }
  ]
}